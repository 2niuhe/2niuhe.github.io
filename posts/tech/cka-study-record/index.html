<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>CKAå¤‡è€ƒç¬”è®° | Niuhe&#39;s Blog</title>
<meta name="keywords" content="Kubernetes">
<meta name="description" content="è®°å½•ä¸€ä¸‹CKAè€ƒè¯•çš„å¤‡è€ƒè¿‡ç¨‹">
<meta name="author" content="Niuhe">
<link rel="canonical" href="https://blog.niuhemoon.win/posts/tech/cka-study-record/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css" integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe&#43;FVUFzPh7U=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://blog.niuhemoon.win/base/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://blog.niuhemoon.win/base/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="https://blog.niuhemoon.win/base/favicon.ico">
<link rel="apple-touch-icon" href="https://blog.niuhemoon.win/base/avatar.jpeg">
<link rel="mask-icon" href="https://blog.niuhemoon.win/base/avatar.jpeg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-116933089-1', 'auto');
	
	ga('send', 'pageview');
}
</script><meta property="og:title" content="CKAå¤‡è€ƒç¬”è®°" />
<meta property="og:description" content="è®°å½•ä¸€ä¸‹CKAè€ƒè¯•çš„å¤‡è€ƒè¿‡ç¨‹" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.niuhemoon.win/posts/tech/cka-study-record/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-15T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-01-15T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="CKAå¤‡è€ƒç¬”è®°"/>
<meta name="twitter:description" content="è®°å½•ä¸€ä¸‹CKAè€ƒè¯•çš„å¤‡è€ƒè¿‡ç¨‹"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "ğŸ“šæ–‡ç« ",
      "item": "https://blog.niuhemoon.win/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯",
      "item": "https://blog.niuhemoon.win/posts/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "CKAå¤‡è€ƒç¬”è®°",
      "item": "https://blog.niuhemoon.win/posts/tech/cka-study-record/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CKAå¤‡è€ƒç¬”è®°",
  "name": "CKAå¤‡è€ƒç¬”è®°",
  "description": "è®°å½•ä¸€ä¸‹CKAè€ƒè¯•çš„å¤‡è€ƒè¿‡ç¨‹\n",
  "keywords": [
    "Kubernetes"
  ],
  "articleBody": "è®°å½•ä¸€ä¸‹CKAè€ƒè¯•çš„å¤‡è€ƒè¿‡ç¨‹\nCKAè€ƒè¯•å¤‡è€ƒç¬”è®°\nè®°å½•å¤‡è€ƒCKAçš„è¿‡ç¨‹\nå­¦ä¹ K8Sçš„èµ„æºä¸»è¦æœ‰ä¸‰ä¸ªï¼š\nCertified Kubernetes Administrator (CKA) Practice Exam Tests | Udemy kubectl Cheat Sheet | Kubernetes Udemy Labs - Certified Kubernetes Administrator with Practice Tests - KodeKloud å…¶ä¸­kodekloudæä¾›äº†åœ¨çº¿çš„å®éªŒç¯å¢ƒï¼Œæ— éœ€è‡ªå·±æ­å»ºk8sé›†ç¾¤æµ‹è¯•ç¯å¢ƒ æœ€ç»ˆè€ƒäº†94åˆ†ï¼Œé«˜åˆ†é£˜è¿‡\nè€ƒè¯•æŠ€å·§ è€ƒè¯•ç¯å¢ƒæ˜¯ç±»ä¼¼è¿œç¨‹æ¡Œé¢ï¼Œæ˜¯ä¸€ä¸ªè¿œç¨‹çš„ubuntuæ¡Œé¢ï¼Œåªèƒ½åœ¨è¿œç¨‹æ¡Œé¢å†…æ“ä½œï¼Œä¸èƒ½ä½¿ç”¨ä½ è‡ªå·±ç”µè„‘ä¸Šçš„æµè§ˆå™¨ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨è¿œç¨‹æ¡Œé¢é‡Œçš„firefoxæµè§ˆå™¨\næå‰30åˆ†é’Ÿå°±å¯ä»¥è¿›å…¥è€ƒåœºï¼Œå‡ºç¤ºè¯ä»¶å¹¶æ£€æŸ¥ç¯å¢ƒ\nè€ƒè¯•å‘½ä»¤è¡Œå„ç§å¿«æ·é”®å’Œå‘½ä»¤è¡¥å…¨éƒ½å·²ç»é…ç½®å¥½äº†ï¼Œä¸ç”¨æ“å¿ƒ\nå¦‚æœè¦æ±‚æ˜¯å†™shellå‘½ä»¤è¡Œåˆ°æ–‡ä»¶ä¸­ï¼Œä¸èƒ½ç”¨kç¼©å†™ï¼Œå¿…é¡»æ˜¯å®Œæ•´çš„kubeletå‘½ä»¤\nè€ƒè¯•æ—¶å¯ä»¥å¤åˆ¶ç²˜è´´k8så®˜ç½‘çš„å†…å®¹\nä¸€å®šè¦çœ‹çœ‹ç½‘ä¸Šå†å¹´çœŸé¢˜ï¼Œå¹¶å®é™…è”ç³»ï¼Œé¢˜ç›®å‡ ä¹ä¸€æ ·ï¼ˆå¾ˆå…³é”®ï¼‰\næœ€å¥½çœ‹è‹±æ–‡è¯•é¢˜ï¼Œä¸ä¼šå› ä¸ºç¿»è¯‘äº§ç”Ÿè¯¯è§£\næœ€å¥½å‚åŠ ä¸‹Killer Shell - Exam Simulatorsçš„æ¨¡æ‹Ÿè€ƒè¯•ï¼Œæ¨¡æ‹Ÿéš¾åº¦å¾ˆå¤§ï¼Œåˆ†æå­¦ä¹ å®Œä¼šæœ‰æ˜æ˜¾æé«˜\nå¿…å­¦å‘½ä»¤\nvim grepå‘½ä»¤ yamlè¯­æ³• netstatå‘½ä»¤ ipå‘½ä»¤ systemctlå‘½ä»¤ journalctlå‘½ä»¤ ipcalcå‘½ä»¤(å¯é€‰) apt-cache madison apt-get json-path ç¬”è®° æ ¸å¿ƒæ¦‚å¿µ æ ¸å¿ƒæ¦‚å¿µ ä¸€åˆ‡çš†æ˜¯èµ„æº\né€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯ä»¥åˆ—å‡ºapiæ”¯æŒçš„èµ„æº\nkubectl api-resources Short name Full name csr certificatesigningrequests cs componentstatuses cm configmaps ds daemonsets deploy deployments ep endpoints ev events hpa horizontalpodautoscalers ing ingresses limits limitranges ns namespaces no nodes pvc persistentvolumeclaims pv persistentvolumes po pods pdb poddisruptionbudgets psp podsecuritypolicies rs replicasets rc replicationcontrollers quota resourcequotas sa serviceaccounts svc services é€šç”¨å‘½ä»¤ # åˆ—å‡ºapiæ¥å£æ”¯æŒçš„èµ„æº(ä¹ŸåŒ…å«äº†èµ„æºçš„apiVersionoå’Œkindä¿¡æ¯) kubectl api-resources # è§£é‡Šå…·ä½“çš„èµ„æº kubectl explain kubectl explain replicaset kubectl explain rs | head -n3 # åˆ—å‡ºå½“å‰namespaceæ‰€æœ‰èµ„æº kubectl get all Pod # æŸ¥çœ‹æ‰€æœ‰pods kubectl get pods kubectl get pods -o wide # åˆ›å»ºä¸€ä¸ªnginxå®¹å™¨ kubectl run nginx --image=nginx # æŸ¥çœ‹podçš„è¯¦æƒ… kubectl describe pod | less # åˆ é™¤pod kubectl delete pod # æŸ¥æ‰¾ç‰¹å®šlableçš„pods k get pods --selector env=dev,bu=finance åˆ©ç”¨å£°æ˜å¼æ¥å£åˆ›å»ºpod\ndry runæœºåˆ¶ç”Ÿæˆyaml kubectl create -f ä»yamlæ–‡ä»¶ç”Ÿæˆpod controlplane ~ âœ kubectl run redis --image=redis123 --dry-run=client -o yaml \u003e redis-definition.yaml controlplane ~ âœ cat redis-definition.yaml apiVersion: v1 kind: Pod metadata: creationTimestamp: null labels: run: redis name: redis spec: containers: - image: redis123 name: redis resources: {} dnsPolicy: ClusterFirst restartPolicy: Always status: {} controlplane ~ âœ kubectl create -f redis-definition.yaml pod/redis created åˆšæ‰åˆ›å»ºçš„podä¸­imageåå­—redis123æ— æ³•pullé•œåƒï¼Œç°åœ¨è¿›è¡Œä¿®å¤\næ–¹å¼1:\nkubectl edit pod rediså°†specæ®µä¸­çš„redis123ä¿®æ”¹ä¸ºredisï¼Œä¿å­˜å³å¯ç”Ÿæ•ˆ\næ–¹å¼2:\nç›´æ¥ç¼–è¾‘redis-definition.yamlæ–‡ä»¶ï¼Œä¿®æ”¹imageåå\nkubectl apply -f redis-definition.yaml æ–¹å¼3:\nå…ˆè·å–podçš„yaml\nkubectl get pod redis -o yaml \u003e redis-definition.yaml\nç¼–è¾‘ä¿®æ”¹åå†è¿›è¡Œæ›¿æ¢\nkubectl replace -f redis-definition.yaml --force\nä¸€äº›ä¾‹å­\n# åˆ›å»ºå¸¦lableçš„pod kubectl run redis --image=redis:alpine --labels tier=db # ä¸ºpodåˆ›å»ºä¸€ä¸ªservice k expose pod redis --port 6379 --name redis-service # åˆ›å»ºpodå¹¶åˆ¶å®šç«¯å£ k run custom-nginx --image=nginx --port=8080 # åˆ›å»ºpodåŒæ—¶åˆ›å»ºåŒåçš„service k run httpd --image httpd:alpine --port=80 --expose æŸ¥çœ‹/åˆ›å»ºstatic pod\nstatic podç”±kubeletç›´æ¥ç®¡ç†ï¼Œåªèƒ½ä»apiæ¥å£æŸ¥çœ‹ï¼Œæ— æ³•ä»apiç®¡ç†\n# æŸ¥çœ‹å“ªäº›æ˜¯static podï¼Œä»¥-controlplaneç»“å°¾çš„æ˜¯çš„ k get pods --all-namespaces | grep -controlplane # æŸ¥æ‰¾static podçš„yamlé…ç½®è·¯å¾„ # step1: æŸ¥çœ‹kubeletçš„é…ç½®æ–‡ä»¶ï¼ˆå¯åŠ¨æ—¶é€šè¿‡å‘½ä»¤è¡Œä¼ é€’ï¼‰ ps -aux | grep /usr/bin/kubelet # kubeletçš„é…ç½®è·¯å¾„ä¸º/var/lib/kubelet/config.yaml grep -i staticpod /var/lib/kubelet/config.yaml # åˆ›å»ºstatic pod # é¦–å…ˆåˆ›å»ºå®šä¹‰podçš„yamlæ–‡ä»¶ï¼Œç„¶åæ”¾åˆ°/etc/kubernetes/manifestsè·¯å¾„ä¸‹ kubectl run --restart=Never --image=busybox static-busybox --dry-run=client -o yaml --command -- sleep 1000 \u003e /etc/kubernetes/manifests/static-busybox.yaml Replicaset # åˆ—å‡ºreplicasetsèµ„æº kubectl get replicasets kubectl get rs # æŸ¥çœ‹replicasetsæ›´å¤šä¿¡æ¯ kubectl get rs -o wide kubectl describe replicaset # ä»yamlæ–‡ä»¶åˆ›å»ºreplicasets # å‘½ä»¤å¼ï¼šèµ„æºå·²å­˜åœ¨ä¼šæŠ¥é”™ kubectl create -f replicaset-definition.yaml # å£°æ˜å¼ï¼šèµ„æºå·²å­˜åœ¨ä¸ä¼šæŠ¥é”™ï¼Œæ›´é€‚ç”¨äºç‰ˆæœ¬æ›´æ–° kubectl apply -f replicaset-definition.yaml # åˆ é™¤replicasets kubectl delete rs # ä¿®å¤é”™è¯¯çš„replicasets # step1: ä¿®å¤é…ç½® kubectl edit rs # step2: åˆ é™¤ä¹‹å‰æœªæˆåŠŸçš„pods k get po | grep | awk '{print $1}' | xargs -n 1 k delete po # scaleæ‰©å®¹æˆ–ç¼©å®¹ k scale rs --replicas=5 # æˆ–è€…ç›´æ¥k editç¼–è¾‘replicas k edit rs ä¸€äº›ä¾‹å­\nk create deployment webapp --image kodekloud/webapp-color --replicas DaemonSet # è·å–æ‰€æœ‰namespaceä¸­çš„daemonsets k get daemonsets --all-namespaces # æŸ¥çœ‹daemonsetè¯¦æƒ… kubectl describe ds --namespace= # åˆ›å»ºä¸€ä¸ªdaemonsetçš„yaml # step1: å…ˆé€šè¿‡dry runæ–¹å¼åˆ›å»ºä¸€ä¸ªdeploymentçš„yaml # step2: ç¼–è¾‘yamlï¼Œç§»é™¤replicas, strategy and status æ®µ # step3: å°†kindä»Deployment æ”¹ä¸º DaemonSet åˆ›å»ºdaemonsetçš„ä¾‹å­\nk create deployment elasticsearch -n kube-system --image registry.k8s.io/fluentd-elasticsearch:1.20 --dry-run=client -o yaml \u003e daemonset.yaml apiVersion: apps/v1 kind: DaemonSet metadata: creationTimestamp: null labels: app: elasticsearch name: elasticsearch namespace: kube-system spec: selector: matchLabels: app: elasticsearch template: metadata: creationTimestamp: null labels: app: elasticsearch spec: containers: - image: registry.k8s.io/fluentd-elasticsearch:1.20 name: fluentd-elasticsearch resources: {} k apply -f daemonset.yaml Deployment # åˆ—å‡ºdeploymentsèµ„æº kubectl get deployments kubectl get deploy # åˆ›å»ºdeployment # æ–¹å¼1:ç›´æ¥å‘½ä»¤åˆ›å»º kubectl create deployment --image httpd:2.4-alpine --replicas 3 httpd-frontent # æ–¹å¼2:å…ˆdry-runç”Ÿæˆyamlï¼Œç„¶åä¿®æ”¹åå†apply kubectl create deployment --image httpd:2.4-alpine --replicas 3 --dry-run=client httpd-frontent -o yaml \u003e httpd-deployment.yaml kubectl apply -f httpd-deployment.yaml # åˆ é™¤deployment k delete deploy ä¸€äº›ä¾‹å­\n# æŒ‡å®šnamespaceåˆ›å»ºdeployment kubectl create deployment redis-deploy -n dev-ns --image redis --replicas 2 Namespace # åˆ—å‡ºæ‰€æœ‰namespace k get namespaces k get ns # è·å–ç¯å¢ƒä¸­namespaceä¸ªæ•° k get ns --no-headers | wc -l # åˆ—å‡ºç‰¹å®šnamespaceä¸­çš„pods k get pods -n # è·å–æ‰€æœ‰namespaceä¸­çš„pods k get pods --all-namespaces # åœ¨ç‰¹å®šnamespaceä¸­åˆ›å»ºpod k run redis --image=redis -n finance k run redis --image=redis --dry-run=client -n finance -o yaml # åˆ—å‡ºç‰¹å®šnamespaceä¸­çš„service k get service -n # åˆ›å»ºä¸€ä¸ªæ–°çš„namespace k create namespace å¤‡æ³¨ï¼š\nserviceçš„DNSè§£æç­–ç•¥ åŒnamespaceï¼Œå¯ä»¥ç›´æ¥ç”¨serviceçš„åå­— ä¸åŒnamesapceï¼Œéœ€è¦åŠ ä¸Šnamespaceçš„åç¼€ï¼Œä¾‹å¦‚ db-service.dev db-service.dev.svc.cluster.local Service # åˆ—å‡ºæ‰€æœ‰services k get services k get svc # æŸ¥çœ‹ç‰¹å®šserviceè¯¦æƒ… k describe svc # åˆ›å»ºserviceï¼Œä½¿ç”¨ç±»ä¼¼ä¸‹æ°‘çš„yamlåˆ›å»º k apply -f service-definition.yaml --- apiVersion: v1 kind: Service metadata: name: webapp-service namespace: default spec: ports: - nodePort: 30080 port: 8080 targetPort: 8080 selector: name: simple-webapp type: NodePort Node # è·å–é›†ç¾¤ä¸­æ‰€æœ‰nodeçš„ä¿¡æ¯ kubectl get nodes # æŸ¥çœ‹èŠ‚ç‚¹è¯¦æƒ… k describe node è°ƒåº¦éƒ¨åˆ† é€šè¿‡æŒ‡å®šnodeNameæŒ‡å®šèŠ‚ç‚¹éƒ¨ç½²\n--- apiVersion: v1 kind: Pod metadata: name: nginx spec: nodeName: node01 containers: - image: nginx name: nginx Taintå’ŒTolerance\n# ä¸ºèŠ‚ç‚¹node01æ·»åŠ taintï¼Œæ•ˆæœæ˜¯NoSchedule k taint node node01 spary=mortein:NoSchedule # ä¸ºèŠ‚ç‚¹node01ç§»é™¤keyæ˜¯sparyçš„taint k taint node node01 spary- åˆ›å»ºå¯ä»¥å®¹å¿ç‰¹å®štaintçš„pod\n--- apiVersion: v1 kind: Pod metadata: name: bee spec: containers: - image: nginx name: bee tolerations: - key: spray value: mortein effect: NoSchedule operator: Equal Label\n# ä¸ºèŠ‚ç‚¹æ·»åŠ lable color=blue kubectl label node node01 color=blue ä½¿ç”¨labelå®ç°ä¸€ä¸ªdeploymentä¸­çš„podè°ƒåº¦äº²å’Œ\n--- apiVersion: apps/v1 kind: Deployment metadata: name: blue spec: replicas: 3 selector: matchLabels: run: nginx template: metadata: labels: run: nginx spec: containers: - image: nginx imagePullPolicy: Always name: nginx affinity: nodeAffinity: requiredDuringSchedulingIgnoredDuringExecution: nodeSelectorTerms: - matchExpressions: - key: color operator: In values: - blue é‡åˆ°podå®šä¹‰çš„èµ„æºä¸è¶³ä»¥è¿è¡Œ\nkubectl get pod elephant -o yaml \u003e ele.yaml # ç¼–è¾‘èµ„æºrequestå kubectl replace -f ele.yaml --force podé€šè¿‡schedulerNameæŒ‡å®šè°ƒåº¦å™¨\n--- apiVersion: v1 kind: Pod metadata: name: nginx spec: schedulerName: my-scheduler containers: - image: nginx name: nginx åº¦é‡å’Œæ—¥å¿—Metric \u0026 Log Metrics # Metricsåº¦é‡ git clone https://github.com/kodekloudhub/kubernetes-metrics-server.git cd kubernetes-metrics-server/ kubectl create -f . # wait a minute kubectl top node # cpuå ç”¨æœ€é«˜çš„èŠ‚ç‚¹ kubectl top node --sort-by='cpu' --no-headers | head -1 # å†…å­˜å ç”¨æœ€é«˜çš„èŠ‚ç‚¹ kubectl top node --sort-by='memory' --no-headers | head -1 # å†…å­˜å ç”¨æœ€å¤šçš„pod kubectl top pod --sort-by='memory' --no-headers | head -1 # å†…å­˜å ç”¨æœ€å°‘çš„pod kubectl top pod --sort-by='memory' --no-headers | tail -1 Log # æŸ¥çœ‹podæ—¥å¿— kubectl logs # æŒ‡å®špodä¸­å®¹å™¨æŸ¥çœ‹æ—¥å¿—ï¼ˆä¸€ä¸ªpodå¯ä»¥æœ‰å¤šä¸ªcontainerï¼‰ kubectl logs -c # ç™»å…¥podä¸­æŒ‡å®šçš„å®¹å™¨ kubectl exec -it -c -- /bin/bash åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç† æ›´æ–°deploymentç‰ˆæœ¬ # æŸ¥çœ‹deploymentçš„ç­–ç•¥ k describe deploy | grep StrategyType # RollingUpdateæ„å‘³ç€ä¸€æ¬¡åªæ›´æ–°éƒ¨åˆ†pod # Recreateæ„å‘³ç€åŒæ—¶ç»ˆæ­¢podå¹¶é‡æ–°åˆ›å»º k describe deploy | grep RollingUpdateStrategy # 25% max unavailable, 25% max surgeæ„å‘³ç€æœ€å¤šå¯ä»¥åŒæ—¶ç»ˆæ­¢25%çš„pod # æ›´æ–°deploymentçš„é•œåƒ k edit deploy å‘½ä»¤è¡Œ æŒ‡å®šå®¹å™¨å‘½ä»¤è¡Œ\napiVersion: v1 kind: Pod metadata: name: ubuntu-sleeper-2 spec: containers: - name: ubuntu image: ubuntu command: - \"sleep\" - \"5000\" apiVersion: v1 kind: Pod metadata: name: webapp-green labels: name: webapp-green spec: containers: - name: simple-webapp image: kodekloud/webapp-color command: [\"python\", \"app.py\"] args: [\"--color\", \"pink\"] Secret # åˆ—å‡ºsecrets k get secrets # æŸ¥çœ‹secretè¯¦æƒ… k describe secrets # åˆ›å»ºsecretï¼Œåä¸ºdb-secret kubectl create secret generic db-secret --from-literal=DB_Host=sql01 --from-literal=DB_User=root podä½¿ç”¨secret\n--- apiVersion: v1 kind: Pod metadata: labels: name: webapp-pod name: webapp-pod namespace: default spec: containers: - image: kodekloud/simple-webapp-mysql imagePullPolicy: Always name: webapp envFrom: - secretRef: name: db-secret Multi Container apiVersion: v1 kind: Pod metadata: creationTimestamp: null labels: run: yellow name: yellow spec: containers: - image: busybox name: lemon resources: {} command: [\"sleep\", \"1000\"] - image: redis name: gold resources: {} dnsPolicy: ClusterFirst restartPolicy: Always status: {} å¤šå®¹å™¨å…±äº«æ–‡ä»¶ç³»ç»Ÿ\n--- apiVersion: v1 kind: Pod metadata: name: app namespace: elastic-stack labels: name: app spec: containers: - name: app image: kodekloud/event-simulator volumeMounts: - mountPath: /log name: log-volume - name: sidecar image: kodekloud/filebeat-configured volumeMounts: - mountPath: /var/log/event-simulator/ name: log-volume volumes: - name: log-volume hostPath: # directory location on host path: /var/log/webapp # this field is optional type: DirectoryOrCreate Init Container --- apiVersion: v1 kind: Pod metadata: name: red namespace: default spec: containers: - command: - sh - -c - echo The app is running! \u0026\u0026 sleep 3600 image: busybox:1.28 name: red-container initContainers: - image: busybox name: red-initcontainer command: - \"sleep\" - \"20\" Cluster ç»´æŠ¤ å‡çº§OS # å‡çº§node01ï¼Œé¦–å…ˆæ¸…ç©ºnode01ä¸Šçš„pod # æ•ˆæœ pod evicted, node drained # drainä¼šé»˜è®¤å°†node cordonï¼Œå³ä¸å¯è°ƒåº¦ kubectl drain node01 --ignore-daemonsets # node01ç»´æŠ¤å®Œæ¯•åï¼Œå°†node01è®¾ç½®ä¸ºå¯è°ƒåº¦ kubectl uncordon node01 # NOTE: drainåªèƒ½å¤„ç†replicasetï¼Œå•ç‹¬çš„podéœ€è¦å¼ºåˆ¶æ‰§è¡Œ k drain node01 --ignore-daemonsets --force # å¯¹ä¸å±äºreplicasetçš„podï¼Œå°†ä¼šæ°¸ä¹…ä¸¢å¤± # å°†node01è®¾ç½®ä¸å¯è°ƒåº¦ kubectl cordon node01 å‡çº§K8S # æŸ¥çœ‹æ§åˆ¶èŠ‚ç‚¹ç‰ˆæœ¬ k version --short # æŸ¥çœ‹nodeç‰ˆæœ¬ï¼Œå½“å‰1.26 k get nodes # æŸ¥çœ‹è¿œç«¯å¯å‡çº§ç‰ˆæœ¬ kubeadm upgrade plan # æœ‰ä¸¤ä¸ªnodeåˆ†åˆ«æ˜¯controlplaneå’Œnode01 # å…ˆæ¸…ç©ºcontrolplaneçš„pod kubectl drain controlplane --ignore-daemonsets # å¼€å§‹å‡çº§controlplane apt update # é¦–å…ˆå‡çº§kubeadm apt-get install kubeadm=1.27.0-00 kubeadm upgrade apply v1.27.0 # å‡çº§å‘½ä»¤è¡Œ apt-get install kubelet=1.27.0-00 # é‡å¯æœåŠ¡ systemctl daemon-reload systemctl restart kubelet # controlplaneå‡çº§å®Œæ¯•ï¼Œæ ‡è®°ä¸ºå¯è°ƒåº¦ kubectl uncordon controlplane # éœ€è¦è§£é™¤controlplaneçš„taint k drain node01 # æ¥ç€sshç™»å½•åˆ°node01ä¸Šï¼Œå‡çº§node01 apt-get update apt-get install kubeadm=1.27.0-00 kubeadm upgrade node apt-get install kubelet=1.27.0-00 systemctl daemon-reload systemctl restart kubelet # æœ€åè®©node01å¯è°ƒåº¦ kubectl uncordon node01 å¤‡ä»½æ¢å¤ # æŸ¥çœ‹etcdç‰ˆæœ¬ï¼ˆæŸ¥çœ‹æ—¥å¿—æˆ–è€…é•œåƒï¼‰ kubectl -n kube-system logs etcd-controlplane | grep -i 'etcd-version' kubectl -n kube-system describe pod etcd-controlplane | grep Image: # æŸ¥çœ‹etcdçš„endpoint kubectl -n kube-system describe pod etcd-controlplane | grep '\\--listen-client-urls' # æŸ¥çœ‹etcdçš„certæ–‡ä»¶ kubectl -n kube-system describe pod etcd-controlplane | grep '\\--cert-file' # æŸ¥çœ‹etcdçš„ca certæ–‡ä»¶ kubectl -n kube-system describe pod etcd-controlplane | grep '\\--trusted-ca-file' # åœ¨ç»´æŠ¤æˆ–è€…å¯¹ç¯å¢ƒåšæ“ä½œå‰å…ˆå¤‡ä»½etcd ETCDCTL_API=3 etcdctl --endpoints=https://[127.0.0.1]:2379 \\ --cacert=/etc/kubernetes/pki/etcd/ca.crt \\ --cert=/etc/kubernetes/pki/etcd/server.crt \\ --key=/etc/kubernetes/pki/etcd/server.key \\ snapshot save /opt/snapshot-pre-boot.db # åœ¨ç»´æŠ¤çª—å£æœŸé—´ä¸¢å¤±äº†ä¸€äº›podæˆ–deploymentï¼Œéœ€è¦æ¢å¤ # é¦–å…ˆå°†etcdå¿«ç…§æ¢å¤åˆ°ä¸€ä¸ªæ–°çš„ç›®å½• ETCDCTL_API=3 etcdctl --data-dir /var/lib/etcd-from-backup \\ snapshot restore /opt/snapshot-pre-boot.db # ä¿®æ”¹etcdè¿™ä¸ªstaticpodçš„yamlï¼ŒæŒ‡å‘æ¢å¤çš„data-dir vim /etc/kubernetes/manifests/etcd.yaml # ä¿®æ”¹æˆå¦‚ä¸‹ï¼Œå°†etcd-dataè¿™ä¸ªvolumeæŒ‡å‘hostPath: /var/lib/etcd-from-backup # volumes: # - hostPath: # path: /var/lib/etcd-from-backup # type: DirectoryOrCreate # name: etcd-data # æ›´æ–°yamlåï¼Œetcdä¼šè‡ªåŠ¨é‡å»ºï¼Œè‹¥etcdä¸€ç›´PENDINGï¼Œæ‰‹åŠ¨åˆ é™¤è§¦å‘é‡å¯ kubectl delete pod -n kube-system etcd-controlplane å¤šcluster\n# æŸ¥çœ‹clusterä¿¡æ¯ kubectl config view # æˆ–è€… kubectl config get-clusters # æŸ¥çœ‹å½“å‰çš„cluster kubectl config view | grep current-context # åˆ‡æ¢cluster kubectl config use-context cluster2 # Type1: Stacked ETCD Topology # å¦‚ä¸‹å‘½ä»¤å¯ä»¥åœ¨clusterä¸­æŸ¥æ‰¾åˆ°etcdçš„pod kubectl get pods -n kube-system | grep etcd kubectl -n kube-system describe pod etcd-cluster1-controlplane # Type2: External ETCD # clusterå†…æ²¡æœ‰etcdçš„podï¼Œkube-apiserverç›´æ¥æŒ‡å‘ä¸€ä¸ªå¤–éƒ¨çš„etcd endpoint ps -aux | grep etcd # æŸ¥çœ‹ETCDé›†ç¾¤çš„members ETCDCTL_API=3 etcdctl \\ --endpoints=https://127.0.0.1:2379 \\ --cacert=/etc/etcd/pki/ca.pem \\ --cert=/etc/etcd/pki/etcd.pem \\ --key=/etc/etcd/pki/etcd-key.pem \\ member list # å¤‡ä»½Stacked ETCD kubectl config use-context cluster1 kubectl describe pods -n kube-system etcd-cluster1-controlplane | grep advertise-client-urls # --advertise-client-urls=https://10.1.218.16:2379 kubectl describe pods -n kube-system etcd-cluster1-controlplane | grep pki # --cert-file=/etc/kubernetes/pki/etcd/server.crt # --key-file=/etc/kubernetes/pki/etcd/server.key # --peer-cert-file=/etc/kubernetes/pki/etcd/peer.crt # --peer-key-file=/etc/kubernetes/pki/etcd/peer.key # --peer-trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt # --trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt # /etc/kubernetes/pki/etcd from etcd-certs (rw) # Path: /etc/kubernetes/pki/etcd # ç™»å½•åˆ°etcd podæ‰€åœ¨çš„èŠ‚ç‚¹ ETCDCTL_API=3 etcdctl --endpoints=https://10.1.220.8:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key snapshot save /opt/cluster1.db # æ¢å¤External ETCD ETCDCTL_API=3 etcdctl --endpoints=https://127.0.0.1:2379 --cacert=/etc/etcd/pki/ca.pem --cert=/etc/etcd/pki/etcd.pem --key=/etc/etcd/pki/etcd-key.pem snapshot restore /root/cluster2.db --data-dir /var/lib/etcd-data-new systemctl status etcd.service vim /etc/systemd/system/etcd.service systemctl daemon-reload # serviceçš„Useræ˜¯etcdï¼Œä¿®æ”¹æ–‡ä»¶æƒé™ chown -R etcd:etcd /var/lib/etcd-data-new systemctl restart etcd # æ¨èé‡å¯æ§åˆ¶å¹³é¢çš„pod(kube-scheduler, kube-controller-manager, kubelet) å®‰å…¨Security TLSå’Œè¯ä¹¦ä»‹ç» Certificate: Data: Version: 3 (0x2) Serial Number: 3478545236123834268 (0x304646764e49d79c) Signature Algorithm: sha256WithRSAEncryption Issuer: CN = kubernetes Validity Not Before: Dec 1 12:24:30 2023 GMT Not After : Nov 30 12:24:30 2024 GMT Subject: CN = kube-apiserver Subject Public Key Info: Public Key Algorithm: rsaEncryption RSA Public-Key: (2048 bit) Modulus: 00:ce:fc:11:8c:a0:2c:83:2d:20:b2:47:83:dc:38: ec:3f:7f:b5:9a:09:c8:a5:7a:16:7a:c7:2d:1d:62: ae:a6:02:7e:d0:be:6a:c6:fd:71:d3:1a:a8:fd:9b: 4d:11:45:f1:21:aa:20:a1:9d:4e:d7:be:f1:22:25: a9:82:52:87:f8:e5:ce:d5:30:e6:1f:99:a5:13:56: e1:38:e3:68:f5:54:de:67:e1:d1:7e:7a:30:12:6c: 48:fd:d9:89:95:07:2a:51:8e:d8:fa:0c:02:79:54: c4:8f:16:42:b1:f4:a9:0e:ac:83:20:f7:d4:eb:c6: 8f:e2:74:2a:03:c7:2a:b6:d9:c4:ea:28:3c:b8:14: 3f:dd:f0:d9:d9:b2:1f:6c:89:93:0b:37:cd:1b:57: 1c:8e:53:fe:d1:40:f5:80:ee:2d:8d:c6:ce:c2:39: 03:d6:c7:aa:61:cb:b5:8d:5c:d6:73:99:ef:c8:6b: 87:ac:0e:3b:59:bb:ec:e2:c5:04:54:4b:ad:d5:da: 48:16:f5:15:0c:bb:29:fe:13:c7:ed:29:dc:bc:01: b5:ac:dd:84:c9:01:e1:fc:40:1e:8f:c5:4a:82:c5: 69:3a:4a:54:b3:22:c6:4b:61:78:54:59:e9:21:ef: a9:5d:cf:a1:b4:c8:f2:18:4e:6a:03:d3:44:3c:be: 9e:d9 Exponent: 65537 (0x10001) X509v3 extensions: X509v3 Key Usage: critical Digital Signature, Key Encipherment X509v3 Extended Key Usage: TLS Web Server Authentication X509v3 Basic Constraints: critical CA:FALSE X509v3 Authority Key Identifier: keyid:27:89:3A:1C:08:4F:74:4E:60:20:1A:44:E0:47:AC:D6:F9:05:93:E5 X509v3 Subject Alternative Name: DNS:controlplane, DNS:kubernetes, DNS:kubernetes.default, DNS:kubernetes.default.svc, DNS:kubernetes.default.svc.cluster.local, IP Address:10.96.0.1, IP Address:192.21.43.6 Signature Algorithm: sha256WithRSAEncryption 8e:75:b2:8e:47:5c:8f:a1:6c:c8:49:da:ef:e0:09:09:6d:cf: ddğŸ’¿35:f0:e2:df:b2ğŸ‡©ğŸ‡ªb0:f0:8a:0a:4b:4b:32:7e:46:45: 6b:0b:52:7b:8d:ad:17:67:59:fb:7d:68:86:2b:d1:91:7d:99: c8:ff:d2:17:46:a0:92:ae:3c:55:9a:e4:f5:ee:59:48:a5:2a: 93:4d:8d:02:ba:02:73:f6:07:36:2a:5a:99:4a:33:52:ce:36: ea:44:29:19:cb:d1:6f:4a:db:1f:d9:47:7e:8c:e7:2b:6a:7f: 11:43:57:f1:f6:7a:19:c1:b6:ff:81:37:71:3a:f6:14:d5:63: ab:9d:31:f7:bc:4c:0a:19:fb:36:d7:84:f2:1c:fd:c5:fc:8d: 83:b0:8f:ec:1b:9c:ae:57:4f:f1:96:f5:45:f5:c5:4e:8f:a0: ac:04:97:fa:87:2c:0d:5c:83:a9:d8:94:2f:d5:64:8d:ec:13: c6:b4:93:d2:29:f9:87:23:a0:90:7b:68:8c:d6:5c:fd:a3:97: 96:68:a7:e0:2a:22:8b:a9:d4:01:fc:f5:06:39:7f:63:6b:33: 8e:3f:6b:23:18:9c:c8:7c:0f:0c:c1:4c:73:3f:a3:c2:d7:ea: cb:2a:a8:5d:86:a1:0d:4a:5e:12:51:ba:6c:1e:1c:20:75:d6: 5f:62:5f:d3 è¯ä¹¦æŸ¥çœ‹ # æŸ¥çœ‹kube-apiçš„certæ–‡ä»¶ cat /etc/kubernetes/manifests/kube-apiserver.yaml | grep tls-cert-file # æŸ¥çœ‹certfileè¯¦æƒ… openssl x509 -in ./apiserver.crt -text -noout # kube-apiæ•…éšœï¼Œæ’æŸ¥é—®é¢˜ # åˆ—å‡ºæ‰€æœ‰çš„å®¹å™¨ crictl ps -a crictl ps -a | grep kube-api crictl logs CertificateSigningRequest # æœ‰ç­¾åæ–‡ä»¶akshay.csrï¼Œå…ˆbase64ç¼–ç  cat akshay.csr | base64 -w 0 # æŒ‰ç…§å¦‚ä¸‹yamlï¼Œæ‰§è¡Œk applyåˆ›å»ºcsr # æŸ¥çœ‹csrï¼Œåˆšåˆ›å»ºçš„çŠ¶æ€æ˜¯Pending k get certificatesigningrequests k get csr # æˆæƒï¼ŒæˆæƒåçŠ¶æ€æ˜¯Approved,Issued k certificate approve # æ‹’ç» csr kubectl certificate deny # åˆ é™¤csr k delete csr # æŸ¥çœ‹csrè¯¦æƒ… k get csr -o yaml --- apiVersion: certificates.k8s.io/v1 kind: CertificateSigningRequest metadata: name: akshay spec: groups: - system:authenticated request: signerName: kubernetes.io/kube-apiserver-client usages: - client auth Kube Config Client-certificateï¼ˆå®¢æˆ·ç«¯è¯ä¹¦ï¼‰å’Œclient-keyï¼ˆå®¢æˆ·ç«¯å¯†é’¥ï¼‰æ˜¯åœ¨SSL/TLSé€šä¿¡ä¸­ç”¨äºå®¢æˆ·ç«¯èº«ä»½éªŒè¯çš„ä¸¤ä¸ªé‡è¦ç»„ä»¶ã€‚\nå®¢æˆ·ç«¯è¯ä¹¦æ˜¯ä¸€ç§æ•°å­—è¯ä¹¦ï¼Œç”¨äºéªŒè¯å®¢æˆ·ç«¯çš„èº«ä»½ã€‚å®ƒåŒ…å«äº†å®¢æˆ·ç«¯çš„å…¬é’¥ä»¥åŠä¸ä¹‹ç›¸å…³è”çš„èº«ä»½ä¿¡æ¯ï¼Œé€šå¸¸ç”±è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ç­¾å‘ã€‚å®¢æˆ·ç«¯è¯ä¹¦å¯ä»¥è¢«æœåŠ¡å™¨ç”¨æ¥éªŒè¯å®¢æˆ·ç«¯çš„èº«ä»½ï¼Œç¡®ä¿é€šä¿¡åŒæ–¹çš„åˆæ³•æ€§å’Œå®‰å…¨æ€§ã€‚\nå®¢æˆ·ç«¯å¯†é’¥æ˜¯å®¢æˆ·ç«¯è¯ä¹¦ä¸­åŒ…å«çš„ç§é’¥éƒ¨åˆ†ã€‚ç§é’¥æ˜¯ä¸€ç§åŠ å¯†å¯†é’¥ï¼Œç”¨äºå¯¹æ•°æ®è¿›è¡Œç­¾åå’Œè§£å¯†ã€‚å®¢æˆ·ç«¯ä½¿ç”¨ç§é’¥å¯¹æ•°æ®è¿›è¡Œç­¾åï¼ŒæœåŠ¡å™¨ä½¿ç”¨å®¢æˆ·ç«¯è¯ä¹¦ä¸­çš„å…¬é’¥å¯¹ç­¾åè¿›è¡ŒéªŒè¯ï¼Œä»è€Œç¡®è®¤å®¢æˆ·ç«¯çš„èº«ä»½ã€‚\nåœ¨SSL/TLSé€šä¿¡ä¸­ï¼Œå®¢æˆ·ç«¯è¯ä¹¦å’Œå®¢æˆ·ç«¯å¯†é’¥é€šå¸¸ä¸€èµ·ä½¿ç”¨ï¼Œä»¥ç¡®ä¿é€šä¿¡çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ã€‚å®¢æˆ·ç«¯è¯ä¹¦ç”¨äºéªŒè¯å®¢æˆ·ç«¯çš„èº«ä»½ï¼Œå®¢æˆ·ç«¯å¯†é’¥ç”¨äºç”Ÿæˆæ•°å­—ç­¾åä»¥è¿›è¡Œèº«ä»½éªŒè¯å’Œæ•°æ®åŠ å¯†ã€‚\nè¿™ä¸‰ä¸ªæ–‡ä»¶ååç¼€åˆ†åˆ«ä»£è¡¨ä»¥ä¸‹å«ä¹‰ï¼š\n.crtï¼šä»£è¡¨è¯ä¹¦æ–‡ä»¶ï¼ŒåŒ…å«äº†å…¬é’¥å’Œè¯ä¹¦ç›¸å…³ä¿¡æ¯ã€‚ .csrï¼šä»£è¡¨è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶ï¼ŒåŒ…å«äº†å…¬é’¥å’Œä¸€äº›ä¸ªäººä¿¡æ¯ï¼Œç”¨äºå‘è¯ä¹¦é¢å‘æœºæ„ç”³è¯·ç­¾åã€‚ .keyï¼šä»£è¡¨å¯†é’¥æ–‡ä»¶ï¼ŒåŒ…å«äº†ä¸è¯ä¹¦ç›¸å…³çš„ç§é’¥ä¿¡æ¯ã€‚ è¿™ä¸‰ä¸ªæ–‡ä»¶ä¹‹é—´çš„å…³è”æ€§åœ¨äºï¼š\nè¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶ï¼ˆ.csrï¼‰æ˜¯ç”¨æ¥å‘è¯ä¹¦é¢å‘æœºæ„ç”³è¯·ç­¾åçš„ï¼Œå…¶ä¸­åŒ…å«äº†å…¬é’¥å’Œä¸€äº›ä¸ªäººä¿¡æ¯ã€‚ è¯ä¹¦æ–‡ä»¶ï¼ˆ.crtï¼‰æ˜¯ç”±è¯ä¹¦é¢å‘æœºæ„ç­¾ååçš„è¯ä¹¦ï¼ŒåŒ…å«äº†å…¬é’¥å’Œè¯ä¹¦ç›¸å…³ä¿¡æ¯ã€‚ å¯†é’¥æ–‡ä»¶ï¼ˆ.keyï¼‰åŒ…å«äº†ä¸è¯ä¹¦ç›¸å…³çš„ç§é’¥ä¿¡æ¯ï¼Œç”¨äºä¸è¯ä¹¦è¿›è¡Œé…å¯¹ï¼Œä»¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†æ“ä½œã€‚ è¿™ä¸‰ä¸ªæ–‡ä»¶é€šå¸¸ä¸€èµ·ä½¿ç”¨ï¼Œä»¥å»ºç«‹å®‰å…¨çš„é€šä¿¡è¿æ¥å’Œè¿›è¡ŒåŠ å¯†æ“ä½œã€‚\n# configé»˜è®¤æ–‡ä»¶è·¯å¾„ ls ~/.kube/config # æŸ¥çœ‹æ‰€æœ‰cluster k config view # æŒ‡å®šconfigæ–‡ä»¶ kubectl config view --kubeconfig # æŸ¥çœ‹configä¸­çš„current-context kubectl config current-context --kubeconfig # åˆ‡æ¢context kubectl config --kubeconfig= use-context # å°†è‡ªå®šä¹‰çš„configæ–‡ä»¶æ›¿æ¢~/.kube/configæ–‡ä»¶ï¼Œå³å¯è®¾ç½®ä¸ºé»˜è®¤çš„config RBAC # æŸ¥çœ‹kube-apiçš„authorization-mode kubectl describe pod kube-apiserver-controlplane -n kube-system | grep mode # åˆ—å‡ºroles k get roles # åˆ—å‡ºæ‰€æœ‰namespaceçš„roles k get roles.rbac.authorization.k8s.io --all-namespaces --no-headers # æŸ¥çœ‹rolesè¯¦æƒ… k describe roles # åˆ—å‡ºrolebinding k get rolebindings --all-namespaces # æŸ¥çœ‹rolebindingè¯¦æƒ… k describe rolebindings -n kube-system # æŸ¥çœ‹config k config view # æŒ‡å®šconfigä¸­çš„ç”¨æˆ·æ‰§è¡Œkubectlå‘½ä»¤ k get pods --as # ä¸Šè¿°å‘½ä»¤æ‰§è¡ŒæŠ¥é”™ï¼Œç”¨æˆ·æ— æƒé™ï¼Œéœ€è¦åˆ›å»ºroleå’Œrolebinding # åˆ›å»ºä¸€ä¸ªroleï¼Œåä¸ºdeveloper k create role developer --namespace=default --verb=list,create,delete --resource=pod --dry-run=client -o yaml # åˆ›å»ºrolebindingï¼Œå°†deveploerç»‘å®šåˆ°ç”¨æˆ·dev-userä¸Š kubectl create rolebinding dev-user-binding --namespace=default --role=developer --user=dev-user # ç¼–è¾‘roleçš„æƒé™ï¼Œç¼–è¾‘åæ— éœ€é‡æ–°binding k edit role Cluster Role # åˆ—å‡ºclusterrole k get clusterrole # åˆ—å‡ºclusterrolebinding k get clusterrolebindings # æŸ¥çœ‹ç¯å¢ƒä¸­clusteræ•°é‡ k get clusterrole --no-headers | wc -l # æŸ¥çœ‹clusterrolebindingæ•°é‡ k get clusterrolebindings.rbac.authorization.k8s.io --no-headers | wc -l # æŸ¥çœ‹æ‰€æœ‰ä¸namspaceæ— å…³çš„resource k api-resources --namespaced=false # æŸ¥çœ‹clusterroleè¯¦æƒ… k describe clusterrole # æŸ¥çœ‹clusterrolebindingè¯¦æƒ… k describe clusterrolebindings.rbac.authorization.k8s.io # åˆ›å»ºä¸€ä¸ªç®¡ç†nodeçš„clusterrole k create clusterrole nodeadmin --resource=nodes --verb=get,watch,list,create,delete --dry-run=client -o yaml # åˆ›å»ºclusterrolebinding k create clusterrolebinding michella-binding --clusterrole nodeadmin --user=michelle --dry-run=client -o yaml # æµ‹è¯•æ˜¯å¦æœ‰æ‰§è¡Œæƒé™ kubectl auth can-i list nodes --as michelle # éœ€è¦ç»™michelleç”¨æˆ·å¢åŠ æƒé™ï¼Œæ–°å»ºå­˜å‚¨ç›¸å…³çš„clusterroleå’Œbinding k create clusterrole storage-admin --resource=persistentvolumes,storageclasses --verb=get,watch,list,create,delete --dry-run=client -o yaml k create clusterrolebinding michelle-storage-admin --clusterrole=storage-admin --user=michelle --dry-run=client -o yaml Service Account # è·å–æ‰€æœ‰service account k get serviceaccounts k get sa # æŸ¥çœ‹service accountè¯¦æƒ… k describe sa # æŸ¥çœ‹podçš„serviceaccount k get po web-dashboard-97c9c59f6-vmw8g -o yaml | grep -i account # åˆ›å»ºä¸€ä¸ªserviceaccount k create serviceaccount dashboard-sa # ç”¨å¦‚ä¸‹yamlä¸ºserviceaccountåˆ›å»ºroleå’Œrolebindingèµ‹äºˆæƒé™ # ä¸ºdashboard-saè¿™ä¸ªservice accountåˆ›å»ºtoken kubectl create token dashboard-sa # ç¼–è¾‘deploymentçš„serviceaccountï¼ˆé»˜è®¤æ˜¯defaultï¼‰ k edit deployments.apps web-dashboard # æˆ–è€… k set serviceaccount deploy/web-dashboard dashboard-sa --- kind: Role apiVersion: rbac.authorization.k8s.io/v1 metadata: namespace: default name: pod-reader rules: - apiGroups: - '' resources: - pods verbs: - get - watch - list --- kind: RoleBinding apiVersion: rbac.authorization.k8s.io/v1 metadata: name: read-pods namespace: default subjects: - kind: ServiceAccount name: dashboard-sa # Name is case sensitive namespace: default roleRef: kind: Role #this must be Role or ClusterRole name: pod-reader # this must match the name of the Role or ClusterRole you wish to bind to apiGroup: rbac.authorization.k8s.io Image Secret # åº”ç”¨ä½¿ç”¨ç§æœ‰ä»“åº“çš„é•œåƒ k create secret --help # åˆ›å»ºdocker-registryç±»å‹çš„å¯†é’¥ k create secret docker-registry private-reg-cred --docker-username=dock_user --docker-password=dock_passwd --docker-server=myprivateregistry.com:5000 --docker-email=dock_user@myprivateregistry.com apiVersion: apps/v1 kind: Deployment metadata: annotations: deployment.kubernetes.io/revision: \"3\" creationTimestamp: \"2023-12-02T13:18:12Z\" generation: 3 labels: app: web name: web namespace: default resourceVersion: \"2598\" uid: b375109f-b184-4cb1-9a80-425f1a940e3d spec: progressDeadlineSeconds: 600 replicas: 2 revisionHistoryLimit: 10 selector: matchLabels: app: web strategy: rollingUpdate: maxSurge: 25% maxUnavailable: 25% type: RollingUpdate template: metadata: creationTimestamp: null labels: app: web spec: containers: - image: myprivateregistry.com:5000/nginx:alpine imagePullPolicy: IfNotPresent name: nginx resources: {} terminationMessagePath: /dev/termination-log terminationMessagePolicy: File dnsPolicy: ClusterFirst imagePullSecrets: - name: private-reg-cred restartPolicy: Always schedulerName: default-scheduler securityContext: {} terminationGracePeriodSeconds: 30 Security Context # æ‰§è¡ŒwhoamiæŸ¥çœ‹å®¹å™¨å†…éƒ¨çš„æ‰§è¡Œç”¨æˆ· kubectl exec -- whoami # å¼ºåˆ¶åˆ é™¤pod kubectl delete pod --force # æ›´æ–°security contextå¿…é¡»å…ˆåˆ é™¤å†æ–°å»ºpodï¼Œå¯ä»¥ç”¨k replaceå‘½ä»¤ # ç¼–è¾‘å¦‚ä¸‹yamlï¼Œå®¹å™¨å†…ç”¨user ID 1010æ‰§è¡Œsleepå‘½ä»¤ --- apiVersion: v1 kind: Pod metadata: name: ubuntu-sleeper namespace: default spec: securityContext: runAsUser: 1010 containers: - command: - sleep - \"4800\" image: ubuntu name: ubuntu-sleeper securityContext: capabilities: add: [\"SYS_TIME\"] ä¸åŒlevelçš„context\napiVersion: v1 kind: Pod metadata: name: multi-pod spec: securityContext: runAsUser: 1001 containers: - image: ubuntu name: web command: [\"sleep\", \"5000\"] securityContext: runAsUser: 1002 - image: ubuntu name: sidecar command: [\"sleep\", \"5000\"] ç¼–è¾‘å¦‚ä¸‹yamlï¼Œä¸ºå®¹å™¨å¢åŠ SYS_TIMEçš„èƒ½åŠ›\n--- apiVersion: v1 kind: Pod metadata: name: ubuntu-sleeper namespace: default spec: containers: - command: - sleep - \"4800\" image: ubuntu name: ubuntu-sleeper securityContext: capabilities: add: [\"SYS_TIME\"] Network Policy # åˆ—å‡ºnetworkpolicy k get networkpolicies.networking.k8s.io k get netpol # æŸ¥çœ‹netpolè¯¦æƒ… k describe netpol # ä½¿ç”¨netpolä¸­å¯¹åº”çš„selectoræŸ¥è¯¢åº”ç”¨çš„pod k get pods --selector name=payroll # æˆ–è€… k get po --show-labels # åˆ›å»ºnetwork policyä½¿å¾—Internalåªèƒ½è®¿é—®mysqlå’Œpayroll # æ³¨æ„åŒæ—¶æ”¾å¼€äº†53ç«¯å£ï¼Œå› ä¸ºéœ€è¦é€šè¿‡53ç«¯å£è®¿é—®DNS # ä½¿ç”¨å¦‚ä¸‹yamlå®ç° apiVersion: networking.k8s.io/v1 kind: NetworkPolicy metadata: name: internal-policy namespace: default spec: podSelector: matchLabels: name: internal policyTypes: - Egress - Ingress ingress: - {} egress: - to: - podSelector: matchLabels: name: mysql ports: - protocol: TCP port: 3306 - to: - podSelector: matchLabels: name: payroll ports: - protocol: TCP port: 8080 - ports: - port: 53 protocol: UDP - port: 53 protocol: TCP å­˜å‚¨Storage Persistent Volume Claim # æŸ¥çœ‹podå†…çš„æ—¥å¿— kubectl exec -- cat /log/app.log # ä¸ºpodæ·»åŠ æŒä¹…åŒ–çš„æ—¥å¿—å· kubectl get po webapp -o yaml \u003e webapp.yaml # é…ç½®hostpathç±»å‹çš„volume apiVersion: v1 kind: Pod metadata: name: webapp spec: containers: - name: event-simulator image: kodekloud/event-simulator env: - name: LOG_HANDLERS value: file volumeMounts: - mountPath: /log name: log-volume volumes: - name: log-volume hostPath: # directory location on host path: /var/log/webapp # this field is optional type: Directory ç”¨å¦‚ä¸‹yamlåˆ›å»ºPersistent Volume\napiVersion: v1 kind: PersistentVolume metadata: name: pv-log spec: persistentVolumeReclaimPolicy: Retain accessModes: - ReadWriteMany capacity: storage: 100Mi hostPath: path: /pv/log åˆ›å»ºPersistent Volume Claim\nkind: PersistentVolumeClaim apiVersion: v1 metadata: name: claim-log-1 spec: accessModes: - ReadWriteOnce resources: requests: storage: 50Mi # åˆ—å‡ºpersistent volume k get persistentvolume k get pv # åˆ—å‡ºpersistent volume claim k get pvc k get persistentvolumeclaims # åˆ—å‡ºå¤šç§èµ„æº k get pv,pvc # podä¸­ä½¿ç”¨pvc apiVersion: v1 kind: Pod metadata: name: webapp spec: containers: - name: event-simulator image: kodekloud/event-simulator env: - name: LOG_HANDLERS value: file volumeMounts: - mountPath: /log name: log-volume volumes: - name: log-volume persistentVolumeClaim: claimName: claim-log-1 è¢«podä½¿ç”¨ä¸­çš„PVCæ— æ³•ç›´æ¥åˆ é™¤ï¼Œéœ€è¦ç­‰åˆ°podåˆ é™¤åæ‰èƒ½åˆ æ‰PVC\nStorage Class # åˆ—å‡ºstorage class k get storageclasses.storage.k8s.io k get sc # æŸ¥çœ‹scè¯¦æƒ… k describe sc # åˆ›å»ºstorage classï¼Œä½¿ç”¨å¦‚ä¸‹yaml --- apiVersion: storage.k8s.io/v1 kind: StorageClass metadata: name: delayed-volume-sc provisioner: kubernetes.io/no-provisioner volumeBindingMode: WaitForFirstConsumer æ³¨æ„WaitForFirstConsumeæ¨¡å¼çš„storageï¼Œpvcç»‘å®špvæ—¶ï¼Œä¸ä¼šç«‹åˆ»ç”³è¯·å­˜å‚¨ï¼Œè€Œæ˜¯å¤„äºPENDINGçŠ¶æ€ï¼Œç­‰åˆ°ä½¿ç”¨pvcçš„podè¢«è°ƒåº¦æ—¶ï¼Œæ‰ä¼šå®é™…ä¸Šç”³è¯·å­˜å‚¨\nå¦‚ä¸‹ä¸ºä¸€ä¸ªä½¿ç”¨pvcçš„yaml\n--- apiVersion: v1 kind: Pod metadata: name: nginx labels: name: nginx spec: containers: - name: nginx image: nginx:alpine volumeMounts: - name: local-persistent-storage mountPath: /var/www/html volumes: - name: local-persistent-storage persistentVolumeClaim: claimName: local-pvc ç½‘ç»œNetworking ç½‘ç»œåŸºæœ¬å‘½ä»¤ # æŸ¥çœ‹nodeçš„internal ipåœ°å€ k get nodes -o wide # æŸ¥çœ‹ipåœ°å€å¯¹åº”çš„ç½‘å£ ip a | grep # æŸ¥çœ‹ç½‘å£çš„macåœ°å€/çŠ¶æ€ ip link show # æŸ¥çœ‹Containerdåˆ›å»ºçš„ç½‘å£(Container Network Interface) ip link | grep cni # æŸ¥çœ‹è·¯ç”±è¡¨ ip route list # æŸ¥çœ‹é»˜è®¤è·¯ç”± # é»˜è®¤è·¯ç”±ï¼šé»˜è®¤è·¯ç”±æ˜¯æŒ‡å½“ç›®æ ‡ç½‘ç»œä¸åœ¨è·¯ç”±è¡¨ä¸­æ—¶ï¼Œæ•°æ®åŒ…å°†è¢«å‘é€åˆ°çš„é»˜è®¤ç½‘å…³ ip route show default # æŸ¥çœ‹kubeæœåŠ¡ç›‘å¬çš„port netstat -ntpl | grep kube # æŸ¥çœ‹etcdçš„tcpç›‘å¬æœåŠ¡ netstat -ntpl | grep etcd # æŸ¥çœ‹etcdçš„æ‰€æœ‰é“¾æ¥ï¼ˆåŒ…å«clientï¼‰ netstat -anp | grep etcd CNI # æŸ¥çœ‹kubeletçš„container runtime endpoint ps aux | grep kubelet | grep runtime # æŸ¥çœ‹cniçš„æ’ä»¶ ls /opt/cni/bin/ # æŸ¥çœ‹å½“å‰clusteré…ç½®çš„cniæ’ä»¶ ls /etc/cni/net.d/ éƒ¨ç½²weave net # éƒ¨ç½²weave-net k apply -f weave-daemonset-k8s.yaml # serviceaccount/weave-net created # clusterrole.rbac.authorization.k8s.io/weave-net created # clusterrolebinding.rbac.authorization.k8s.io/weave-net created # role.rbac.authorization.k8s.io/weave-net created # rolebinding.rbac.authorization.k8s.io/weave-net created # daemonset.apps/weave-net created apiVersion: v1 kind: List items: - apiVersion: v1 kind: ServiceAccount metadata: name: weave-net labels: name: weave-net namespace: kube-system - apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: weave-net labels: name: weave-net rules: - apiGroups: - '' resources: - pods - namespaces - nodes verbs: - get - list - watch - apiGroups: - extensions resources: - networkpolicies verbs: - get - list - watch - apiGroups: - 'networking.k8s.io' resources: - networkpolicies verbs: - get - list - watch - apiGroups: - '' resources: - nodes/status verbs: - patch - update - apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: weave-net labels: name: weave-net roleRef: kind: ClusterRole name: weave-net apiGroup: rbac.authorization.k8s.io subjects: - kind: ServiceAccount name: weave-net namespace: kube-system - apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: name: weave-net namespace: kube-system labels: name: weave-net rules: - apiGroups: - '' resources: - configmaps resourceNames: - weave-net verbs: - get - update - apiGroups: - '' resources: - configmaps verbs: - create - apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: weave-net namespace: kube-system labels: name: weave-net roleRef: kind: Role name: weave-net apiGroup: rbac.authorization.k8s.io subjects: - kind: ServiceAccount name: weave-net namespace: kube-system - apiVersion: apps/v1 kind: DaemonSet metadata: name: weave-net labels: name: weave-net namespace: kube-system spec: # Wait 5 seconds to let pod connect before rolling next pod selector: matchLabels: name: weave-net minReadySeconds: 5 template: metadata: labels: name: weave-net spec: initContainers: - name: weave-init image: 'weaveworks/weave-kube:2.8.1' command: - /home/weave/init.sh env: securityContext: privileged: true volumeMounts: - name: cni-bin mountPath: /host/opt - name: cni-bin2 mountPath: /host/home - name: cni-conf mountPath: /host/etc - name: lib-modules mountPath: /lib/modules - name: xtables-lock mountPath: /run/xtables.lock readOnly: false containers: - name: weave command: - /home/weave/launch.sh env: - name: IPALLOC_RANGE value: 10.32.1.0/24 - name: INIT_CONTAINER value: \"true\" - name: HOSTNAME valueFrom: fieldRef: apiVersion: v1 fieldPath: spec.nodeName image: 'weaveworks/weave-kube:2.8.1' readinessProbe: httpGet: host: 127.0.0.1 path: /status port: 6784 resources: requests: cpu: 50m securityContext: privileged: true volumeMounts: - name: weavedb mountPath: /weavedb - name: dbus mountPath: /host/var/lib/dbus readOnly: true - mountPath: /host/etc/machine-id name: cni-machine-id readOnly: true - name: xtables-lock mountPath: /run/xtables.lock readOnly: false - name: weave-npc env: - name: HOSTNAME valueFrom: fieldRef: apiVersion: v1 fieldPath: spec.nodeName image: 'weaveworks/weave-npc:2.8.1' #npc-args resources: requests: cpu: 50m securityContext: privileged: true volumeMounts: - name: xtables-lock mountPath: /run/xtables.lock readOnly: false hostNetwork: true dnsPolicy: ClusterFirstWithHostNet hostPID: false restartPolicy: Always securityContext: seLinuxOptions: {} serviceAccountName: weave-net tolerations: - effect: NoSchedule operator: Exists - effect: NoExecute operator: Exists volumes: - name: weavedb hostPath: path: /var/lib/weave - name: cni-bin hostPath: path: /opt - name: cni-bin2 hostPath: path: /home - name: cni-conf hostPath: path: /etc - name: cni-machine-id hostPath: path: /etc/machine-id - name: dbus hostPath: path: /var/lib/dbus - name: lib-modules hostPath: path: /lib/modules - name: xtables-lock hostPath: path: /run/xtables.lock type: FileOrCreate priorityClassName: system-node-critical updateStrategy: type: RollingUpdate # æŸ¥çœ‹weaveçš„agent/peer k get pods --all-namespaces | grep weave # weave podåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šå­˜åœ¨ä¸€ä¸ªï¼ˆåŒ…æ‹¬masterå’Œwork nodeï¼‰ # æŸ¥çœ‹weaveåˆ›å»ºçš„ç½‘å£ ip link | grep weave # æŸ¥çœ‹weaveç½‘å£çš„ipåœ°å€æ®µ ip addr show weave ip route list # æŸ¥çœ‹work nodeä¸Šweave netçš„é»˜è®¤ç½‘å…³ï¼Œé¦–å…ˆç™»å½•åˆ°work node ip route | gre weave Service Networking # æŸ¥çœ‹æ•´ä¸ªclusterçš„ç½‘ç»œèŒƒå›´ ip addr | grep eth0 # 215: eth0@if216: mtu 1450 qdisc noqueue state UP group default # inet 192.4.210.9/24 brd 192.4.210.255 scope global eth0 ipcalc -b 192.4.210.9 # è®¡ç®—çš„clusterçš„åœ°å€èŒƒå›´192.4.210.0/24 # æŸ¥çœ‹clusterä¸­podçš„ç½‘ç»œåœ°å€èŒƒå›´ # è‹¥podä½¿ç”¨weaveç½‘ç»œï¼Œä½¿ç”¨å¦‚ä¸‹æŸ¥è¯¢æ–¹å¼ k logs -n kube-system weave-net-8v8hr | grep ipalloc-range # podåœ°å€èŒƒå›´æ˜¯10.244.0.0/16 # æŸ¥çœ‹serviceçš„ç½‘ç»œåœ°å€èŒƒå›´ cat /etc/kubernetes/manifests/kube-apiserver.yaml | grep cluster-ip-range # --service-cluster-ip-range=10.96.0.0/12 # æŸ¥çœ‹kube-proxyçš„ç±»å‹ k logs -n kube-system CoreDNS # æŸ¥çœ‹clusterçš„DNSè§£å†³æ–¹æ¡ˆ k get pods -n kube-system | grep dns # æŸ¥çœ‹dns service k get service --all-namespaces | grep dns # æŸ¥çœ‹corednsçš„é…ç½®æ–‡ä»¶ k -n kube-system describe deployments.apps coredns | grep -A2 Args # æŸ¥çœ‹Corefileçš„æ³¨å…¥æ–¹å¼ k get po -n kube-system coredns-5d78c9869d-5sxxz -o yaml k describe cm -n kube-system coredns # serviceçš„DNSè§„åˆ™å¦‚ä¸‹ï¼šservice.namespace.svc.cluster.local # web-service.payroll.svc.cluster.local # æŸ¥çœ‹DNSç»“æœ kubectl exec -it hr -- nslookup mysql.payroll \u003e /root/CKA/nslookup.out Ingress # æŸ¥çœ‹ingress kubectl get all -A | grep -i ingress k get ingress -A # æŸ¥çœ‹ingressè¯¦æƒ… kubectl describe ingress # ç¼–è¾‘ingressä¿®æ”¹rules kubectl edit ingress # åˆ›å»ºingressï¼Œæ³¨æ„å¦‚ä¸‹å‘½ä»¤ç¼ºå°‘annotationï¼Œåˆ›å»ºçš„yamlæ·»åŠ annotationæ‰èƒ½æ­£å¸¸å·¥ä½œ # pathType: Exact k create ingress -n critical-space test-ingress --rule=/pay=pay-service:8282 --dry-run=client -o yaml # pathType: Prefix k create ingress -n critical-space test-ingress --rule=/pay*=pay-service:8282 --dry-run=client -o yaml apiVersion: networking.k8s.io/v1 kind: Ingress metadata: annotations: nginx.ingress.kubernetes.io/rewrite-target: / nginx.ingress.kubernetes.io/ssl-redirect: \"false\" name: ingress-wear-watch namespace: app-space spec: rules: - http: paths: - backend: service: name: wear-service port: number: 8080 path: /wear pathType: Prefix - backend: service: name: video-service port: number: 8080 path: /stream pathType: Prefix å¦‚ä¸‹ä¸ºclusteråˆ›å»ºingress controller\n# åˆ›å»ºingressç‹¬ç«‹çš„namespace(ä¾¿äºéš”ç¦») k create namespace ingress-nginx # åˆ›å»ºconfigmap kubectl create configmap ingress-nginx-controller --namespace ingress-nginx # åˆ›å»ºservice account k create sa ingress-nginx -n ingress-nginx k create sa ingress-nginx-admission -n ingress-nginx # åˆ›å»ºroleï¼Œrolebindingï¼Œclusterroleï¼Œclusterrolebinding # ç•¥ # ingress controller çš„yamlå¦‚ä¸‹ apiVersion: apps/v1 kind: Deployment metadata: labels: app.kubernetes.io/component: controller app.kubernetes.io/instance: ingress-nginx app.kubernetes.io/managed-by: Helm app.kubernetes.io/name: ingress-nginx app.kubernetes.io/part-of: ingress-nginx app.kubernetes.io/version: 1.1.2 helm.sh/chart: ingress-nginx-4.0.18 name: ingress-nginx-controller namespace: ingress-nginx spec: replicas: 1 minReadySeconds: 0 revisionHistoryLimit: 10 selector: matchLabels: app.kubernetes.io/component: controller app.kubernetes.io/instance: ingress-nginx app.kubernetes.io/name: ingress-nginx template: metadata: labels: app.kubernetes.io/component: controller app.kubernetes.io/instance: ingress-nginx app.kubernetes.io/name: ingress-nginx spec: containers: - args: - /nginx-ingress-controller - --publish-service=$(POD_NAMESPACE)/ingress-nginx-controller - --election-id=ingress-controller-leader - --watch-ingress-without-class=true - --default-backend-service=app-space/default-http-backend - --controller-class=k8s.io/ingress-nginx - --ingress-class=nginx - --configmap=$(POD_NAMESPACE)/ingress-nginx-controller - --validating-webhook=:8443 - --validating-webhook-certificate=/usr/local/certificates/cert - --validating-webhook-key=/usr/local/certificates/key env: - name: POD_NAME valueFrom: fieldRef: fieldPath: metadata.name - name: POD_NAMESPACE valueFrom: fieldRef: fieldPath: metadata.namespace - name: LD_PRELOAD value: /usr/local/lib/libmimalloc.so image: registry.k8s.io/ingress-nginx/controller:v1.1.2@sha256:28b11ce69e57843de44e3db6413e98d09de0f6688e33d4bd384002a44f78405c imagePullPolicy: IfNotPresent lifecycle: preStop: exec: command: - /wait-shutdown livenessProbe: failureThreshold: 5 httpGet: path: /healthz port: 10254 scheme: HTTP initialDelaySeconds: 10 periodSeconds: 10 successThreshold: 1 timeoutSeconds: 1 name: controller ports: - name: http containerPort: 80 protocol: TCP - containerPort: 443 name: https protocol: TCP - containerPort: 8443 name: webhook protocol: TCP readinessProbe: failureThreshold: 3 httpGet: path: /healthz port: 10254 scheme: HTTP initialDelaySeconds: 10 periodSeconds: 10 successThreshold: 1 timeoutSeconds: 1 resources: requests: cpu: 100m memory: 90Mi securityContext: allowPrivilegeEscalation: true capabilities: add: - NET_BIND_SERVICE drop: - ALL runAsUser: 101 volumeMounts: - mountPath: /usr/local/certificates/ name: webhook-cert readOnly: true dnsPolicy: ClusterFirst nodeSelector: kubernetes.io/os: linux serviceAccountName: ingress-nginx terminationGracePeriodSeconds: 300 volumes: - name: webhook-cert secret: secretName: ingress-nginx-admission --- apiVersion: v1 kind: Service metadata: creationTimestamp: null labels: app.kubernetes.io/component: controller app.kubernetes.io/instance: ingress-nginx app.kubernetes.io/managed-by: Helm app.kubernetes.io/name: ingress-nginx app.kubernetes.io/part-of: ingress-nginx app.kubernetes.io/version: 1.1.2 helm.sh/chart: ingress-nginx-4.0.18 name: ingress-nginx-controller namespace: ingress-nginx spec: ports: - port: 80 protocol: TCP targetPort: 80 nodePort: 30080 selector: app.kubernetes.io/component: controller app.kubernetes.io/instance: ingress-nginx app.kubernetes.io/name: ingress-nginx type: NodePort # æ¥ç€åˆ›å»ºingressï¼Œingressèµ„æºæ˜¯åœ¨namespaceèŒƒå›´ä¸‹çš„ï¼Œæ‰€ä»¥ingressè¦å’ŒserviceåŒä¸€ä¸ªnamespace k create ingress -n app-space --rule /wear*=wear-service:8080 --rule /watch*=video-service:8080 --annotation nginx.ingress.kubernetes.io/rewrite-target=/ --annotation nginx.ingress.kubernetes.io/ssl-redirect=false test-ingress --dry-run=client -o yaml apiVersion: networking.k8s.io/v1 kind: Ingress metadata: annotations: nginx.ingress.kubernetes.io/rewrite-target: / nginx.ingress.kubernetes.io/ssl-redirect: \"false\" creationTimestamp: null name: test-ingress namespace: app-space spec: rules: - http: paths: - backend: service: name: wear-service port: number: 8080 path: /wear pathType: Prefix - backend: service: name: video-service port: number: 8080 path: /watch pathType: Prefix status: loadBalancer: {} éƒ¨ç½²K8S # åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œå¦‚ä¸‹å®‰è£…æ“ä½œ # step1: ä¿®æ”¹ç½‘ç»œç­–ç•¥ cat \u003c",
  "wordCount" : "10926",
  "inLanguage": "zh",
  "datePublished": "2024-01-15T00:00:00Z",
  "dateModified": "2024-01-15T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Niuhe"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://blog.niuhemoon.win/posts/tech/cka-study-record/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Niuhe's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://blog.niuhemoon.win/base/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://blog.niuhemoon.win" accesskey="h" title="Niuhe&#39;s Blog (Alt + H)">
                <img src="https://blog.niuhemoon.win/base/avatar.jpeg" alt="" aria-label="logo"
                    height="35">Niuhe&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://blog.niuhemoon.win/search" title="ğŸ”æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://blog.niuhemoon.win/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://blog.niuhemoon.win/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://blog.niuhemoon.win/tags" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://blog.niuhemoon.win/archives/" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://blog.niuhemoon.win/about" title="ğŸ™‹ğŸ»â€â™‚ï¸å…³äº">
                    <span>ğŸ™‹ğŸ»â€â™‚ï¸å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://blog.niuhemoon.win">ğŸ ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://blog.niuhemoon.win/posts/">ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href="https://blog.niuhemoon.win/posts/tech/">ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯</a></div>
    <h1 class="post-title">
      CKAå¤‡è€ƒç¬”è®°
    </h1>
    <div class="post-meta"><span title='2024-01-15 00:00:00 +0000 UTC'>2024-01-15</span>&nbsp;Â·&nbsp;22 min&nbsp;Â·&nbsp;10926 å­—&nbsp;Â·&nbsp;Niuhe

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">æ–‡ç« ç›®å½•</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e8%80%83%e8%af%95%e6%8a%80%e5%b7%a7" aria-label="è€ƒè¯•æŠ€å·§">è€ƒè¯•æŠ€å·§</a></li>
                <li>
                    <a href="#%e7%ac%94%e8%ae%b0" aria-label="ç¬”è®°">ç¬”è®°</a><ul>
                        
                <li>
                    <a href="#%e6%a0%b8%e5%bf%83%e6%a6%82%e5%bf%b5" aria-label="æ ¸å¿ƒæ¦‚å¿µ">æ ¸å¿ƒæ¦‚å¿µ</a><ul>
                        
                <li>
                    <a href="#%e6%a0%b8%e5%bf%83%e6%a6%82%e5%bf%b5-1" aria-label="æ ¸å¿ƒæ¦‚å¿µ">æ ¸å¿ƒæ¦‚å¿µ</a></li>
                <li>
                    <a href="#%e9%80%9a%e7%94%a8%e5%91%bd%e4%bb%a4" aria-label="é€šç”¨å‘½ä»¤">é€šç”¨å‘½ä»¤</a></li>
                <li>
                    <a href="#pod" aria-label="Pod">Pod</a></li>
                <li>
                    <a href="#replicaset" aria-label="Replicaset">Replicaset</a></li>
                <li>
                    <a href="#daemonset" aria-label="DaemonSet">DaemonSet</a></li>
                <li>
                    <a href="#deployment" aria-label="Deployment">Deployment</a></li>
                <li>
                    <a href="#namespace" aria-label="Namespace">Namespace</a></li>
                <li>
                    <a href="#service" aria-label="Service">Service</a></li>
                <li>
                    <a href="#node" aria-label="Node">Node</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%b0%83%e5%ba%a6%e9%83%a8%e5%88%86" aria-label="è°ƒåº¦éƒ¨åˆ†">è°ƒåº¦éƒ¨åˆ†</a></li>
                <li>
                    <a href="#%e5%ba%a6%e9%87%8f%e5%92%8c%e6%97%a5%e5%bf%97metric--log" aria-label="åº¦é‡å’Œæ—¥å¿—Metric &amp;amp; Log">åº¦é‡å’Œæ—¥å¿—Metric &amp; Log</a><ul>
                        
                <li>
                    <a href="#metrics" aria-label="Metrics">Metrics</a></li>
                <li>
                    <a href="#log" aria-label="Log">Log</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ba%94%e7%94%a8%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e7%ae%a1%e7%90%86" aria-label="åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†">åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†</a><ul>
                        
                <li>
                    <a href="#%e6%9b%b4%e6%96%b0deployment%e7%89%88%e6%9c%ac" aria-label="æ›´æ–°deploymentç‰ˆæœ¬">æ›´æ–°deploymentç‰ˆæœ¬</a></li>
                <li>
                    <a href="#%e5%91%bd%e4%bb%a4%e8%a1%8c" aria-label="å‘½ä»¤è¡Œ">å‘½ä»¤è¡Œ</a></li>
                <li>
                    <a href="#secret" aria-label="Secret">Secret</a></li>
                <li>
                    <a href="#multi-container" aria-label="Multi Container">Multi Container</a></li>
                <li>
                    <a href="#init-container" aria-label="Init Container">Init Container</a></li></ul>
                </li>
                <li>
                    <a href="#cluster-%e7%bb%b4%e6%8a%a4" aria-label="Cluster ç»´æŠ¤">Cluster ç»´æŠ¤</a><ul>
                        
                <li>
                    <a href="#%e5%8d%87%e7%ba%a7os" aria-label="å‡çº§OS">å‡çº§OS</a></li>
                <li>
                    <a href="#%e5%8d%87%e7%ba%a7k8s" aria-label="å‡çº§K8S">å‡çº§K8S</a></li>
                <li>
                    <a href="#%e5%a4%87%e4%bb%bd%e6%81%a2%e5%a4%8d" aria-label="å¤‡ä»½æ¢å¤">å¤‡ä»½æ¢å¤</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ae%89%e5%85%a8security" aria-label="å®‰å…¨Security">å®‰å…¨Security</a><ul>
                        
                <li>
                    <a href="#tls%e5%92%8c%e8%af%81%e4%b9%a6%e4%bb%8b%e7%bb%8d" aria-label="TLSå’Œè¯ä¹¦ä»‹ç»">TLSå’Œè¯ä¹¦ä»‹ç»</a></li>
                <li>
                    <a href="#%e8%af%81%e4%b9%a6%e6%9f%a5%e7%9c%8b" aria-label="è¯ä¹¦æŸ¥çœ‹">è¯ä¹¦æŸ¥çœ‹</a></li>
                <li>
                    <a href="#certificatesigningrequest" aria-label="CertificateSigningRequest">CertificateSigningRequest</a></li>
                <li>
                    <a href="#kube-config" aria-label="Kube Config">Kube Config</a></li>
                <li>
                    <a href="#rbac" aria-label="RBAC">RBAC</a></li>
                <li>
                    <a href="#cluster-role" aria-label="Cluster Role">Cluster Role</a></li>
                <li>
                    <a href="#service-account" aria-label="Service Account">Service Account</a></li>
                <li>
                    <a href="#image-secret" aria-label="Image Secret">Image Secret</a></li>
                <li>
                    <a href="#security-context" aria-label="Security Context">Security Context</a></li>
                <li>
                    <a href="#network-policy" aria-label="Network Policy">Network Policy</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ad%98%e5%82%a8storage" aria-label="å­˜å‚¨Storage">å­˜å‚¨Storage</a><ul>
                        
                <li>
                    <a href="#persistent-volume-claim" aria-label="Persistent Volume Claim">Persistent Volume Claim</a></li>
                <li>
                    <a href="#storage-class" aria-label="Storage Class">Storage Class</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%bd%91%e7%bb%9cnetworking" aria-label="ç½‘ç»œNetworking">ç½‘ç»œNetworking</a><ul>
                        
                <li>
                    <a href="#%e7%bd%91%e7%bb%9c%e5%9f%ba%e6%9c%ac%e5%91%bd%e4%bb%a4" aria-label="ç½‘ç»œåŸºæœ¬å‘½ä»¤">ç½‘ç»œåŸºæœ¬å‘½ä»¤</a></li>
                <li>
                    <a href="#cni" aria-label="CNI">CNI</a></li>
                <li>
                    <a href="#%e9%83%a8%e7%bd%b2weave-net" aria-label="éƒ¨ç½²weave net">éƒ¨ç½²weave net</a></li>
                <li>
                    <a href="#service-networking" aria-label="Service Networking">Service Networking</a></li>
                <li>
                    <a href="#coredns" aria-label="CoreDNS">CoreDNS</a></li>
                <li>
                    <a href="#ingress" aria-label="Ingress">Ingress</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%83%a8%e7%bd%b2k8s" aria-label="éƒ¨ç½²K8S">éƒ¨ç½²K8S</a></li>
                <li>
                    <a href="#trouble-shooting" aria-label="Trouble Shooting">Trouble Shooting</a></li>
                <li>
                    <a href="#lighting-lab" aria-label="Lighting Lab">Lighting Lab</a><ul>
                        
                <li>
                    <a href="#%e5%8f%82%e8%80%83" aria-label="å‚è€ƒ">å‚è€ƒ</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>è®°å½•ä¸€ä¸‹CKAè€ƒè¯•çš„å¤‡è€ƒè¿‡ç¨‹</p>
<p>CKAè€ƒè¯•å¤‡è€ƒç¬”è®°</p>
<blockquote>
<p>è®°å½•å¤‡è€ƒCKAçš„è¿‡ç¨‹</p>
<p>å­¦ä¹ K8Sçš„èµ„æºä¸»è¦æœ‰ä¸‰ä¸ªï¼š</p>
<ul>
<li><a href="https://www.udemy.com/course/certified-kubernetes-administrator-with-practice-tests/">Certified Kubernetes Administrator (CKA) Practice Exam Tests | Udemy</a></li>
<li><a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/">kubectl Cheat Sheet | Kubernetes</a></li>
<li><a href="https://kodekloud.com/courses/labs-certified-kubernetes-administrator-with-practice-tests/">Udemy Labs - Certified Kubernetes Administrator with Practice Tests - KodeKloud</a></li>
</ul>
<p>å…¶ä¸­kodekloudæä¾›äº†åœ¨çº¿çš„å®éªŒç¯å¢ƒï¼Œæ— éœ€è‡ªå·±æ­å»ºk8sé›†ç¾¤æµ‹è¯•ç¯å¢ƒ
æœ€ç»ˆè€ƒäº†94åˆ†ï¼Œé«˜åˆ†é£˜è¿‡</p>
</blockquote>
<h1 id="è€ƒè¯•æŠ€å·§">è€ƒè¯•æŠ€å·§<a hidden class="anchor" aria-hidden="true" href="#è€ƒè¯•æŠ€å·§">#</a></h1>
<ul>
<li>
<p>è€ƒè¯•ç¯å¢ƒæ˜¯ç±»ä¼¼è¿œç¨‹æ¡Œé¢ï¼Œæ˜¯ä¸€ä¸ªè¿œç¨‹çš„ubuntuæ¡Œé¢ï¼Œåªèƒ½åœ¨è¿œç¨‹æ¡Œé¢å†…æ“ä½œï¼Œä¸èƒ½ä½¿ç”¨ä½ è‡ªå·±ç”µè„‘ä¸Šçš„æµè§ˆå™¨ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨è¿œç¨‹æ¡Œé¢é‡Œçš„firefoxæµè§ˆå™¨</p>
</li>
<li>
<p>æå‰30åˆ†é’Ÿå°±å¯ä»¥è¿›å…¥è€ƒåœºï¼Œå‡ºç¤ºè¯ä»¶å¹¶æ£€æŸ¥ç¯å¢ƒ</p>
</li>
<li>
<p>è€ƒè¯•å‘½ä»¤è¡Œå„ç§å¿«æ·é”®å’Œå‘½ä»¤è¡¥å…¨éƒ½å·²ç»é…ç½®å¥½äº†ï¼Œä¸ç”¨æ“å¿ƒ</p>
</li>
<li>
<p>å¦‚æœè¦æ±‚æ˜¯å†™shellå‘½ä»¤è¡Œåˆ°æ–‡ä»¶ä¸­ï¼Œä¸èƒ½ç”¨kç¼©å†™ï¼Œå¿…é¡»æ˜¯å®Œæ•´çš„kubeletå‘½ä»¤</p>
</li>
<li>
<p>è€ƒè¯•æ—¶å¯ä»¥å¤åˆ¶ç²˜è´´k8så®˜ç½‘çš„å†…å®¹</p>
</li>
<li>
<p>ä¸€å®šè¦çœ‹çœ‹ç½‘ä¸Šå†å¹´çœŸé¢˜ï¼Œå¹¶å®é™…è”ç³»ï¼Œé¢˜ç›®å‡ ä¹ä¸€æ ·ï¼ˆå¾ˆå…³é”®ï¼‰</p>
</li>
<li>
<p>æœ€å¥½çœ‹è‹±æ–‡è¯•é¢˜ï¼Œä¸ä¼šå› ä¸ºç¿»è¯‘äº§ç”Ÿè¯¯è§£</p>
</li>
<li>
<p>æœ€å¥½å‚åŠ ä¸‹<a href="https://killer.sh/dashboard">Killer Shell - Exam Simulators</a>çš„æ¨¡æ‹Ÿè€ƒè¯•ï¼Œæ¨¡æ‹Ÿéš¾åº¦å¾ˆå¤§ï¼Œåˆ†æå­¦ä¹ å®Œä¼šæœ‰æ˜æ˜¾æé«˜</p>
</li>
<li>
<p>å¿…å­¦å‘½ä»¤</p>
<ul>
<li>vim</li>
<li>grepå‘½ä»¤</li>
<li>yamlè¯­æ³•</li>
<li>netstatå‘½ä»¤</li>
<li>ipå‘½ä»¤</li>
<li>systemctlå‘½ä»¤</li>
<li>journalctlå‘½ä»¤</li>
<li>ipcalcå‘½ä»¤(å¯é€‰)</li>
<li>apt-cache madison</li>
<li>apt-get</li>
<li>json-path</li>
</ul>
</li>
</ul>
<h1 id="ç¬”è®°">ç¬”è®°<a hidden class="anchor" aria-hidden="true" href="#ç¬”è®°">#</a></h1>
<h2 id="æ ¸å¿ƒæ¦‚å¿µ">æ ¸å¿ƒæ¦‚å¿µ<a hidden class="anchor" aria-hidden="true" href="#æ ¸å¿ƒæ¦‚å¿µ">#</a></h2>
<h3 id="æ ¸å¿ƒæ¦‚å¿µ-1">æ ¸å¿ƒæ¦‚å¿µ<a hidden class="anchor" aria-hidden="true" href="#æ ¸å¿ƒæ¦‚å¿µ-1">#</a></h3>
<blockquote>
<p>ä¸€åˆ‡çš†æ˜¯èµ„æº</p>
</blockquote>
<p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯ä»¥åˆ—å‡ºapiæ”¯æŒçš„èµ„æº</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>kubectl api-resources
</span></span></code></pre></div><table>
<thead>
<tr>
<th>Short name</th>
<th>Full name</th>
</tr>
</thead>
<tbody>
<tr>
<td>csr</td>
<td>certificatesigningrequests</td>
</tr>
<tr>
<td>cs</td>
<td>componentstatuses</td>
</tr>
<tr>
<td>cm</td>
<td>configmaps</td>
</tr>
<tr>
<td>ds</td>
<td>daemonsets</td>
</tr>
<tr>
<td>deploy</td>
<td>deployments</td>
</tr>
<tr>
<td>ep</td>
<td>endpoints</td>
</tr>
<tr>
<td>ev</td>
<td>events</td>
</tr>
<tr>
<td>hpa</td>
<td>horizontalpodautoscalers</td>
</tr>
<tr>
<td>ing</td>
<td>ingresses</td>
</tr>
<tr>
<td>limits</td>
<td>limitranges</td>
</tr>
<tr>
<td>ns</td>
<td>namespaces</td>
</tr>
<tr>
<td>no</td>
<td>nodes</td>
</tr>
<tr>
<td>pvc</td>
<td>persistentvolumeclaims</td>
</tr>
<tr>
<td>pv</td>
<td>persistentvolumes</td>
</tr>
<tr>
<td>po</td>
<td>pods</td>
</tr>
<tr>
<td>pdb</td>
<td>poddisruptionbudgets</td>
</tr>
<tr>
<td>psp</td>
<td>podsecuritypolicies</td>
</tr>
<tr>
<td>rs</td>
<td>replicasets</td>
</tr>
<tr>
<td>rc</td>
<td>replicationcontrollers</td>
</tr>
<tr>
<td>quota</td>
<td>resourcequotas</td>
</tr>
<tr>
<td>sa</td>
<td>serviceaccounts</td>
</tr>
<tr>
<td>svc</td>
<td>services</td>
</tr>
</tbody>
</table>
<h3 id="é€šç”¨å‘½ä»¤">é€šç”¨å‘½ä»¤<a hidden class="anchor" aria-hidden="true" href="#é€šç”¨å‘½ä»¤">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># åˆ—å‡ºapiæ¥å£æ”¯æŒçš„èµ„æº(ä¹ŸåŒ…å«äº†èµ„æºçš„apiVersionoå’Œkindä¿¡æ¯)</span>
</span></span><span style="display:flex;"><span>kubectl api-resources
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># è§£é‡Šå…·ä½“çš„èµ„æº</span>
</span></span><span style="display:flex;"><span>kubectl explain &lt;resource-name&gt;
</span></span><span style="display:flex;"><span>kubectl explain replicaset
</span></span><span style="display:flex;"><span>kubectl explain rs | head -n3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ—å‡ºå½“å‰namespaceæ‰€æœ‰èµ„æº</span>
</span></span><span style="display:flex;"><span>kubectl get all
</span></span></code></pre></div><h3 id="pod">Pod<a hidden class="anchor" aria-hidden="true" href="#pod">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹æ‰€æœ‰pods</span>
</span></span><span style="display:flex;"><span>kubectl get pods
</span></span><span style="display:flex;"><span>kubectl get pods -o wide
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºä¸€ä¸ªnginxå®¹å™¨</span>
</span></span><span style="display:flex;"><span>kubectl run nginx --image=nginx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹podçš„è¯¦æƒ…</span>
</span></span><span style="display:flex;"><span>kubectl describe pod &lt;podname&gt; | less
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ é™¤pod</span>
</span></span><span style="display:flex;"><span>kubectl delete pod &lt;podname&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥æ‰¾ç‰¹å®šlableçš„pods</span>
</span></span><span style="display:flex;"><span>k get pods --selector env=dev,bu=finance
</span></span></code></pre></div><blockquote>
<p>åˆ©ç”¨å£°æ˜å¼æ¥å£åˆ›å»ºpod</p>
<ul>
<li>dry runæœºåˆ¶ç”Ÿæˆyaml</li>
<li><code>kubectl create -f</code> ä»yamlæ–‡ä»¶ç”Ÿæˆpod</li>
</ul>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>controlplane ~ âœ  kubectl run redis --image=redis123 --dry-run=client -o yaml &gt; redis-definition.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>controlplane ~ âœ  cat redis-definition.yaml 
</span></span><span style="display:flex;"><span>apiVersion: v1
</span></span><span style="display:flex;"><span>kind: Pod
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  creationTimestamp: null
</span></span><span style="display:flex;"><span>  labels:
</span></span><span style="display:flex;"><span>    run: redis
</span></span><span style="display:flex;"><span>  name: redis
</span></span><span style="display:flex;"><span>spec:
</span></span><span style="display:flex;"><span>  containers:
</span></span><span style="display:flex;"><span>  - image: redis123
</span></span><span style="display:flex;"><span>    name: redis
</span></span><span style="display:flex;"><span>    resources: {}
</span></span><span style="display:flex;"><span>  dnsPolicy: ClusterFirst
</span></span><span style="display:flex;"><span>  restartPolicy: Always
</span></span><span style="display:flex;"><span>status: {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>controlplane ~ âœ  kubectl create -f redis-definition.yaml 
</span></span><span style="display:flex;"><span>pod/redis created
</span></span></code></pre></div><blockquote>
<p>åˆšæ‰åˆ›å»ºçš„podä¸­imageåå­—redis123æ— æ³•pullé•œåƒï¼Œç°åœ¨è¿›è¡Œä¿®å¤</p>
<p>æ–¹å¼1:</p>
<p><code>kubectl edit pod redis</code>å°†specæ®µä¸­çš„redis123ä¿®æ”¹ä¸ºredisï¼Œä¿å­˜å³å¯ç”Ÿæ•ˆ</p>
<p>æ–¹å¼2:</p>
<p>ç›´æ¥ç¼–è¾‘redis-definition.yamlæ–‡ä»¶ï¼Œä¿®æ”¹imageåå</p>
<p><code>kubectl apply -f redis-definition.yaml </code></p>
<p>æ–¹å¼3:</p>
<p>å…ˆè·å–podçš„yaml</p>
<p><code>kubectl get pod redis -o yaml &gt; redis-definition.yaml</code></p>
<p>ç¼–è¾‘ä¿®æ”¹åå†è¿›è¡Œæ›¿æ¢</p>
<p><code>kubectl replace -f redis-definition.yaml --force</code></p>
</blockquote>
<blockquote>
<p>ä¸€äº›ä¾‹å­</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºå¸¦lableçš„pod</span>
</span></span><span style="display:flex;"><span>kubectl run redis --image=redis:alpine --labels tier=db
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ä¸ºpodåˆ›å»ºä¸€ä¸ªservice</span>
</span></span><span style="display:flex;"><span>k expose pod redis --port <span style="color:#ff0;font-weight:bold">6379</span> --name redis-service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºpodå¹¶åˆ¶å®šç«¯å£</span>
</span></span><span style="display:flex;"><span>k run custom-nginx --image=nginx --port=<span style="color:#ff0;font-weight:bold">8080</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºpodåŒæ—¶åˆ›å»ºåŒåçš„service</span>
</span></span><span style="display:flex;"><span>k run httpd --image httpd:alpine --port=<span style="color:#ff0;font-weight:bold">80</span> --expose
</span></span></code></pre></div><blockquote>
<p>æŸ¥çœ‹/åˆ›å»ºstatic pod</p>
<p>static podç”±kubeletç›´æ¥ç®¡ç†ï¼Œåªèƒ½ä»apiæ¥å£æŸ¥çœ‹ï¼Œæ— æ³•ä»apiç®¡ç†</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹å“ªäº›æ˜¯static podï¼Œä»¥-controlplaneç»“å°¾çš„æ˜¯çš„</span>
</span></span><span style="display:flex;"><span>k get pods --all-namespaces | grep -controlplane
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥æ‰¾static podçš„yamlé…ç½®è·¯å¾„</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># step1: æŸ¥çœ‹kubeletçš„é…ç½®æ–‡ä»¶ï¼ˆå¯åŠ¨æ—¶é€šè¿‡å‘½ä»¤è¡Œä¼ é€’ï¼‰</span>
</span></span><span style="display:flex;"><span>ps -aux | grep /usr/bin/kubelet
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># kubeletçš„é…ç½®è·¯å¾„ä¸º/var/lib/kubelet/config.yaml</span>
</span></span><span style="display:flex;"><span>grep -i staticpod /var/lib/kubelet/config.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºstatic pod</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># é¦–å…ˆåˆ›å»ºå®šä¹‰podçš„yamlæ–‡ä»¶ï¼Œç„¶åæ”¾åˆ°/etc/kubernetes/manifestsè·¯å¾„ä¸‹</span>
</span></span><span style="display:flex;"><span>kubectl run --restart=Never --image=busybox static-busybox --dry-run=client -o yaml --command -- sleep <span style="color:#ff0;font-weight:bold">1000</span> &gt; /etc/kubernetes/manifests/static-busybox.yaml
</span></span></code></pre></div><h3 id="replicaset">Replicaset<a hidden class="anchor" aria-hidden="true" href="#replicaset">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># åˆ—å‡ºreplicasetsèµ„æº</span>
</span></span><span style="display:flex;"><span>kubectl get replicasets
</span></span><span style="display:flex;"><span>kubectl get rs
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹replicasetsæ›´å¤šä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>kubectl get rs -o wide
</span></span><span style="display:flex;"><span>kubectl describe replicaset &lt;replicaset-name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ä»yamlæ–‡ä»¶åˆ›å»ºreplicasets</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å‘½ä»¤å¼ï¼šèµ„æºå·²å­˜åœ¨ä¼šæŠ¥é”™</span>
</span></span><span style="display:flex;"><span>kubectl create -f replicaset-definition.yaml
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å£°æ˜å¼ï¼šèµ„æºå·²å­˜åœ¨ä¸ä¼šæŠ¥é”™ï¼Œæ›´é€‚ç”¨äºç‰ˆæœ¬æ›´æ–°</span>
</span></span><span style="display:flex;"><span>kubectl apply -f replicaset-definition.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ é™¤replicasets</span>
</span></span><span style="display:flex;"><span>kubectl delete rs &lt;replicaset-name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ä¿®å¤é”™è¯¯çš„replicasets</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># step1: ä¿®å¤é…ç½®</span>
</span></span><span style="display:flex;"><span>kubectl edit rs &lt;replicaset-name&gt;
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># step2: åˆ é™¤ä¹‹å‰æœªæˆåŠŸçš„pods</span>
</span></span><span style="display:flex;"><span>k get po | grep &lt;replicaset-name&gt; | awk  <span style="color:#0ff;font-weight:bold">&#39;{print $1}&#39;</span> | xargs -n <span style="color:#ff0;font-weight:bold">1</span> k delete po
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># scaleæ‰©å®¹æˆ–ç¼©å®¹</span>
</span></span><span style="display:flex;"><span>k scale rs &lt;replicaset-name&gt; --replicas=<span style="color:#ff0;font-weight:bold">5</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æˆ–è€…ç›´æ¥k editç¼–è¾‘replicas</span>
</span></span><span style="display:flex;"><span>k edit rs &lt;replicaset-name&gt;
</span></span></code></pre></div><blockquote>
<p>ä¸€äº›ä¾‹å­</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>k create deployment webapp --image kodekloud/webapp-color --replicas 
</span></span></code></pre></div><h3 id="daemonset">DaemonSet<a hidden class="anchor" aria-hidden="true" href="#daemonset">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># è·å–æ‰€æœ‰namespaceä¸­çš„daemonsets</span>
</span></span><span style="display:flex;"><span>k get daemonsets --all-namespaces
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹daemonsetè¯¦æƒ…</span>
</span></span><span style="display:flex;"><span>kubectl describe ds &lt;daemonset-name&gt; --namespace=&lt;namespace-name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºä¸€ä¸ªdaemonsetçš„yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># step1: å…ˆé€šè¿‡dry runæ–¹å¼åˆ›å»ºä¸€ä¸ªdeploymentçš„yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># step2: ç¼–è¾‘yamlï¼Œç§»é™¤replicas, strategy and status æ®µ</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># step3: å°†kindä»Deployment æ”¹ä¸º DaemonSet</span>
</span></span></code></pre></div><blockquote>
<p>åˆ›å»ºdaemonsetçš„ä¾‹å­</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>k create deployment elasticsearch -n kube-system --image registry.k8s.io/fluentd-elasticsearch:1.20 --dry-run=client  -o yaml &gt; daemonset.yaml
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: apps/v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: DaemonSet
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">creationTimestamp</span>: <span style="color:#fff;font-weight:bold">null</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">app</span>: elasticsearch
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: elasticsearch
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">namespace</span>: kube-system
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">app</span>: elasticsearch
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">template</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">creationTimestamp</span>: <span style="color:#fff;font-weight:bold">null</span>
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">app</span>: elasticsearch
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="font-weight:bold">image</span>: registry.k8s.io/fluentd-elasticsearch:1.20
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">name</span>: fluentd-elasticsearch
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">resources</span>: {}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>k apply -f daemonset.yaml
</span></span></code></pre></div><h3 id="deployment">Deployment<a hidden class="anchor" aria-hidden="true" href="#deployment">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># åˆ—å‡ºdeploymentsèµ„æº</span>
</span></span><span style="display:flex;"><span>kubectl get deployments
</span></span><span style="display:flex;"><span>kubectl get deploy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºdeployment</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æ–¹å¼1:ç›´æ¥å‘½ä»¤åˆ›å»º</span>
</span></span><span style="display:flex;"><span>kubectl create deployment --image httpd:2.4-alpine --replicas <span style="color:#ff0;font-weight:bold">3</span> httpd-frontent
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æ–¹å¼2:å…ˆdry-runç”Ÿæˆyamlï¼Œç„¶åä¿®æ”¹åå†apply</span>
</span></span><span style="display:flex;"><span>kubectl create deployment --image httpd:2.4-alpine --replicas <span style="color:#ff0;font-weight:bold">3</span> --dry-run=client httpd-frontent -o yaml &gt; httpd-deployment.yaml
</span></span><span style="display:flex;"><span>kubectl apply -f httpd-deployment.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ é™¤deployment</span>
</span></span><span style="display:flex;"><span>k delete deploy &lt;deployment-name&gt;
</span></span></code></pre></div><blockquote>
<p>ä¸€äº›ä¾‹å­</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># æŒ‡å®šnamespaceåˆ›å»ºdeployment</span>
</span></span><span style="display:flex;"><span>kubectl create deployment redis-deploy -n dev-ns --image redis --replicas <span style="color:#ff0;font-weight:bold">2</span>
</span></span></code></pre></div><h3 id="namespace">Namespace<a hidden class="anchor" aria-hidden="true" href="#namespace">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># åˆ—å‡ºæ‰€æœ‰namespace</span>
</span></span><span style="display:flex;"><span>k get namespaces
</span></span><span style="display:flex;"><span>k get ns
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># è·å–ç¯å¢ƒä¸­namespaceä¸ªæ•°</span>
</span></span><span style="display:flex;"><span>k get ns --no-headers | wc -l
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ—å‡ºç‰¹å®šnamespaceä¸­çš„pods</span>
</span></span><span style="display:flex;"><span>k get pods -n &lt;namespace-name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># è·å–æ‰€æœ‰namespaceä¸­çš„pods</span>
</span></span><span style="display:flex;"><span>k get pods --all-namespaces
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åœ¨ç‰¹å®šnamespaceä¸­åˆ›å»ºpod</span>
</span></span><span style="display:flex;"><span>k run redis --image=redis  -n finance
</span></span><span style="display:flex;"><span>k run redis --image=redis --dry-run=client -n finance -o yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ—å‡ºç‰¹å®šnamespaceä¸­çš„service</span>
</span></span><span style="display:flex;"><span>k get service -n &lt;namespace-name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºä¸€ä¸ªæ–°çš„namespace</span>
</span></span><span style="display:flex;"><span>k create namespace &lt;namespace-name&gt;
</span></span></code></pre></div><p>å¤‡æ³¨ï¼š</p>
<ul>
<li>serviceçš„DNSè§£æç­–ç•¥
<ul>
<li>åŒnamespaceï¼Œå¯ä»¥ç›´æ¥ç”¨serviceçš„åå­—</li>
<li>ä¸åŒnamesapceï¼Œéœ€è¦åŠ ä¸Šnamespaceçš„åç¼€ï¼Œä¾‹å¦‚
<ul>
<li>db-service.dev</li>
<li>db-service.dev.svc.cluster.local</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="service">Service<a hidden class="anchor" aria-hidden="true" href="#service">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># åˆ—å‡ºæ‰€æœ‰services</span>
</span></span><span style="display:flex;"><span>k get services
</span></span><span style="display:flex;"><span>k get svc
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹ç‰¹å®šserviceè¯¦æƒ…</span>
</span></span><span style="display:flex;"><span>k describe svc &lt;service-name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºserviceï¼Œä½¿ç”¨ç±»ä¼¼ä¸‹æ°‘çš„yamlåˆ›å»º</span>
</span></span><span style="display:flex;"><span>k apply -f service-definition.yaml
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Service
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: webapp-service 
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">namespace</span>: default
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">ports</span>: 
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">nodePort</span>: <span style="color:#ff0;font-weight:bold">30080</span> 
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">port</span>: <span style="color:#ff0;font-weight:bold">8080</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">targetPort</span>: <span style="color:#ff0;font-weight:bold">8080</span> 
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">name</span>:  simple-webapp
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">type</span>: NodePort
</span></span></code></pre></div><h3 id="node">Node<a hidden class="anchor" aria-hidden="true" href="#node">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># è·å–é›†ç¾¤ä¸­æ‰€æœ‰nodeçš„ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>kubectl get nodes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹èŠ‚ç‚¹è¯¦æƒ…</span>
</span></span><span style="display:flex;"><span>k describe node &lt;node-name&gt;
</span></span></code></pre></div><hr>
<h2 id="è°ƒåº¦éƒ¨åˆ†">è°ƒåº¦éƒ¨åˆ†<a hidden class="anchor" aria-hidden="true" href="#è°ƒåº¦éƒ¨åˆ†">#</a></h2>
<blockquote>
<p>é€šè¿‡æŒ‡å®š<code>nodeName</code>æŒ‡å®šèŠ‚ç‚¹éƒ¨ç½²</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Pod
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: nginx
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">nodeName</span>: node01
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">containers</span>:
</span></span><span style="display:flex;"><span>  -  <span style="font-weight:bold">image</span>: nginx
</span></span><span style="display:flex;"><span>     <span style="font-weight:bold">name</span>: nginx
</span></span></code></pre></div><blockquote>
<p>Taintå’ŒTolerance</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># ä¸ºèŠ‚ç‚¹node01æ·»åŠ taintï¼Œæ•ˆæœæ˜¯NoSchedule</span>
</span></span><span style="display:flex;"><span>k taint node node01 spary=mortein:NoSchedule
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ä¸ºèŠ‚ç‚¹node01ç§»é™¤keyæ˜¯sparyçš„taint</span>
</span></span><span style="display:flex;"><span>k taint node node01 spary-
</span></span></code></pre></div><blockquote>
<p>åˆ›å»ºå¯ä»¥å®¹å¿ç‰¹å®štaintçš„pod</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Pod
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: bee
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">image</span>: nginx
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">name</span>: bee
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">tolerations</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">key</span>: spray
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">value</span>: mortein
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">effect</span>: NoSchedule
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">operator</span>: Equal
</span></span></code></pre></div><blockquote>
<p>Label</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># ä¸ºèŠ‚ç‚¹æ·»åŠ lable color=blue</span>
</span></span><span style="display:flex;"><span>kubectl label node node01 color=blue
</span></span></code></pre></div><blockquote>
<p>ä½¿ç”¨labelå®ç°ä¸€ä¸ªdeploymentä¸­çš„podè°ƒåº¦äº²å’Œ</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: apps/v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Deployment
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: blue
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">replicas</span>: <span style="color:#ff0;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">run</span>: nginx
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">template</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">run</span>: nginx
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="font-weight:bold">image</span>: nginx
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">imagePullPolicy</span>: Always
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">name</span>: nginx
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">affinity</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">nodeAffinity</span>:
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">nodeSelectorTerms</span>:
</span></span><span style="display:flex;"><span>            - <span style="font-weight:bold">matchExpressions</span>:
</span></span><span style="display:flex;"><span>              - <span style="font-weight:bold">key</span>: color
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">operator</span>: In
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">values</span>:
</span></span><span style="display:flex;"><span>                - blue
</span></span></code></pre></div><blockquote>
<p>é‡åˆ°podå®šä¹‰çš„èµ„æºä¸è¶³ä»¥è¿è¡Œ</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>kubectl get pod elephant -o yaml &gt; ele.yaml
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ç¼–è¾‘èµ„æºrequestå</span>
</span></span><span style="display:flex;"><span>kubectl replace -f ele.yaml --force
</span></span></code></pre></div><blockquote>
<p>podé€šè¿‡schedulerNameæŒ‡å®šè°ƒåº¦å™¨</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: v1 
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Pod 
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: nginx 
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">schedulerName</span>: my-scheduler
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">image</span>: nginx
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">name</span>: nginx
</span></span></code></pre></div><h2 id="åº¦é‡å’Œæ—¥å¿—metric--log">åº¦é‡å’Œæ—¥å¿—Metric &amp; Log<a hidden class="anchor" aria-hidden="true" href="#åº¦é‡å’Œæ—¥å¿—metric--log">#</a></h2>
<h3 id="metrics">Metrics<a hidden class="anchor" aria-hidden="true" href="#metrics">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># Metricsåº¦é‡</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>git clone https://github.com/kodekloudhub/kubernetes-metrics-server.git
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">cd</span> kubernetes-metrics-server/
</span></span><span style="display:flex;"><span>kubectl create -f .
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># wait a minute</span>
</span></span><span style="display:flex;"><span>kubectl top node
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># cpuå ç”¨æœ€é«˜çš„èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>kubectl top node --sort-by=<span style="color:#0ff;font-weight:bold">&#39;cpu&#39;</span> --no-headers | head -1 
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å†…å­˜å ç”¨æœ€é«˜çš„èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>kubectl top node --sort-by=<span style="color:#0ff;font-weight:bold">&#39;memory&#39;</span> --no-headers | head -1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å†…å­˜å ç”¨æœ€å¤šçš„pod</span>
</span></span><span style="display:flex;"><span>kubectl top pod --sort-by=<span style="color:#0ff;font-weight:bold">&#39;memory&#39;</span> --no-headers | head -1
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å†…å­˜å ç”¨æœ€å°‘çš„pod</span>
</span></span><span style="display:flex;"><span>kubectl top pod --sort-by=<span style="color:#0ff;font-weight:bold">&#39;memory&#39;</span> --no-headers | tail -1
</span></span></code></pre></div><h3 id="log">Log<a hidden class="anchor" aria-hidden="true" href="#log">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹podæ—¥å¿—</span>
</span></span><span style="display:flex;"><span>kubectl logs &lt;pod-name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŒ‡å®špodä¸­å®¹å™¨æŸ¥çœ‹æ—¥å¿—ï¼ˆä¸€ä¸ªpodå¯ä»¥æœ‰å¤šä¸ªcontainerï¼‰</span>
</span></span><span style="display:flex;"><span>kubectl logs &lt;pod-name&gt; -c &lt;container-name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ç™»å…¥podä¸­æŒ‡å®šçš„å®¹å™¨</span>
</span></span><span style="display:flex;"><span>kubectl <span style="color:#fff;font-weight:bold">exec</span> -it &lt;pod-name&gt; -c &lt;container-name&gt; -- /bin/bash
</span></span></code></pre></div><h2 id="åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†">åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†<a hidden class="anchor" aria-hidden="true" href="#åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†">#</a></h2>
<h3 id="æ›´æ–°deploymentç‰ˆæœ¬">æ›´æ–°deploymentç‰ˆæœ¬<a hidden class="anchor" aria-hidden="true" href="#æ›´æ–°deploymentç‰ˆæœ¬">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹deploymentçš„ç­–ç•¥</span>
</span></span><span style="display:flex;"><span>k describe deploy &lt;deployment-name&gt; | grep StrategyType
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># RollingUpdateæ„å‘³ç€ä¸€æ¬¡åªæ›´æ–°éƒ¨åˆ†pod</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Recreateæ„å‘³ç€åŒæ—¶ç»ˆæ­¢podå¹¶é‡æ–°åˆ›å»º</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>k describe deploy &lt;deployment-name&gt; | grep RollingUpdateStrategy
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 25% max unavailable, 25% max surgeæ„å‘³ç€æœ€å¤šå¯ä»¥åŒæ—¶ç»ˆæ­¢25%çš„pod</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æ›´æ–°deploymentçš„é•œåƒ</span>
</span></span><span style="display:flex;"><span>k edit deploy &lt;deployment-name&gt;
</span></span></code></pre></div><h3 id="å‘½ä»¤è¡Œ">å‘½ä»¤è¡Œ<a hidden class="anchor" aria-hidden="true" href="#å‘½ä»¤è¡Œ">#</a></h3>
<blockquote>
<p>æŒ‡å®šå®¹å™¨å‘½ä»¤è¡Œ</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: v1 
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Pod 
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: ubuntu-sleeper-2 
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">name</span>: ubuntu
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">image</span>: ubuntu
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">command</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#0ff;font-weight:bold">&#34;sleep&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#0ff;font-weight:bold">&#34;5000&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: v1 
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Pod 
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: webapp-green
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">labels</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">name</span>: webapp-green 
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">name</span>: simple-webapp
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">image</span>: kodekloud/webapp-color
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">command</span>: [<span style="color:#0ff;font-weight:bold">&#34;python&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;app.py&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">args</span>: [<span style="color:#0ff;font-weight:bold">&#34;--color&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;pink&#34;</span>]
</span></span></code></pre></div><h3 id="secret">Secret<a hidden class="anchor" aria-hidden="true" href="#secret">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># åˆ—å‡ºsecrets</span>
</span></span><span style="display:flex;"><span>k get secrets
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹secretè¯¦æƒ…</span>
</span></span><span style="display:flex;"><span>k describe secrets &lt;secret-name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºsecretï¼Œåä¸ºdb-secret</span>
</span></span><span style="display:flex;"><span>kubectl create secret generic db-secret --from-literal=DB_Host=sql01 --from-literal=DB_User=root
</span></span></code></pre></div><blockquote>
<p>podä½¿ç”¨secret</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: v1 
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Pod 
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">name</span>: webapp-pod
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: webapp-pod
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">namespace</span>: default 
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">image</span>: kodekloud/simple-webapp-mysql
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">imagePullPolicy</span>: Always
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">name</span>: webapp
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">envFrom</span>:
</span></span><span style="display:flex;"><span>    - <span style="font-weight:bold">secretRef</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">name</span>: db-secret
</span></span></code></pre></div><h3 id="multi-container">Multi Container<a hidden class="anchor" aria-hidden="true" href="#multi-container">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Pod
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">creationTimestamp</span>: <span style="color:#fff;font-weight:bold">null</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">run</span>: yellow
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: yellow
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">image</span>: busybox
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">name</span>: lemon
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">resources</span>: {}
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">command</span>: [<span style="color:#0ff;font-weight:bold">&#34;sleep&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;1000&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">image</span>: redis
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">name</span>: gold
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">resources</span>: {}
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">dnsPolicy</span>: ClusterFirst
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">restartPolicy</span>: Always
</span></span><span style="display:flex;"><span><span style="font-weight:bold">status</span>: {}
</span></span></code></pre></div><blockquote>
<p>å¤šå®¹å™¨å…±äº«æ–‡ä»¶ç³»ç»Ÿ</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Pod
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: app
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">namespace</span>: elastic-stack
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">name</span>: app
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">name</span>: app
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">image</span>: kodekloud/event-simulator
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">volumeMounts</span>:
</span></span><span style="display:flex;"><span>    - <span style="font-weight:bold">mountPath</span>: /log
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">name</span>: log-volume
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">name</span>: sidecar
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">image</span>: kodekloud/filebeat-configured
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">volumeMounts</span>:
</span></span><span style="display:flex;"><span>    - <span style="font-weight:bold">mountPath</span>: /var/log/event-simulator/
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">name</span>: log-volume
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">volumes</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">name</span>: log-volume
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">hostPath</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f"># directory location on host</span>
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">path</span>: /var/log/webapp
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f"># this field is optional</span>
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">type</span>: DirectoryOrCreate
</span></span></code></pre></div><h3 id="init-container">Init Container<a hidden class="anchor" aria-hidden="true" href="#init-container">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Pod
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: red
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">namespace</span>: default
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">command</span>:
</span></span><span style="display:flex;"><span>    - sh
</span></span><span style="display:flex;"><span>    - -c
</span></span><span style="display:flex;"><span>    - echo The app is running! &amp;&amp; sleep 3600
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">image</span>: busybox:1.28
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">name</span>: red-container
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">initContainers</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">image</span>: busybox
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">name</span>: red-initcontainer
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">command</span>: 
</span></span><span style="display:flex;"><span>      - <span style="color:#0ff;font-weight:bold">&#34;sleep&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#0ff;font-weight:bold">&#34;20&#34;</span>
</span></span></code></pre></div><h2 id="cluster-ç»´æŠ¤">Cluster ç»´æŠ¤<a hidden class="anchor" aria-hidden="true" href="#cluster-ç»´æŠ¤">#</a></h2>
<h3 id="å‡çº§os">å‡çº§OS<a hidden class="anchor" aria-hidden="true" href="#å‡çº§os">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># å‡çº§node01ï¼Œé¦–å…ˆæ¸…ç©ºnode01ä¸Šçš„pod</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æ•ˆæœ pod evicted, node drained</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># drainä¼šé»˜è®¤å°†node cordonï¼Œå³ä¸å¯è°ƒåº¦</span>
</span></span><span style="display:flex;"><span>kubectl drain node01 --ignore-daemonsets
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># node01ç»´æŠ¤å®Œæ¯•åï¼Œå°†node01è®¾ç½®ä¸ºå¯è°ƒåº¦</span>
</span></span><span style="display:flex;"><span>kubectl uncordon node01
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># NOTE: drainåªèƒ½å¤„ç†replicasetï¼Œå•ç‹¬çš„podéœ€è¦å¼ºåˆ¶æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>k drain node01 --ignore-daemonsets --force
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å¯¹ä¸å±äºreplicasetçš„podï¼Œå°†ä¼šæ°¸ä¹…ä¸¢å¤±</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å°†node01è®¾ç½®ä¸å¯è°ƒåº¦</span>
</span></span><span style="display:flex;"><span>kubectl cordon node01
</span></span></code></pre></div><h3 id="å‡çº§k8s">å‡çº§K8S<a hidden class="anchor" aria-hidden="true" href="#å‡çº§k8s">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹æ§åˆ¶èŠ‚ç‚¹ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>k version --short
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹nodeç‰ˆæœ¬ï¼Œå½“å‰1.26</span>
</span></span><span style="display:flex;"><span>k get nodes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹è¿œç«¯å¯å‡çº§ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>kubeadm upgrade plan
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æœ‰ä¸¤ä¸ªnodeåˆ†åˆ«æ˜¯controlplaneå’Œnode01</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å…ˆæ¸…ç©ºcontrolplaneçš„pod</span>
</span></span><span style="display:flex;"><span>kubectl drain controlplane --ignore-daemonsets
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å¼€å§‹å‡çº§controlplane</span>
</span></span><span style="display:flex;"><span>apt update
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># é¦–å…ˆå‡çº§kubeadm</span>
</span></span><span style="display:flex;"><span>apt-get install kubeadm=1.27.0-00
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubeadm upgrade apply v1.27.0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å‡çº§å‘½ä»¤è¡Œ</span>
</span></span><span style="display:flex;"><span>apt-get install kubelet=1.27.0-00 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># é‡å¯æœåŠ¡</span>
</span></span><span style="display:flex;"><span>systemctl daemon-reload
</span></span><span style="display:flex;"><span>systemctl restart kubelet
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># controlplaneå‡çº§å®Œæ¯•ï¼Œæ ‡è®°ä¸ºå¯è°ƒåº¦</span>
</span></span><span style="display:flex;"><span>kubectl uncordon controlplane
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># éœ€è¦è§£é™¤controlplaneçš„taint</span>
</span></span><span style="display:flex;"><span>k drain node01
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æ¥ç€sshç™»å½•åˆ°node01ä¸Šï¼Œå‡çº§node01</span>
</span></span><span style="display:flex;"><span>apt-get update
</span></span><span style="display:flex;"><span>apt-get install kubeadm=1.27.0-00
</span></span><span style="display:flex;"><span>kubeadm upgrade node
</span></span><span style="display:flex;"><span>apt-get install kubelet=1.27.0-00 
</span></span><span style="display:flex;"><span>systemctl daemon-reload
</span></span><span style="display:flex;"><span>systemctl restart kubelet
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æœ€åè®©node01å¯è°ƒåº¦</span>
</span></span><span style="display:flex;"><span>kubectl uncordon node01
</span></span></code></pre></div><h3 id="å¤‡ä»½æ¢å¤">å¤‡ä»½æ¢å¤<a hidden class="anchor" aria-hidden="true" href="#å¤‡ä»½æ¢å¤">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹etcdç‰ˆæœ¬ï¼ˆæŸ¥çœ‹æ—¥å¿—æˆ–è€…é•œåƒï¼‰</span>
</span></span><span style="display:flex;"><span>kubectl -n kube-system logs etcd-controlplane | grep -i <span style="color:#0ff;font-weight:bold">&#39;etcd-version&#39;</span>
</span></span><span style="display:flex;"><span>kubectl -n kube-system describe pod etcd-controlplane | grep Image:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹etcdçš„endpoint</span>
</span></span><span style="display:flex;"><span>kubectl -n kube-system describe pod etcd-controlplane | grep <span style="color:#0ff;font-weight:bold">&#39;\--listen-client-urls&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹etcdçš„certæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>kubectl -n kube-system describe pod etcd-controlplane | grep <span style="color:#0ff;font-weight:bold">&#39;\--cert-file&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹etcdçš„ca certæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>kubectl -n kube-system describe pod etcd-controlplane | grep <span style="color:#0ff;font-weight:bold">&#39;\--trusted-ca-file&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åœ¨ç»´æŠ¤æˆ–è€…å¯¹ç¯å¢ƒåšæ“ä½œå‰å…ˆå¤‡ä»½etcd</span>
</span></span><span style="display:flex;"><span>ETCDCTL_API=<span style="color:#ff0;font-weight:bold">3</span> etcdctl --endpoints=https://[127.0.0.1]:2379 <span style="color:#0ff;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold"></span>--cacert=/etc/kubernetes/pki/etcd/ca.crt <span style="color:#0ff;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold"></span>--cert=/etc/kubernetes/pki/etcd/server.crt <span style="color:#0ff;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold"></span>--key=/etc/kubernetes/pki/etcd/server.key <span style="color:#0ff;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold"></span>snapshot save /opt/snapshot-pre-boot.db
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åœ¨ç»´æŠ¤çª—å£æœŸé—´ä¸¢å¤±äº†ä¸€äº›podæˆ–deploymentï¼Œéœ€è¦æ¢å¤</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># é¦–å…ˆå°†etcdå¿«ç…§æ¢å¤åˆ°ä¸€ä¸ªæ–°çš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>ETCDCTL_API=<span style="color:#ff0;font-weight:bold">3</span> etcdctl  --data-dir /var/lib/etcd-from-backup <span style="color:#0ff;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold"></span>snapshot restore /opt/snapshot-pre-boot.db
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ä¿®æ”¹etcdè¿™ä¸ªstaticpodçš„yamlï¼ŒæŒ‡å‘æ¢å¤çš„data-dir</span>
</span></span><span style="display:flex;"><span>vim /etc/kubernetes/manifests/etcd.yaml
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ä¿®æ”¹æˆå¦‚ä¸‹ï¼Œå°†etcd-dataè¿™ä¸ªvolumeæŒ‡å‘hostPath: /var/lib/etcd-from-backup</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#  volumes:</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#  - hostPath:</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#      path: /var/lib/etcd-from-backup</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#      type: DirectoryOrCreate</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#    name: etcd-data</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æ›´æ–°yamlåï¼Œetcdä¼šè‡ªåŠ¨é‡å»ºï¼Œè‹¥etcdä¸€ç›´PENDINGï¼Œæ‰‹åŠ¨åˆ é™¤è§¦å‘é‡å¯</span>
</span></span><span style="display:flex;"><span>kubectl delete pod -n kube-system etcd-controlplane
</span></span></code></pre></div><blockquote>
<p>å¤šcluster</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹clusterä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>kubectl config view
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æˆ–è€…</span>
</span></span><span style="display:flex;"><span>kubectl config get-clusters
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹å½“å‰çš„cluster</span>
</span></span><span style="display:flex;"><span>kubectl config view | grep current-context
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ‡æ¢cluster</span>
</span></span><span style="display:flex;"><span>kubectl config use-context cluster2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Type1: Stacked ETCD Topology</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å¦‚ä¸‹å‘½ä»¤å¯ä»¥åœ¨clusterä¸­æŸ¥æ‰¾åˆ°etcdçš„pod</span>
</span></span><span style="display:flex;"><span>kubectl get pods -n kube-system | grep etcd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl -n kube-system describe pod etcd-cluster1-controlplane
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Type2: External ETCD</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># clusterå†…æ²¡æœ‰etcdçš„podï¼Œkube-apiserverç›´æ¥æŒ‡å‘ä¸€ä¸ªå¤–éƒ¨çš„etcd endpoint</span>
</span></span><span style="display:flex;"><span>ps -aux | grep etcd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹ETCDé›†ç¾¤çš„members</span>
</span></span><span style="display:flex;"><span>ETCDCTL_API=<span style="color:#ff0;font-weight:bold">3</span> etcdctl <span style="color:#0ff;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold"></span> --endpoints=https://127.0.0.1:2379 <span style="color:#0ff;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold"></span> --cacert=/etc/etcd/pki/ca.pem <span style="color:#0ff;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold"></span> --cert=/etc/etcd/pki/etcd.pem <span style="color:#0ff;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold"></span> --key=/etc/etcd/pki/etcd-key.pem <span style="color:#0ff;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold"></span>  member list
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å¤‡ä»½Stacked ETCD</span>
</span></span><span style="display:flex;"><span>kubectl config use-context cluster1
</span></span><span style="display:flex;"><span>kubectl describe pods -n kube-system etcd-cluster1-controlplane  | grep advertise-client-urls
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># --advertise-client-urls=https://10.1.218.16:2379</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl describe  pods -n kube-system etcd-cluster1-controlplane  | grep pki
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#      --cert-file=/etc/kubernetes/pki/etcd/server.crt</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#      --key-file=/etc/kubernetes/pki/etcd/server.key</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#      --peer-cert-file=/etc/kubernetes/pki/etcd/peer.crt</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#      --peer-key-file=/etc/kubernetes/pki/etcd/peer.key</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#      --peer-trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#      --trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#      /etc/kubernetes/pki/etcd from etcd-certs (rw)</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#    Path:          /etc/kubernetes/pki/etcd</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ç™»å½•åˆ°etcd podæ‰€åœ¨çš„èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>ETCDCTL_API=<span style="color:#ff0;font-weight:bold">3</span> etcdctl --endpoints=https://10.1.220.8:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key snapshot save /opt/cluster1.db
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æ¢å¤External ETCD</span>
</span></span><span style="display:flex;"><span>ETCDCTL_API=<span style="color:#ff0;font-weight:bold">3</span> etcdctl --endpoints=https://127.0.0.1:2379 --cacert=/etc/etcd/pki/ca.pem --cert=/etc/etcd/pki/etcd.pem --key=/etc/etcd/pki/etcd-key.pem snapshot restore /root/cluster2.db --data-dir /var/lib/etcd-data-new
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>systemctl status etcd.service
</span></span><span style="display:flex;"><span>vim /etc/systemd/system/etcd.service
</span></span><span style="display:flex;"><span>systemctl daemon-reload 
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># serviceçš„Useræ˜¯etcdï¼Œä¿®æ”¹æ–‡ä»¶æƒé™</span>
</span></span><span style="display:flex;"><span>chown -R etcd:etcd /var/lib/etcd-data-new
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>systemctl restart etcd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æ¨èé‡å¯æ§åˆ¶å¹³é¢çš„pod(kube-scheduler, kube-controller-manager, kubelet)</span>
</span></span></code></pre></div><h2 id="å®‰å…¨security">å®‰å…¨Security<a hidden class="anchor" aria-hidden="true" href="#å®‰å…¨security">#</a></h2>
<h3 id="tlså’Œè¯ä¹¦ä»‹ç»">TLSå’Œè¯ä¹¦ä»‹ç»<a hidden class="anchor" aria-hidden="true" href="#tlså’Œè¯ä¹¦ä»‹ç»">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Certificate:
</span></span><span style="display:flex;"><span>    Data:
</span></span><span style="display:flex;"><span>        Version: <span style="color:#ff0;font-weight:bold">3</span> (0x2)
</span></span><span style="display:flex;"><span>        Serial Number: <span style="color:#ff0;font-weight:bold">3478545236123834268</span> (0x304646764e49d79c)
</span></span><span style="display:flex;"><span>        Signature Algorithm: sha256WithRSAEncryption
</span></span><span style="display:flex;"><span>        Issuer: CN = kubernetes
</span></span><span style="display:flex;"><span>        Validity
</span></span><span style="display:flex;"><span>            Not Before: Dec  <span style="color:#ff0;font-weight:bold">1</span> 12:24:30 <span style="color:#ff0;font-weight:bold">2023</span> GMT
</span></span><span style="display:flex;"><span>            Not After : Nov <span style="color:#ff0;font-weight:bold">30</span> 12:24:30 <span style="color:#ff0;font-weight:bold">2024</span> GMT
</span></span><span style="display:flex;"><span>        Subject: CN = kube-apiserver
</span></span><span style="display:flex;"><span>        Subject Public Key Info:
</span></span><span style="display:flex;"><span>            Public Key Algorithm: rsaEncryption
</span></span><span style="display:flex;"><span>                RSA Public-Key: (<span style="color:#ff0;font-weight:bold">2048</span> bit)
</span></span><span style="display:flex;"><span>                Modulus:
</span></span><span style="display:flex;"><span>                    00:ce:fc:11:8c:a0:2c:83:2d:20:b2:47:83:dc:38:
</span></span><span style="display:flex;"><span>                    ec:3f:7f:b5:9a:09:c8:a5:7a:16:7a:c7:2d:1d:62:
</span></span><span style="display:flex;"><span>                    ae:a6:02:7e:d0:be:6a:c6:fd:71:d3:1a:a8:fd:9b:
</span></span><span style="display:flex;"><span>                    4d:11:45:f1:21:aa:20:a1:9d:4e:d7:be:f1:22:25:
</span></span><span style="display:flex;"><span>                    a9:82:52:87:f8:e5:ce:d5:30:e6:1f:99:a5:13:56:
</span></span><span style="display:flex;"><span>                    e1:38:e3:68:f5:54:de:67:e1:d1:7e:7a:30:12:6c:
</span></span><span style="display:flex;"><span>                    48:fd:d9:89:95:07:2a:51:8e:d8:fa:0c:02:79:54:
</span></span><span style="display:flex;"><span>                    c4:8f:16:42:b1:f4:a9:0e:ac:83:20:f7:d4:eb:c6:
</span></span><span style="display:flex;"><span>                    8f:e2:74:2a:03:c7:2a:b6:d9:c4:ea:28:3c:b8:14:
</span></span><span style="display:flex;"><span>                    3f:dd:f0:d9:d9:b2:1f:6c:89:93:0b:37:cd:1b:57:
</span></span><span style="display:flex;"><span>                    1c:8e:53:fe:d1:40:f5:80:ee:2d:8d:c6:ce:c2:39:
</span></span><span style="display:flex;"><span>                    03:d6:c7:aa:61:cb:b5:8d:5c:d6:73:99:ef:c8:6b:
</span></span><span style="display:flex;"><span>                    87:ac:0e:3b:59:bb:ec:e2:c5:04:54:4b:ad:d5:da:
</span></span><span style="display:flex;"><span>                    48:16:f5:15:0c:bb:29:fe:13:c7:ed:29:dc:bc:01:
</span></span><span style="display:flex;"><span>                    b5:ac:dd:84:c9:01:e1:fc:40:1e:8f:c5:4a:82:c5:
</span></span><span style="display:flex;"><span>                    69:3a:4a:54:b3:22:c6:4b:61:78:54:59:e9:21:ef:
</span></span><span style="display:flex;"><span>                    a9:5d:cf:a1:b4:c8:f2:18:4e:6a:03:d3:44:3c:be:
</span></span><span style="display:flex;"><span>                    9e:d9
</span></span><span style="display:flex;"><span>                Exponent: <span style="color:#ff0;font-weight:bold">65537</span> (0x10001)
</span></span><span style="display:flex;"><span>        X509v3 extensions:
</span></span><span style="display:flex;"><span>            X509v3 Key Usage: critical
</span></span><span style="display:flex;"><span>                Digital Signature, Key Encipherment
</span></span><span style="display:flex;"><span>            X509v3 Extended Key Usage: 
</span></span><span style="display:flex;"><span>                TLS Web Server Authentication
</span></span><span style="display:flex;"><span>            X509v3 Basic Constraints: critical
</span></span><span style="display:flex;"><span>                CA:FALSE
</span></span><span style="display:flex;"><span>            X509v3 Authority Key Identifier: 
</span></span><span style="display:flex;"><span>                keyid:27:89:3A:1C:08:4F:74:4E:60:20:1A:44:E0:47:AC:D6:F9:05:93:E5
</span></span><span style="display:flex;"><span>            X509v3 Subject Alternative Name: 
</span></span><span style="display:flex;"><span>                DNS:controlplane, DNS:kubernetes, DNS:kubernetes.default, DNS:kubernetes.default.svc, DNS:kubernetes.default.svc.cluster.local, IP Address:10.96.0.1, IP Address:192.21.43.6
</span></span><span style="display:flex;"><span>    Signature Algorithm: sha256WithRSAEncryption
</span></span><span style="display:flex;"><span>         8e:75:b2:8e:47:5c:8f:a1:6c:c8:49:da:ef:e0:09:09:6d:cf:
</span></span><span style="display:flex;"><span>         ddğŸ’¿35:f0:e2:df:b2ğŸ‡©ğŸ‡ªb0:f0:8a:0a:4b:4b:32:7e:46:45:
</span></span><span style="display:flex;"><span>         6b:0b:52:7b:8d:ad:17:67:59:fb:7d:68:86:2b:d1:91:7d:99:
</span></span><span style="display:flex;"><span>         c8:ff:d2:17:46:a0:92:ae:3c:55:9a:e4:f5:ee:59:48:a5:2a:
</span></span><span style="display:flex;"><span>         93:4d:8d:02:ba:02:73:f6:07:36:2a:5a:99:4a:33:52:ce:36:
</span></span><span style="display:flex;"><span>         ea:44:29:19:cb:d1:6f:4a:db:1f:d9:47:7e:8c:e7:2b:6a:7f:
</span></span><span style="display:flex;"><span>         11:43:57:f1:f6:7a:19:c1:b6:ff:81:37:71:3a:f6:14:d5:63:
</span></span><span style="display:flex;"><span>         ab:9d:31:f7:bc:4c:0a:19:fb:36:d7:84:f2:1c:fd:c5:fc:8d:
</span></span><span style="display:flex;"><span>         83:b0:8f:ec:1b:9c:ae:57:4f:f1:96:f5:45:f5:c5:4e:8f:a0:
</span></span><span style="display:flex;"><span>         ac:04:97:fa:87:2c:0d:5c:83:a9:d8:94:2f:d5:64:8d:ec:13:
</span></span><span style="display:flex;"><span>         c6:b4:93:d2:29:f9:87:23:a0:90:7b:68:8c:d6:5c:fd:a3:97:
</span></span><span style="display:flex;"><span>         96:68:a7:e0:2a:22:8b:a9:d4:01:fc:f5:06:39:7f:63:6b:33:
</span></span><span style="display:flex;"><span>         8e:3f:6b:23:18:9c:c8:7c:0f:0c:c1:4c:73:3f:a3:c2:d7:ea:
</span></span><span style="display:flex;"><span>         cb:2a:a8:5d:86:a1:0d:4a:5e:12:51:ba:6c:1e:1c:20:75:d6:
</span></span><span style="display:flex;"><span>         5f:62:5f:d3
</span></span></code></pre></div><h3 id="è¯ä¹¦æŸ¥çœ‹">è¯ä¹¦æŸ¥çœ‹<a hidden class="anchor" aria-hidden="true" href="#è¯ä¹¦æŸ¥çœ‹">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹kube-apiçš„certæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>cat /etc/kubernetes/manifests/kube-apiserver.yaml | grep tls-cert-file
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹certfileè¯¦æƒ…</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>openssl x509 -in ./apiserver.crt -text -noout
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># kube-apiæ•…éšœï¼Œæ’æŸ¥é—®é¢˜</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ—å‡ºæ‰€æœ‰çš„å®¹å™¨</span>
</span></span><span style="display:flex;"><span>crictl ps -a
</span></span><span style="display:flex;"><span>crictl ps -a | grep kube-api
</span></span><span style="display:flex;"><span>crictl logs &lt;container-id&gt;
</span></span></code></pre></div><h3 id="certificatesigningrequest">CertificateSigningRequest<a hidden class="anchor" aria-hidden="true" href="#certificatesigningrequest">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># æœ‰ç­¾åæ–‡ä»¶akshay.csrï¼Œå…ˆbase64ç¼–ç </span>
</span></span><span style="display:flex;"><span>cat akshay.csr | base64 -w <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŒ‰ç…§å¦‚ä¸‹yamlï¼Œæ‰§è¡Œk applyåˆ›å»ºcsr</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹csrï¼Œåˆšåˆ›å»ºçš„çŠ¶æ€æ˜¯Pending</span>
</span></span><span style="display:flex;"><span>k get certificatesigningrequests
</span></span><span style="display:flex;"><span>k get csr
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æˆæƒï¼ŒæˆæƒåçŠ¶æ€æ˜¯Approved,Issued</span>
</span></span><span style="display:flex;"><span>k certificate approve &lt;csr-name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æ‹’ç» csr</span>
</span></span><span style="display:flex;"><span>kubectl certificate deny &lt;csr-name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ é™¤csr</span>
</span></span><span style="display:flex;"><span>k delete csr &lt;csr-name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹csrè¯¦æƒ…</span>
</span></span><span style="display:flex;"><span>k get csr &lt;csr-name&gt; -o yaml
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: certificates.k8s.io/v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: CertificateSigningRequest
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: akshay
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">groups</span>:
</span></span><span style="display:flex;"><span>  - system:authenticated
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">request</span>: &lt;Paste the base64 encoded value of the CSR file&gt;
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">signerName</span>: kubernetes.io/kube-apiserver-client
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">usages</span>:
</span></span><span style="display:flex;"><span>  - client auth
</span></span></code></pre></div><h3 id="kube-config">Kube Config<a hidden class="anchor" aria-hidden="true" href="#kube-config">#</a></h3>
<blockquote>
<p>Client-certificateï¼ˆå®¢æˆ·ç«¯è¯ä¹¦ï¼‰å’Œclient-keyï¼ˆå®¢æˆ·ç«¯å¯†é’¥ï¼‰æ˜¯åœ¨SSL/TLSé€šä¿¡ä¸­ç”¨äºå®¢æˆ·ç«¯èº«ä»½éªŒè¯çš„ä¸¤ä¸ªé‡è¦ç»„ä»¶ã€‚</p>
<p>å®¢æˆ·ç«¯è¯ä¹¦æ˜¯ä¸€ç§æ•°å­—è¯ä¹¦ï¼Œç”¨äºéªŒè¯å®¢æˆ·ç«¯çš„èº«ä»½ã€‚å®ƒåŒ…å«äº†å®¢æˆ·ç«¯çš„å…¬é’¥ä»¥åŠä¸ä¹‹ç›¸å…³è”çš„èº«ä»½ä¿¡æ¯ï¼Œé€šå¸¸ç”±è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ç­¾å‘ã€‚å®¢æˆ·ç«¯è¯ä¹¦å¯ä»¥è¢«æœåŠ¡å™¨ç”¨æ¥éªŒè¯å®¢æˆ·ç«¯çš„èº«ä»½ï¼Œç¡®ä¿é€šä¿¡åŒæ–¹çš„åˆæ³•æ€§å’Œå®‰å…¨æ€§ã€‚</p>
<p>å®¢æˆ·ç«¯å¯†é’¥æ˜¯å®¢æˆ·ç«¯è¯ä¹¦ä¸­åŒ…å«çš„ç§é’¥éƒ¨åˆ†ã€‚ç§é’¥æ˜¯ä¸€ç§åŠ å¯†å¯†é’¥ï¼Œç”¨äºå¯¹æ•°æ®è¿›è¡Œç­¾åå’Œè§£å¯†ã€‚å®¢æˆ·ç«¯ä½¿ç”¨ç§é’¥å¯¹æ•°æ®è¿›è¡Œç­¾åï¼ŒæœåŠ¡å™¨ä½¿ç”¨å®¢æˆ·ç«¯è¯ä¹¦ä¸­çš„å…¬é’¥å¯¹ç­¾åè¿›è¡ŒéªŒè¯ï¼Œä»è€Œç¡®è®¤å®¢æˆ·ç«¯çš„èº«ä»½ã€‚</p>
<p>åœ¨SSL/TLSé€šä¿¡ä¸­ï¼Œå®¢æˆ·ç«¯è¯ä¹¦å’Œå®¢æˆ·ç«¯å¯†é’¥é€šå¸¸ä¸€èµ·ä½¿ç”¨ï¼Œä»¥ç¡®ä¿é€šä¿¡çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ã€‚å®¢æˆ·ç«¯è¯ä¹¦ç”¨äºéªŒè¯å®¢æˆ·ç«¯çš„èº«ä»½ï¼Œå®¢æˆ·ç«¯å¯†é’¥ç”¨äºç”Ÿæˆæ•°å­—ç­¾åä»¥è¿›è¡Œèº«ä»½éªŒè¯å’Œæ•°æ®åŠ å¯†ã€‚</p>
</blockquote>
<p>è¿™ä¸‰ä¸ªæ–‡ä»¶ååç¼€åˆ†åˆ«ä»£è¡¨ä»¥ä¸‹å«ä¹‰ï¼š</p>
<ul>
<li><code>.crt</code>ï¼šä»£è¡¨è¯ä¹¦æ–‡ä»¶ï¼ŒåŒ…å«äº†å…¬é’¥å’Œè¯ä¹¦ç›¸å…³ä¿¡æ¯ã€‚</li>
<li><code>.csr</code>ï¼šä»£è¡¨è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶ï¼ŒåŒ…å«äº†å…¬é’¥å’Œä¸€äº›ä¸ªäººä¿¡æ¯ï¼Œç”¨äºå‘è¯ä¹¦é¢å‘æœºæ„ç”³è¯·ç­¾åã€‚</li>
<li><code>.key</code>ï¼šä»£è¡¨å¯†é’¥æ–‡ä»¶ï¼ŒåŒ…å«äº†ä¸è¯ä¹¦ç›¸å…³çš„ç§é’¥ä¿¡æ¯ã€‚</li>
</ul>
<p>è¿™ä¸‰ä¸ªæ–‡ä»¶ä¹‹é—´çš„å…³è”æ€§åœ¨äºï¼š</p>
<ol>
<li>è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶ï¼ˆ.csrï¼‰æ˜¯ç”¨æ¥å‘è¯ä¹¦é¢å‘æœºæ„ç”³è¯·ç­¾åçš„ï¼Œå…¶ä¸­åŒ…å«äº†å…¬é’¥å’Œä¸€äº›ä¸ªäººä¿¡æ¯ã€‚</li>
<li>è¯ä¹¦æ–‡ä»¶ï¼ˆ.crtï¼‰æ˜¯ç”±è¯ä¹¦é¢å‘æœºæ„ç­¾ååçš„è¯ä¹¦ï¼ŒåŒ…å«äº†å…¬é’¥å’Œè¯ä¹¦ç›¸å…³ä¿¡æ¯ã€‚</li>
<li>å¯†é’¥æ–‡ä»¶ï¼ˆ.keyï¼‰åŒ…å«äº†ä¸è¯ä¹¦ç›¸å…³çš„ç§é’¥ä¿¡æ¯ï¼Œç”¨äºä¸è¯ä¹¦è¿›è¡Œé…å¯¹ï¼Œä»¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†æ“ä½œã€‚</li>
</ol>
<p>è¿™ä¸‰ä¸ªæ–‡ä»¶é€šå¸¸ä¸€èµ·ä½¿ç”¨ï¼Œä»¥å»ºç«‹å®‰å…¨çš„é€šä¿¡è¿æ¥å’Œè¿›è¡ŒåŠ å¯†æ“ä½œã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># configé»˜è®¤æ–‡ä»¶è·¯å¾„</span>
</span></span><span style="display:flex;"><span>ls ~/.kube/config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹æ‰€æœ‰cluster</span>
</span></span><span style="display:flex;"><span>k config view
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŒ‡å®šconfigæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>kubectl config view --kubeconfig &lt;config-file-path&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹configä¸­çš„current-context</span>
</span></span><span style="display:flex;"><span>kubectl config current-context --kubeconfig &lt;config-file-path&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ‡æ¢context</span>
</span></span><span style="display:flex;"><span>kubectl config --kubeconfig=&lt;config-file-path&gt; use-context &lt;new-context-name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å°†è‡ªå®šä¹‰çš„configæ–‡ä»¶æ›¿æ¢~/.kube/configæ–‡ä»¶ï¼Œå³å¯è®¾ç½®ä¸ºé»˜è®¤çš„config</span>
</span></span></code></pre></div><h3 id="rbac">RBAC<a hidden class="anchor" aria-hidden="true" href="#rbac">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹kube-apiçš„authorization-mode</span>
</span></span><span style="display:flex;"><span>kubectl describe pod kube-apiserver-controlplane -n kube-system | grep mode
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ—å‡ºroles</span>
</span></span><span style="display:flex;"><span>k get roles
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ—å‡ºæ‰€æœ‰namespaceçš„roles</span>
</span></span><span style="display:flex;"><span>k get roles.rbac.authorization.k8s.io --all-namespaces --no-headers 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹rolesè¯¦æƒ…</span>
</span></span><span style="display:flex;"><span>k describe roles &lt;role-name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ—å‡ºrolebinding</span>
</span></span><span style="display:flex;"><span>k get rolebindings  --all-namespaces
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹rolebindingè¯¦æƒ…</span>
</span></span><span style="display:flex;"><span>k describe rolebindings &lt;rolebinding-name&gt; -n kube-system
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹config</span>
</span></span><span style="display:flex;"><span>k config view
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŒ‡å®šconfigä¸­çš„ç”¨æˆ·æ‰§è¡Œkubectlå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>k get pods --as &lt;user-name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ä¸Šè¿°å‘½ä»¤æ‰§è¡ŒæŠ¥é”™ï¼Œç”¨æˆ·æ— æƒé™ï¼Œéœ€è¦åˆ›å»ºroleå’Œrolebinding</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºä¸€ä¸ªroleï¼Œåä¸ºdeveloper</span>
</span></span><span style="display:flex;"><span>k create role developer --namespace=default --verb=list,create,delete --resource=pod --dry-run=client -o yaml
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºrolebindingï¼Œå°†deveploerç»‘å®šåˆ°ç”¨æˆ·dev-userä¸Š</span>
</span></span><span style="display:flex;"><span>kubectl create rolebinding dev-user-binding --namespace=default --role=developer --user=dev-user
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ç¼–è¾‘roleçš„æƒé™ï¼Œç¼–è¾‘åæ— éœ€é‡æ–°binding</span>
</span></span><span style="display:flex;"><span>k edit role &lt;role-name&gt;
</span></span></code></pre></div><h3 id="cluster-role">Cluster Role<a hidden class="anchor" aria-hidden="true" href="#cluster-role">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># åˆ—å‡ºclusterrole</span>
</span></span><span style="display:flex;"><span>k get clusterrole
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ—å‡ºclusterrolebinding</span>
</span></span><span style="display:flex;"><span>k get clusterrolebindings
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹ç¯å¢ƒä¸­clusteræ•°é‡</span>
</span></span><span style="display:flex;"><span>k get clusterrole --no-headers | wc -l
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹clusterrolebindingæ•°é‡</span>
</span></span><span style="display:flex;"><span>k get clusterrolebindings.rbac.authorization.k8s.io --no-headers | wc -l
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹æ‰€æœ‰ä¸namspaceæ— å…³çš„resource</span>
</span></span><span style="display:flex;"><span>k api-resources --namespaced=<span style="color:#fff;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹clusterroleè¯¦æƒ…</span>
</span></span><span style="display:flex;"><span>k describe clusterrole &lt;clusterrole-name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹clusterrolebindingè¯¦æƒ…</span>
</span></span><span style="display:flex;"><span>k describe clusterrolebindings.rbac.authorization.k8s.io &lt;name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºä¸€ä¸ªç®¡ç†nodeçš„clusterrole</span>
</span></span><span style="display:flex;"><span>k create clusterrole nodeadmin --resource=nodes --verb=get,watch,list,create,delete --dry-run=client  -o yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºclusterrolebinding</span>
</span></span><span style="display:flex;"><span>k create clusterrolebinding michella-binding --clusterrole nodeadmin --user=michelle  --dry-run=client -o yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æµ‹è¯•æ˜¯å¦æœ‰æ‰§è¡Œæƒé™</span>
</span></span><span style="display:flex;"><span>kubectl auth can-i list nodes --as michelle
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># éœ€è¦ç»™michelleç”¨æˆ·å¢åŠ æƒé™ï¼Œæ–°å»ºå­˜å‚¨ç›¸å…³çš„clusterroleå’Œbinding</span>
</span></span><span style="display:flex;"><span>k create clusterrole storage-admin --resource=persistentvolumes,storageclasses --verb=get,watch,list,create,delete --dry-run=client -o yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>k create clusterrolebinding michelle-storage-admin --clusterrole=storage-admin --user=michelle --dry-run=client -o yaml
</span></span></code></pre></div><h3 id="service-account">Service Account<a hidden class="anchor" aria-hidden="true" href="#service-account">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># è·å–æ‰€æœ‰service account</span>
</span></span><span style="display:flex;"><span>k get serviceaccounts
</span></span><span style="display:flex;"><span>k get sa
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹service accountè¯¦æƒ…</span>
</span></span><span style="display:flex;"><span>k describe sa &lt;sa-name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹podçš„serviceaccount</span>
</span></span><span style="display:flex;"><span>k get po web-dashboard-97c9c59f6-vmw8g -o yaml | grep -i account
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºä¸€ä¸ªserviceaccount</span>
</span></span><span style="display:flex;"><span>k create serviceaccount dashboard-sa
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ç”¨å¦‚ä¸‹yamlä¸ºserviceaccountåˆ›å»ºroleå’Œrolebindingèµ‹äºˆæƒé™</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ä¸ºdashboard-saè¿™ä¸ªservice accountåˆ›å»ºtoken</span>
</span></span><span style="display:flex;"><span>kubectl create token dashboard-sa
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ç¼–è¾‘deploymentçš„serviceaccountï¼ˆé»˜è®¤æ˜¯defaultï¼‰</span>
</span></span><span style="display:flex;"><span>k edit deployments.apps web-dashboard
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æˆ–è€…</span>
</span></span><span style="display:flex;"><span>k <span style="color:#fff;font-weight:bold">set</span> serviceaccount deploy/web-dashboard dashboard-sa
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Role
</span></span><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: rbac.authorization.k8s.io/v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">namespace</span>: default
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: pod-reader
</span></span><span style="display:flex;"><span><span style="font-weight:bold">rules</span>:
</span></span><span style="display:flex;"><span>- <span style="font-weight:bold">apiGroups</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#0ff;font-weight:bold">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">resources</span>:
</span></span><span style="display:flex;"><span>  - pods
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">verbs</span>:
</span></span><span style="display:flex;"><span>  - get
</span></span><span style="display:flex;"><span>  - watch
</span></span><span style="display:flex;"><span>  - list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: RoleBinding
</span></span><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: rbac.authorization.k8s.io/v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: read-pods
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">namespace</span>: default
</span></span><span style="display:flex;"><span><span style="font-weight:bold">subjects</span>:
</span></span><span style="display:flex;"><span>- <span style="font-weight:bold">kind</span>: ServiceAccount
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: dashboard-sa <span style="color:#007f7f"># Name is case sensitive</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">namespace</span>: default
</span></span><span style="display:flex;"><span><span style="font-weight:bold">roleRef</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">kind</span>: Role <span style="color:#007f7f">#this must be Role or ClusterRole</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: pod-reader <span style="color:#007f7f"># this must match the name of the Role or ClusterRole you wish to bind to</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">apiGroup</span>: rbac.authorization.k8s.io
</span></span></code></pre></div><h3 id="image-secret">Image Secret<a hidden class="anchor" aria-hidden="true" href="#image-secret">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># åº”ç”¨ä½¿ç”¨ç§æœ‰ä»“åº“çš„é•œåƒ</span>
</span></span><span style="display:flex;"><span>k create secret --help
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºdocker-registryç±»å‹çš„å¯†é’¥</span>
</span></span><span style="display:flex;"><span>k create secret docker-registry private-reg-cred --docker-username=dock_user --docker-password=dock_passwd --docker-server=myprivateregistry.com:5000 --docker-email=dock_user@myprivateregistry.com
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: apps/v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Deployment
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">annotations</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">deployment.kubernetes.io/revision</span>: <span style="color:#0ff;font-weight:bold">&#34;3&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">creationTimestamp</span>: <span style="color:#0ff;font-weight:bold">&#34;2023-12-02T13:18:12Z&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">generation</span>: <span style="color:#ff0;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">app</span>: web
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: web
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">namespace</span>: default
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">resourceVersion</span>: <span style="color:#0ff;font-weight:bold">&#34;2598&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">uid</span>: b375109f-b184-4cb1-9a80-425f1a940e3d
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">progressDeadlineSeconds</span>: <span style="color:#ff0;font-weight:bold">600</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">replicas</span>: <span style="color:#ff0;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">revisionHistoryLimit</span>: <span style="color:#ff0;font-weight:bold">10</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">app</span>: web
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">strategy</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">rollingUpdate</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">maxSurge</span>: <span style="color:#ff0;font-weight:bold">25</span>%
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">maxUnavailable</span>: <span style="color:#ff0;font-weight:bold">25</span>%
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">type</span>: RollingUpdate
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">template</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">creationTimestamp</span>: <span style="color:#fff;font-weight:bold">null</span>
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">app</span>: web
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="font-weight:bold">image</span>: myprivateregistry.com:5000/nginx:alpine
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">imagePullPolicy</span>: IfNotPresent
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">name</span>: nginx
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">resources</span>: {}
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">terminationMessagePath</span>: /dev/termination-log
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">terminationMessagePolicy</span>: File
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">dnsPolicy</span>: ClusterFirst
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">imagePullSecrets</span>:
</span></span><span style="display:flex;"><span>      - <span style="font-weight:bold">name</span>: private-reg-cred
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">restartPolicy</span>: Always
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">schedulerName</span>: default-scheduler
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">securityContext</span>: {}
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">terminationGracePeriodSeconds</span>: <span style="color:#ff0;font-weight:bold">30</span>
</span></span></code></pre></div><h3 id="security-context">Security Context<a hidden class="anchor" aria-hidden="true" href="#security-context">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># æ‰§è¡ŒwhoamiæŸ¥çœ‹å®¹å™¨å†…éƒ¨çš„æ‰§è¡Œç”¨æˆ·</span>
</span></span><span style="display:flex;"><span>kubectl <span style="color:#fff;font-weight:bold">exec</span> &lt;pod-name&gt; -- whoami
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å¼ºåˆ¶åˆ é™¤pod</span>
</span></span><span style="display:flex;"><span>kubectl delete pod &lt;pod-name&gt; --force
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æ›´æ–°security contextå¿…é¡»å…ˆåˆ é™¤å†æ–°å»ºpodï¼Œå¯ä»¥ç”¨k replaceå‘½ä»¤</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ç¼–è¾‘å¦‚ä¸‹yamlï¼Œå®¹å™¨å†…ç”¨user ID 1010æ‰§è¡Œsleepå‘½ä»¤</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Pod
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: ubuntu-sleeper
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">namespace</span>: default
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">securityContext</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">runAsUser</span>: <span style="color:#ff0;font-weight:bold">1010</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">command</span>:
</span></span><span style="display:flex;"><span>    - sleep
</span></span><span style="display:flex;"><span>    - <span style="color:#0ff;font-weight:bold">&#34;4800&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">image</span>: ubuntu
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">name</span>: ubuntu-sleeper
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">securityContext</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">capabilities</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">add</span>: [<span style="color:#0ff;font-weight:bold">&#34;SYS_TIME&#34;</span>]
</span></span></code></pre></div><blockquote>
<p>ä¸åŒlevelçš„context</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Pod
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: multi-pod
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">securityContext</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">runAsUser</span>: <span style="color:#ff0;font-weight:bold">1001</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">containers</span>:
</span></span><span style="display:flex;"><span>  -  <span style="font-weight:bold">image</span>: ubuntu
</span></span><span style="display:flex;"><span>     <span style="font-weight:bold">name</span>: web
</span></span><span style="display:flex;"><span>     <span style="font-weight:bold">command</span>: [<span style="color:#0ff;font-weight:bold">&#34;sleep&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;5000&#34;</span>]
</span></span><span style="display:flex;"><span>     <span style="font-weight:bold">securityContext</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">runAsUser</span>: <span style="color:#ff0;font-weight:bold">1002</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  -  <span style="font-weight:bold">image</span>: ubuntu
</span></span><span style="display:flex;"><span>     <span style="font-weight:bold">name</span>: sidecar
</span></span><span style="display:flex;"><span>     <span style="font-weight:bold">command</span>: [<span style="color:#0ff;font-weight:bold">&#34;sleep&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;5000&#34;</span>]
</span></span></code></pre></div><blockquote>
<p>ç¼–è¾‘å¦‚ä¸‹yamlï¼Œä¸ºå®¹å™¨å¢åŠ SYS_TIMEçš„èƒ½åŠ›</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Pod
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: ubuntu-sleeper
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">namespace</span>: default
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">command</span>:
</span></span><span style="display:flex;"><span>    - sleep
</span></span><span style="display:flex;"><span>    - <span style="color:#0ff;font-weight:bold">&#34;4800&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">image</span>: ubuntu
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">name</span>: ubuntu-sleeper
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">securityContext</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">capabilities</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">add</span>: [<span style="color:#0ff;font-weight:bold">&#34;SYS_TIME&#34;</span>]
</span></span></code></pre></div><h3 id="network-policy">Network Policy<a hidden class="anchor" aria-hidden="true" href="#network-policy">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># åˆ—å‡ºnetworkpolicy</span>
</span></span><span style="display:flex;"><span>k get networkpolicies.networking.k8s.io
</span></span><span style="display:flex;"><span>k get netpol
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹netpolè¯¦æƒ…</span>
</span></span><span style="display:flex;"><span>k describe netpol &lt;netpol-name&gt; 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ä½¿ç”¨netpolä¸­å¯¹åº”çš„selectoræŸ¥è¯¢åº”ç”¨çš„pod</span>
</span></span><span style="display:flex;"><span>k get pods --selector name=payroll
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æˆ–è€…</span>
</span></span><span style="display:flex;"><span>k get po --show-labels
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºnetwork policyä½¿å¾—Internalåªèƒ½è®¿é—®mysqlå’Œpayroll</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æ³¨æ„åŒæ—¶æ”¾å¼€äº†53ç«¯å£ï¼Œå› ä¸ºéœ€è¦é€šè¿‡53ç«¯å£è®¿é—®DNS</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ä½¿ç”¨å¦‚ä¸‹yamlå®ç°</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: networking.k8s.io/v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: NetworkPolicy
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: internal-policy
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">namespace</span>: default
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">podSelector</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">name</span>: internal
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">policyTypes</span>:
</span></span><span style="display:flex;"><span>  - Egress
</span></span><span style="display:flex;"><span>  - Ingress
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">ingress</span>:
</span></span><span style="display:flex;"><span>    - {}
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">egress</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">to</span>:
</span></span><span style="display:flex;"><span>    - <span style="font-weight:bold">podSelector</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">matchLabels</span>:
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">name</span>: mysql
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="font-weight:bold">protocol</span>: TCP
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">port</span>: <span style="color:#ff0;font-weight:bold">3306</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">to</span>:
</span></span><span style="display:flex;"><span>    - <span style="font-weight:bold">podSelector</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">matchLabels</span>:
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">name</span>: payroll
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="font-weight:bold">protocol</span>: TCP
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">port</span>: <span style="color:#ff0;font-weight:bold">8080</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="font-weight:bold">port</span>: <span style="color:#ff0;font-weight:bold">53</span>
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">protocol</span>: UDP
</span></span><span style="display:flex;"><span>    - <span style="font-weight:bold">port</span>: <span style="color:#ff0;font-weight:bold">53</span>
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">protocol</span>: TCP
</span></span></code></pre></div><h2 id="å­˜å‚¨storage">å­˜å‚¨Storage<a hidden class="anchor" aria-hidden="true" href="#å­˜å‚¨storage">#</a></h2>
<h3 id="persistent-volume-claim">Persistent Volume Claim<a hidden class="anchor" aria-hidden="true" href="#persistent-volume-claim">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹podå†…çš„æ—¥å¿—</span>
</span></span><span style="display:flex;"><span>kubectl <span style="color:#fff;font-weight:bold">exec</span> &lt;pod-name&gt; -- cat /log/app.log
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ä¸ºpodæ·»åŠ æŒä¹…åŒ–çš„æ—¥å¿—å·</span>
</span></span><span style="display:flex;"><span>kubectl get po webapp -o yaml &gt; webapp.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># é…ç½®hostpathç±»å‹çš„volume</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Pod
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: webapp
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">name</span>: event-simulator
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">image</span>: kodekloud/event-simulator
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">env</span>:
</span></span><span style="display:flex;"><span>    - <span style="font-weight:bold">name</span>: LOG_HANDLERS
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">value</span>: file
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">volumeMounts</span>:
</span></span><span style="display:flex;"><span>    - <span style="font-weight:bold">mountPath</span>: /log
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">name</span>: log-volume
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">volumes</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">name</span>: log-volume
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">hostPath</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f"># directory location on host</span>
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">path</span>: /var/log/webapp
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f"># this field is optional</span>
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">type</span>: Directory
</span></span></code></pre></div><blockquote>
<p>ç”¨å¦‚ä¸‹yamlåˆ›å»ºPersistent Volume</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: PersistentVolume
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: pv-log
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">persistentVolumeReclaimPolicy</span>: Retain
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">accessModes</span>:
</span></span><span style="display:flex;"><span>    - ReadWriteMany
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">capacity</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">storage</span>: 100Mi
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">hostPath</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">path</span>: /pv/log
</span></span></code></pre></div><blockquote>
<p>åˆ›å»ºPersistent Volume Claim</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: PersistentVolumeClaim
</span></span><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: claim-log-1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">accessModes</span>:
</span></span><span style="display:flex;"><span>    - ReadWriteOnce
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">requests</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">storage</span>: 50Mi
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># åˆ—å‡ºpersistent volume</span>
</span></span><span style="display:flex;"><span>k get persistentvolume
</span></span><span style="display:flex;"><span>k get pv
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ—å‡ºpersistent volume claim</span>
</span></span><span style="display:flex;"><span>k get pvc
</span></span><span style="display:flex;"><span>k get persistentvolumeclaims
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ—å‡ºå¤šç§èµ„æº</span>
</span></span><span style="display:flex;"><span>k get pv,pvc
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># podä¸­ä½¿ç”¨pvc</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Pod
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: webapp
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">name</span>: event-simulator
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">image</span>: kodekloud/event-simulator
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">env</span>:
</span></span><span style="display:flex;"><span>    - <span style="font-weight:bold">name</span>: LOG_HANDLERS
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">value</span>: file
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">volumeMounts</span>:
</span></span><span style="display:flex;"><span>    - <span style="font-weight:bold">mountPath</span>: /log
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">name</span>: log-volume
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">volumes</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">name</span>: log-volume
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">persistentVolumeClaim</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">claimName</span>: claim-log-1
</span></span></code></pre></div><blockquote>
<p>è¢«podä½¿ç”¨ä¸­çš„PVCæ— æ³•ç›´æ¥åˆ é™¤ï¼Œéœ€è¦ç­‰åˆ°podåˆ é™¤åæ‰èƒ½åˆ æ‰PVC</p>
</blockquote>
<h3 id="storage-class">Storage Class<a hidden class="anchor" aria-hidden="true" href="#storage-class">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># åˆ—å‡ºstorage class</span>
</span></span><span style="display:flex;"><span>k get storageclasses.storage.k8s.io
</span></span><span style="display:flex;"><span>k get sc
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹scè¯¦æƒ…</span>
</span></span><span style="display:flex;"><span>k describe sc &lt;sc-name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºstorage classï¼Œä½¿ç”¨å¦‚ä¸‹yaml</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: storage.k8s.io/v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: StorageClass
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: delayed-volume-sc
</span></span><span style="display:flex;"><span><span style="font-weight:bold">provisioner</span>: kubernetes.io/no-provisioner
</span></span><span style="display:flex;"><span><span style="font-weight:bold">volumeBindingMode</span>: WaitForFirstConsumer
</span></span></code></pre></div><blockquote>
<p>æ³¨æ„WaitForFirstConsumeæ¨¡å¼çš„storageï¼Œpvcç»‘å®špvæ—¶ï¼Œä¸ä¼šç«‹åˆ»ç”³è¯·å­˜å‚¨ï¼Œè€Œæ˜¯å¤„äºPENDINGçŠ¶æ€ï¼Œç­‰åˆ°ä½¿ç”¨pvcçš„podè¢«è°ƒåº¦æ—¶ï¼Œæ‰ä¼šå®é™…ä¸Šç”³è¯·å­˜å‚¨</p>
<p>å¦‚ä¸‹ä¸ºä¸€ä¸ªä½¿ç”¨pvcçš„yaml</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Pod
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: nginx
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">name</span>: nginx
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">name</span>: nginx
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">image</span>: nginx:alpine
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">volumeMounts</span>:
</span></span><span style="display:flex;"><span>      - <span style="font-weight:bold">name</span>: local-persistent-storage
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">mountPath</span>: /var/www/html
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">volumes</span>:
</span></span><span style="display:flex;"><span>    - <span style="font-weight:bold">name</span>: local-persistent-storage
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">persistentVolumeClaim</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">claimName</span>: local-pvc
</span></span></code></pre></div><h2 id="ç½‘ç»œnetworking">ç½‘ç»œNetworking<a hidden class="anchor" aria-hidden="true" href="#ç½‘ç»œnetworking">#</a></h2>
<h3 id="ç½‘ç»œåŸºæœ¬å‘½ä»¤">ç½‘ç»œåŸºæœ¬å‘½ä»¤<a hidden class="anchor" aria-hidden="true" href="#ç½‘ç»œåŸºæœ¬å‘½ä»¤">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹nodeçš„internal ipåœ°å€</span>
</span></span><span style="display:flex;"><span>k get nodes -o wide
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹ipåœ°å€å¯¹åº”çš„ç½‘å£</span>
</span></span><span style="display:flex;"><span>ip a | grep &lt;ip&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹ç½‘å£çš„macåœ°å€/çŠ¶æ€</span>
</span></span><span style="display:flex;"><span>ip link show &lt;interface-name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹Containerdåˆ›å»ºçš„ç½‘å£(Container Network Interface)</span>
</span></span><span style="display:flex;"><span>ip link | grep cni
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹è·¯ç”±è¡¨</span>
</span></span><span style="display:flex;"><span>ip route list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹é»˜è®¤è·¯ç”±</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># é»˜è®¤è·¯ç”±ï¼šé»˜è®¤è·¯ç”±æ˜¯æŒ‡å½“ç›®æ ‡ç½‘ç»œä¸åœ¨è·¯ç”±è¡¨ä¸­æ—¶ï¼Œæ•°æ®åŒ…å°†è¢«å‘é€åˆ°çš„é»˜è®¤ç½‘å…³</span>
</span></span><span style="display:flex;"><span>ip route show default
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹kubeæœåŠ¡ç›‘å¬çš„port</span>
</span></span><span style="display:flex;"><span>netstat -ntpl | grep kube
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹etcdçš„tcpç›‘å¬æœåŠ¡</span>
</span></span><span style="display:flex;"><span>netstat -ntpl | grep etcd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹etcdçš„æ‰€æœ‰é“¾æ¥ï¼ˆåŒ…å«clientï¼‰</span>
</span></span><span style="display:flex;"><span>netstat -anp | grep etcd
</span></span></code></pre></div><h3 id="cni">CNI<a hidden class="anchor" aria-hidden="true" href="#cni">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹kubeletçš„container runtime endpoint</span>
</span></span><span style="display:flex;"><span>ps aux | grep kubelet | grep runtime
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹cniçš„æ’ä»¶</span>
</span></span><span style="display:flex;"><span>ls /opt/cni/bin/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹å½“å‰clusteré…ç½®çš„cniæ’ä»¶</span>
</span></span><span style="display:flex;"><span>ls /etc/cni/net.d/
</span></span></code></pre></div><h3 id="éƒ¨ç½²weave-net">éƒ¨ç½²weave net<a hidden class="anchor" aria-hidden="true" href="#éƒ¨ç½²weave-net">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># éƒ¨ç½²weave-net</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>k apply -f weave-daemonset-k8s.yaml
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># serviceaccount/weave-net created</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># clusterrole.rbac.authorization.k8s.io/weave-net created</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># clusterrolebinding.rbac.authorization.k8s.io/weave-net created</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># role.rbac.authorization.k8s.io/weave-net created</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># rolebinding.rbac.authorization.k8s.io/weave-net created</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># daemonset.apps/weave-net created</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: List
</span></span><span style="display:flex;"><span><span style="font-weight:bold">items</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">apiVersion</span>: v1
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">kind</span>: ServiceAccount
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">name</span>: weave-net
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">name</span>: weave-net
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">namespace</span>: kube-system
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">apiVersion</span>: rbac.authorization.k8s.io/v1
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">kind</span>: ClusterRole
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">name</span>: weave-net
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">name</span>: weave-net
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">rules</span>:
</span></span><span style="display:flex;"><span>      - <span style="font-weight:bold">apiGroups</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#0ff;font-weight:bold">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">resources</span>:
</span></span><span style="display:flex;"><span>          - pods
</span></span><span style="display:flex;"><span>          - namespaces
</span></span><span style="display:flex;"><span>          - nodes
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">verbs</span>:
</span></span><span style="display:flex;"><span>          - get
</span></span><span style="display:flex;"><span>          - list
</span></span><span style="display:flex;"><span>          - watch
</span></span><span style="display:flex;"><span>      - <span style="font-weight:bold">apiGroups</span>:
</span></span><span style="display:flex;"><span>          - extensions
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">resources</span>:
</span></span><span style="display:flex;"><span>          - networkpolicies
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">verbs</span>:
</span></span><span style="display:flex;"><span>          - get
</span></span><span style="display:flex;"><span>          - list
</span></span><span style="display:flex;"><span>          - watch
</span></span><span style="display:flex;"><span>      - <span style="font-weight:bold">apiGroups</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#0ff;font-weight:bold">&#39;networking.k8s.io&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">resources</span>:
</span></span><span style="display:flex;"><span>          - networkpolicies
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">verbs</span>:
</span></span><span style="display:flex;"><span>          - get
</span></span><span style="display:flex;"><span>          - list
</span></span><span style="display:flex;"><span>          - watch
</span></span><span style="display:flex;"><span>      - <span style="font-weight:bold">apiGroups</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#0ff;font-weight:bold">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">resources</span>:
</span></span><span style="display:flex;"><span>        - nodes/status
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">verbs</span>:
</span></span><span style="display:flex;"><span>        - patch
</span></span><span style="display:flex;"><span>        - update
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">apiVersion</span>: rbac.authorization.k8s.io/v1
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">kind</span>: ClusterRoleBinding
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">name</span>: weave-net
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">name</span>: weave-net
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">roleRef</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">kind</span>: ClusterRole
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">name</span>: weave-net
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">apiGroup</span>: rbac.authorization.k8s.io
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">subjects</span>:
</span></span><span style="display:flex;"><span>      - <span style="font-weight:bold">kind</span>: ServiceAccount
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">name</span>: weave-net
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">namespace</span>: kube-system
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">apiVersion</span>: rbac.authorization.k8s.io/v1
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">kind</span>: Role
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">name</span>: weave-net
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">namespace</span>: kube-system
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">name</span>: weave-net
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">rules</span>:
</span></span><span style="display:flex;"><span>      - <span style="font-weight:bold">apiGroups</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#0ff;font-weight:bold">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">resources</span>:
</span></span><span style="display:flex;"><span>          - configmaps
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">resourceNames</span>:
</span></span><span style="display:flex;"><span>          - weave-net
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">verbs</span>:
</span></span><span style="display:flex;"><span>          - get
</span></span><span style="display:flex;"><span>          - update
</span></span><span style="display:flex;"><span>      - <span style="font-weight:bold">apiGroups</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#0ff;font-weight:bold">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">resources</span>:
</span></span><span style="display:flex;"><span>          - configmaps
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">verbs</span>:
</span></span><span style="display:flex;"><span>          - create
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">apiVersion</span>: rbac.authorization.k8s.io/v1
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">kind</span>: RoleBinding
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">name</span>: weave-net
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">namespace</span>: kube-system
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">name</span>: weave-net
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">roleRef</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">kind</span>: Role
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">name</span>: weave-net
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">apiGroup</span>: rbac.authorization.k8s.io
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">subjects</span>:
</span></span><span style="display:flex;"><span>      - <span style="font-weight:bold">kind</span>: ServiceAccount
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">name</span>: weave-net
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">namespace</span>: kube-system
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">apiVersion</span>: apps/v1
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">kind</span>: DaemonSet
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">name</span>: weave-net
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">name</span>: weave-net
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">namespace</span>: kube-system
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f"># Wait 5 seconds to let pod connect before rolling next pod</span>
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">selector</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">matchLabels</span>:
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">name</span>: weave-net
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">minReadySeconds</span>: <span style="color:#ff0;font-weight:bold">5</span>
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">template</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">labels</span>:
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">name</span>: weave-net
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">initContainers</span>:
</span></span><span style="display:flex;"><span>            - <span style="font-weight:bold">name</span>: weave-init
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">image</span>: <span style="color:#0ff;font-weight:bold">&#39;weaveworks/weave-kube:2.8.1&#39;</span>
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">command</span>:
</span></span><span style="display:flex;"><span>                - /home/weave/init.sh
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">env</span>:
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">securityContext</span>:
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">privileged</span>: <span style="color:#fff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">volumeMounts</span>:
</span></span><span style="display:flex;"><span>                - <span style="font-weight:bold">name</span>: cni-bin
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">mountPath</span>: /host/opt
</span></span><span style="display:flex;"><span>                - <span style="font-weight:bold">name</span>: cni-bin2
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">mountPath</span>: /host/home
</span></span><span style="display:flex;"><span>                - <span style="font-weight:bold">name</span>: cni-conf
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">mountPath</span>: /host/etc
</span></span><span style="display:flex;"><span>                - <span style="font-weight:bold">name</span>: lib-modules
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">mountPath</span>: /lib/modules
</span></span><span style="display:flex;"><span>                - <span style="font-weight:bold">name</span>: xtables-lock
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">mountPath</span>: /run/xtables.lock
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">readOnly</span>: <span style="color:#fff;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">containers</span>:
</span></span><span style="display:flex;"><span>            - <span style="font-weight:bold">name</span>: weave
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">command</span>:
</span></span><span style="display:flex;"><span>                - /home/weave/launch.sh
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">env</span>:
</span></span><span style="display:flex;"><span>                - <span style="font-weight:bold">name</span>: IPALLOC_RANGE
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">value</span>: <span style="color:#ff0;font-weight:bold">10.32.1.0</span>/24
</span></span><span style="display:flex;"><span>                - <span style="font-weight:bold">name</span>: INIT_CONTAINER
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">value</span>: <span style="color:#0ff;font-weight:bold">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>                - <span style="font-weight:bold">name</span>: HOSTNAME
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">valueFrom</span>:
</span></span><span style="display:flex;"><span>                    <span style="font-weight:bold">fieldRef</span>:
</span></span><span style="display:flex;"><span>                      <span style="font-weight:bold">apiVersion</span>: v1
</span></span><span style="display:flex;"><span>                      <span style="font-weight:bold">fieldPath</span>: spec.nodeName
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">image</span>: <span style="color:#0ff;font-weight:bold">&#39;weaveworks/weave-kube:2.8.1&#39;</span>
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">readinessProbe</span>:
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">httpGet</span>:
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">host</span>: <span style="color:#ff0;font-weight:bold">127.0.0.1</span>
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">path</span>: /status
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">port</span>: <span style="color:#ff0;font-weight:bold">6784</span>
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">resources</span>:
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">requests</span>:
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">cpu</span>: 50m
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">securityContext</span>:
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">privileged</span>: <span style="color:#fff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">volumeMounts</span>:
</span></span><span style="display:flex;"><span>                - <span style="font-weight:bold">name</span>: weavedb
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">mountPath</span>: /weavedb
</span></span><span style="display:flex;"><span>                - <span style="font-weight:bold">name</span>: dbus
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">mountPath</span>: /host/var/lib/dbus
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">readOnly</span>: <span style="color:#fff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>                - <span style="font-weight:bold">mountPath</span>: /host/etc/machine-id
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">name</span>: cni-machine-id
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">readOnly</span>: <span style="color:#fff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>                - <span style="font-weight:bold">name</span>: xtables-lock
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">mountPath</span>: /run/xtables.lock
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">readOnly</span>: <span style="color:#fff;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>            - <span style="font-weight:bold">name</span>: weave-npc
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">env</span>:
</span></span><span style="display:flex;"><span>                - <span style="font-weight:bold">name</span>: HOSTNAME
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">valueFrom</span>:
</span></span><span style="display:flex;"><span>                    <span style="font-weight:bold">fieldRef</span>:
</span></span><span style="display:flex;"><span>                      <span style="font-weight:bold">apiVersion</span>: v1
</span></span><span style="display:flex;"><span>                      <span style="font-weight:bold">fieldPath</span>: spec.nodeName
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">image</span>: <span style="color:#0ff;font-weight:bold">&#39;weaveworks/weave-npc:2.8.1&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#npc-args</span>
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">resources</span>:
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">requests</span>:
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">cpu</span>: 50m
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">securityContext</span>:
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">privileged</span>: <span style="color:#fff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">volumeMounts</span>:
</span></span><span style="display:flex;"><span>                - <span style="font-weight:bold">name</span>: xtables-lock
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">mountPath</span>: /run/xtables.lock
</span></span><span style="display:flex;"><span>                  <span style="font-weight:bold">readOnly</span>: <span style="color:#fff;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">hostNetwork</span>: <span style="color:#fff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">dnsPolicy</span>: ClusterFirstWithHostNet
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">hostPID</span>: <span style="color:#fff;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">restartPolicy</span>: Always
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">securityContext</span>:
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">seLinuxOptions</span>: {}
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">serviceAccountName</span>: weave-net
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">tolerations</span>:
</span></span><span style="display:flex;"><span>            - <span style="font-weight:bold">effect</span>: NoSchedule
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">operator</span>: Exists
</span></span><span style="display:flex;"><span>            - <span style="font-weight:bold">effect</span>: NoExecute
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">operator</span>: Exists
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">volumes</span>:
</span></span><span style="display:flex;"><span>            - <span style="font-weight:bold">name</span>: weavedb
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">hostPath</span>:
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">path</span>: /var/lib/weave
</span></span><span style="display:flex;"><span>            - <span style="font-weight:bold">name</span>: cni-bin
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">hostPath</span>:
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">path</span>: /opt
</span></span><span style="display:flex;"><span>            - <span style="font-weight:bold">name</span>: cni-bin2
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">hostPath</span>:
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">path</span>: /home
</span></span><span style="display:flex;"><span>            - <span style="font-weight:bold">name</span>: cni-conf
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">hostPath</span>:
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">path</span>: /etc
</span></span><span style="display:flex;"><span>            - <span style="font-weight:bold">name</span>: cni-machine-id
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">hostPath</span>:
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">path</span>: /etc/machine-id
</span></span><span style="display:flex;"><span>            - <span style="font-weight:bold">name</span>: dbus
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">hostPath</span>:
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">path</span>: /var/lib/dbus
</span></span><span style="display:flex;"><span>            - <span style="font-weight:bold">name</span>: lib-modules
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">hostPath</span>:
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">path</span>: /lib/modules
</span></span><span style="display:flex;"><span>            - <span style="font-weight:bold">name</span>: xtables-lock
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">hostPath</span>:
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">path</span>: /run/xtables.lock
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold">type</span>: FileOrCreate
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">priorityClassName</span>: system-node-critical
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">updateStrategy</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">type</span>: RollingUpdate
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹weaveçš„agent/peer</span>
</span></span><span style="display:flex;"><span>k get pods --all-namespaces | grep weave
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># weave podåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šå­˜åœ¨ä¸€ä¸ªï¼ˆåŒ…æ‹¬masterå’Œwork nodeï¼‰</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹weaveåˆ›å»ºçš„ç½‘å£</span>
</span></span><span style="display:flex;"><span>ip link | grep weave
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹weaveç½‘å£çš„ipåœ°å€æ®µ</span>
</span></span><span style="display:flex;"><span>ip addr show weave
</span></span><span style="display:flex;"><span>ip route list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹work nodeä¸Šweave netçš„é»˜è®¤ç½‘å…³ï¼Œé¦–å…ˆç™»å½•åˆ°work node</span>
</span></span><span style="display:flex;"><span>ip route | gre weave
</span></span></code></pre></div><h3 id="service-networking">Service Networking<a hidden class="anchor" aria-hidden="true" href="#service-networking">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹æ•´ä¸ªclusterçš„ç½‘ç»œèŒƒå›´</span>
</span></span><span style="display:flex;"><span>ip addr | grep eth0
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 215: eth0@if216: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UP group default </span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#    inet 192.4.210.9/24 brd 192.4.210.255 scope global eth0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ipcalc -b 192.4.210.9
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># è®¡ç®—çš„clusterçš„åœ°å€èŒƒå›´192.4.210.0/24</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹clusterä¸­podçš„ç½‘ç»œåœ°å€èŒƒå›´</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># è‹¥podä½¿ç”¨weaveç½‘ç»œï¼Œä½¿ç”¨å¦‚ä¸‹æŸ¥è¯¢æ–¹å¼</span>
</span></span><span style="display:flex;"><span>k logs -n kube-system weave-net-8v8hr  | grep ipalloc-range
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># podåœ°å€èŒƒå›´æ˜¯10.244.0.0/16</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹serviceçš„ç½‘ç»œåœ°å€èŒƒå›´</span>
</span></span><span style="display:flex;"><span>cat /etc/kubernetes/manifests/kube-apiserver.yaml | grep cluster-ip-range
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># --service-cluster-ip-range=10.96.0.0/12</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹kube-proxyçš„ç±»å‹</span>
</span></span><span style="display:flex;"><span>k logs -n kube-system &lt;kube-proxy-pod-name&gt;
</span></span></code></pre></div><h3 id="coredns">CoreDNS<a hidden class="anchor" aria-hidden="true" href="#coredns">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹clusterçš„DNSè§£å†³æ–¹æ¡ˆ</span>
</span></span><span style="display:flex;"><span>k get pods -n kube-system | grep dns
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹dns service</span>
</span></span><span style="display:flex;"><span>k get service --all-namespaces | grep dns
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹corednsçš„é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>k -n kube-system describe deployments.apps coredns | grep -A2 Args
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹Corefileçš„æ³¨å…¥æ–¹å¼</span>
</span></span><span style="display:flex;"><span>k get po -n kube-system coredns-5d78c9869d-5sxxz  -o yaml
</span></span><span style="display:flex;"><span>k describe cm -n kube-system coredns
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># serviceçš„DNSè§„åˆ™å¦‚ä¸‹ï¼šservice.namespace.svc.cluster.local</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># web-service.payroll.svc.cluster.local</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹DNSç»“æœ</span>
</span></span><span style="display:flex;"><span>kubectl <span style="color:#fff;font-weight:bold">exec</span> -it hr -- nslookup mysql.payroll &gt; /root/CKA/nslookup.out
</span></span></code></pre></div><h3 id="ingress">Ingress<a hidden class="anchor" aria-hidden="true" href="#ingress">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹ingress</span>
</span></span><span style="display:flex;"><span>kubectl get all -A | grep -i ingress
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>k get ingress -A
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹ingressè¯¦æƒ…</span>
</span></span><span style="display:flex;"><span>kubectl describe ingress &lt;ingress-name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ç¼–è¾‘ingressä¿®æ”¹rules</span>
</span></span><span style="display:flex;"><span>kubectl edit ingress
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºingressï¼Œæ³¨æ„å¦‚ä¸‹å‘½ä»¤ç¼ºå°‘annotationï¼Œåˆ›å»ºçš„yamlæ·»åŠ annotationæ‰èƒ½æ­£å¸¸å·¥ä½œ</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># pathType: Exact</span>
</span></span><span style="display:flex;"><span>k create ingress -n critical-space test-ingress --rule=/pay=pay-service:8282  --dry-run=client -o yaml
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># pathType: Prefix</span>
</span></span><span style="display:flex;"><span>k create ingress -n critical-space test-ingress --rule=/pay*=pay-service:8282   --dry-run=client -o yaml
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: networking.k8s.io/v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Ingress
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">annotations</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">nginx.ingress.kubernetes.io/rewrite-target</span>: /
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">nginx.ingress.kubernetes.io/ssl-redirect</span>: <span style="color:#0ff;font-weight:bold">&#34;false&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: ingress-wear-watch
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">namespace</span>: app-space
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">rules</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">http</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">paths</span>:
</span></span><span style="display:flex;"><span>      - <span style="font-weight:bold">backend</span>:
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">service</span>:
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">name</span>: wear-service
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">port</span>: 
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">number</span>: <span style="color:#ff0;font-weight:bold">8080</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">path</span>: /wear
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">pathType</span>: Prefix
</span></span><span style="display:flex;"><span>      - <span style="font-weight:bold">backend</span>:
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">service</span>:
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">name</span>: video-service
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">port</span>: 
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">number</span>: <span style="color:#ff0;font-weight:bold">8080</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">path</span>: /stream
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">pathType</span>: Prefix
</span></span></code></pre></div><blockquote>
<p>å¦‚ä¸‹ä¸ºclusteråˆ›å»ºingress controller</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºingressç‹¬ç«‹çš„namespace(ä¾¿äºéš”ç¦»)</span>
</span></span><span style="display:flex;"><span>k create namespace ingress-nginx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºconfigmap</span>
</span></span><span style="display:flex;"><span>kubectl create configmap ingress-nginx-controller --namespace ingress-nginx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºservice account</span>
</span></span><span style="display:flex;"><span>k create sa ingress-nginx -n ingress-nginx
</span></span><span style="display:flex;"><span>k create sa ingress-nginx-admission -n ingress-nginx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># åˆ›å»ºroleï¼Œrolebindingï¼Œclusterroleï¼Œclusterrolebinding</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ç•¥</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ingress controller çš„yamlå¦‚ä¸‹</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: apps/v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Deployment
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">app.kubernetes.io/component</span>: controller
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">app.kubernetes.io/instance</span>: ingress-nginx
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">app.kubernetes.io/managed-by</span>: Helm
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">app.kubernetes.io/name</span>: ingress-nginx
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">app.kubernetes.io/part-of</span>: ingress-nginx
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">app.kubernetes.io/version</span>: <span style="color:#ff0;font-weight:bold">1.1.2</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">helm.sh/chart</span>: ingress-nginx-4.0.18
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: ingress-nginx-controller
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">namespace</span>: ingress-nginx
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">replicas</span>: <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">minReadySeconds</span>: <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">revisionHistoryLimit</span>: <span style="color:#ff0;font-weight:bold">10</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">app.kubernetes.io/component</span>: controller
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">app.kubernetes.io/instance</span>: ingress-nginx
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">app.kubernetes.io/name</span>: ingress-nginx
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">template</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">app.kubernetes.io/component</span>: controller
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">app.kubernetes.io/instance</span>: ingress-nginx
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">app.kubernetes.io/name</span>: ingress-nginx
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="font-weight:bold">args</span>:
</span></span><span style="display:flex;"><span>        - /nginx-ingress-controller
</span></span><span style="display:flex;"><span>        - --publish-service=$(POD_NAMESPACE)/ingress-nginx-controller
</span></span><span style="display:flex;"><span>        - --election-id=ingress-controller-leader
</span></span><span style="display:flex;"><span>        - --watch-ingress-without-class=true
</span></span><span style="display:flex;"><span>        - --default-backend-service=app-space/default-http-backend
</span></span><span style="display:flex;"><span>        - --controller-class=k8s.io/ingress-nginx
</span></span><span style="display:flex;"><span>        - --ingress-class=nginx
</span></span><span style="display:flex;"><span>        - --configmap=$(POD_NAMESPACE)/ingress-nginx-controller
</span></span><span style="display:flex;"><span>        - --validating-webhook=:8443
</span></span><span style="display:flex;"><span>        - --validating-webhook-certificate=/usr/local/certificates/cert
</span></span><span style="display:flex;"><span>        - --validating-webhook-key=/usr/local/certificates/key
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">env</span>:
</span></span><span style="display:flex;"><span>        - <span style="font-weight:bold">name</span>: POD_NAME
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">valueFrom</span>:
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">fieldRef</span>:
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">fieldPath</span>: metadata.name
</span></span><span style="display:flex;"><span>        - <span style="font-weight:bold">name</span>: POD_NAMESPACE
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">valueFrom</span>:
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">fieldRef</span>:
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">fieldPath</span>: metadata.namespace
</span></span><span style="display:flex;"><span>        - <span style="font-weight:bold">name</span>: LD_PRELOAD
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">value</span>: /usr/local/lib/libmimalloc.so
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">image</span>: registry.k8s.io/ingress-nginx/controller:v1.1.2@sha256:28b11ce69e57843de44e3db6413e98d09de0f6688e33d4bd384002a44f78405c
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">imagePullPolicy</span>: IfNotPresent
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">lifecycle</span>:
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">preStop</span>:
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">exec</span>:
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">command</span>:
</span></span><span style="display:flex;"><span>              - /wait-shutdown
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">livenessProbe</span>:
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">failureThreshold</span>: <span style="color:#ff0;font-weight:bold">5</span>
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">httpGet</span>:
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">path</span>: /healthz
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">port</span>: <span style="color:#ff0;font-weight:bold">10254</span>
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">scheme</span>: HTTP
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">initialDelaySeconds</span>: <span style="color:#ff0;font-weight:bold">10</span>
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">periodSeconds</span>: <span style="color:#ff0;font-weight:bold">10</span>
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">successThreshold</span>: <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">timeoutSeconds</span>: <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">name</span>: controller
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="font-weight:bold">name</span>: http
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">containerPort</span>: <span style="color:#ff0;font-weight:bold">80</span>
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">protocol</span>: TCP
</span></span><span style="display:flex;"><span>        - <span style="font-weight:bold">containerPort</span>: <span style="color:#ff0;font-weight:bold">443</span>
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">name</span>: https
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">protocol</span>: TCP
</span></span><span style="display:flex;"><span>        - <span style="font-weight:bold">containerPort</span>: <span style="color:#ff0;font-weight:bold">8443</span>
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">name</span>: webhook
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">protocol</span>: TCP
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">readinessProbe</span>:
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">failureThreshold</span>: <span style="color:#ff0;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">httpGet</span>:
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">path</span>: /healthz
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">port</span>: <span style="color:#ff0;font-weight:bold">10254</span>
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">scheme</span>: HTTP
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">initialDelaySeconds</span>: <span style="color:#ff0;font-weight:bold">10</span>
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">periodSeconds</span>: <span style="color:#ff0;font-weight:bold">10</span>
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">successThreshold</span>: <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">timeoutSeconds</span>: <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">resources</span>:
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">requests</span>:
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">cpu</span>: 100m
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">memory</span>: 90Mi
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">securityContext</span>:
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">allowPrivilegeEscalation</span>: <span style="color:#fff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">capabilities</span>:
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">add</span>:
</span></span><span style="display:flex;"><span>            - NET_BIND_SERVICE
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">drop</span>:
</span></span><span style="display:flex;"><span>            - ALL
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">runAsUser</span>: <span style="color:#ff0;font-weight:bold">101</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">volumeMounts</span>:
</span></span><span style="display:flex;"><span>        - <span style="font-weight:bold">mountPath</span>: /usr/local/certificates/
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">name</span>: webhook-cert
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">readOnly</span>: <span style="color:#fff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">dnsPolicy</span>: ClusterFirst
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">nodeSelector</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">kubernetes.io/os</span>: linux
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">serviceAccountName</span>: ingress-nginx
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">terminationGracePeriodSeconds</span>: <span style="color:#ff0;font-weight:bold">300</span>
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="font-weight:bold">name</span>: webhook-cert
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">secret</span>:
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">secretName</span>: ingress-nginx-admission
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Service
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">creationTimestamp</span>: <span style="color:#fff;font-weight:bold">null</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">app.kubernetes.io/component</span>: controller
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">app.kubernetes.io/instance</span>: ingress-nginx
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">app.kubernetes.io/managed-by</span>: Helm
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">app.kubernetes.io/name</span>: ingress-nginx
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">app.kubernetes.io/part-of</span>: ingress-nginx
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">app.kubernetes.io/version</span>: <span style="color:#ff0;font-weight:bold">1.1.2</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">helm.sh/chart</span>: ingress-nginx-4.0.18
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: ingress-nginx-controller
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">namespace</span>: ingress-nginx
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">ports</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">port</span>: <span style="color:#ff0;font-weight:bold">80</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">protocol</span>: TCP
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">targetPort</span>: <span style="color:#ff0;font-weight:bold">80</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">nodePort</span>: <span style="color:#ff0;font-weight:bold">30080</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">app.kubernetes.io/component</span>: controller
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">app.kubernetes.io/instance</span>: ingress-nginx
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">app.kubernetes.io/name</span>: ingress-nginx
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">type</span>: NodePort
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># æ¥ç€åˆ›å»ºingressï¼Œingressèµ„æºæ˜¯åœ¨namespaceèŒƒå›´ä¸‹çš„ï¼Œæ‰€ä»¥ingressè¦å’ŒserviceåŒä¸€ä¸ªnamespace</span>
</span></span><span style="display:flex;"><span>k create ingress -n app-space --rule /wear*=wear-service:8080 --rule /watch*=video-service:8080 --annotation nginx.ingress.kubernetes.io/rewrite-target=/ --annotation nginx.ingress.kubernetes.io/ssl-redirect=<span style="color:#fff;font-weight:bold">false</span> test-ingress --dry-run=client -o yaml
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="font-weight:bold">apiVersion</span>: networking.k8s.io/v1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">kind</span>: Ingress
</span></span><span style="display:flex;"><span><span style="font-weight:bold">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">annotations</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">nginx.ingress.kubernetes.io/rewrite-target</span>: /
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">nginx.ingress.kubernetes.io/ssl-redirect</span>: <span style="color:#0ff;font-weight:bold">&#34;false&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">creationTimestamp</span>: <span style="color:#fff;font-weight:bold">null</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">name</span>: test-ingress
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">namespace</span>: app-space
</span></span><span style="display:flex;"><span><span style="font-weight:bold">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">rules</span>:
</span></span><span style="display:flex;"><span>  - <span style="font-weight:bold">http</span>:
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">paths</span>:
</span></span><span style="display:flex;"><span>      - <span style="font-weight:bold">backend</span>:
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">service</span>:
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">name</span>: wear-service
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">port</span>:
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">number</span>: <span style="color:#ff0;font-weight:bold">8080</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">path</span>: /wear
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">pathType</span>: Prefix
</span></span><span style="display:flex;"><span>      - <span style="font-weight:bold">backend</span>:
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">service</span>:
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">name</span>: video-service
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">port</span>:
</span></span><span style="display:flex;"><span>              <span style="font-weight:bold">number</span>: <span style="color:#ff0;font-weight:bold">8080</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">path</span>: /watch
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">pathType</span>: Prefix
</span></span><span style="display:flex;"><span><span style="font-weight:bold">status</span>:
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">loadBalancer</span>: {}
</span></span></code></pre></div><h2 id="éƒ¨ç½²k8s">éƒ¨ç½²K8S<a hidden class="anchor" aria-hidden="true" href="#éƒ¨ç½²k8s">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œå¦‚ä¸‹å®‰è£…æ“ä½œ</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># step1: ä¿®æ”¹ç½‘ç»œç­–ç•¥</span>
</span></span><span style="display:flex;"><span>cat <span style="color:#0ff;font-weight:bold">&lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">br_netfilter
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cat <span style="color:#0ff;font-weight:bold">&lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">net.bridge.bridge-nf-call-iptables = 1
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo sysctl --system
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># step2: å®‰è£…åŒ…</span>
</span></span><span style="display:flex;"><span>sudo apt-get update
</span></span><span style="display:flex;"><span>sudo apt-get install -y apt-transport-https ca-certificates curl
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo mkdir -m <span style="color:#ff0;font-weight:bold">755</span> /etc/apt/keyrings
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.27/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#39;deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.27/deb/ /&#39;</span> | sudo tee /etc/apt/sources.list.d/kubernetes.list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo apt-get update
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># To see the new version labels</span>
</span></span><span style="display:flex;"><span>sudo apt-cache madison kubeadm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo apt-get install -y kubelet=1.27.0-2.1 kubeadm=1.27.0-2.1 kubectl=1.27.0-2.1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo apt-mark hold kubelet kubeadm kubectl
</span></span></code></pre></div><p><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">Installing kubeadm | Kubernetes</a></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># step3: æŸ¥çœ‹kubeletç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>kubelet --version
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># step4: ä½¿ç”¨kubeadmå¯åŠ¨kubernetesé›†ç¾¤</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># step4-1: å¯åŠ¨controlplane</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æŸ¥çœ‹eth0ç½‘å£ipåœ°å€</span>
</span></span><span style="display:flex;"><span>ifconfig eth0
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å‡è®¾ä¸Šä¸€æ­¥eth0åœ°å€æ˜¯192.17.132.9</span>
</span></span><span style="display:flex;"><span>kubeadm init --apiserver-cert-extra-sans=controlplane --apiserver-advertise-address 192.17.132.9 --pod-network-cidr=10.244.0.0/16
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æˆ–è€…æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>IP_ADDR=<span style="color:#fff;font-weight:bold">$(</span>ip addr show eth0 | grep -oP <span style="color:#0ff;font-weight:bold">&#39;(?&lt;=inet\s)\d+(\.\d+){3}&#39;</span><span style="color:#fff;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>kubeadm init --apiserver-cert-extra-sans=controlplane --apiserver-advertise-address $IP_ADDR --pod-network-cidr=10.244.0.0/16
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æ‰§è¡Œå®Œæ¯•åï¼Œé…ç½®kubeconfig</span>
</span></span><span style="display:flex;"><span>mkdir -p $HOME/.kube
</span></span><span style="display:flex;"><span>sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</span></span><span style="display:flex;"><span>sudo chown <span style="color:#fff;font-weight:bold">$(</span>id -u<span style="color:#fff;font-weight:bold">)</span>:<span style="color:#fff;font-weight:bold">$(</span>id -g<span style="color:#fff;font-weight:bold">)</span> $HOME/.kube/config
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>You should now deploy a pod network to the cluster.
</span></span><span style="display:flex;"><span>Run <span style="color:#0ff;font-weight:bold">&#34;kubectl apply -f [podnetwork].yaml&#34;</span> with one of the options listed at:
</span></span><span style="display:flex;"><span>  https://kubernetes.io/docs/concepts/cluster-administration/addons/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Then you can join any number of worker nodes by running the following on each as root:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubeadm join 192.17.132.9:6443 --token b2134k.u3alyaj4iwkjhm6w <span style="color:#0ff;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold"></span>        --discovery-token-ca-cert-hash sha256:23471ecdb6d52790d13880d333fa0a667cc249297ed26faa7b75171b84157c46 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># Step 4-2: å°†node01åŠ å…¥åˆ°cluster</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># kubeadmç”Ÿæˆjoin token</span>
</span></span><span style="display:flex;"><span>kubeadm token generate
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æˆ–</span>
</span></span><span style="display:flex;"><span>kubeadm token create --print-join-command
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ç”Ÿæˆå¦‚ä¸‹å‘½ä»¤ï¼Œsshç™»å½•åˆ°node01ä¸Šæ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>kubeadm join 192.17.132.9:6443 --token 2uh5xs.qoh26441ba0l4du4 --discovery-token-ca-cert-hash sha256:23471ecdb6d52790d13880d333fa0a667cc249297ed26faa7b75171b84157c46
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Step5: å®‰è£…Flannelç½‘ç»œ</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ä¸‹è½½kube-flannel.yml</span>
</span></span><span style="display:flex;"><span>curl -LO https://raw.githubusercontent.com/flannel-io/flannel/v0.20.2/Documentation/kube-flannel.yml
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ç¼–è¾‘kube-flannel.yml</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># å®šä½åˆ°</span>
</span></span><span style="display:flex;"><span>  args:
</span></span><span style="display:flex;"><span>  - --ip-masq
</span></span><span style="display:flex;"><span>  - --kube-subnet-mgr
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># æ·»åŠ å‚æ•°</span>
</span></span><span style="display:flex;"><span>  - --iface=eth0
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>kubectl apply -f kube-flannel.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># ç½‘ç»œåˆ›å»ºæˆåŠŸåï¼ŒnodeçŠ¶æ€å˜æˆReady</span>
</span></span></code></pre></div><pre tabindex="0"><code>controlplane ~ âœ  kubectl get nodes
NAME           STATUS   ROLES           AGE   VERSION
controlplane   Ready    control-plane   15m   v1.27.0
node01         Ready    &lt;none&gt;          15m   v1.27.0
</code></pre><h2 id="trouble-shooting">Trouble Shooting<a hidden class="anchor" aria-hidden="true" href="#trouble-shooting">#</a></h2>
<p>Application Failureï¼š</p>
<ul>
<li>dnsè§£æçš„serviceåç§°ä¸å¯¹</li>
<li>serviceä¸­selectoræ²¡æœ‰é€‰ä¸­å·¥ä½œçš„pod</li>
<li>serviceçš„targetPorté…ç½®é”™è¯¯</li>
<li>dbçš„ç”¨æˆ·åå¯†ç é”™è¯¯</li>
<li>serviceæš´éœ²çš„nodeç«¯å£é”™è¯¯</li>
</ul>
<p>Control Plane Failureï¼š</p>
<ul>
<li>kube-scheduleræ•…éšœï¼Œä¿®æ”¹/etc/kubernetes/manifests/ä¸‹çš„yaml</li>
<li>scaleæ— å“åº”ï¼ŒæŸ¥çœ‹kube-controlleræ•…éšœ</li>
</ul>
<p>Work Node Failure:</p>
<ul>
<li>è®¡ç®—èŠ‚ç‚¹containerdæœåŠ¡æˆ–è€…kubeletæœåŠ¡åœæ‰äº†ï¼Œç”¨systemctlå‘½ä»¤æ‰‹åŠ¨å¯åŠ¨</li>
<li><code>/var/lib/kubelet/config.yaml</code>é…ç½®æ–‡ä»¶æœ‰é—®é¢˜</li>
<li><code>/etc/kubernetes/kubelet.conf</code>ä¸­kube-apiçš„ç«¯å£é…ç½®</li>
</ul>
<p>Network Failure:</p>
<ul>
<li>
<p>ç¼ºå°‘ç½‘ç»œæ’ä»¶<a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#pod-network">Creating a cluster with kubeadm | Kubernetes</a></p>
<p><code>curl -L https://github.com/weaveworks/weave/releases/download/latest_release/weave-daemonset-k8s-1.11.yaml | kubectl apply -f -</code></p>
</li>
<li>
<p>æŸ¥çœ‹æ‰€æœ‰kube-proxyæ˜¯å¦è¿è¡Œæ­£å¸¸ï¼ŒæŸ¥çœ‹å…³è”çš„configMapæ˜¯å¦æ­£ç¡®ï¼Œä¿®æ”¹daemonset</p>
</li>
</ul>
<h2 id="lighting-lab">Lighting Lab<a hidden class="anchor" aria-hidden="true" href="#lighting-lab">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># json pathå®šä¹‰è¾“å‡º</span>
</span></span><span style="display:flex;"><span>kubectl get deployments.apps -n admin2406 -o custom-columns=DEPLOYMENT:.metadata.name,CONTAINER_IMAGE:.spec.template.spec.containers[*].image,READY_REPLICAS:.status.readyReplicas,NAMESPACE:.metadata.namespace --sort-by=.metadata.name
</span></span></code></pre></div><h3 id="å‚è€ƒ">å‚è€ƒ<a hidden class="anchor" aria-hidden="true" href="#å‚è€ƒ">#</a></h3>
<p><a href="https://www.geeksforgeeks.org/kubectl-cheatsheet/">Kubectl Command Cheat Sheet - Learn Essential Kubernetes Commands</a></p>
<p><a href="https://www.bluematador.com/learn/kubectl-cheatsheet">Kubectl Cheatsheet | Free Cheatsheet</a></p>
<p><a href="https://training.linuxfoundation.cn/news/308">LF è®¤è¯è€ƒè¯•æ”»ç•¥ï½œè®¤è¯è€ƒè¯•æµç¨‹å…¨ä»‹ç»&ndash;è´­ä¹°ã€æ³¨å†ŒåŠé¢„çº¦è€ƒè¯•ç¯‡ï¼ˆå»ºè®®æ”¶è—ï¼‰-Linux Foundationå¼€æºè½¯ä»¶å­¦å›­</a></p>
<p><a href="https://training.linuxfoundation.cn/certificates/1">CKA (Certified Kubernetes Administrator)</a></p>
<p><a href="https://killer.sh/dashboard">Killer Shell - Exam Simulators</a></p>
<p><a href="https://docs.linuxfoundation.org/tc-docs/certification/lf-handbook2">Linux Foundation Certification Exam: Candidate Handbook (using PSI BRIDGE Proctoring platform) - T&amp;C DOCS (Candidate Facing Resources)</a></p>
<p><a href="https://trainingportal.linuxfoundation.org/learn/course/certified-kubernetes-administrator-china-exam-cka-cn/exam/exam">è€ƒè¯•å…¥å£Certified Kubernetes Administrator China Exam (CKA-CN) - Exam | The Linux Foundation</a></p>
<p><a href="https://www.cnblogs.com/itzgr/p/12165908.html">CKAè€ƒè¯•å¿ƒå¾—åˆ†äº« - æœ¨äºŒ - åšå®¢å›­</a></p>
<p><a href="https://www.jianshu.com/p/135c1d618a79">CKAè€ƒè¯•ç»éªŒæ€»ç»“ - ç®€ä¹¦</a></p>
<p><a href="https://kodekloud.com/topic/introduction-to-yaml-3/">Introduction to YAML - KodeKloud</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/564737349">äº’è”ç½‘æœ€å…¨ckaçœŸé¢˜è§£æ-2022.9.9 - çŸ¥ä¹</a></p>
<p><a href="https://www.cnblogs.com/even160941/p/17710997.html">2023å¹´CKAè€ƒè¯•çœŸé¢˜åŠæ³¨æ„äº‹é¡¹ - jiayou111 - åšå®¢å›­</a></p>
<p><a href="https://blog.csdn.net/zhouwenjun0820/article/details/105881669">Kubernetes CKAçœŸé¢˜è§£æ-20200402çœŸé¢˜_check to see how many nodes are ready (not includi-CSDNåšå®¢</a></p>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://blog.niuhemoon.win/tags/kubernetes/">Kubernetes</a></li>
    </ul>
<div class="footer-comments">
  <p>For comments, please   <a href="mailto:carlton2tang@gmail.com" class="email-button" style="font-size: inherit; padding: 5px 10px; background-color: #3f6b9a; color: white; text-decoration: none; border-radius: 3px; transition: background-color 0.3s;">
    send an email
</a> to me</p>

</div>
<nav class="paginav">
  <a class="prev" href="https://blog.niuhemoon.win/posts/tech/pytorch-model-view/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>Pytorchæ¨¡å‹å¯è§†åŒ–</span>
  </a>
  <a class="next" href="https://blog.niuhemoon.win/posts/tech/text2sql-prompt-engineering/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>text2sql Prompt è°ƒä¼˜ç¬”è®°</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
      
    <span>&copy; 2024 <a href="https://blog.niuhemoon.win">Niuhe&#39;s Blog</a></span>
    <span xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/">
        Licensed under
        <a
          href="http://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1"
          target="_blank"
          rel="license noopener noreferrer"
          style="display:inline-block;"
          >CC BY-NC-SA 4.0 </a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'ğŸ“„å¤åˆ¶';

        function copyingDone() {
            copybutton.innerHTML = 'ğŸ‘ŒğŸ»å·²å¤åˆ¶!';
            setTimeout(() => {
                copybutton.innerHTML = 'ğŸ“„å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
