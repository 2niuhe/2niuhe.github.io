<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>openstackåˆ›å»ºè™šæ‹Ÿæœº | Niuhe&#39;s Blog</title>
<meta name="keywords" content="Nova, Openstack">
<meta name="description" content="åˆ›å»ºè™šæ‹Ÿæœºæµç¨‹å›¾">
<meta name="author" content="Niuhe">
<link rel="canonical" href="https://blog.niuhemoon.win/posts/tech/create-instance/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css" integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe&#43;FVUFzPh7U=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://blog.niuhemoon.win/base/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://blog.niuhemoon.win/base/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="https://blog.niuhemoon.win/base/favicon.ico">
<link rel="apple-touch-icon" href="https://blog.niuhemoon.win/base/avatar.jpeg">
<link rel="mask-icon" href="https://blog.niuhemoon.win/base/avatar.jpeg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-116933089-1', 'auto');
	
	ga('send', 'pageview');
}
</script><meta property="og:title" content="openstackåˆ›å»ºè™šæ‹Ÿæœº" />
<meta property="og:description" content="åˆ›å»ºè™šæ‹Ÿæœºæµç¨‹å›¾" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.niuhemoon.win/posts/tech/create-instance/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-31T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-10-31T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="openstackåˆ›å»ºè™šæ‹Ÿæœº"/>
<meta name="twitter:description" content="åˆ›å»ºè™šæ‹Ÿæœºæµç¨‹å›¾"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "ğŸ“šæ–‡ç« ",
      "item": "https://blog.niuhemoon.win/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯",
      "item": "https://blog.niuhemoon.win/posts/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "openstackåˆ›å»ºè™šæ‹Ÿæœº",
      "item": "https://blog.niuhemoon.win/posts/tech/create-instance/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "openstackåˆ›å»ºè™šæ‹Ÿæœº",
  "name": "openstackåˆ›å»ºè™šæ‹Ÿæœº",
  "description": "åˆ›å»ºè™šæ‹Ÿæœºæµç¨‹å›¾",
  "keywords": [
    "Nova", "Openstack"
  ],
  "articleBody": "åˆ›å»ºè™šæ‹Ÿæœº 1ã€ç•Œé¢æˆ–å‘½ä»¤è¡Œé€šè¿‡RESTful APIå‘keystoneè·å–è®¤è¯ä¿¡æ¯ã€‚\n2ã€keystoneé€šè¿‡ç”¨æˆ·è¯·æ±‚è®¤è¯ä¿¡æ¯ï¼Œå¹¶ç”Ÿæˆauth-tokenè¿”å›ç»™å¯¹åº”çš„è®¤è¯è¯·æ±‚ã€‚\n3ã€ç•Œé¢æˆ–å‘½ä»¤è¡Œé€šè¿‡RESTful APIå‘nova-apiå‘é€ä¸€ä¸ªboot instanceçš„è¯·æ±‚ï¼ˆæºå¸¦auth-tokenï¼‰ã€‚\n4ã€nova-apiæ¥å—è¯·æ±‚åå‘keystoneå‘é€è®¤è¯è¯·æ±‚ï¼ŒæŸ¥çœ‹tokenæ˜¯å¦ä¸ºæœ‰æ•ˆç”¨æˆ·å’Œtokenã€‚\n5ã€keystoneéªŒè¯tokenæ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æœ‰æ•ˆåˆ™è¿”å›æœ‰æ•ˆçš„è®¤è¯å’Œå¯¹åº”çš„è§’è‰²ï¼ˆæ³¨ï¼šæœ‰äº›æ“ä½œéœ€è¦æœ‰è§’è‰²æƒé™æ‰èƒ½æ“ä½œï¼‰ã€‚\n6ã€é€šè¿‡è®¤è¯ånova-apiå’Œæ•°æ®åº“é€šè®¯ã€‚\n7ã€åˆå§‹åŒ–æ–°å»ºè™šæ‹Ÿæœºçš„æ•°æ®åº“è®°å½•ã€‚\n8ã€nova-apié€šè¿‡rpc.callå‘nova-schedulerè¯·æ±‚æ˜¯å¦æœ‰åˆ›å»ºè™šæ‹Ÿæœºçš„èµ„æº(Host ID)ã€‚\n9ã€nova-schedulerè¿›ç¨‹ä¾¦å¬æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè·å–nova-apiçš„è¯·æ±‚ã€‚\n10ã€nova-scheduleré€šè¿‡æŸ¥è¯¢novaæ•°æ®åº“ä¸­è®¡ç®—èµ„æºçš„æƒ…å†µï¼Œå¹¶é€šè¿‡è°ƒåº¦ç®—æ³•è®¡ç®—ç¬¦åˆè™šæ‹Ÿæœºåˆ›å»ºéœ€è¦çš„ä¸»æœºã€‚\n11ã€å¯¹äºæœ‰ç¬¦åˆè™šæ‹Ÿæœºåˆ›å»ºçš„ä¸»æœºï¼Œnova-scheduleræ›´æ–°æ•°æ®åº“ä¸­è™šæ‹Ÿæœºå¯¹åº”çš„ç‰©ç†ä¸»æœºä¿¡æ¯ã€‚\n12ã€nova-scheduleré€šè¿‡rpc.castå‘nova-computeå‘é€å¯¹åº”çš„åˆ›å»ºè™šæ‹Ÿæœºè¯·æ±‚çš„æ¶ˆæ¯ã€‚\n13ã€nova-computeä¼šä»å¯¹åº”çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–åˆ›å»ºè™šæ‹Ÿæœºè¯·æ±‚çš„æ¶ˆæ¯ã€‚\n14ã€nova-computeé€šè¿‡rpc.callå‘nova-conductorè¯·æ±‚è·å–è™šæ‹Ÿæœºæ¶ˆæ¯ã€‚ï¼ˆFlavorï¼‰\n15ã€nova-conductorä»æ¶ˆæ¯é˜Ÿé˜Ÿåˆ—ä¸­æ‹¿åˆ°nova-computeè¯·æ±‚æ¶ˆæ¯ã€‚\n16ã€nova-conductoræ ¹æ®æ¶ˆæ¯æŸ¥è¯¢è™šæ‹Ÿæœºå¯¹åº”çš„ä¿¡æ¯ã€‚\n17ã€nova-conductorä»æ•°æ®åº“ä¸­è·å¾—è™šæ‹Ÿæœºå¯¹åº”ä¿¡æ¯ã€‚\n18ã€nova-conductoræŠŠè™šæ‹Ÿæœºä¿¡æ¯é€šè¿‡æ¶ˆæ¯çš„æ–¹å¼å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚\n19ã€nova-computeä»å¯¹åº”çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–è™šæ‹Ÿæœºä¿¡æ¯æ¶ˆæ¯ã€‚\n20ã€nova-computeé€šè¿‡keystoneçš„RESTfull APIæ‹¿åˆ°è®¤è¯çš„tokenï¼Œå¹¶é€šè¿‡HTTPè¯·æ±‚glance-apiè·å–åˆ›å»ºè™šæ‹Ÿæœºæ‰€éœ€è¦é•œåƒã€‚\n21ã€glance-apiå‘keystoneè®¤è¯tokenæ˜¯å¦æœ‰æ•ˆï¼Œå¹¶è¿”å›éªŒè¯ç»“æœã€‚\n22ã€tokenéªŒè¯é€šè¿‡ï¼Œnova-computeè·å¾—è™šæ‹Ÿæœºé•œåƒä¿¡æ¯(URL)ã€‚\n23ã€nova-computeé€šè¿‡keystoneçš„RESTfull APIæ‹¿åˆ°è®¤è¯kçš„tokenï¼Œå¹¶é€šè¿‡HTTPè¯·æ±‚neutron-serverè·å–åˆ›å»ºè™šæ‹Ÿæœºæ‰€éœ€è¦çš„ç½‘ç»œä¿¡æ¯ã€‚\n24ã€neutron-serverå‘keystoneè®¤è¯tokenæ˜¯å¦æœ‰æ•ˆï¼Œå¹¶è¿”å›éªŒè¯ç»“æœã€‚\n25ã€tokenéªŒè¯é€šè¿‡ï¼Œnova-computeè·å¾—è™šæ‹Ÿæœºç½‘ç»œä¿¡æ¯ã€‚\n26ã€nova-computeé€šè¿‡keystoneçš„RESTfull APIæ‹¿åˆ°è®¤è¯çš„tokenï¼Œå¹¶é€šè¿‡HTTPè¯·æ±‚cinder-apiè·å–åˆ›å»ºè™šæ‹Ÿæœºæ‰€éœ€è¦çš„æŒä¹…åŒ–å­˜å‚¨ä¿¡æ¯ã€‚\n27ã€cinder-apiå‘keystoneè®¤è¯tokenæ˜¯å¦æœ‰æ•ˆï¼Œå¹¶è¿”å›éªŒè¯ç»“æœã€‚\n28ã€tokenéªŒè¯é€šè¿‡ï¼Œnova-computeè·å¾—è™šæ‹ŸæœºæŒä¹…åŒ–å­˜å‚¨ä¿¡æ¯ã€‚\n29ã€nova-computeæ ¹æ®instanceçš„ä¿¡æ¯è°ƒç”¨é…ç½®çš„è™šæ‹ŸåŒ–é©±åŠ¨æ¥åˆ›å»ºè™šæ‹Ÿæœºã€‚\nä»¥Novaä¸ºä¾‹ï¼Œnova/computeç›®å½•å¹¶ä¸æ˜¯ä¸€å®šåœ¨nova-computeèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œè€Œä¸»è¦æ˜¯å’Œcomputeç›¸å…³(è™šæ‹Ÿæœºæ“ä½œç›¸å…³ï¼‰çš„åŠŸèƒ½å®ç°ï¼ŒåŒæ ·çš„ï¼Œschedulerç›®å½•ä»£ç å¹¶ä¸å…¨åœ¨scheduleræœåŠ¡èŠ‚ç‚¹è¿è¡Œï¼Œä½†ä¸»è¦æ˜¯å’Œè°ƒåº¦ç›¸å…³çš„ä»£ç ã€‚ä¸è¿‡ç›®å½•ç»“æ„éµå¾ªä¸€å®šçš„è§„å¾‹ã€‚\né€šå¸¸ä¸€ä¸ªOpenStacké¡¹ç›®çš„ä»£ç ç›®å½•éƒ½ä¼šåŒ…å«api.pyã€rpcapi.pyã€manager.pyï¼Œè¿™ä¸‰ä¸ªæ˜¯æœ€é‡è¦çš„æ¨¡å—ã€‚\napi.pyï¼š é€šå¸¸æ˜¯ä¾›å…¶å®ƒç»„ä»¶è°ƒç”¨çš„å°è£…åº“ã€‚æ¢å¥è¯è¯´ï¼Œè¯¥æ¨¡å—é€šå¸¸å¹¶ä¸ä¼šç”±æœ¬æ¨¡å—è°ƒç”¨ã€‚æ¯”å¦‚computeç›®å½•çš„api.pyï¼Œé€šå¸¸ç”±nova-apiæœåŠ¡çš„controllerè°ƒç”¨ã€‚å¯ä»¥ç®€å•è®¤ä¸ºæ˜¯ä¾›å…¶ä»–æœåŠ¡è°ƒç”¨çš„sdkã€‚ rpcapi.pyï¼šè¿™ä¸ªæ˜¯RPCè¯·æ±‚çš„å°è£…ï¼Œæˆ–è€…è¯´æ˜¯RPCå°è£…çš„clientç«¯ï¼Œè¯¥æ¨¡å—å°è£…äº†RPCè¯·æ±‚è°ƒç”¨ã€‚ manager.pyï¼š è¿™ä¸ªæ‰æ˜¯çœŸæ­£æœåŠ¡çš„åŠŸèƒ½å®ç°ï¼Œä¹Ÿæ˜¯RPCçš„serverç«¯ï¼Œå³å¤„ç†RPCè¯·æ±‚çš„å…¥å£ï¼Œå®ç°çš„æ–¹æ³•é€šå¸¸å’Œrpcapiå®ç°çš„æ–¹æ³•ä¸€ä¸€å¯¹åº”ã€‚ å…³æœºæµç¨‹\nAPIèŠ‚ç‚¹ nova-apiæ¥æ”¶ç”¨æˆ·è¯·æ±‚ -\u003e nova-apiè°ƒç”¨compute/api.py -\u003e compute/apiè°ƒç”¨compute/rpcapi.py -\u003e rpcapi.pyå‘ç›®æ ‡è®¡ç®—èŠ‚ç‚¹å‘èµ·stop_instance()RPCè¯·æ±‚ è®¡ç®—èŠ‚ç‚¹ æ”¶åˆ°stop_instance()è¯·æ±‚ -\u003e è°ƒç”¨compute/manager.pyçš„callbackæ–¹æ³•stop_instance() -\u003e è°ƒç”¨libvirtå…³æœºè™šæ‹Ÿæœº\nå‰é¢æåˆ°OpenStacké¡¹ç›®çš„ç›®å½•ç»“æ„æ˜¯æŒ‰ç…§åŠŸèƒ½åˆ’åˆ†çš„ï¼Œè€Œä¸æ˜¯æœåŠ¡ç»„ä»¶ï¼Œå› æ­¤å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç›®å½•éƒ½èƒ½æœ‰å¯¹åº”çš„ç»„ä»¶ã€‚ä»ä»¥Novaä¸ºä¾‹:\nnova/cmdï¼šè¿™æ˜¯æœåŠ¡çš„å¯åŠ¨è„šæœ¬ï¼Œå³æ‰€æœ‰æœåŠ¡çš„mainå‡½æ•°ã€‚çœ‹æœåŠ¡æ€ä¹ˆåˆå§‹åŒ–ï¼Œå°±ä»è¿™é‡Œå¼€å§‹ã€‚ nova/db: å°è£…æ•°æ®åº“è®¿é—®ï¼Œç›®å‰æ”¯æŒçš„driverä¸ºsqlalchemyã€‚ nova/confï¼šNovaæ‰€æœ‰é…ç½®é¡¹å£°æ˜éƒ½æ”¾åœ¨è¿™ä¸ªç›®å½•ã€‚ nova/locale: æœ¬åœ°åŒ–å¤„ç†ã€‚ nova/image: å°è£…Glanceæ¥å£ã€‚ nova/network: å°è£…Neutronæ¥å£ã€‚ nova/volume: å°è£…Cinderæ¥å£ã€‚ nova/virt: è¿™æ˜¯æ”¯æŒçš„æ‰€æœ‰è™šæ‹ŸåŒ–é©±åŠ¨å®ç°ï¼Œå³compute driverå®ç°ï¼Œä¸»æµçš„å¦‚libvirtã€hypervã€ironicã€vmwareapiç­‰ã€‚ nova/objects: å¯¹è±¡æ¨¡å‹ï¼Œå°è£…äº†æ‰€æœ‰Novaå¯¹è±¡çš„CURDæ“ä½œï¼Œç›¸å¯¹ä»¥å‰ç›´æ¥è°ƒç”¨dbçš„modelæ›´å®‰å…¨ï¼Œå¹¶ä¸”æ”¯æŒç‰ˆæœ¬æ§åˆ¶ã€‚ nova/policiesï¼š API policyé›†åˆã€‚ nova/tests: æµ‹è¯•ä»£ç ï¼Œå¦‚å•å…ƒæµ‹è¯•ã€åŠŸèƒ½æµ‹è¯•ã€‚ nova/hacking: Novaä»£ç è§„èŒƒå®šä¹‰çš„ä¸€äº›è§„åˆ™ã€‚ nova â€“debug boot â€“image 81e58b1a-4732-4255-b4f8-c844430485d2 â€“flavor 1 yikun\ncontrollerçš„indexæ–¹æ³•å¯¹åº”listæ“ä½œã€showæ–¹æ³•å¯¹åº”getæ“ä½œã€createå¯¹åº”åˆ›å»ºæ“ä½œã€deleteå¯¹åº”åˆ é™¤æ“ä½œã€updateå¯¹åº”æ›´æ–°æ“ä½œç­‰ã€‚\nopenstack-nova-compute.service ä¸¤ä¸ªèŒè´£ï¼Œå…¶ä¸€ï¼Œæ˜¯å®ˆæŠ¤è¿›ç¨‹ï¼Œè´Ÿè´£åŸºäºå„ç§è™šæ‹ŸåŒ–æŠ€æœ¯Hypervisiorå®ç°åˆ›å»ºå’Œç»ˆæ­¢è™šæ‹Ÿæœºï¼›å…¶äºŒï¼Œæ•´åˆäº†è®¡ç®—èµ„æºCPUï¼Œå­˜å‚¨ï¼Œç½‘ç»œä¸‰ç±»èµ„æºéƒ¨ç½²ç®¡ç†è™šæ‹Ÿæœºï¼Œå®ç°è®¡ç®—èƒ½åŠ›çš„äº¤ä»˜ã€‚\nCell V2çš„è®¾è®¡æ€æƒ³æ˜¯ï¼Œç”±APIã€Super Conductorå»è®¿é—®ä¸Šå±‚çš„å…¨å±€æ•°æ®åº“ï¼ˆnova_apiæ•°æ®åº“ï¼‰ï¼Œè€Œåº•ä¸‹çš„cellä¸­çš„ç»„ä»¶ï¼Œåªéœ€è¦å…³å¿ƒcellä¸­çš„é€»è¾‘å³å¯\né¦–å…ˆï¼Œapiä¸­è¿›è¡Œç¬¬ä¸€æ¬¡Quotaæ£€æµ‹ï¼Œä¸»è¦æ–¹æ³•å°±æ˜¯æ”¶é›†åœ°ä¸‹å„ä¸ªcellæ•°æ®åº“ä¸­çš„èµ„æºä¿¡æ¯ï¼Œç„¶åå’Œapiæ•°æ®åº“ä¸­çš„quotaä¸Šé™è¿›è¡Œå¯¹æ¯”ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥åˆ›å»º10ä¸ªè™šæ‹Ÿæœºï¼Œåœ¨cell1ä¸­æœ‰2ä¸ªï¼Œcell2ä¸­æœ‰7ä¸ªï¼Œå†åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºæ—¶ï¼Œä¼šæœé›†cell1å’Œcell2ä¸­çš„è™šæ‹Ÿæœºä¸ªæ•°ä¹‹å’Œï¼ˆ9ä¸ªï¼‰ï¼Œç„¶ååŠ ä¸Šå˜åŒ–ï¼ˆæ–°å¢ä¸€ä¸ªï¼‰ï¼Œä¸æ€»é…é¢è¿›è¡Œæ¯”è¾ƒã€‚ äºŒæ¬¡æ£€æµ‹ï¼ˆcell v2åœ¨super conductoré‡Œåšï¼‰ã€‚ç”±äºåœ¨å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¯èƒ½å‡ºç°åŒæ—¶æ£€æµ‹å‘ç°æ»¡è¶³ï¼Œä¹‹åè¿›è¡Œåˆ›å»ºï¼Œå°±ä¼šé€ æˆé…é¢çš„è¶…åˆ†ï¼Œé’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œç¤¾åŒºç›®å‰ç»™å‡ºçš„æ–¹æ¡ˆæ˜¯ï¼Œåœ¨åˆ›å»ºè™šæ‹Ÿæœºè®°å½•ä¹‹åï¼Œå†è¿›è¡Œrecheckï¼Œå¦‚æœå‘ç°è¶…é¢äº†ï¼Œä¼šå°†è¶…é¢åˆ†é…çš„è™šæ‹Ÿæœºæ ‡è®°ä¸ºERRORï¼Œä¸å†ç»§ç»­å¾€ä¸‹èµ°äº†ã€‚ åœ¨Cell v2åœºæ™¯ï¼Œè™šæ‹Ÿæœºçš„åˆ›å»ºè®°å½•å·²ç»éœ€è¦å†™å…¥çš„å­cellä¸­ï¼Œå› æ­¤ï¼Œconductoréœ€è¦åšçš„äº‹ï¼ŒåŒ…æ‹¬ä¸€ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\nè¿›è¡Œè°ƒåº¦ï¼Œé€‰å‡ºhostã€‚ æ ¹æ®hostï¼Œé€šè¿‡host_mappingsæ‰¾åˆ°å¯¹åº”çš„cell åœ¨å¯¹åº”çš„cell dbä¸­åˆ›å»ºè™šæ‹Ÿæœºè®°å½•ï¼Œå¹¶ä¸”è®°å½•instances_mappingsä¿¡æ¯ é€šè¿‡cell_mappingsæ¥æŸ¥æ‰¾å¯¹åº”çš„cellçš„mqï¼Œç„¶åæŠ•é€’åˆ°å¯¹åº”çš„cellä¸­çš„compute å®Œæˆè¿™äº›æ“ä½œæ—¶ï¼Œéœ€è¦ç‰µæ‰¯åˆ°3ä¸ªå…³é”®çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬æ¥ç®€å•çš„çœ‹ä¸€ä¸‹ï¼š\nhost_mappingsï¼šè®°å½•äº†hostå’Œcellçš„æ˜ å°„ä¿¡æ¯ instances_mappingsï¼šè®°å½•äº†è™šæ‹Ÿæœºå’Œcellçš„æ˜ å°„ä¿¡æ¯ cell_mappingsï¼šè®°å½•äº†cellå’Œcellå¯¹åº”çš„mqçš„æ˜ å°„ä¿¡æ¯ ä¸Cell v1ä¸å¤ªç›¸åŒï¼Œåœ¨ç›®å‰çš„è®¾è®¡ä¸­ï¼Œè®¤ä¸ºschedulerèƒ½çœ‹åˆ°çš„åº”è¯¥æ˜¯åº•ä¸‹èƒ½å¤Ÿæä¾›èµ„æºçš„å…·ä½“çš„æ‰€æœ‰çš„Resource Providerï¼ˆå¯¹äºè®¡ç®—èµ„æºæ¥è¯´ï¼Œå°±æ˜¯æ‰€æœ‰çš„è®¡ç®—èŠ‚ç‚¹ï¼‰ï¼Œè€Œä¸æ˜¯æ•´ä¸ªcellï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰cellä¸­çš„èµ„æºscheduleréƒ½å¯ä»¥çœ‹åˆ°ï¼Œè€Œå­cellå°±è´Ÿè´£åˆ›å»ºå°±å¥½äº†ã€‚å› æ­¤ï¼Œåœ¨super conductorä¸­ï¼Œéœ€è¦åšä¸€äº›transferçš„äº‹æƒ…ï¼Œè¿™æ ·ä¹Ÿå°±ä¸å¿…åœ¨åƒcell v1é‚£æ ·ï¼Œåœ¨å­cellé‡Œè¿˜å¾—æä¸ªschedulerå»åšè°ƒåº¦ã€‚\né€šè¿‡Placementè·å–å¯ç”¨çš„å¤‡é€‰èµ„æºï¼Œå‚è€ƒPlacement Allocation Requestsçš„å®ç°ã€‚ åœ¨Ocataç‰ˆæœ¬æ—¶ï¼ŒResource Providers - Scheduler Filters in DBè¿™ä¸ªBPå°±å·²ç»åœ¨è°ƒåº¦å‰åŠ äº†ä¸€æ­¥ï¼Œè·å–å¤‡é€‰èŠ‚ç‚¹ã€‚ä»BPçš„æ ‡é¢˜å°±å¯ä»¥çœ‹å‡ºï¼Œè®¾è®¡è€…æƒ³é€šè¿‡PlacementæœåŠ¡æä¾›çš„æ–°çš„ä¸€å¥—æœºåˆ¶ï¼Œæ¥åšè¿‡æ»¤ã€‚åŸå› æ˜¯ä¹‹å‰çš„è°ƒåº¦éœ€è¦åœ¨schedulerç»´æŠ¤æ¯ä¸€ä¸ªcomputeèŠ‚ç‚¹çš„hoststateä¿¡æ¯ï¼Œç„¶åè°ƒåº¦çš„æ—¶å€™ï¼Œå†ä¸€ä¸ªä¸ªå»æŸ¥ï¼Œè¿™å¤ªä½æ•ˆäº†ï¼Œå°¤å…¶æ˜¯åœ¨è®¡ç®—èŠ‚ç‚¹æ•°ç›®æ¯”è¾ƒå¤šçš„æ—¶å€™ã€‚å› æ­¤ï¼Œå¢åŠ äº†ä¸€ä¸ªâ€œé¢„è¿‡æ»¤â€çš„æµç¨‹ï¼Œé€šè¿‡å‘PlacementæŸ¥è¯¢ï¼ŒPlacementæœåŠ¡ç›´æ¥é€šè¿‡SQLå»æŸ¥ä¸€æŠŠï¼ŒæŠŠæ»¡è¶³æ¡ä»¶ï¼ˆæ¯”å¦‚CPUå……è¶³ã€RAMå……è¶³ç­‰ï¼‰å…ˆè·å–åˆ°ã€‚ è€ŒåŸæ¥è·å–å¤‡é€‰èŠ‚ç‚¹çš„æ—¶å€™ï¼Œåªæ”¯æŒè·å–å•ä¸€çš„Resource Providerï¼Œè¿™ä¸ªBPå¢å¼ºäº†è·å–å¤‡é€‰èµ„æºçš„èƒ½åŠ›ï¼Œç”¨äºåç»­æ”¯æŒæ›´å¤æ‚çš„è¯·æ±‚ï¼Œæ¯”å¦‚å…±äº«èµ„æºã€åµŒå¥—èµ„æºçš„ProvideræŸ¥è¯¢ã€‚åé¢ï¼ŒPlacementè¿˜ä¼šé™†ç»­æ”¯æŒæ›´å¤šçš„è¯·æ±‚ï¼Œæ¯”å¦‚å¯¹ä¸€äº›éå­˜é‡ä¸å¯è®¡æ•°çš„èµ„æºçš„æ”¯æŒã€‚è¿™æ ·ç•™ç»™åé¢Filter\u0026Weightçš„å‹åŠ›å°±å°ä¸€äº›äº†ï¼Œå†å¾€åï¼Œä¼šä¸ä¼šå®Œå…¨å–ä»£Filterå‘¢ï¼Ÿæˆ‘æƒ³ï¼Œç°æœ‰çš„å„ç§è¿‡æ»¤éƒ½å¯ä»¥é€šè¿‡Placementæ”¯æŒåï¼Œå®Œå…¨æœ‰å¯èƒ½çš„ã€‚ Scheduleré€šè¿‡Placementæ¥claimèµ„æºã€‚å‚è€ƒScheduler claiming resources to the Placement APIçš„å®ç°ã€‚ åœ¨æœ€æ—©çš„æ—¶å€™ï¼Œclaimèµ„æºæ˜¯ç”±computeæ¥åšçš„ï¼Œç°åœ¨ç›¸å½“äºæå‰åˆ°schedulerå»æäº†ã€‚æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿæˆ‘ä»¬å…ˆçœ‹çœ‹åŸæ¥çš„é—®é¢˜ï¼š è°ƒåº¦æ—¶åˆ»å’ŒçœŸæ­£çš„å»computeèŠ‚ç‚¹å»claimèµ„æºçš„æ—¶åˆ»ä¹‹é—´æ˜¯ç”±ä¸€æ®µæ—¶é—´çš„ï¼Œåœ¨èµ„æºä¸æ˜¯é‚£ä¹ˆå……è¶³çš„ç¯å¢ƒï¼Œå°±ä¼šé€ æˆåœ¨schedulerè°ƒåº¦çš„æ—¶å€™ï¼Œèµ„æºè¿˜æ²¡åˆ·æ–°ï¼Œæ‰€ä»¥è°ƒåº¦æ—¶å€™æˆåŠŸäº†ï¼Œä½†æ˜¯çœŸæ­£ä¸‹æ¥çš„æ—¶å€™ï¼Œæ‰å‘ç°computeå®é™…å·²ç»æ²¡æœ‰èµ„æºäº†ï¼Œç„¶ååˆâ€œè·¨è¶ŠåŠä¸ªåœ°çƒâ€å»åšé‡è°ƒåº¦ï¼Œæ— å½¢åœ°å¢åŠ äº†ç³»ç»Ÿçš„è´Ÿè½½ã€‚ è€Œä¸”å¢åŠ äº†åˆ›å»ºçš„æ—¶é•¿ï¼ˆå“¦ï¼Œå“ªæ€•åˆ›å»ºå¤±è´¥å‘¢ï¼Ÿï¼‰ï¼Œä½ æƒ³æƒ³ï¼Œç”¨æˆ·åˆ›äº†é‚£ä¹ˆä¹…çš„è™šæ‹Ÿæœºï¼Œæœ€åä½ å‘Šè¯‰æˆ‘è°ƒåº¦å¤±è´¥äº†ï¼Œç”¨æˆ·ä¸å¤ªèƒ½å¿ã€‚ æ‰€ä»¥è¿™ä¸ªBPå°±æŠŠClaimèµ„æºæ”¾åœ¨è°ƒåº¦å¤„äº†ï¼Œæˆ‘ä¸Šä¸€ä¸ªè°ƒåº¦è¯·æ±‚å¤„ç†å®Œï¼Œé©¬ä¸Šå°±å‘Šè¯‰placementï¼Œè¿™èµ„æºè€å­ç”¨äº†ï¼Œå…¶ä»–äººä¸è¦åŠ¨äº†ã€‚OKï¼Œä¸–ç•Œç»ˆäºæ¸…å‡€äº†ï¼Œèƒ½æ‹¿åˆ°èµ„æºçš„æ‹¿åˆ°äº†ï¼Œæ‹¿ä¸åˆ°èµ„æºçš„é©¬ä¸Šä¹ŸçŸ¥é“è‡ªå·±æ‹¿ä¸åˆ°äº†ï¼Œå¤§å¤§å¢å¼ºäº†è°ƒåº¦çš„ç”¨æˆ·ä½“éªŒã€‚ 2.4 Placement æ©ï¼Œåœ¨è°ƒåº¦çš„æ—¶å€™ï¼Œå·²ç»ä»‹ç»è¿‡è¿™ä¸ªæœåŠ¡äº†ï¼Œåœ¨è™šæ‹Ÿæœºåˆ›å»ºçš„æµç¨‹ä¸­ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ¥å£å°±æ˜¯è·å–å¤‡é€‰èµ„æºå’Œclaimèµ„æºã€‚ Placementç›®æ ‡å¾ˆå®ä¼Ÿï¼Œå¤§è‡´çš„ä½œç”¨å°±æ˜¯ï¼šèµ„æºæˆ‘æ¥ç®¡ï¼Œè¦èµ„æºé—®æˆ‘è¦ï¼Œç”¨äº†èµ„æºå‘Šè¯‰æˆ‘ã€‚åé¢å‡†å¤‡ç”¨ä¸€ç¯‡æ–‡ç« æ•´ä½“ä»‹ç»ä¸€ä¸‹Placementã€‚ï¼ˆyepï¼Œè¿™ä¸ªFlagæˆ‘ç«‹ä¸‹äº†ï¼Œä¼šå†™çš„ï¼‰\nserviceçš„è¯¦ç»†ä¿¡æ¯ä¸»è¦åŒ…æ‹¬å¦‚ä¸‹å‡ é¡¹ï¼š binary, host, zone, status, state å…¶ä¸­ï¼š binaryï¼Œå¯ä»¥ç†è§£ä¸ºserviceçš„åç§°ï¼Œç±»ä¼¼äºnova-computeï¼› hostæ˜¯serviceæ‰€åœ¨çš„ä¸»æœºåç§°ï¼› zoneæ˜¯serviceæ‰€å±çš„AZï¼Œå…¶å®å°±æ˜¯serviceæ‰€åœ¨çš„ä¸»æœºæ‰€å±çš„aggregateï¼Œåªæ˜¯aggregateçš„æ¦‚å¿µä¸å¯¹å¤–å‘ˆç°ï¼Œæ‰€ä»¥ç”¨æˆ·çœ‹åˆ°çš„æ˜¯AZã€‚å…¶å®ï¼Œåœ¨Novaå†…éƒ¨ï¼ŒAZæ˜¯AGçš„metadataè€Œå·²ã€‚\nzoneçš„ç¡®å®šï¼Œæ¶‰åŠåˆ°ä¸¤ä¸ªé…ç½®é¡¹ï¼Œå¯¹äºéè®¡ç®—èŠ‚ç‚¹ï¼Œzoneçš„åç§°ä¾èµ–äºé…ç½®é¡¹internal_service_availability_zoneï¼ˆé»˜è®¤æ˜¯internalï¼‰ï¼› å¯¹äºè®¡ç®—èŠ‚ç‚¹ï¼Œå¦‚æœä¸å±äºä»»ä½•AGï¼Œæˆ–è€…æ‰€å±çš„AGæ²¡æœ‰AZçš„metadataä¿¡æ¯ï¼Œé»˜è®¤çš„zoneä¾èµ–äºé…ç½®é¡¹default_availability_zoneï¼ˆé»˜è®¤æ˜¯novaï¼‰ã€‚ statusæ˜¯æœåŠ¡disableå±æ€§çš„ä½“ç°ï¼Œè¯¥å±æ€§å¯ä»¥ç›´æ¥é€šè¿‡APIä¿®æ”¹; stateæ˜¯æœåŠ¡çœŸå®çš„çŠ¶æ€ï¼Œæ˜¯é€šè¿‡servicegroup apiè·å–ã€‚æ¯ä¸ªæœåŠ¡åœ¨å¯åŠ¨æ—¶ä¼šåŠ å…¥servicegroupï¼Œä»¥dbåç«¯ä¸ºä¾‹ï¼Œä¼šåœ¨æœåŠ¡ä¸­å¯åŠ¨å®šæ—¶å™¨ï¼Œæ›´æ–°serviceè¡¨ä¸­çš„report_countçš„å€¼ï¼ŒåŒæ—¶ä¹Ÿä¼šåˆ·æ–°æ›´æ–°æ—¶é—´ï¼Œåç»­ä¼šæ ¹æ®è¿™ä¸ªæ›´æ–°æ—¶é—´ç¡®å®šæœåŠ¡çš„æ­»æ´»ï¼›\nå½“ç„¶ï¼ŒæŸ¥è¯¢serviceä¿¡æ¯ä¹Ÿæ”¯æŒè¿‡æ»¤æ¡ä»¶ï¼Œæ¯”å¦‚ï¼š 1ã€æŸ¥è¯¢æŸä¸ªhostç›¸å…³çš„serviceï¼› 2ã€æŒ‰binaryåç§°æŸ¥è¯¢serviceï¼›\nå…¶å®Novaä¸­æ²¡æœ‰hostè¿™ä¸ªç‹¬ç«‹çš„èµ„æºï¼ˆæ•°æ®åº“å¯¹è±¡ï¼‰ï¼Œä½†æ˜¯Novaå´æœ‰é’ˆå¯¹hostçš„APIæ“ä½œï¼Œå…¶å®ï¼Œåœ¨å†…éƒ¨å®ç°ä¸­ï¼Œå°±æ˜¯é€šè¿‡å‰é¢çš„serviceä¿¡æ¯ï¼Œé—´æ¥ç»„è£…è¿”å›hostä¿¡æ¯ã€‚\nç§Ÿæˆ·ï¼šé…é¢\nä¸æ­¤åŒæ—¶ï¼Œè™šæ‹Ÿæœºstateæˆ–task_stateå‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¹Ÿä¼šå‘å¤–éƒ¨å‘é€é€šçŸ¥ã€‚ å‰ææ˜¯é…ç½®é¡¹notify_on_state_changeè¦é…ç½®ä¸ºvm_stateæˆ–vm_and_task_stateã€‚ Novaä¸­çš„è™šæ‹Ÿæœºæ¯ä¸ªæ“ä½œï¼ˆå¯åŠ¨ã€åœæ­¢ã€æš‚åœã€æ¢å¤ç­‰ç­‰ï¼‰ï¼Œéƒ½ä¼šåœ¨dbä¸­ä¿å­˜ç›¸å…³çš„æ“ä½œè®°å½•ï¼Œç»™ç”¨æˆ·æä¾›æŸ¥è¯¢ã€‚åˆ©ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œç”¨æˆ·å¯¹è‡ªå·±çš„è™šæ‹Ÿæœºæ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„è¿‡ç¨‹å’ŒçŠ¶æ€éƒ½ä¼šäº†å¦‚æŒ‡æŒï¼Œä¾¿äºç”¨æˆ·çš„ç®¡ç†ã€‚å‚è§è¿™é‡Œã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š\nåœ¨å†…éƒ¨å®ç°ä¸­ï¼Œnova-apiå±‚ä¼šè®°å½•actionå¼€å§‹çš„è®°å½•ï¼Œåœ¨nova-computeå±‚ï¼Œåˆ™ä¼šæ·»åŠ eventå¼€å§‹å’Œç»“æŸçš„ä¿¡æ¯ï¼Œactionå’Œeventæ ¹æ®request idï¼ˆä¸€æ¬¡æ¶ˆæ¯è¯·æ±‚çš„æ ‡è¯†ï¼‰å…³è”ã€‚\nå…ˆè¯´é€šçŸ¥ï¼Œè™šæ‹Ÿæœºæ“ä½œå¼‚å¸¸æ—¶ï¼Œä¸€èˆ¬éƒ½ä¼šå‘é€erroré€šçŸ¥ï¼Œé€šçŸ¥ä¸­åŒ…å«å¼‚å¸¸çš„å‡½æ•°åç§°ã€å¼‚å¸¸æ—¶å‡½æ•°çš„å‚æ•°ä»¥åŠå¼‚å¸¸ä¿¡æ¯ã€‚ å†è¯´dbï¼Œè™šæ‹Ÿæœºæ“ä½œå¼‚å¸¸æ—¶ï¼Œæ— è®ºæ˜¯åœ¨conductor, schedulerè¿˜æ˜¯computeå±‚ï¼Œé™¤äº†ä¼šå‘é€é€šçŸ¥å¤–ï¼Œè¿˜ä¼šè®°å½•å¼‚å¸¸ä¿¡æ¯åˆ°æ•°æ®åº“ï¼ˆinstance_faultsè¡¨ï¼‰ï¼Œå½“æŸ¥è¯¢è™šæ‹Ÿæœºä¿¡æ¯æ—¶ï¼Œä¼šè¿”å›è™šæ‹Ÿæœºçš„å¼‚å¸¸ä¿¡æ¯ã€‚ ä¸€ä¸ªhypervisorï¼Œæ˜¯åˆ›å»ºè™šæ‹Ÿæœºèƒ½å¤Ÿè°ƒåº¦åˆ°çš„æœ€å°å•å…ƒã€‚\napi.pyæä¾›å¯¹å¤–è®¿é—®çš„æ¥å£ï¼Œå¯ä»¥ä»è¿™å¼€å§‹å…¥æ‰‹è·Ÿè¸ªå„ä¸ªåŠŸèƒ½å®ç°ã€‚ rpcapi.pyå°è£…RPCè¯·æ±‚è°ƒç”¨ï¼Œå¤§å¤šæ•°æ˜¯å¼‚æ­¥è°ƒç”¨ã€‚ manager.pyå„ç§RPCè°ƒç”¨çš„å®ç°ï¼ŒåŸºæœ¬å’Œrpcapi.pyä¸­è°ƒç”¨çš„åç§°ä¸€ä¸€å¯¹åº”ã€‚ æ­¤å¤–è¿˜æœ‰ä¸€ç‚¹ï¼ŒOpenstackçš„ç›®å½•ç»“æ„æ˜¯æ ¹æ®åŠŸèƒ½åˆ’åˆ†çš„ï¼Œæ¯”å¦‚Novaä¸­computeç›®å½•ä¸ä¸€å®šéƒ½æ˜¯åœ¨nova-computeèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œè€Œæ˜¯æ‰€æœ‰å’Œè™šæ‹Ÿæœºåˆ›å»ºç›¸å…³çš„åŠŸèƒ½éƒ½åœ¨è¿™é‡Œã€‚\nä»é…ç½®æ–‡ä»¶å¯ä»¥æ˜æ˜¾çš„çœ‹å‡ºï¼Œnova-apiå¯¹åº”çš„æ–‡ä»¶æ˜¯nova/cmd/api.pyçš„main()å‡½æ•°ï¼š\nvm_state\npower_state\ntask_state\n_record_action_start notify_about_instance_action elevated\n@startuml title: åˆ›å»ºè™šæ‹Ÿæœº participant \"API\" as api note left of api nova/api/openstack/compute/servers.py end note participant \"Scheduler\" as sch database \"Database\" as db #Green participant \"Condutor(super)\" as pconductor participant \"Placement\" as placement box \"internal service\" participant \"Compute\" as compute participant \"Libvirt\" as virt end box participant \"Conductor(cell)\" as ccondutor participant \"Neutron\" as neutron participant \"Cinder\" as cinder participant \"Glance\" as glance autonumber \" [00]\" [-\u003e api++ : åˆ›å»ºè™šæ‹Ÿæœº api -\u003e api : validate schema api -\u003e api : get context api -\u003e api : get server_dict api -\u003e api : gen create_kwargs api -\u003e api : policy check api -\u003e api : provision instance api -\u003e glance : è·å–é•œåƒä¿¡æ¯ api -\u003e api : policyæ ¡éªŒ api -\u003e api : é…é¢æ ¡éªŒ api -\u003e api : æ·»åŠ Group hnote left #FFAAAA vm_state: Building task_state: Scheduling end note api -\u003e db : åˆ›å»ºinstance db -\u003e api : create success [\u003c- api : return 202 deactivate api api -\u003e pconductor ++: schedule \u0026 build pconductor -\u003e sch : select_destination sch -\u003e placement : get allocation candidates placement -\u003e sch : alloc_reqs.provider_summarys sch -\u003e sch : Filter \u0026 weighter sch -\u003e placement : claim Resources placement -\u003e sch : hello sch -\u003e pconductor : return host pconductor -\u003e pconductor : in target cell DBä¸­åˆ›å»ºinstance pconductor -\u003e pconductor : é…é¢æ ¡éªŒ recheck pconductor -\u003e pconductor : åˆ·æ–°instance cell ä¿¡æ¯ pconductor -\u003e pconductor : åˆ é™¤build request() pconductor -\u003e compute : åœ¨æŒ‡å®šcellä¸­åˆ›å»ºè™šæ‹Ÿæœº hnote left #FFAAAA vm_state: Building task_state: None end note compute -\u003e neutron : åˆ›å»ºç½‘ç»œ hnote left #FFAAAA vm_state: Building task_state: Networking end note compute -\u003e cinder : æ„å»ºå—è®¾å¤‡ hnote left #FFAAAA vm_state: Building task_state: Block Device Mapping end note compute -\u003e compute : spawn() hnote left #FFAAAA vm_state: Building task_state: Spawning end note compute -\u003e glance : ä¸‹è½½é•œåƒ compute -\u003e compute : ç”Ÿæˆxml compute -\u003e compute : åˆ·æ–°è™šæ‹ŸæœºçŠ¶æ€ hnote left #FFAAAA vm_state: Building task_state: None end note @enduml @startuml title: Lockè™šæ‹Ÿæœº participant \"API\" as api database \"Database\" as db #Green autonumber \" [00]\" [-\u003e api : lock api -\u003e api : get_context api -\u003e api : authorize action [lock] policy api -\u003e db : get instance by id db -\u003e api : done api -\u003e api : check policy api -\u003e db : instance.locked = True\\n locked_by=owner or admin\\n record locked reason db -\u003e api : done [\u003c- api : response @enduml @startuml title: Pauseè™šæ‹Ÿæœº participant \"API\" as api database \"Database\" as db #Green box \"internal service\" participant \"Compute\" as compute participant \"Libvirt\" as virt end box autonumber \" [00]\" [-\u003e api++ : pause instance api -\u003e api : authorize context api -\u003e db++ : get instance by uuid return done api -\u003e api : check policy api -\u003e api : check instance lock api -\u003e api : check instance cell api -\u003e api : ensure instance state is ACTIVE api -\u003e db++ : task_state = PAUSING return done api -\u003e api : record pause action api -\u003e compute++ : pause_instance compute -\u003e compute : notify : pause.start compute -\u003e virt++ : pause virt -\u003e virt : get domain virt -\u003e virt : domain.suspend() return done compute -\u003e db++ : vm_state = PAUSE\\n task_state = None return done compute -\u003e compute : notify: pause.end [\u003c- api : response @enduml @startuml title: Renameè™šæ‹Ÿæœº participant \"API\" as api database \"Database\" as db #Green autonumber \" [00]\" [-\u003e api : update name activate api api -\u003e api : validate schema api -\u003e api : get context api -\u003e api : authorize [update] policy api -\u003e api : get update_dict[\"display_name\"] api -\u003e db++ : get server by id return done api -\u003e db : update(update_dict) db -\u003e db : save [\u003c- api : responee @enduml @startuml title: Suspendè™šæ‹Ÿæœº participant \"API\" as api database \"Database\" as db #Green box \"internal service\" participant \"Compute\" as compute participant \"Libvirt\" as virt end box autonumber \" [00]\" [-\u003e api++ : suspend instance api -\u003e api : authorize context api -\u003e db++ : get instance by uuid return done api -\u003e api : check policy api -\u003e api : check instance lock api -\u003e api : check instance cell api -\u003e api : ensure instance state is ACTIVE api -\u003e db++ : task_state = SUSPANDING return done api -\u003e api : record action : suspand api -\u003e compute++ : suspand_instance compute -\u003e compute : notify : suspand.start compute -\u003e virt++ : suspand virt -\u003e virt : get instance guest virt -\u003e virt : detach pci device virt -\u003e virt : detach sriow ports virt -\u003e virt : guest.save_memory_state() return done compute -\u003e db++ : vm_state = SUSPENDED\\n task_state = None return done compute -\u003e compute : notify: suspend.end [\u003c- api : response @enduml @startuml hide empty description [*] --\u003e State1 State1 --\u003e [*] vm_state:powering\\n task_state:good\\n nihao State1 : this is another string State1 -\u003e State2 State2 --\u003e [*] @enduml @startuml title: Unlockè™šæ‹Ÿæœº participant \"API\" as api database \"Database\" as db #Green autonumber \" [00]\" [-\u003e api : lock api -\u003e api : get_context api -\u003e api : authorize action [unlock] policy api -\u003e db : get instance by id db -\u003e api : done api -\u003e api : check policy api -\u003e db : query instance.locked db -\u003e api : done api -\u003e db : instance.locked = False\\n locked_by=None\\n clear locked reason db -\u003e api : done [\u003c- api : response @enduml @startuml title: Unpauseè™šæ‹Ÿæœº participant \"API\" as api database \"Database\" as db #Green box \"internal service\" participant \"Compute\" as compute participant \"Libvirt\" as virt end box autonumber \" [00]\" [-\u003e api++ : unpause instance api -\u003e api : authorize context api -\u003e db++ : get instance by uuid return done api -\u003e api : check policy api -\u003e api : check instance lock api -\u003e api : check instance cell api -\u003e api : ensure instance state is PAUSED api -\u003e db++ : task_state = UNPAUSING return done api -\u003e api : record action : unpause api -\u003e compute++ : unpause_instance compute -\u003e compute : notify : unpause.start compute -\u003e virt++ : unpause virt -\u003e virt : get domain virt -\u003e virt : domain.resume() return done compute -\u003e db++ : vm_state = ACTIVE\\n task_state = None return done compute -\u003e compute : notify: unpause.end [\u003c- api : response @enduml å‚è€ƒ Openstackè™šæ‹Ÿæœºå¯åŠ¨æ–¹å¼\nOpenstackæºç å­¦ä¹ ç¬”è®°\nOpenstackè¯æ±‡è¡¨\nOpenstackä»ç¡¬ç›˜å¯åŠ¨å®ä¾‹\nNovaè™šæ‹Ÿæœºåˆ›å»ºæµç¨‹åˆ†æ\nNovaåˆ›å»ºè™šæ‹Ÿæœºæµç¨‹åˆ†æ\nå¦‚ä½•é˜…è¯»openstackæºç \nè™šæ‹Ÿæœºåˆ›å»ºçš„50ä¸ªæ­¥éª¤å’Œ100ä¸ªçŸ¥è¯†ç‚¹\nOpenstackæºç å­¦ä¹ ä¹‹çƒ­è¿ç§»\n",
  "wordCount" : "7418",
  "inLanguage": "zh",
  "datePublished": "2020-10-31T00:00:00Z",
  "dateModified": "2020-10-31T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Niuhe"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://blog.niuhemoon.win/posts/tech/create-instance/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Niuhe's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://blog.niuhemoon.win/base/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://blog.niuhemoon.win" accesskey="h" title="Niuhe&#39;s Blog (Alt + H)">
                <img src="https://blog.niuhemoon.win/base/avatar.jpeg" alt="" aria-label="logo"
                    height="35">Niuhe&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://blog.niuhemoon.win/search" title="ğŸ”æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://blog.niuhemoon.win/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://blog.niuhemoon.win/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://blog.niuhemoon.win/tags" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://blog.niuhemoon.win/archives/" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://blog.niuhemoon.win/about" title="ğŸ™‹ğŸ»â€â™‚ï¸å…³äº">
                    <span>ğŸ™‹ğŸ»â€â™‚ï¸å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://blog.niuhemoon.win">ğŸ ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://blog.niuhemoon.win/posts/">ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href="https://blog.niuhemoon.win/posts/tech/">ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯</a></div>
    <h1 class="post-title">
      openstackåˆ›å»ºè™šæ‹Ÿæœº
    </h1>
    <div class="post-description">
      åˆ›å»ºè™šæ‹Ÿæœºæµç¨‹å›¾
    </div>
    <div class="post-meta"><span title='2020-10-31 00:00:00 +0000 UTC'>2020-10-31</span>&nbsp;Â·&nbsp;15 min&nbsp;Â·&nbsp;7418 å­—&nbsp;Â·&nbsp;Niuhe

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">æ–‡ç« ç›®å½•</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba%e8%99%9a%e6%8b%9f%e6%9c%ba" aria-label="åˆ›å»ºè™šæ‹Ÿæœº">åˆ›å»ºè™šæ‹Ÿæœº</a></li>
                <li>
                    <a href="#24-placement" aria-label="2.4 Placement">2.4 Placement</a></li>
                <li>
                    <a href="#%e5%8f%82%e8%80%83" aria-label="å‚è€ƒ">å‚è€ƒ</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h3 id="åˆ›å»ºè™šæ‹Ÿæœº">åˆ›å»ºè™šæ‹Ÿæœº<a hidden class="anchor" aria-hidden="true" href="#åˆ›å»ºè™šæ‹Ÿæœº">#</a></h3>
<p><img loading="lazy" src="/img/31555782_1550044632AC7C.png" alt="img"  />
</p>
<p>1ã€ç•Œé¢æˆ–å‘½ä»¤è¡Œé€šè¿‡RESTful APIå‘keystoneè·å–è®¤è¯ä¿¡æ¯ã€‚</p>
<p>2ã€keystoneé€šè¿‡ç”¨æˆ·è¯·æ±‚è®¤è¯ä¿¡æ¯ï¼Œå¹¶ç”Ÿæˆauth-tokenè¿”å›ç»™å¯¹åº”çš„è®¤è¯è¯·æ±‚ã€‚</p>
<p>3ã€ç•Œé¢æˆ–å‘½ä»¤è¡Œé€šè¿‡RESTful APIå‘nova-apiå‘é€ä¸€ä¸ªboot instanceçš„è¯·æ±‚ï¼ˆæºå¸¦auth-tokenï¼‰ã€‚</p>
<p>4ã€nova-apiæ¥å—è¯·æ±‚åå‘keystoneå‘é€è®¤è¯è¯·æ±‚ï¼ŒæŸ¥çœ‹tokenæ˜¯å¦ä¸ºæœ‰æ•ˆç”¨æˆ·å’Œtokenã€‚</p>
<p>5ã€keystoneéªŒè¯tokenæ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æœ‰æ•ˆåˆ™è¿”å›æœ‰æ•ˆçš„è®¤è¯å’Œå¯¹åº”çš„è§’è‰²ï¼ˆæ³¨ï¼šæœ‰äº›æ“ä½œéœ€è¦æœ‰è§’è‰²æƒé™æ‰èƒ½æ“ä½œï¼‰ã€‚</p>
<p>6ã€é€šè¿‡è®¤è¯ånova-apiå’Œæ•°æ®åº“é€šè®¯ã€‚</p>
<p>7ã€åˆå§‹åŒ–æ–°å»ºè™šæ‹Ÿæœºçš„æ•°æ®åº“è®°å½•ã€‚</p>
<p>8ã€nova-apié€šè¿‡rpc.callå‘nova-schedulerè¯·æ±‚æ˜¯å¦æœ‰åˆ›å»ºè™šæ‹Ÿæœºçš„èµ„æº(Host ID)ã€‚</p>
<p>9ã€nova-schedulerè¿›ç¨‹ä¾¦å¬æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè·å–nova-apiçš„è¯·æ±‚ã€‚</p>
<p>10ã€nova-scheduleré€šè¿‡æŸ¥è¯¢novaæ•°æ®åº“ä¸­è®¡ç®—èµ„æºçš„æƒ…å†µï¼Œå¹¶é€šè¿‡è°ƒåº¦ç®—æ³•è®¡ç®—ç¬¦åˆè™šæ‹Ÿæœºåˆ›å»ºéœ€è¦çš„ä¸»æœºã€‚</p>
<p>11ã€å¯¹äºæœ‰ç¬¦åˆè™šæ‹Ÿæœºåˆ›å»ºçš„ä¸»æœºï¼Œnova-scheduleræ›´æ–°æ•°æ®åº“ä¸­è™šæ‹Ÿæœºå¯¹åº”çš„ç‰©ç†ä¸»æœºä¿¡æ¯ã€‚</p>
<p>12ã€nova-scheduleré€šè¿‡rpc.castå‘nova-computeå‘é€å¯¹åº”çš„åˆ›å»ºè™šæ‹Ÿæœºè¯·æ±‚çš„æ¶ˆæ¯ã€‚</p>
<p>13ã€nova-computeä¼šä»å¯¹åº”çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–åˆ›å»ºè™šæ‹Ÿæœºè¯·æ±‚çš„æ¶ˆæ¯ã€‚</p>
<p>14ã€nova-computeé€šè¿‡rpc.callå‘nova-conductorè¯·æ±‚è·å–è™šæ‹Ÿæœºæ¶ˆæ¯ã€‚ï¼ˆFlavorï¼‰</p>
<p>15ã€nova-conductorä»æ¶ˆæ¯é˜Ÿé˜Ÿåˆ—ä¸­æ‹¿åˆ°nova-computeè¯·æ±‚æ¶ˆæ¯ã€‚</p>
<p>16ã€nova-conductoræ ¹æ®æ¶ˆæ¯æŸ¥è¯¢è™šæ‹Ÿæœºå¯¹åº”çš„ä¿¡æ¯ã€‚</p>
<p>17ã€nova-conductorä»æ•°æ®åº“ä¸­è·å¾—è™šæ‹Ÿæœºå¯¹åº”ä¿¡æ¯ã€‚</p>
<p>18ã€nova-conductoræŠŠè™šæ‹Ÿæœºä¿¡æ¯é€šè¿‡æ¶ˆæ¯çš„æ–¹å¼å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚</p>
<p>19ã€nova-computeä»å¯¹åº”çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–è™šæ‹Ÿæœºä¿¡æ¯æ¶ˆæ¯ã€‚</p>
<p>20ã€nova-computeé€šè¿‡keystoneçš„RESTfull APIæ‹¿åˆ°è®¤è¯çš„tokenï¼Œå¹¶é€šè¿‡HTTPè¯·æ±‚glance-apiè·å–åˆ›å»ºè™šæ‹Ÿæœºæ‰€éœ€è¦é•œåƒã€‚</p>
<p>21ã€glance-apiå‘keystoneè®¤è¯tokenæ˜¯å¦æœ‰æ•ˆï¼Œå¹¶è¿”å›éªŒè¯ç»“æœã€‚</p>
<p>22ã€tokenéªŒè¯é€šè¿‡ï¼Œnova-computeè·å¾—è™šæ‹Ÿæœºé•œåƒä¿¡æ¯(URL)ã€‚</p>
<p>23ã€nova-computeé€šè¿‡keystoneçš„RESTfull APIæ‹¿åˆ°è®¤è¯kçš„tokenï¼Œå¹¶é€šè¿‡HTTPè¯·æ±‚neutron-serverè·å–åˆ›å»ºè™šæ‹Ÿæœºæ‰€éœ€è¦çš„ç½‘ç»œä¿¡æ¯ã€‚</p>
<p>24ã€neutron-serverå‘keystoneè®¤è¯tokenæ˜¯å¦æœ‰æ•ˆï¼Œå¹¶è¿”å›éªŒè¯ç»“æœã€‚</p>
<p>25ã€tokenéªŒè¯é€šè¿‡ï¼Œnova-computeè·å¾—è™šæ‹Ÿæœºç½‘ç»œä¿¡æ¯ã€‚</p>
<p>26ã€nova-computeé€šè¿‡keystoneçš„RESTfull APIæ‹¿åˆ°è®¤è¯çš„tokenï¼Œå¹¶é€šè¿‡HTTPè¯·æ±‚cinder-apiè·å–åˆ›å»ºè™šæ‹Ÿæœºæ‰€éœ€è¦çš„æŒä¹…åŒ–å­˜å‚¨ä¿¡æ¯ã€‚</p>
<p>27ã€cinder-apiå‘keystoneè®¤è¯tokenæ˜¯å¦æœ‰æ•ˆï¼Œå¹¶è¿”å›éªŒè¯ç»“æœã€‚</p>
<p>28ã€tokenéªŒè¯é€šè¿‡ï¼Œnova-computeè·å¾—è™šæ‹ŸæœºæŒä¹…åŒ–å­˜å‚¨ä¿¡æ¯ã€‚</p>
<p>29ã€nova-computeæ ¹æ®instanceçš„ä¿¡æ¯è°ƒç”¨é…ç½®çš„è™šæ‹ŸåŒ–é©±åŠ¨æ¥åˆ›å»ºè™šæ‹Ÿæœºã€‚</p>
<p>ä»¥Novaä¸ºä¾‹ï¼Œ<code>nova/compute</code>ç›®å½•å¹¶ä¸æ˜¯ä¸€å®šåœ¨nova-computeèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œè€Œä¸»è¦æ˜¯å’Œcomputeç›¸å…³(è™šæ‹Ÿæœºæ“ä½œç›¸å…³ï¼‰çš„åŠŸèƒ½å®ç°ï¼ŒåŒæ ·çš„ï¼Œschedulerç›®å½•ä»£ç å¹¶ä¸å…¨åœ¨scheduleræœåŠ¡èŠ‚ç‚¹è¿è¡Œï¼Œä½†ä¸»è¦æ˜¯å’Œè°ƒåº¦ç›¸å…³çš„ä»£ç ã€‚ä¸è¿‡ç›®å½•ç»“æ„éµå¾ªä¸€å®šçš„è§„å¾‹ã€‚</p>
<p>é€šå¸¸ä¸€ä¸ªOpenStacké¡¹ç›®çš„ä»£ç ç›®å½•éƒ½ä¼šåŒ…å«<code>api.py</code>ã€<code>rpcapi.py</code>ã€<code>manager.py</code>ï¼Œè¿™ä¸‰ä¸ªæ˜¯æœ€é‡è¦çš„æ¨¡å—ã€‚</p>
<ul>
<li><code>api.py</code>ï¼š é€šå¸¸æ˜¯ä¾›å…¶å®ƒç»„ä»¶è°ƒç”¨çš„å°è£…åº“ã€‚æ¢å¥è¯è¯´ï¼Œè¯¥æ¨¡å—é€šå¸¸å¹¶ä¸ä¼šç”±æœ¬æ¨¡å—è°ƒç”¨ã€‚æ¯”å¦‚computeç›®å½•çš„api.pyï¼Œé€šå¸¸ç”±nova-apiæœåŠ¡çš„controllerè°ƒç”¨ã€‚å¯ä»¥ç®€å•è®¤ä¸ºæ˜¯ä¾›å…¶ä»–æœåŠ¡è°ƒç”¨çš„sdkã€‚</li>
<li><code>rpcapi.py</code>ï¼šè¿™ä¸ªæ˜¯RPCè¯·æ±‚çš„å°è£…ï¼Œæˆ–è€…è¯´æ˜¯RPCå°è£…çš„clientç«¯ï¼Œè¯¥æ¨¡å—å°è£…äº†RPCè¯·æ±‚è°ƒç”¨ã€‚</li>
<li><code>manager.py</code>ï¼š è¿™ä¸ªæ‰æ˜¯çœŸæ­£æœåŠ¡çš„åŠŸèƒ½å®ç°ï¼Œä¹Ÿæ˜¯RPCçš„serverç«¯ï¼Œå³å¤„ç†RPCè¯·æ±‚çš„å…¥å£ï¼Œå®ç°çš„æ–¹æ³•é€šå¸¸å’Œrpcapiå®ç°çš„æ–¹æ³•ä¸€ä¸€å¯¹åº”ã€‚</li>
</ul>
<p>å…³æœºæµç¨‹</p>
<p>APIèŠ‚ç‚¹ nova-apiæ¥æ”¶ç”¨æˆ·è¯·æ±‚ -&gt; nova-apiè°ƒç”¨compute/api.py -&gt; compute/apiè°ƒç”¨compute/rpcapi.py -&gt; rpcapi.pyå‘ç›®æ ‡è®¡ç®—èŠ‚ç‚¹å‘èµ·stop_instance()RPCè¯·æ±‚ è®¡ç®—èŠ‚ç‚¹ æ”¶åˆ°stop_instance()è¯·æ±‚ -&gt; è°ƒç”¨compute/manager.pyçš„callbackæ–¹æ³•stop_instance() -&gt; è°ƒç”¨libvirtå…³æœºè™šæ‹Ÿæœº</p>
<p>å‰é¢æåˆ°OpenStacké¡¹ç›®çš„ç›®å½•ç»“æ„æ˜¯æŒ‰ç…§åŠŸèƒ½åˆ’åˆ†çš„ï¼Œè€Œä¸æ˜¯æœåŠ¡ç»„ä»¶ï¼Œå› æ­¤å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç›®å½•éƒ½èƒ½æœ‰å¯¹åº”çš„ç»„ä»¶ã€‚ä»ä»¥Novaä¸ºä¾‹:</p>
<ul>
<li><code>nova/cmd</code>ï¼šè¿™æ˜¯æœåŠ¡çš„å¯åŠ¨è„šæœ¬ï¼Œå³æ‰€æœ‰æœåŠ¡çš„mainå‡½æ•°ã€‚çœ‹æœåŠ¡æ€ä¹ˆåˆå§‹åŒ–ï¼Œå°±ä»è¿™é‡Œå¼€å§‹ã€‚</li>
<li><code>nova/db</code>: å°è£…æ•°æ®åº“è®¿é—®ï¼Œç›®å‰æ”¯æŒçš„driverä¸ºsqlalchemyã€‚</li>
<li><code>nova/conf</code>ï¼šNovaæ‰€æœ‰é…ç½®é¡¹å£°æ˜éƒ½æ”¾åœ¨è¿™ä¸ªç›®å½•ã€‚</li>
<li><code>nova/locale</code>: æœ¬åœ°åŒ–å¤„ç†ã€‚</li>
<li><code>nova/image</code>: å°è£…Glanceæ¥å£ã€‚</li>
<li><code>nova/network</code>: å°è£…Neutronæ¥å£ã€‚</li>
<li><code>nova/volume</code>: å°è£…Cinderæ¥å£ã€‚</li>
<li><code>nova/virt</code>: è¿™æ˜¯æ”¯æŒçš„æ‰€æœ‰è™šæ‹ŸåŒ–é©±åŠ¨å®ç°ï¼Œå³compute driverå®ç°ï¼Œä¸»æµçš„å¦‚<code>libvirt</code>ã€<code>hyperv</code>ã€<code>ironic</code>ã€<code>vmwareapi</code>ç­‰ã€‚</li>
<li><code>nova/objects</code>: å¯¹è±¡æ¨¡å‹ï¼Œå°è£…äº†æ‰€æœ‰Novaå¯¹è±¡çš„CURDæ“ä½œï¼Œç›¸å¯¹ä»¥å‰ç›´æ¥è°ƒç”¨dbçš„modelæ›´å®‰å…¨ï¼Œå¹¶ä¸”æ”¯æŒç‰ˆæœ¬æ§åˆ¶ã€‚</li>
<li><code>nova/policies</code>ï¼š API policyé›†åˆã€‚</li>
<li><code>nova/tests</code>: æµ‹è¯•ä»£ç ï¼Œå¦‚å•å…ƒæµ‹è¯•ã€åŠŸèƒ½æµ‹è¯•ã€‚</li>
<li><code>nova/hacking</code>: Novaä»£ç è§„èŒƒå®šä¹‰çš„ä¸€äº›è§„åˆ™ã€‚</li>
</ul>
<p>nova &ndash;debug boot &ndash;image 81e58b1a-4732-4255-b4f8-c844430485d2 &ndash;flavor 1 yikun</p>
<p><code>controller</code>çš„<code>index</code>æ–¹æ³•å¯¹åº”<code>list</code>æ“ä½œã€<code>show</code>æ–¹æ³•å¯¹åº”<code>get</code>æ“ä½œã€<code>create</code>å¯¹åº”åˆ›å»ºæ“ä½œã€<code>delete</code>å¯¹åº”åˆ é™¤æ“ä½œã€<code>update</code>å¯¹åº”æ›´æ–°æ“ä½œç­‰ã€‚</p>
<p>openstack-nova-compute.service ä¸¤ä¸ªèŒè´£ï¼Œå…¶ä¸€ï¼Œæ˜¯å®ˆæŠ¤è¿›ç¨‹ï¼Œè´Ÿè´£åŸºäºå„ç§è™šæ‹ŸåŒ–æŠ€æœ¯Hypervisiorå®ç°åˆ›å»ºå’Œç»ˆæ­¢è™šæ‹Ÿæœºï¼›å…¶äºŒï¼Œæ•´åˆäº†è®¡ç®—èµ„æºCPUï¼Œå­˜å‚¨ï¼Œç½‘ç»œä¸‰ç±»èµ„æºéƒ¨ç½²ç®¡ç†è™šæ‹Ÿæœºï¼Œå®ç°è®¡ç®—èƒ½åŠ›çš„äº¤ä»˜ã€‚</p>
<p>Cell V2çš„è®¾è®¡æ€æƒ³æ˜¯ï¼Œç”±APIã€Super Conductorå»è®¿é—®ä¸Šå±‚çš„å…¨å±€æ•°æ®åº“ï¼ˆnova_apiæ•°æ®åº“ï¼‰ï¼Œè€Œåº•ä¸‹çš„cellä¸­çš„ç»„ä»¶ï¼Œåªéœ€è¦å…³å¿ƒcellä¸­çš„é€»è¾‘å³å¯</p>
<ol>
<li>é¦–å…ˆï¼Œapiä¸­è¿›è¡Œç¬¬ä¸€æ¬¡Quotaæ£€æµ‹ï¼Œä¸»è¦æ–¹æ³•å°±æ˜¯æ”¶é›†åœ°ä¸‹å„ä¸ªcellæ•°æ®åº“ä¸­çš„èµ„æºä¿¡æ¯ï¼Œç„¶åå’Œapiæ•°æ®åº“ä¸­çš„quotaä¸Šé™è¿›è¡Œå¯¹æ¯”ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥åˆ›å»º10ä¸ªè™šæ‹Ÿæœºï¼Œåœ¨cell1ä¸­æœ‰2ä¸ªï¼Œcell2ä¸­æœ‰7ä¸ªï¼Œå†åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºæ—¶ï¼Œä¼šæœé›†cell1å’Œcell2ä¸­çš„è™šæ‹Ÿæœºä¸ªæ•°ä¹‹å’Œï¼ˆ9ä¸ªï¼‰ï¼Œç„¶ååŠ ä¸Šå˜åŒ–ï¼ˆæ–°å¢ä¸€ä¸ªï¼‰ï¼Œä¸æ€»é…é¢è¿›è¡Œæ¯”è¾ƒã€‚</li>
<li>äºŒæ¬¡æ£€æµ‹ï¼ˆcell v2åœ¨super conductoré‡Œåšï¼‰ã€‚ç”±äºåœ¨å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¯èƒ½å‡ºç°åŒæ—¶æ£€æµ‹å‘ç°æ»¡è¶³ï¼Œä¹‹åè¿›è¡Œåˆ›å»ºï¼Œå°±ä¼šé€ æˆé…é¢çš„è¶…åˆ†ï¼Œé’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œç¤¾åŒºç›®å‰ç»™å‡ºçš„æ–¹æ¡ˆæ˜¯ï¼Œåœ¨åˆ›å»ºè™šæ‹Ÿæœºè®°å½•ä¹‹åï¼Œå†è¿›è¡Œrecheckï¼Œå¦‚æœå‘ç°è¶…é¢äº†ï¼Œä¼šå°†è¶…é¢åˆ†é…çš„è™šæ‹Ÿæœºæ ‡è®°ä¸ºERRORï¼Œä¸å†ç»§ç»­å¾€ä¸‹èµ°äº†ã€‚</li>
</ol>
<p>åœ¨Cell v2åœºæ™¯ï¼Œè™šæ‹Ÿæœºçš„åˆ›å»ºè®°å½•å·²ç»éœ€è¦å†™å…¥çš„å­cellä¸­ï¼Œå› æ­¤ï¼Œconductoréœ€è¦åšçš„äº‹ï¼ŒåŒ…æ‹¬ä¸€ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>è¿›è¡Œè°ƒåº¦ï¼Œé€‰å‡ºhostã€‚</li>
<li>æ ¹æ®hostï¼Œé€šè¿‡<strong>host_mappings</strong>æ‰¾åˆ°å¯¹åº”çš„cell</li>
<li>åœ¨å¯¹åº”çš„cell dbä¸­åˆ›å»ºè™šæ‹Ÿæœºè®°å½•ï¼Œå¹¶ä¸”è®°å½•<strong>instances_mappings</strong>ä¿¡æ¯</li>
<li>é€šè¿‡cell_mappingsæ¥æŸ¥æ‰¾å¯¹åº”çš„cellçš„mqï¼Œç„¶åæŠ•é€’åˆ°å¯¹åº”çš„cellä¸­çš„compute</li>
</ol>
<p>å®Œæˆè¿™äº›æ“ä½œæ—¶ï¼Œéœ€è¦ç‰µæ‰¯åˆ°3ä¸ªå…³é”®çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬æ¥ç®€å•çš„çœ‹ä¸€ä¸‹ï¼š</p>
<ul>
<li>host_mappingsï¼šè®°å½•äº†hostå’Œcellçš„æ˜ å°„ä¿¡æ¯</li>
<li>instances_mappingsï¼šè®°å½•äº†è™šæ‹Ÿæœºå’Œcellçš„æ˜ å°„ä¿¡æ¯</li>
<li>cell_mappingsï¼šè®°å½•äº†cellå’Œcellå¯¹åº”çš„mqçš„æ˜ å°„ä¿¡æ¯</li>
</ul>
<p>ä¸Cell v1ä¸å¤ªç›¸åŒï¼Œåœ¨ç›®å‰çš„è®¾è®¡ä¸­ï¼Œè®¤ä¸ºschedulerèƒ½çœ‹åˆ°çš„åº”è¯¥æ˜¯åº•ä¸‹èƒ½å¤Ÿæä¾›èµ„æºçš„å…·ä½“çš„æ‰€æœ‰çš„Resource Providerï¼ˆå¯¹äºè®¡ç®—èµ„æºæ¥è¯´ï¼Œå°±æ˜¯æ‰€æœ‰çš„è®¡ç®—èŠ‚ç‚¹ï¼‰ï¼Œè€Œä¸æ˜¯æ•´ä¸ªcellï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰cellä¸­çš„èµ„æºscheduleréƒ½å¯ä»¥çœ‹åˆ°ï¼Œè€Œå­cellå°±è´Ÿè´£åˆ›å»ºå°±å¥½äº†ã€‚å› æ­¤ï¼Œåœ¨super conductorä¸­ï¼Œéœ€è¦åšä¸€äº›transferçš„äº‹æƒ…ï¼Œè¿™æ ·ä¹Ÿå°±ä¸å¿…åœ¨åƒcell v1é‚£æ ·ï¼Œåœ¨å­cellé‡Œè¿˜å¾—æä¸ªschedulerå»åšè°ƒåº¦ã€‚</p>
<ol>
<li>é€šè¿‡Placementè·å–å¯ç”¨çš„å¤‡é€‰èµ„æºï¼Œå‚è€ƒ<a href="https://specs.openstack.org/openstack/nova-specs/specs/pike/approved/placement-allocation-requests.html">Placement Allocation Requests</a>çš„å®ç°ã€‚
åœ¨Ocataç‰ˆæœ¬æ—¶ï¼Œ<a href="https://specs.openstack.org/openstack/nova-specs/specs/ocata/implemented/resource-providers-scheduler-db-filters.html">Resource Providers - Scheduler Filters in DB</a>è¿™ä¸ªBPå°±å·²ç»åœ¨è°ƒåº¦å‰åŠ äº†ä¸€æ­¥ï¼Œè·å–å¤‡é€‰èŠ‚ç‚¹ã€‚ä»BPçš„æ ‡é¢˜å°±å¯ä»¥çœ‹å‡ºï¼Œè®¾è®¡è€…æƒ³é€šè¿‡PlacementæœåŠ¡æä¾›çš„æ–°çš„ä¸€å¥—æœºåˆ¶ï¼Œæ¥åšè¿‡æ»¤ã€‚åŸå› æ˜¯ä¹‹å‰çš„è°ƒåº¦éœ€è¦åœ¨schedulerç»´æŠ¤æ¯ä¸€ä¸ªcomputeèŠ‚ç‚¹çš„hoststateä¿¡æ¯ï¼Œç„¶åè°ƒåº¦çš„æ—¶å€™ï¼Œå†ä¸€ä¸ªä¸ªå»æŸ¥ï¼Œè¿™å¤ªä½æ•ˆäº†ï¼Œå°¤å…¶æ˜¯åœ¨è®¡ç®—èŠ‚ç‚¹æ•°ç›®æ¯”è¾ƒå¤šçš„æ—¶å€™ã€‚å› æ­¤ï¼Œå¢åŠ äº†ä¸€ä¸ªâ€œé¢„è¿‡æ»¤â€çš„æµç¨‹ï¼Œé€šè¿‡å‘PlacementæŸ¥è¯¢ï¼ŒPlacementæœåŠ¡ç›´æ¥é€šè¿‡SQLå»æŸ¥ä¸€æŠŠï¼ŒæŠŠæ»¡è¶³æ¡ä»¶ï¼ˆæ¯”å¦‚CPUå……è¶³ã€RAMå……è¶³ç­‰ï¼‰å…ˆè·å–åˆ°ã€‚
è€ŒåŸæ¥è·å–å¤‡é€‰èŠ‚ç‚¹çš„æ—¶å€™ï¼Œåªæ”¯æŒè·å–å•ä¸€çš„Resource Providerï¼Œè¿™ä¸ªBPå¢å¼ºäº†è·å–å¤‡é€‰èµ„æºçš„èƒ½åŠ›ï¼Œç”¨äºåç»­æ”¯æŒæ›´å¤æ‚çš„è¯·æ±‚ï¼Œæ¯”å¦‚å…±äº«èµ„æºã€åµŒå¥—èµ„æºçš„ProvideræŸ¥è¯¢ã€‚åé¢ï¼ŒPlacementè¿˜ä¼šé™†ç»­æ”¯æŒæ›´å¤šçš„è¯·æ±‚ï¼Œæ¯”å¦‚å¯¹ä¸€äº›éå­˜é‡ä¸å¯è®¡æ•°çš„èµ„æºçš„æ”¯æŒã€‚è¿™æ ·ç•™ç»™åé¢Filter&amp;Weightçš„å‹åŠ›å°±å°ä¸€äº›äº†ï¼Œå†å¾€åï¼Œä¼šä¸ä¼šå®Œå…¨å–ä»£Filterå‘¢ï¼Ÿæˆ‘æƒ³ï¼Œç°æœ‰çš„å„ç§è¿‡æ»¤éƒ½å¯ä»¥é€šè¿‡Placementæ”¯æŒåï¼Œå®Œå…¨æœ‰å¯èƒ½çš„ã€‚</li>
<li>Scheduleré€šè¿‡Placementæ¥claimèµ„æºã€‚å‚è€ƒ<a href="https://blueprints.launchpad.net/nova/+spec/placement-claims">Scheduler claiming resources to the Placement API</a>çš„å®ç°ã€‚
åœ¨æœ€æ—©çš„æ—¶å€™ï¼Œclaimèµ„æºæ˜¯ç”±computeæ¥åšçš„ï¼Œç°åœ¨ç›¸å½“äºæå‰åˆ°schedulerå»æäº†ã€‚æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿæˆ‘ä»¬å…ˆçœ‹çœ‹åŸæ¥çš„é—®é¢˜ï¼š
è°ƒåº¦æ—¶åˆ»å’ŒçœŸæ­£çš„å»computeèŠ‚ç‚¹å»claimèµ„æºçš„æ—¶åˆ»ä¹‹é—´æ˜¯ç”±ä¸€æ®µæ—¶é—´çš„ï¼Œåœ¨èµ„æºä¸æ˜¯é‚£ä¹ˆå……è¶³çš„ç¯å¢ƒï¼Œå°±ä¼šé€ æˆåœ¨schedulerè°ƒåº¦çš„æ—¶å€™ï¼Œèµ„æºè¿˜æ²¡åˆ·æ–°ï¼Œæ‰€ä»¥è°ƒåº¦æ—¶å€™æˆåŠŸäº†ï¼Œä½†æ˜¯çœŸæ­£ä¸‹æ¥çš„æ—¶å€™ï¼Œæ‰å‘ç°computeå®é™…å·²ç»æ²¡æœ‰èµ„æºäº†ï¼Œç„¶ååˆâ€œè·¨è¶ŠåŠä¸ªåœ°çƒâ€å»åšé‡è°ƒåº¦ï¼Œæ— å½¢åœ°å¢åŠ äº†ç³»ç»Ÿçš„è´Ÿè½½ã€‚
è€Œä¸”å¢åŠ äº†åˆ›å»ºçš„æ—¶é•¿ï¼ˆå“¦ï¼Œå“ªæ€•åˆ›å»ºå¤±è´¥å‘¢ï¼Ÿï¼‰ï¼Œä½ æƒ³æƒ³ï¼Œç”¨æˆ·åˆ›äº†é‚£ä¹ˆä¹…çš„è™šæ‹Ÿæœºï¼Œæœ€åä½ å‘Šè¯‰æˆ‘è°ƒåº¦å¤±è´¥äº†ï¼Œç”¨æˆ·ä¸å¤ªèƒ½å¿ã€‚
æ‰€ä»¥è¿™ä¸ªBPå°±æŠŠClaimèµ„æºæ”¾åœ¨è°ƒåº¦å¤„äº†ï¼Œæˆ‘ä¸Šä¸€ä¸ªè°ƒåº¦è¯·æ±‚å¤„ç†å®Œï¼Œé©¬ä¸Šå°±å‘Šè¯‰placementï¼Œè¿™èµ„æºè€å­ç”¨äº†ï¼Œå…¶ä»–äººä¸è¦åŠ¨äº†ã€‚OKï¼Œä¸–ç•Œç»ˆäºæ¸…å‡€äº†ï¼Œèƒ½æ‹¿åˆ°èµ„æºçš„æ‹¿åˆ°äº†ï¼Œæ‹¿ä¸åˆ°èµ„æºçš„é©¬ä¸Šä¹ŸçŸ¥é“è‡ªå·±æ‹¿ä¸åˆ°äº†ï¼Œå¤§å¤§å¢å¼ºäº†è°ƒåº¦çš„ç”¨æˆ·ä½“éªŒã€‚</li>
</ol>
<h3 id="24-placement">2.4 Placement<a hidden class="anchor" aria-hidden="true" href="#24-placement">#</a></h3>
<p>æ©ï¼Œåœ¨è°ƒåº¦çš„æ—¶å€™ï¼Œå·²ç»ä»‹ç»è¿‡è¿™ä¸ªæœåŠ¡äº†ï¼Œåœ¨è™šæ‹Ÿæœºåˆ›å»ºçš„æµç¨‹ä¸­ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ¥å£å°±æ˜¯è·å–å¤‡é€‰èµ„æºå’Œclaimèµ„æºã€‚
Placementç›®æ ‡å¾ˆå®ä¼Ÿï¼Œå¤§è‡´çš„ä½œç”¨å°±æ˜¯ï¼šèµ„æºæˆ‘æ¥ç®¡ï¼Œè¦èµ„æºé—®æˆ‘è¦ï¼Œç”¨äº†èµ„æºå‘Šè¯‰æˆ‘ã€‚åé¢å‡†å¤‡ç”¨ä¸€ç¯‡æ–‡ç« æ•´ä½“ä»‹ç»ä¸€ä¸‹Placementã€‚ï¼ˆyepï¼Œè¿™ä¸ªFlagæˆ‘ç«‹ä¸‹äº†ï¼Œä¼šå†™çš„ï¼‰</p>
<p>serviceçš„è¯¦ç»†ä¿¡æ¯ä¸»è¦åŒ…æ‹¬å¦‚ä¸‹å‡ é¡¹ï¼š
binary, host, zone, status, state
å…¶ä¸­ï¼š binaryï¼Œå¯ä»¥ç†è§£ä¸ºserviceçš„åç§°ï¼Œç±»ä¼¼äºnova-computeï¼›
hostæ˜¯serviceæ‰€åœ¨çš„ä¸»æœºåç§°ï¼›
zoneæ˜¯serviceæ‰€å±çš„AZï¼Œå…¶å®å°±æ˜¯serviceæ‰€åœ¨çš„ä¸»æœºæ‰€å±çš„aggregateï¼Œåªæ˜¯aggregateçš„æ¦‚å¿µä¸å¯¹å¤–å‘ˆç°ï¼Œæ‰€ä»¥ç”¨æˆ·çœ‹åˆ°çš„æ˜¯AZã€‚å…¶å®ï¼Œåœ¨Novaå†…éƒ¨ï¼ŒAZæ˜¯AGçš„metadataè€Œå·²ã€‚</p>
<pre tabindex="0"><code>zoneçš„ç¡®å®šï¼Œæ¶‰åŠåˆ°ä¸¤ä¸ªé…ç½®é¡¹ï¼Œå¯¹äºéè®¡ç®—èŠ‚ç‚¹ï¼Œzoneçš„åç§°ä¾èµ–äºé…ç½®é¡¹internal_service_availability_zoneï¼ˆé»˜è®¤æ˜¯internalï¼‰ï¼›
å¯¹äºè®¡ç®—èŠ‚ç‚¹ï¼Œå¦‚æœä¸å±äºä»»ä½•AGï¼Œæˆ–è€…æ‰€å±çš„AGæ²¡æœ‰AZçš„metadataä¿¡æ¯ï¼Œé»˜è®¤çš„zoneä¾èµ–äºé…ç½®é¡¹default_availability_zoneï¼ˆé»˜è®¤æ˜¯novaï¼‰ã€‚
</code></pre><p>statusæ˜¯æœåŠ¡disableå±æ€§çš„ä½“ç°ï¼Œè¯¥å±æ€§å¯ä»¥ç›´æ¥é€šè¿‡APIä¿®æ”¹;
stateæ˜¯æœåŠ¡çœŸå®çš„çŠ¶æ€ï¼Œæ˜¯é€šè¿‡servicegroup apiè·å–ã€‚æ¯ä¸ªæœåŠ¡åœ¨å¯åŠ¨æ—¶ä¼šåŠ å…¥servicegroupï¼Œä»¥dbåç«¯ä¸ºä¾‹ï¼Œä¼šåœ¨æœåŠ¡ä¸­å¯åŠ¨å®šæ—¶å™¨ï¼Œæ›´æ–°serviceè¡¨ä¸­çš„<code>report_count</code>çš„å€¼ï¼ŒåŒæ—¶ä¹Ÿä¼šåˆ·æ–°æ›´æ–°æ—¶é—´ï¼Œåç»­ä¼šæ ¹æ®è¿™ä¸ªæ›´æ–°æ—¶é—´ç¡®å®šæœåŠ¡çš„æ­»æ´»ï¼›</p>
<p>å½“ç„¶ï¼ŒæŸ¥è¯¢serviceä¿¡æ¯ä¹Ÿæ”¯æŒè¿‡æ»¤æ¡ä»¶ï¼Œæ¯”å¦‚ï¼š
1ã€æŸ¥è¯¢æŸä¸ªhostç›¸å…³çš„serviceï¼›
2ã€æŒ‰binaryåç§°æŸ¥è¯¢serviceï¼›</p>
<p>å…¶å®Novaä¸­æ²¡æœ‰hostè¿™ä¸ªç‹¬ç«‹çš„èµ„æºï¼ˆæ•°æ®åº“å¯¹è±¡ï¼‰ï¼Œä½†æ˜¯Novaå´æœ‰é’ˆå¯¹hostçš„APIæ“ä½œï¼Œå…¶å®ï¼Œåœ¨å†…éƒ¨å®ç°ä¸­ï¼Œå°±æ˜¯é€šè¿‡å‰é¢çš„serviceä¿¡æ¯ï¼Œé—´æ¥ç»„è£…è¿”å›hostä¿¡æ¯ã€‚</p>
<p>ç§Ÿæˆ·ï¼šé…é¢</p>
<pre tabindex="0"><code>ä¸æ­¤åŒæ—¶ï¼Œè™šæ‹Ÿæœºstateæˆ–task_stateå‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¹Ÿä¼šå‘å¤–éƒ¨å‘é€é€šçŸ¥ã€‚
å‰ææ˜¯é…ç½®é¡¹notify_on_state_changeè¦é…ç½®ä¸ºvm_stateæˆ–vm_and_task_stateã€‚
</code></pre><p>Novaä¸­çš„è™šæ‹Ÿæœºæ¯ä¸ªæ“ä½œï¼ˆå¯åŠ¨ã€åœæ­¢ã€æš‚åœã€æ¢å¤ç­‰ç­‰ï¼‰ï¼Œéƒ½ä¼šåœ¨dbä¸­ä¿å­˜ç›¸å…³çš„æ“ä½œè®°å½•ï¼Œç»™ç”¨æˆ·æä¾›æŸ¥è¯¢ã€‚åˆ©ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œ<strong>ç”¨æˆ·å¯¹è‡ªå·±çš„è™šæ‹Ÿæœºæ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„è¿‡ç¨‹å’ŒçŠ¶æ€éƒ½ä¼šäº†å¦‚æŒ‡æŒ</strong>ï¼Œä¾¿äºç”¨æˆ·çš„ç®¡ç†ã€‚å‚è§<a href="http://developer.openstack.org/api-ref-compute-v2-ext.html#ext-os-instance-actions">è¿™é‡Œ</a>ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<p>åœ¨å†…éƒ¨å®ç°ä¸­ï¼Œnova-apiå±‚ä¼šè®°å½•actionå¼€å§‹çš„è®°å½•ï¼Œåœ¨nova-computeå±‚ï¼Œåˆ™ä¼šæ·»åŠ eventå¼€å§‹å’Œç»“æŸçš„ä¿¡æ¯ï¼Œactionå’Œeventæ ¹æ®request idï¼ˆä¸€æ¬¡æ¶ˆæ¯è¯·æ±‚çš„æ ‡è¯†ï¼‰å…³è”ã€‚</p>
<ul>
<li>å…ˆè¯´é€šçŸ¥ï¼Œè™šæ‹Ÿæœºæ“ä½œå¼‚å¸¸æ—¶ï¼Œä¸€èˆ¬éƒ½ä¼šå‘é€erroré€šçŸ¥ï¼Œé€šçŸ¥ä¸­åŒ…å«å¼‚å¸¸çš„å‡½æ•°åç§°ã€å¼‚å¸¸æ—¶å‡½æ•°çš„å‚æ•°ä»¥åŠå¼‚å¸¸ä¿¡æ¯ã€‚</li>
<li>å†è¯´dbï¼Œè™šæ‹Ÿæœºæ“ä½œå¼‚å¸¸æ—¶ï¼Œæ— è®ºæ˜¯åœ¨conductor, schedulerè¿˜æ˜¯computeå±‚ï¼Œé™¤äº†ä¼šå‘é€é€šçŸ¥å¤–ï¼Œè¿˜ä¼šè®°å½•å¼‚å¸¸ä¿¡æ¯åˆ°æ•°æ®åº“ï¼ˆ<code>instance_faults</code>è¡¨ï¼‰ï¼Œå½“æŸ¥è¯¢è™šæ‹Ÿæœºä¿¡æ¯æ—¶ï¼Œä¼šè¿”å›è™šæ‹Ÿæœºçš„å¼‚å¸¸ä¿¡æ¯ã€‚</li>
</ul>
<p>ä¸€ä¸ªhypervisorï¼Œæ˜¯åˆ›å»ºè™šæ‹Ÿæœºèƒ½å¤Ÿè°ƒåº¦åˆ°çš„æœ€å°å•å…ƒã€‚</p>
<ol>
<li><code>api.py</code>æä¾›å¯¹å¤–è®¿é—®çš„æ¥å£ï¼Œå¯ä»¥ä»è¿™å¼€å§‹å…¥æ‰‹è·Ÿè¸ªå„ä¸ªåŠŸèƒ½å®ç°ã€‚</li>
<li><code>rpcapi.py</code>å°è£…RPCè¯·æ±‚è°ƒç”¨ï¼Œå¤§å¤šæ•°æ˜¯å¼‚æ­¥è°ƒç”¨ã€‚</li>
<li><code>manager.py</code>å„ç§RPCè°ƒç”¨çš„å®ç°ï¼ŒåŸºæœ¬å’Œ<code>rpcapi.py</code>ä¸­è°ƒç”¨çš„åç§°ä¸€ä¸€å¯¹åº”ã€‚</li>
</ol>
<p>æ­¤å¤–è¿˜æœ‰ä¸€ç‚¹ï¼ŒOpenstackçš„ç›®å½•ç»“æ„æ˜¯æ ¹æ®åŠŸèƒ½åˆ’åˆ†çš„ï¼Œæ¯”å¦‚Novaä¸­computeç›®å½•ä¸ä¸€å®šéƒ½æ˜¯åœ¨<code>nova-compute</code>èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œè€Œæ˜¯æ‰€æœ‰å’Œè™šæ‹Ÿæœºåˆ›å»ºç›¸å…³çš„åŠŸèƒ½éƒ½åœ¨è¿™é‡Œã€‚</p>
<p>ä»é…ç½®æ–‡ä»¶å¯ä»¥æ˜æ˜¾çš„çœ‹å‡ºï¼Œnova-apiå¯¹åº”çš„æ–‡ä»¶æ˜¯<code>nova/cmd/api.py</code>çš„<code>main()</code>å‡½æ•°ï¼š</p>
<p>vm_state</p>
<p>power_state</p>
<p>task_state</p>
<p>_record_action_start
notify_about_instance_action
elevated</p>
<pre tabindex="0"><code class="language-plantuml" data-lang="plantuml">@startuml

title: åˆ›å»ºè™šæ‹Ÿæœº

participant &#34;API&#34; as api
note left of api
nova/api/openstack/compute/servers.py
end note 
participant &#34;Scheduler&#34; as sch
database &#34;Database&#34; as db #Green 
participant &#34;Condutor(super)&#34; as pconductor
participant &#34;Placement&#34; as placement 
box &#34;internal service&#34;
participant &#34;Compute&#34; as compute
participant &#34;Libvirt&#34; as virt 
end box
participant &#34;Conductor(cell)&#34; as ccondutor

participant &#34;Neutron&#34; as neutron
participant &#34;Cinder&#34; as cinder 
participant &#34;Glance&#34; as glance


autonumber &#34;&lt;b&gt; [00]&#34;
[-&gt; api++ : åˆ›å»ºè™šæ‹Ÿæœº
api -&gt; api : validate schema
api -&gt; api : get context
api -&gt; api : get server_dict
api -&gt; api : gen create_kwargs
api -&gt; api : policy check
api -&gt; api : provision instance
api -&gt; glance : è·å–é•œåƒä¿¡æ¯
api -&gt; api : policyæ ¡éªŒ
api -&gt; api : é…é¢æ ¡éªŒ
api -&gt; api : æ·»åŠ Group


hnote left #FFAAAA
vm_state: Building
task_state: Scheduling
end note


api -&gt; db : åˆ›å»ºinstance

db -&gt; api : create success

[&lt;- api : return 202

deactivate api

api -&gt; pconductor ++: schedule &amp; build
pconductor -&gt; sch : select_destination

sch -&gt; placement : get allocation candidates
placement -&gt; sch : alloc_reqs.provider_summarys

sch -&gt; sch : Filter &amp; weighter

sch -&gt; placement : claim Resources
placement -&gt; sch : hello

sch -&gt; pconductor : return host
pconductor -&gt; pconductor : in target cell DBä¸­åˆ›å»ºinstance
pconductor -&gt; pconductor : é…é¢æ ¡éªŒ recheck
pconductor -&gt; pconductor : åˆ·æ–°instance cell ä¿¡æ¯
pconductor -&gt; pconductor : åˆ é™¤build request()

pconductor -&gt; compute : åœ¨æŒ‡å®šcellä¸­åˆ›å»ºè™šæ‹Ÿæœº
hnote left #FFAAAA
vm_state: Building
task_state: None
end note

compute -&gt; neutron : åˆ›å»ºç½‘ç»œ
hnote left #FFAAAA
vm_state: Building
task_state: Networking 
end note

compute -&gt; cinder : æ„å»ºå—è®¾å¤‡
hnote left #FFAAAA
vm_state: Building
task_state: Block Device Mapping
end note

compute -&gt; compute : spawn()
hnote left #FFAAAA
vm_state: Building
task_state: Spawning
end note

compute -&gt; glance : ä¸‹è½½é•œåƒ

compute -&gt; compute : ç”Ÿæˆxml
compute -&gt; compute : åˆ·æ–°è™šæ‹ŸæœºçŠ¶æ€
hnote left #FFAAAA
vm_state: Building
task_state: None
end note









@enduml
</code></pre><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>@startuml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>title: Lockè™šæ‹Ÿæœº
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>participant <span style="color:#0ff;font-weight:bold">&#34;API&#34;</span> as api
</span></span><span style="display:flex;"><span>database <span style="color:#0ff;font-weight:bold">&#34;Database&#34;</span> as db <span style="color:#007f7f">#Green </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>autonumber <span style="color:#0ff;font-weight:bold">&#34;&lt;b&gt; [00]&#34;</span>
</span></span><span style="display:flex;"><span>[-&gt; api : lock
</span></span><span style="display:flex;"><span>api -&gt; api : get_context
</span></span><span style="display:flex;"><span>api -&gt; api : authorize  action [lock] policy
</span></span><span style="display:flex;"><span>api -&gt; db : get instance by id
</span></span><span style="display:flex;"><span>db -&gt; api : <span style="color:#fff;font-weight:bold">done</span>
</span></span><span style="display:flex;"><span>api -&gt; api : check policy
</span></span><span style="display:flex;"><span>api -&gt; db : instance.locked = True<span style="color:#0ff;font-weight:bold">\n</span> locked_by=owner or admin<span style="color:#0ff;font-weight:bold">\n</span> record locked reason
</span></span><span style="display:flex;"><span>db -&gt; api : <span style="color:#fff;font-weight:bold">done</span>
</span></span><span style="display:flex;"><span>[&lt;- api : response
</span></span><span style="display:flex;"><span>@enduml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@startuml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>title: Pauseè™šæ‹Ÿæœº
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>participant <span style="color:#0ff;font-weight:bold">&#34;API&#34;</span> as api
</span></span><span style="display:flex;"><span>database <span style="color:#0ff;font-weight:bold">&#34;Database&#34;</span> as db <span style="color:#007f7f">#Green </span>
</span></span><span style="display:flex;"><span>box <span style="color:#0ff;font-weight:bold">&#34;internal service&#34;</span>
</span></span><span style="display:flex;"><span>participant <span style="color:#0ff;font-weight:bold">&#34;Compute&#34;</span> as compute
</span></span><span style="display:flex;"><span>participant <span style="color:#0ff;font-weight:bold">&#34;Libvirt&#34;</span> as virt 
</span></span><span style="display:flex;"><span>end box
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>autonumber <span style="color:#0ff;font-weight:bold">&#34;&lt;b&gt; [00]&#34;</span>
</span></span><span style="display:flex;"><span>[-&gt; api++ : pause instance
</span></span><span style="display:flex;"><span>api -&gt; api : authorize context
</span></span><span style="display:flex;"><span>api -&gt; db++ : get instance by uuid
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">done</span> 
</span></span><span style="display:flex;"><span>api -&gt; api : check policy
</span></span><span style="display:flex;"><span>api -&gt; api : check instance lock
</span></span><span style="display:flex;"><span>api -&gt; api : check instance cell
</span></span><span style="display:flex;"><span>api -&gt; api : ensure instance state is ACTIVE
</span></span><span style="display:flex;"><span>api -&gt; db++ : task_state = PAUSING
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">done</span> 
</span></span><span style="display:flex;"><span>api -&gt; api : record pause action
</span></span><span style="display:flex;"><span>api -&gt; compute++ : pause_instance
</span></span><span style="display:flex;"><span>compute -&gt; compute : notify : pause.start
</span></span><span style="display:flex;"><span>compute -&gt; virt++ : pause 
</span></span><span style="display:flex;"><span>virt -&gt; virt : get domain
</span></span><span style="display:flex;"><span>virt -&gt; virt : domain.suspend()
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">done</span> 
</span></span><span style="display:flex;"><span>compute -&gt; db++ : vm_state = PAUSE<span style="color:#0ff;font-weight:bold">\n</span> task_state = None
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">done</span> 
</span></span><span style="display:flex;"><span>compute -&gt; compute : notify: pause.end
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[&lt;- api : response
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@enduml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@startuml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>title: Renameè™šæ‹Ÿæœº
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>participant <span style="color:#0ff;font-weight:bold">&#34;API&#34;</span> as api
</span></span><span style="display:flex;"><span>database <span style="color:#0ff;font-weight:bold">&#34;Database&#34;</span> as db <span style="color:#007f7f">#Green </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>autonumber <span style="color:#0ff;font-weight:bold">&#34;&lt;b&gt; [00]&#34;</span>
</span></span><span style="display:flex;"><span>[-&gt; api : update name
</span></span><span style="display:flex;"><span>activate api
</span></span><span style="display:flex;"><span>api -&gt; api : validate schema 
</span></span><span style="display:flex;"><span>api -&gt; api : get context
</span></span><span style="display:flex;"><span>api -&gt; api : authorize [update] policy
</span></span><span style="display:flex;"><span>api -&gt; api : get update_dict[<span style="color:#0ff;font-weight:bold">&#34;display_name&#34;</span>]
</span></span><span style="display:flex;"><span>api -&gt; db++ : get server by id
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">done</span> 
</span></span><span style="display:flex;"><span>api -&gt; db : update(update_dict)
</span></span><span style="display:flex;"><span>db -&gt; db : save 
</span></span><span style="display:flex;"><span>[&lt;- api : responee
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@enduml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@startuml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>title: Suspendè™šæ‹Ÿæœº
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>participant <span style="color:#0ff;font-weight:bold">&#34;API&#34;</span> as api
</span></span><span style="display:flex;"><span>database <span style="color:#0ff;font-weight:bold">&#34;Database&#34;</span> as db <span style="color:#007f7f">#Green </span>
</span></span><span style="display:flex;"><span>box <span style="color:#0ff;font-weight:bold">&#34;internal service&#34;</span>
</span></span><span style="display:flex;"><span>participant <span style="color:#0ff;font-weight:bold">&#34;Compute&#34;</span> as compute
</span></span><span style="display:flex;"><span>participant <span style="color:#0ff;font-weight:bold">&#34;Libvirt&#34;</span> as virt 
</span></span><span style="display:flex;"><span>end box
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>autonumber <span style="color:#0ff;font-weight:bold">&#34;&lt;b&gt; [00]&#34;</span>
</span></span><span style="display:flex;"><span>[-&gt; api++ : <span style="color:#fff;font-weight:bold">suspend</span> instance
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>api -&gt; api : authorize context
</span></span><span style="display:flex;"><span>api -&gt; db++ : get instance by uuid
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">done</span> 
</span></span><span style="display:flex;"><span>api -&gt; api : check policy
</span></span><span style="display:flex;"><span>api -&gt; api : check instance lock
</span></span><span style="display:flex;"><span>api -&gt; api : check instance cell
</span></span><span style="display:flex;"><span>api -&gt; api : ensure instance state is ACTIVE
</span></span><span style="display:flex;"><span>api -&gt; db++ : task_state = SUSPANDING
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">done</span> 
</span></span><span style="display:flex;"><span>api -&gt; api : record action : suspand
</span></span><span style="display:flex;"><span>api -&gt; compute++ : suspand_instance
</span></span><span style="display:flex;"><span>compute -&gt; compute : notify : suspand.start
</span></span><span style="display:flex;"><span>compute -&gt; virt++ : suspand
</span></span><span style="display:flex;"><span>virt -&gt; virt : get instance guest
</span></span><span style="display:flex;"><span>virt -&gt; virt : detach pci device
</span></span><span style="display:flex;"><span>virt -&gt; virt : detach sriow ports
</span></span><span style="display:flex;"><span>virt -&gt; virt : guest.save_memory_state()
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">done</span> 
</span></span><span style="display:flex;"><span>compute -&gt; db++ : vm_state = SUSPENDED<span style="color:#0ff;font-weight:bold">\n</span> task_state = None
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">done</span> 
</span></span><span style="display:flex;"><span>compute -&gt; compute : notify: suspend.end
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[&lt;- api : response
</span></span><span style="display:flex;"><span>@enduml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@startuml
</span></span><span style="display:flex;"><span>hide empty description
</span></span><span style="display:flex;"><span>[*] --&gt; State1
</span></span><span style="display:flex;"><span>State1 --&gt; [*]
</span></span><span style="display:flex;"><span>vm_state:powering<span style="color:#0ff;font-weight:bold">\n</span> task_state:good<span style="color:#0ff;font-weight:bold">\n</span> nihao
</span></span><span style="display:flex;"><span>State1 : this is another string
</span></span><span style="display:flex;"><span>State1 -&gt; State2
</span></span><span style="display:flex;"><span>State2 --&gt; [*]
</span></span><span style="display:flex;"><span>@enduml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@startuml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>title: Unlockè™šæ‹Ÿæœº
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>participant <span style="color:#0ff;font-weight:bold">&#34;API&#34;</span> as api
</span></span><span style="display:flex;"><span>database <span style="color:#0ff;font-weight:bold">&#34;Database&#34;</span> as db <span style="color:#007f7f">#Green </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>autonumber <span style="color:#0ff;font-weight:bold">&#34;&lt;b&gt; [00]&#34;</span>
</span></span><span style="display:flex;"><span>[-&gt; api : lock
</span></span><span style="display:flex;"><span>api -&gt; api : get_context
</span></span><span style="display:flex;"><span>api -&gt; api : authorize  action [unlock] policy
</span></span><span style="display:flex;"><span>api -&gt; db : get instance by id
</span></span><span style="display:flex;"><span>db -&gt; api : <span style="color:#fff;font-weight:bold">done</span>
</span></span><span style="display:flex;"><span>api -&gt; api : check policy
</span></span><span style="display:flex;"><span>api -&gt; db : query instance.locked
</span></span><span style="display:flex;"><span>db -&gt; api : <span style="color:#fff;font-weight:bold">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>api -&gt; db : instance.locked = False<span style="color:#0ff;font-weight:bold">\n</span> locked_by=None<span style="color:#0ff;font-weight:bold">\n</span> clear locked reason
</span></span><span style="display:flex;"><span>db -&gt; api : <span style="color:#fff;font-weight:bold">done</span>
</span></span><span style="display:flex;"><span>[&lt;- api : response
</span></span><span style="display:flex;"><span>@enduml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@startuml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>title: Unpauseè™šæ‹Ÿæœº
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>participant <span style="color:#0ff;font-weight:bold">&#34;API&#34;</span> as api
</span></span><span style="display:flex;"><span>database <span style="color:#0ff;font-weight:bold">&#34;Database&#34;</span> as db <span style="color:#007f7f">#Green </span>
</span></span><span style="display:flex;"><span>box <span style="color:#0ff;font-weight:bold">&#34;internal service&#34;</span>
</span></span><span style="display:flex;"><span>participant <span style="color:#0ff;font-weight:bold">&#34;Compute&#34;</span> as compute
</span></span><span style="display:flex;"><span>participant <span style="color:#0ff;font-weight:bold">&#34;Libvirt&#34;</span> as virt 
</span></span><span style="display:flex;"><span>end box
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>autonumber <span style="color:#0ff;font-weight:bold">&#34;&lt;b&gt; [00]&#34;</span>
</span></span><span style="display:flex;"><span>[-&gt; api++ : unpause instance
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>api -&gt; api : authorize context
</span></span><span style="display:flex;"><span>api -&gt; db++ : get instance by uuid
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">done</span> 
</span></span><span style="display:flex;"><span>api -&gt; api : check policy
</span></span><span style="display:flex;"><span>api -&gt; api : check instance lock
</span></span><span style="display:flex;"><span>api -&gt; api : check instance cell
</span></span><span style="display:flex;"><span>api -&gt; api : ensure instance state is PAUSED
</span></span><span style="display:flex;"><span>api -&gt; db++ : task_state = UNPAUSING
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">done</span> 
</span></span><span style="display:flex;"><span>api -&gt; api : record action : unpause
</span></span><span style="display:flex;"><span>api -&gt; compute++ : unpause_instance
</span></span><span style="display:flex;"><span>compute -&gt; compute : notify : unpause.start
</span></span><span style="display:flex;"><span>compute -&gt; virt++ : unpause 
</span></span><span style="display:flex;"><span>virt -&gt; virt : get domain
</span></span><span style="display:flex;"><span>virt -&gt; virt : domain.resume()
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">done</span> 
</span></span><span style="display:flex;"><span>compute -&gt; db++ : vm_state = ACTIVE<span style="color:#0ff;font-weight:bold">\n</span> task_state = None
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">done</span> 
</span></span><span style="display:flex;"><span>compute -&gt; compute : notify: unpause.end
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[&lt;- api : response
</span></span><span style="display:flex;"><span>@enduml
</span></span></code></pre></div><h3 id="å‚è€ƒ">å‚è€ƒ<a hidden class="anchor" aria-hidden="true" href="#å‚è€ƒ">#</a></h3>
<p><a href="https://docs.openstack.org/zh_CN/user-guide/cli-nova-launch-instance-from-volume.html">Openstackè™šæ‹Ÿæœºå¯åŠ¨æ–¹å¼</a></p>
<p><a href="https://www.hi-roy.com/2019/09/16/OpenStack%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/">Openstackæºç å­¦ä¹ ç¬”è®°</a></p>
<p><a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/common/glossary.html#term-domain">Openstackè¯æ±‡è¡¨</a></p>
<p><a href="https://docs.openstack.org/zh_CN/user-guide/cli-nova-launch-instance-from-volume.html">Openstackä»ç¡¬ç›˜å¯åŠ¨å®ä¾‹</a></p>
<p><a href="http://yikun.github.io/2017/09/27/OpenStack-Nova%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%88%9B%E5%BB%BA%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90/">Novaè™šæ‹Ÿæœºåˆ›å»ºæµç¨‹åˆ†æ</a></p>
<p><a href="https://www.cnblogs.com/jmilkfan-fanguiju/p/10589721.html">Novaåˆ›å»ºè™šæ‹Ÿæœºæµç¨‹åˆ†æ</a></p>
<p><a href="https://www.jingh.top/2019/04/29/%E5%A6%82%E4%BD%95%E9%98%85%E8%AF%BBOpenStack%E6%BA%90%E7%A0%81(%E6%9B%B4%E6%96%B0%E7%89%88)/">å¦‚ä½•é˜…è¯»openstackæºç </a></p>
<p><a href="https://blog.csdn.net/u010305706/article/details/52206175">è™šæ‹Ÿæœºåˆ›å»ºçš„50ä¸ªæ­¥éª¤å’Œ100ä¸ªçŸ¥è¯†ç‚¹</a></p>
<p><a href="https://www.hi-roy.com/2020/07/20/OpenStack%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B06/">Openstackæºç å­¦ä¹ ä¹‹çƒ­è¿ç§»</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://blog.niuhemoon.win/tags/nova/">Nova</a></li>
      <li><a href="https://blog.niuhemoon.win/tags/openstack/">Openstack</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://blog.niuhemoon.win/posts/tech/vscode-shortcut/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>vscode å¿«æ·é”®å’Œæ’ä»¶è®°å½•</span>
  </a>
  <a class="next" href="https://blog.niuhemoon.win/posts/tech/openstack-command-tutorial/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>Openstackå‘½ä»¤è¡ŒåŸºç¡€</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
      
    <span>&copy; 2024 <a href="https://blog.niuhemoon.win">Niuhe&#39;s Blog</a></span>
    <span xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/">
        Licensed under
        <a
          href="http://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1"
          target="_blank"
          rel="license noopener noreferrer"
          style="display:inline-block;"
          >CC BY-NC-SA 4.0 </a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'ğŸ“„å¤åˆ¶';

        function copyingDone() {
            copybutton.innerHTML = 'ğŸ‘ŒğŸ»å·²å¤åˆ¶!';
            setTimeout(() => {
                copybutton.innerHTML = 'ğŸ“„å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
