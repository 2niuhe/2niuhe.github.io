<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Python对称AES和DES加密算法 | Niuhe&#39;s Blog</title>
<meta name="keywords" content="Python, 密码学">
<meta name="description" content="Python3实现AES和DES对称加密算法的">
<meta name="author" content="Niuhe">
<link rel="canonical" href="https://blog.niuhemoon.win/posts/tech/python-symmetric-encryption/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css" integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe&#43;FVUFzPh7U=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://blog.niuhemoon.win/base/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://blog.niuhemoon.win/base/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="https://blog.niuhemoon.win/base/favicon.ico">
<link rel="apple-touch-icon" href="https://blog.niuhemoon.win/base/avatar.jpeg">
<link rel="mask-icon" href="https://blog.niuhemoon.win/base/avatar.jpeg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-116933089-1', 'auto');
	
	ga('send', 'pageview');
}
</script><meta property="og:title" content="Python对称AES和DES加密算法" />
<meta property="og:description" content="Python3实现AES和DES对称加密算法的" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.niuhemoon.win/posts/tech/python-symmetric-encryption/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-05-18T00:00:00+00:00" />
<meta property="article:modified_time" content="2018-05-18T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Python对称AES和DES加密算法"/>
<meta name="twitter:description" content="Python3实现AES和DES对称加密算法的"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "📚文章",
      "item": "https://blog.niuhemoon.win/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "👨🏻‍💻 技术",
      "item": "https://blog.niuhemoon.win/posts/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "Python对称AES和DES加密算法",
      "item": "https://blog.niuhemoon.win/posts/tech/python-symmetric-encryption/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Python对称AES和DES加密算法",
  "name": "Python对称AES和DES加密算法",
  "description": "Python3实现AES和DES对称加密算法的\n",
  "keywords": [
    "Python", "密码学"
  ],
  "articleBody": "Python3实现AES和DES对称加密算法的\n对称算法编写 本实验是使用python来实现AES和DES加密和解密过程，并对加密解密过程的正确性进行验证。\n1.实验目的 掌握分组加密的原理 掌握数据加密标准DES和高级数据加密标准AES的原理及其应用 2.实验工具 Jupyter Notebook Python3.5 3.实验环境 Ubuntu16.04LTS操作系统 Python3标准库 4.实验步骤 4.1 回顾课程，查阅资料 4.2 熟悉AES的原理 AES(Advanced Encryption Standard)高级加密标准，在密码学中又称Rijndael加密法，是美国联邦政府采用的一种区块加密标准。这个标准用来替代原先的DES，已经被多方分析且广为全世界所使用。\nAES加密过程是在一个4×4的字节矩阵上运作，这个矩阵又称为“体（state）”，其初值就是一个明文区块（矩阵中一个元素大小就是明文区块中的一个Byte）。（Rijndael加密法因支持更大的区块，其矩阵行数可视情况增加）加密时，各轮AES加密循环（除最后一轮外）均包含4个步骤：\nAddRoundKey—矩阵中的每一个字节都与该次回合密钥（round key）做XOR运算；每个子密钥由密钥生成方案产生。 SubBytes—通过一个非线性的替换函数，用查找表的方式把每个字节替换成对应的字节。 ShiftRows—将矩阵中的每个横列进行循环式移位。 MixColumns—为了充分混合矩阵中各个直行的操作。这个步骤使用线性转换来混合每内联的四个字节。最后一个加密循环中省略MixColumns步骤，而以另一个AddRoundKey取代。 4.3 编写AES加密解密的测试用例 先使用其他已有工具计算出plaintext对应的\n测试程序如下：\nimport unittest class AES: def __init__(self, master_key): self.change_key(master_key) def change_key(self, master_key): pass def encrypt(self, plaintext): pass def decrypt(self, ciphertext): pass class AES_TEST(unittest.TestCase): def setUp(self): master_key = 0x2b7e151628aed2a6abf7158809cf4f3c self.AES = AES(master_key) def test_encryption(self): plaintext = 0x3243f6a8885a308d313198a2e0370734 encrypted = self.AES.encrypt(plaintext) self.assertEqual(encrypted, 0x3925841d02dc09fbdc118597196a0b32) def test_decryption(self): ciphertext = 0x3925841d02dc09fbdc118597196a0b32 decrypted = self.AES.decrypt(ciphertext) self.assertEqual(decrypted, 0x3243f6a8885a308d313198a2e0370734) if __name__ == '__main__': unittest.main() 4.4 编写DES算法的测试代码 4.5 编写AES和DES对称加密的python实现，并进行测试验证 代码和测试结果在报告最后\n4.6 总结实验，编写实验报告 5. 实验总结 需要善于借鉴前人经验，搜集资料 实验只支持ascii码，对其他字符编码没有解决 利用优秀的工具，如Jupyter可以提高学习效率 6. 实验完整代码 #!/usr/bin/env python #-*- coding:utf-8 -*- \"\"\" ASE的python实现： 支持128位秘钥 支持秘钥和原文均为数字的AES加密解密 \"\"\" Sbox = ( 0x63, 0x7C, 0x77, 0x7B, 0xF2, 0x6B, 0x6F, 0xC5, 0x30, 0x01, 0x67, 0x2B, 0xFE, 0xD7, 0xAB, 0x76, 0xCA, 0x82, 0xC9, 0x7D, 0xFA, 0x59, 0x47, 0xF0, 0xAD, 0xD4, 0xA2, 0xAF, 0x9C, 0xA4, 0x72, 0xC0, 0xB7, 0xFD, 0x93, 0x26, 0x36, 0x3F, 0xF7, 0xCC, 0x34, 0xA5, 0xE5, 0xF1, 0x71, 0xD8, 0x31, 0x15, 0x04, 0xC7, 0x23, 0xC3, 0x18, 0x96, 0x05, 0x9A, 0x07, 0x12, 0x80, 0xE2, 0xEB, 0x27, 0xB2, 0x75, 0x09, 0x83, 0x2C, 0x1A, 0x1B, 0x6E, 0x5A, 0xA0, 0x52, 0x3B, 0xD6, 0xB3, 0x29, 0xE3, 0x2F, 0x84, 0x53, 0xD1, 0x00, 0xED, 0x20, 0xFC, 0xB1, 0x5B, 0x6A, 0xCB, 0xBE, 0x39, 0x4A, 0x4C, 0x58, 0xCF, 0xD0, 0xEF, 0xAA, 0xFB, 0x43, 0x4D, 0x33, 0x85, 0x45, 0xF9, 0x02, 0x7F, 0x50, 0x3C, 0x9F, 0xA8, 0x51, 0xA3, 0x40, 0x8F, 0x92, 0x9D, 0x38, 0xF5, 0xBC, 0xB6, 0xDA, 0x21, 0x10, 0xFF, 0xF3, 0xD2, 0xCD, 0x0C, 0x13, 0xEC, 0x5F, 0x97, 0x44, 0x17, 0xC4, 0xA7, 0x7E, 0x3D, 0x64, 0x5D, 0x19, 0x73, 0x60, 0x81, 0x4F, 0xDC, 0x22, 0x2A, 0x90, 0x88, 0x46, 0xEE, 0xB8, 0x14, 0xDE, 0x5E, 0x0B, 0xDB, 0xE0, 0x32, 0x3A, 0x0A, 0x49, 0x06, 0x24, 0x5C, 0xC2, 0xD3, 0xAC, 0x62, 0x91, 0x95, 0xE4, 0x79, 0xE7, 0xC8, 0x37, 0x6D, 0x8D, 0xD5, 0x4E, 0xA9, 0x6C, 0x56, 0xF4, 0xEA, 0x65, 0x7A, 0xAE, 0x08, 0xBA, 0x78, 0x25, 0x2E, 0x1C, 0xA6, 0xB4, 0xC6, 0xE8, 0xDD, 0x74, 0x1F, 0x4B, 0xBD, 0x8B, 0x8A, 0x70, 0x3E, 0xB5, 0x66, 0x48, 0x03, 0xF6, 0x0E, 0x61, 0x35, 0x57, 0xB9, 0x86, 0xC1, 0x1D, 0x9E, 0xE1, 0xF8, 0x98, 0x11, 0x69, 0xD9, 0x8E, 0x94, 0x9B, 0x1E, 0x87, 0xE9, 0xCE, 0x55, 0x28, 0xDF, 0x8C, 0xA1, 0x89, 0x0D, 0xBF, 0xE6, 0x42, 0x68, 0x41, 0x99, 0x2D, 0x0F, 0xB0, 0x54, 0xBB, 0x16, ) InvSbox = ( 0x52, 0x09, 0x6A, 0xD5, 0x30, 0x36, 0xA5, 0x38, 0xBF, 0x40, 0xA3, 0x9E, 0x81, 0xF3, 0xD7, 0xFB, 0x7C, 0xE3, 0x39, 0x82, 0x9B, 0x2F, 0xFF, 0x87, 0x34, 0x8E, 0x43, 0x44, 0xC4, 0xDE, 0xE9, 0xCB, 0x54, 0x7B, 0x94, 0x32, 0xA6, 0xC2, 0x23, 0x3D, 0xEE, 0x4C, 0x95, 0x0B, 0x42, 0xFA, 0xC3, 0x4E, 0x08, 0x2E, 0xA1, 0x66, 0x28, 0xD9, 0x24, 0xB2, 0x76, 0x5B, 0xA2, 0x49, 0x6D, 0x8B, 0xD1, 0x25, 0x72, 0xF8, 0xF6, 0x64, 0x86, 0x68, 0x98, 0x16, 0xD4, 0xA4, 0x5C, 0xCC, 0x5D, 0x65, 0xB6, 0x92, 0x6C, 0x70, 0x48, 0x50, 0xFD, 0xED, 0xB9, 0xDA, 0x5E, 0x15, 0x46, 0x57, 0xA7, 0x8D, 0x9D, 0x84, 0x90, 0xD8, 0xAB, 0x00, 0x8C, 0xBC, 0xD3, 0x0A, 0xF7, 0xE4, 0x58, 0x05, 0xB8, 0xB3, 0x45, 0x06, 0xD0, 0x2C, 0x1E, 0x8F, 0xCA, 0x3F, 0x0F, 0x02, 0xC1, 0xAF, 0xBD, 0x03, 0x01, 0x13, 0x8A, 0x6B, 0x3A, 0x91, 0x11, 0x41, 0x4F, 0x67, 0xDC, 0xEA, 0x97, 0xF2, 0xCF, 0xCE, 0xF0, 0xB4, 0xE6, 0x73, 0x96, 0xAC, 0x74, 0x22, 0xE7, 0xAD, 0x35, 0x85, 0xE2, 0xF9, 0x37, 0xE8, 0x1C, 0x75, 0xDF, 0x6E, 0x47, 0xF1, 0x1A, 0x71, 0x1D, 0x29, 0xC5, 0x89, 0x6F, 0xB7, 0x62, 0x0E, 0xAA, 0x18, 0xBE, 0x1B, 0xFC, 0x56, 0x3E, 0x4B, 0xC6, 0xD2, 0x79, 0x20, 0x9A, 0xDB, 0xC0, 0xFE, 0x78, 0xCD, 0x5A, 0xF4, 0x1F, 0xDD, 0xA8, 0x33, 0x88, 0x07, 0xC7, 0x31, 0xB1, 0x12, 0x10, 0x59, 0x27, 0x80, 0xEC, 0x5F, 0x60, 0x51, 0x7F, 0xA9, 0x19, 0xB5, 0x4A, 0x0D, 0x2D, 0xE5, 0x7A, 0x9F, 0x93, 0xC9, 0x9C, 0xEF, 0xA0, 0xE0, 0x3B, 0x4D, 0xAE, 0x2A, 0xF5, 0xB0, 0xC8, 0xEB, 0xBB, 0x3C, 0x83, 0x53, 0x99, 0x61, 0x17, 0x2B, 0x04, 0x7E, 0xBA, 0x77, 0xD6, 0x26, 0xE1, 0x69, 0x14, 0x63, 0x55, 0x21, 0x0C, 0x7D, ) # 参考了C语言实现 http://cs.ucsb.edu/~koc/cs178/projects/JT/aes.c xtime = lambda a: (((a \u003c\u003c 1) ^ 0x1B) \u0026 0xFF) if (a \u0026 0x80) else (a \u003c\u003c 1) Rcon = ( 0x00, 0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x1B, 0x36, 0x6C, 0xD8, 0xAB, 0x4D, 0x9A, 0x2F, 0x5E, 0xBC, 0x63, 0xC6, 0x97, 0x35, 0x6A, 0xD4, 0xB3, 0x7D, 0xFA, 0xEF, 0xC5, 0x91, 0x39, ) def text2matrix(text): matrix = [] for i in range(16): byte = (text \u003e\u003e (8 * (15 - i))) \u0026 0xFF if i % 4 == 0: matrix.append([byte]) else: matrix[int(i / 4)].append(byte) return matrix def matrix2text(matrix): text = 0 for i in range(4): for j in range(4): text |= (matrix[i][j] \u003c\u003c (120 - 8 * (4 * i + j))) return text class AES: def __init__(self, master_key): self.change_key(master_key) def change_key(self, master_key): self.round_keys = text2matrix(master_key) # print self.round_keys for i in range(4, 4 * 11): self.round_keys.append([]) if i % 4 == 0: byte = self.round_keys[i - 4][0] \\ ^ Sbox[self.round_keys[i - 1][1]] \\ ^ Rcon[int(i / 4)] self.round_keys[i].append(byte) for j in range(1, 4): byte = self.round_keys[i - 4][j] \\ ^ Sbox[self.round_keys[i - 1][(j + 1) % 4]] self.round_keys[i].append(byte) else: for j in range(4): byte = self.round_keys[i - 4][j] \\ ^ self.round_keys[i - 1][j] self.round_keys[i].append(byte) # print self.round_keys def encrypt(self, plaintext): self.plain_state = text2matrix(plaintext) self.__add_round_key(self.plain_state, self.round_keys[:4]) for i in range(1, 10): self.__round_encrypt(self.plain_state, self.round_keys[4 * i : 4 * (i + 1)]) self.__sub_bytes(self.plain_state) self.__shift_rows(self.plain_state) self.__add_round_key(self.plain_state, self.round_keys[40:]) return matrix2text(self.plain_state) def decrypt(self, ciphertext): self.cipher_state = text2matrix(ciphertext) self.__add_round_key(self.cipher_state, self.round_keys[40:]) self.__inv_shift_rows(self.cipher_state) self.__inv_sub_bytes(self.cipher_state) for i in range(9, 0, -1): self.__round_decrypt(self.cipher_state, self.round_keys[4 * i : 4 * (i + 1)]) self.__add_round_key(self.cipher_state, self.round_keys[:4]) return matrix2text(self.cipher_state) def __add_round_key(self, s, k): for i in range(4): for j in range(4): s[i][j] ^= k[i][j] def __round_encrypt(self, state_matrix, key_matrix): self.__sub_bytes(state_matrix) self.__shift_rows(state_matrix) self.__mix_columns(state_matrix) self.__add_round_key(state_matrix, key_matrix) def __round_decrypt(self, state_matrix, key_matrix): self.__add_round_key(state_matrix, key_matrix) self.__inv_mix_columns(state_matrix) self.__inv_shift_rows(state_matrix) self.__inv_sub_bytes(state_matrix) def __sub_bytes(self, s): for i in range(4): for j in range(4): s[i][j] = Sbox[s[i][j]] def __inv_sub_bytes(self, s): for i in range(4): for j in range(4): s[i][j] = InvSbox[s[i][j]] def __shift_rows(self, s): s[0][1], s[1][1], s[2][1], s[3][1] = s[1][1], s[2][1], s[3][1], s[0][1] s[0][2], s[1][2], s[2][2], s[3][2] = s[2][2], s[3][2], s[0][2], s[1][2] s[0][3], s[1][3], s[2][3], s[3][3] = s[3][3], s[0][3], s[1][3], s[2][3] def __inv_shift_rows(self, s): s[0][1], s[1][1], s[2][1], s[3][1] = s[3][1], s[0][1], s[1][1], s[2][1] s[0][2], s[1][2], s[2][2], s[3][2] = s[2][2], s[3][2], s[0][2], s[1][2] s[0][3], s[1][3], s[2][3], s[3][3] = s[1][3], s[2][3], s[3][3], s[0][3] def __mix_single_column(self, a): # please see Sec 4.1.2 in The Design of Rijndael t = a[0] ^ a[1] ^ a[2] ^ a[3] u = a[0] a[0] ^= t ^ xtime(a[0] ^ a[1]) a[1] ^= t ^ xtime(a[1] ^ a[2]) a[2] ^= t ^ xtime(a[2] ^ a[3]) a[3] ^= t ^ xtime(a[3] ^ u) def __mix_columns(self, s): for i in range(4): self.__mix_single_column(s[i]) def __inv_mix_columns(self, s): # see Sec 4.1.3 in The Design of Rijndael for i in range(4): u = xtime(xtime(s[i][0] ^ s[i][2])) v = xtime(xtime(s[i][1] ^ s[i][3])) s[i][0] ^= u s[i][1] ^= v s[i][2] ^= u s[i][3] ^= v self.__mix_columns(s) master_key = 0x2b7e151628aed2a6abf7158809cf4f3c AESbar = AES(master_key) def test_encryption(): plaintext = 0x3243f6a8885a308d313198a2e0370734 encrypted = AESbar.encrypt(plaintext) print('加密得密文： 0x%x' % encrypted) assert encrypted == 0x3925841d02dc09fbdc118597196a0b32 print('加密结果正确') def test_decryption(): ciphertext = 0x3925841d02dc09fbdc118597196a0b32 decrypted = AESbar.decrypt(ciphertext) print('解密得原文: 0x%x' % decrypted) assert decrypted == 0x3243f6a8885a308d313198a2e0370734 print('解密成功') if __name__ == '__main__': print('开始单元测试：') test_encryption() test_decryption() print('单元测试成功') 开始单元测试： 加密得密文： 0x3925841d02dc09fbdc118597196a0b32 加密结果正确 解密得原文: 0x3243f6a8885a308d313198a2e0370734 解密成功 单元测试成功 #!/usr/bin/env python #-*- coding:utf-8 -*- ''' DES加密解密的Python3实现 ''' #Initial permut matrix for the datas PI = [58, 50, 42, 34, 26, 18, 10, 2, 60, 52, 44, 36, 28, 20, 12, 4, 62, 54, 46, 38, 30, 22, 14, 6, 64, 56, 48, 40, 32, 24, 16, 8, 57, 49, 41, 33, 25, 17, 9, 1, 59, 51, 43, 35, 27, 19, 11, 3, 61, 53, 45, 37, 29, 21, 13, 5, 63, 55, 47, 39, 31, 23, 15, 7] #Initial permut made on the key CP_1 = [57, 49, 41, 33, 25, 17, 9, 1, 58, 50, 42, 34, 26, 18, 10, 2, 59, 51, 43, 35, 27, 19, 11, 3, 60, 52, 44, 36, 63, 55, 47, 39, 31, 23, 15, 7, 62, 54, 46, 38, 30, 22, 14, 6, 61, 53, 45, 37, 29, 21, 13, 5, 28, 20, 12, 4] #Permut applied on shifted key to get Ki+1 CP_2 = [14, 17, 11, 24, 1, 5, 3, 28, 15, 6, 21, 10, 23, 19, 12, 4, 26, 8, 16, 7, 27, 20, 13, 2, 41, 52, 31, 37, 47, 55, 30, 40, 51, 45, 33, 48, 44, 49, 39, 56, 34, 53, 46, 42, 50, 36, 29, 32] #Expand matrix to get a 48bits matrix of datas to apply the xor with Ki E = [32, 1, 2, 3, 4, 5, 4, 5, 6, 7, 8, 9, 8, 9, 10, 11, 12, 13, 12, 13, 14, 15, 16, 17, 16, 17, 18, 19, 20, 21, 20, 21, 22, 23, 24, 25, 24, 25, 26, 27, 28, 29, 28, 29, 30, 31, 32, 1] #SBOX S_BOX = [ [[14, 4, 13, 1, 2, 15, 11, 8, 3, 10, 6, 12, 5, 9, 0, 7], [0, 15, 7, 4, 14, 2, 13, 1, 10, 6, 12, 11, 9, 5, 3, 8], [4, 1, 14, 8, 13, 6, 2, 11, 15, 12, 9, 7, 3, 10, 5, 0], [15, 12, 8, 2, 4, 9, 1, 7, 5, 11, 3, 14, 10, 0, 6, 13], ], [[15, 1, 8, 14, 6, 11, 3, 4, 9, 7, 2, 13, 12, 0, 5, 10], [3, 13, 4, 7, 15, 2, 8, 14, 12, 0, 1, 10, 6, 9, 11, 5], [0, 14, 7, 11, 10, 4, 13, 1, 5, 8, 12, 6, 9, 3, 2, 15], [13, 8, 10, 1, 3, 15, 4, 2, 11, 6, 7, 12, 0, 5, 14, 9], ], [[10, 0, 9, 14, 6, 3, 15, 5, 1, 13, 12, 7, 11, 4, 2, 8], [13, 7, 0, 9, 3, 4, 6, 10, 2, 8, 5, 14, 12, 11, 15, 1], [13, 6, 4, 9, 8, 15, 3, 0, 11, 1, 2, 12, 5, 10, 14, 7], [1, 10, 13, 0, 6, 9, 8, 7, 4, 15, 14, 3, 11, 5, 2, 12], ], [[7, 13, 14, 3, 0, 6, 9, 10, 1, 2, 8, 5, 11, 12, 4, 15], [13, 8, 11, 5, 6, 15, 0, 3, 4, 7, 2, 12, 1, 10, 14, 9], [10, 6, 9, 0, 12, 11, 7, 13, 15, 1, 3, 14, 5, 2, 8, 4], [3, 15, 0, 6, 10, 1, 13, 8, 9, 4, 5, 11, 12, 7, 2, 14], ], [[2, 12, 4, 1, 7, 10, 11, 6, 8, 5, 3, 15, 13, 0, 14, 9], [14, 11, 2, 12, 4, 7, 13, 1, 5, 0, 15, 10, 3, 9, 8, 6], [4, 2, 1, 11, 10, 13, 7, 8, 15, 9, 12, 5, 6, 3, 0, 14], [11, 8, 12, 7, 1, 14, 2, 13, 6, 15, 0, 9, 10, 4, 5, 3], ], [[12, 1, 10, 15, 9, 2, 6, 8, 0, 13, 3, 4, 14, 7, 5, 11], [10, 15, 4, 2, 7, 12, 9, 5, 6, 1, 13, 14, 0, 11, 3, 8], [9, 14, 15, 5, 2, 8, 12, 3, 7, 0, 4, 10, 1, 13, 11, 6], [4, 3, 2, 12, 9, 5, 15, 10, 11, 14, 1, 7, 6, 0, 8, 13], ], [[4, 11, 2, 14, 15, 0, 8, 13, 3, 12, 9, 7, 5, 10, 6, 1], [13, 0, 11, 7, 4, 9, 1, 10, 14, 3, 5, 12, 2, 15, 8, 6], [1, 4, 11, 13, 12, 3, 7, 14, 10, 15, 6, 8, 0, 5, 9, 2], [6, 11, 13, 8, 1, 4, 10, 7, 9, 5, 0, 15, 14, 2, 3, 12], ], [[13, 2, 8, 4, 6, 15, 11, 1, 10, 9, 3, 14, 5, 0, 12, 7], [1, 15, 13, 8, 10, 3, 7, 4, 12, 5, 6, 11, 0, 14, 9, 2], [7, 11, 4, 1, 9, 12, 14, 2, 0, 6, 10, 13, 15, 3, 5, 8], [2, 1, 14, 7, 4, 10, 8, 13, 15, 12, 9, 0, 3, 5, 6, 11], ] ] #Permut made after each SBox substitution for each round P = [16, 7, 20, 21, 29, 12, 28, 17, 1, 15, 23, 26, 5, 18, 31, 10, 2, 8, 24, 14, 32, 27, 3, 9, 19, 13, 30, 6, 22, 11, 4, 25] #Final permut for datas after the 16 rounds PI_1 = [40, 8, 48, 16, 56, 24, 64, 32, 39, 7, 47, 15, 55, 23, 63, 31, 38, 6, 46, 14, 54, 22, 62, 30, 37, 5, 45, 13, 53, 21, 61, 29, 36, 4, 44, 12, 52, 20, 60, 28, 35, 3, 43, 11, 51, 19, 59, 27, 34, 2, 42, 10, 50, 18, 58, 26, 33, 1, 41, 9, 49, 17, 57, 25] #Matrix that determine the shift for each round of keys SHIFT = [1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1] def string_to_bit_array(text):#Convert a string into a list of bits array = list() for char in text: binval = binvalue(char, 8)#Get the char value on one byte array.extend([int(x) for x in list(binval)]) #Add the bits to the final list return array def bit_array_to_string(array): #Recreate the string from the bit array res = ''.join([chr(int(y,2)) for y in [''.join([str(x) for x in bytes]) for bytes in nsplit(array,8)]]) return res def binvalue(val, bitsize): #Return the binary value as a string of the given size binval = bin(val)[2:] if isinstance(val, int) else bin(ord(val))[2:] if len(binval) \u003e bitsize: raise \"binary value larger than the expected size\" while len(binval) \u003c bitsize: binval = \"0\"+binval #Add as many 0 as needed to get the wanted size return binval def nsplit(s, n):#Split a list into sublists of size \"n\" return [s[k:k+n] for k in range(0, len(s), n)] ENCRYPT=1 DECRYPT=0 class des(): def __init__(self): self.password = None self.text = None self.keys = list() def run(self, key, text, action=ENCRYPT, padding=False): if len(key) \u003c 8: raise \"Key Should be 8 bytes long\" elif len(key) \u003e 8: key = key[:8] #If key size is above 8bytes, cut to be 8bytes long self.password = key self.text = text if padding and action==ENCRYPT: self.addPadding() elif len(self.text) % 8 != 0:#If not padding specified data size must be multiple of 8 bytes raise \"Data size should be multiple of 8\" self.generatekeys() #Generate all the keys text_blocks = nsplit(self.text, 8) #Split the text in blocks of 8 bytes so 64 bits result = list() for block in text_blocks:#Loop over all the blocks of data block = string_to_bit_array(block)#Convert the block in bit array block = self.permut(block,PI)#Apply the initial permutation g, d = nsplit(block, 32) #g(LEFT), d(RIGHT) tmp = None for i in range(16): #Do the 16 rounds d_e = self.expand(d, E) #Expand d to match Ki size (48bits) if action == ENCRYPT: tmp = self.xor(self.keys[i], d_e)#If encrypt use Ki else: tmp = self.xor(self.keys[15-i], d_e)#If decrypt start by the last key tmp = self.substitute(tmp) #Method that will apply the SBOXes tmp = self.permut(tmp, P) tmp = self.xor(g, tmp) g = d d = tmp result += self.permut(d+g, PI_1) #Do the last permut and append the result to result final_res = bit_array_to_string(result) if padding and action==DECRYPT: return self.removePadding(final_res) #Remove the padding if decrypt and padding is true else: return final_res #Return the final string of data ciphered/deciphered def substitute(self, d_e):#Substitute bytes using SBOX subblocks = nsplit(d_e, 6)#Split bit array into sublist of 6 bits result = list() for i in range(len(subblocks)): #For all the sublists block = subblocks[i] row = int(str(block[0])+str(block[5]),2)#Get the row with the first and last bit column = int(''.join([str(x) for x in block[1:][:-1]]),2) #Column is the 2,3,4,5th bits val = S_BOX[i][row][column] #Take the value in the SBOX appropriated for the round (i) bin = binvalue(val, 4)#Convert the value to binary result += [int(x) for x in bin]#And append it to the resulting list return result def permut(self, block, table):#Permut the given block using the given table (so generic method) return [block[x-1] for x in table] def expand(self, block, table):#Do the exact same thing than permut but for more clarity has been renamed return [block[x-1] for x in table] def xor(self, t1, t2):#Apply a xor and return the resulting list return [x^y for x,y in zip(t1,t2)] def generatekeys(self):#Algorithm that generates all the keys self.keys = [] key = string_to_bit_array(self.password) key = self.permut(key, CP_1) #Apply the initial permut on the key g, d = nsplit(key, 28) #Split it in to (g-\u003eLEFT),(d-\u003eRIGHT) for i in range(16):#Apply the 16 rounds g, d = self.shift(g, d, SHIFT[i]) #Apply the shift associated with the round (not always 1) tmp = g + d #Merge them self.keys.append(self.permut(tmp, CP_2)) #Apply the permut to get the Ki def shift(self, g, d, n): #Shift a list of the given value return g[n:] + g[:n], d[n:] + d[:n] def addPadding(self):#Add padding to the datas using PKCS5 spec. pad_len = 8 - (len(self.text) % 8) self.text += pad_len * chr(pad_len) def removePadding(self, data):#Remove the padding of the plain text (it assume there is padding) pad_len = ord(data[-1]) return data[:-pad_len] def encrypt(self, key, text, padding=False): return self.run(key, text, ENCRYPT, padding) def decrypt(self, key, text, padding=False): return self.run(key, text, DECRYPT, padding) if __name__ == '__main__': key = \"secret_k\" text= \"Hello wo\" d = des() r = d.encrypt(key,text) r2 = d.decrypt(key,r) print(\"Ciphered: %r\" % r) print(\"Deciphered: \", r2) assert r2 == text print('成功实现DES加密解密') Ciphered: 'ßåýåÚ\\x9f\\\\\\x9d' Deciphered: Hello wo 成功实现DES加密解密 ",
  "wordCount" : "3863",
  "inLanguage": "zh",
  "datePublished": "2018-05-18T00:00:00Z",
  "dateModified": "2018-05-18T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Niuhe"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://blog.niuhemoon.win/posts/tech/python-symmetric-encryption/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Niuhe's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://blog.niuhemoon.win/base/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://blog.niuhemoon.win" accesskey="h" title="Niuhe&#39;s Blog (Alt + H)">
                <img src="https://blog.niuhemoon.win/base/avatar.jpeg" alt="" aria-label="logo"
                    height="35">Niuhe&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://blog.niuhemoon.win/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
            <li>
                <a href="https://blog.niuhemoon.win/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="https://blog.niuhemoon.win/posts" title="📚文章">
                    <span>📚文章</span>
                </a>
            </li>
            <li>
                <a href="https://blog.niuhemoon.win/tags" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="https://blog.niuhemoon.win/archives/" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://blog.niuhemoon.win/about" title="🙋🏻‍♂️关于">
                    <span>🙋🏻‍♂️关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://blog.niuhemoon.win">🏠主页</a>&nbsp;»&nbsp;<a href="https://blog.niuhemoon.win/posts/">📚文章</a>&nbsp;»&nbsp;<a href="https://blog.niuhemoon.win/posts/tech/">👨🏻‍💻 技术</a></div>
    <h1 class="post-title">
      Python对称AES和DES加密算法
    </h1>
    <div class="post-meta"><span title='2018-05-18 00:00:00 +0000 UTC'>2018-05-18</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;3863 字&nbsp;·&nbsp;Niuhe

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">文章目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%af%b9%e7%a7%b0%e7%ae%97%e6%b3%95%e7%bc%96%e5%86%99" aria-label="对称算法编写">对称算法编写</a><ul>
                        
                <li>
                    <a href="#1%e5%ae%9e%e9%aa%8c%e7%9b%ae%e7%9a%84" aria-label="1.实验目的">1.实验目的</a></li>
                <li>
                    <a href="#2%e5%ae%9e%e9%aa%8c%e5%b7%a5%e5%85%b7" aria-label="2.实验工具">2.实验工具</a></li>
                <li>
                    <a href="#3%e5%ae%9e%e9%aa%8c%e7%8e%af%e5%a2%83" aria-label="3.实验环境">3.实验环境</a></li>
                <li>
                    <a href="#4%e5%ae%9e%e9%aa%8c%e6%ad%a5%e9%aa%a4" aria-label="4.实验步骤">4.实验步骤</a><ul>
                        
                <li>
                    <a href="#41-%e5%9b%9e%e9%a1%be%e8%af%be%e7%a8%8b%e6%9f%a5%e9%98%85%e8%b5%84%e6%96%99" aria-label="4.1 回顾课程，查阅资料">4.1 回顾课程，查阅资料</a></li>
                <li>
                    <a href="#42-%e7%86%9f%e6%82%89aes%e7%9a%84%e5%8e%9f%e7%90%86" aria-label="4.2 熟悉AES的原理">4.2 熟悉AES的原理</a></li>
                <li>
                    <a href="#43-%e7%bc%96%e5%86%99aes%e5%8a%a0%e5%af%86%e8%a7%a3%e5%af%86%e7%9a%84%e6%b5%8b%e8%af%95%e7%94%a8%e4%be%8b" aria-label="4.3 编写AES加密解密的测试用例">4.3 编写AES加密解密的测试用例</a></li>
                <li>
                    <a href="#44-%e7%bc%96%e5%86%99des%e7%ae%97%e6%b3%95%e7%9a%84%e6%b5%8b%e8%af%95%e4%bb%a3%e7%a0%81" aria-label="4.4 编写DES算法的测试代码">4.4 编写DES算法的测试代码</a></li>
                <li>
                    <a href="#45-%e7%bc%96%e5%86%99aes%e5%92%8cdes%e5%af%b9%e7%a7%b0%e5%8a%a0%e5%af%86%e7%9a%84python%e5%ae%9e%e7%8e%b0%e5%b9%b6%e8%bf%9b%e8%a1%8c%e6%b5%8b%e8%af%95%e9%aa%8c%e8%af%81" aria-label="4.5 编写AES和DES对称加密的python实现，并进行测试验证">4.5 编写AES和DES对称加密的python实现，并进行测试验证</a></li>
                <li>
                    <a href="#46-%e6%80%bb%e7%bb%93%e5%ae%9e%e9%aa%8c%e7%bc%96%e5%86%99%e5%ae%9e%e9%aa%8c%e6%8a%a5%e5%91%8a" aria-label="4.6 总结实验，编写实验报告">4.6 总结实验，编写实验报告</a></li></ul>
                </li>
                <li>
                    <a href="#5-%e5%ae%9e%e9%aa%8c%e6%80%bb%e7%bb%93" aria-label="5. 实验总结">5. 实验总结</a></li>
                <li>
                    <a href="#6-%e5%ae%9e%e9%aa%8c%e5%ae%8c%e6%95%b4%e4%bb%a3%e7%a0%81" aria-label="6. 实验完整代码">6. 实验完整代码</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>Python3实现AES和DES对称加密算法的</p>
<h2 id="对称算法编写">对称算法编写<a hidden class="anchor" aria-hidden="true" href="#对称算法编写">#</a></h2>
<p>本实验是使用python来实现AES和DES加密和解密过程，并对加密解密过程的正确性进行验证。</p>
<h3 id="1实验目的">1.实验目的<a hidden class="anchor" aria-hidden="true" href="#1实验目的">#</a></h3>
<ol>
<li>掌握分组加密的原理</li>
<li>掌握数据加密标准DES和高级数据加密标准AES的原理及其应用</li>
</ol>
<h3 id="2实验工具">2.实验工具<a hidden class="anchor" aria-hidden="true" href="#2实验工具">#</a></h3>
<ul>
<li>Jupyter Notebook</li>
<li>Python3.5</li>
</ul>
<h3 id="3实验环境">3.实验环境<a hidden class="anchor" aria-hidden="true" href="#3实验环境">#</a></h3>
<ul>
<li>Ubuntu16.04LTS操作系统</li>
<li>Python3标准库</li>
</ul>
<h3 id="4实验步骤">4.实验步骤<a hidden class="anchor" aria-hidden="true" href="#4实验步骤">#</a></h3>
<h4 id="41-回顾课程查阅资料">4.1 回顾课程，查阅资料<a hidden class="anchor" aria-hidden="true" href="#41-回顾课程查阅资料">#</a></h4>
<h4 id="42-熟悉aes的原理">4.2 熟悉AES的原理<a hidden class="anchor" aria-hidden="true" href="#42-熟悉aes的原理">#</a></h4>
<blockquote>
<p>AES(Advanced Encryption Standard)高级加密标准，在密码学中又称Rijndael加密法，是美国联邦政府采用的一种区块加密标准。这个标准用来替代原先的DES，已经被多方分析且广为全世界所使用。</p>
</blockquote>
<blockquote>
<p>AES加密过程是在一个4×4的字节矩阵上运作，这个矩阵又称为“体（state）”，其初值就是一个明文区块（矩阵中一个元素大小就是明文区块中的一个Byte）。（Rijndael加密法因支持更大的区块，其矩阵行数可视情况增加）加密时，各轮AES加密循环（除最后一轮外）均包含4个步骤：</p>
</blockquote>
<ol>
<li>AddRoundKey—矩阵中的每一个字节都与该次回合密钥（round key）做XOR运算；每个子密钥由密钥生成方案产生。</li>
<li>SubBytes—通过一个非线性的替换函数，用查找表的方式把每个字节替换成对应的字节。</li>
<li>ShiftRows—将矩阵中的每个横列进行循环式移位。</li>
<li>MixColumns—为了充分混合矩阵中各个直行的操作。这个步骤使用线性转换来混合每内联的四个字节。最后一个加密循环中省略MixColumns步骤，而以另一个AddRoundKey取代。</li>
</ol>
<h4 id="43-编写aes加密解密的测试用例">4.3 编写AES加密解密的测试用例<a hidden class="anchor" aria-hidden="true" href="#43-编写aes加密解密的测试用例">#</a></h4>
<blockquote>
<p>先使用其他已有工具计算出plaintext对应的</p>
</blockquote>
<blockquote>
<p>测试程序如下：</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> unittest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> AES:
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> __init__(self, master_key):
</span></span><span style="display:flex;"><span>        self.change_key(master_key)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> change_key(self, master_key):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">pass</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> encrypt(self, plaintext):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">pass</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> decrypt(self, ciphertext):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">pass</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> AES_TEST(unittest.TestCase):
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> setUp(self):
</span></span><span style="display:flex;"><span>        master_key = <span style="color:#ff0;font-weight:bold">0x2b7e151628aed2a6abf7158809cf4f3c</span>
</span></span><span style="display:flex;"><span>        self.AES = AES(master_key)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> test_encryption(self):
</span></span><span style="display:flex;"><span>        plaintext = <span style="color:#ff0;font-weight:bold">0x3243f6a8885a308d313198a2e0370734</span>
</span></span><span style="display:flex;"><span>        encrypted = self.AES.encrypt(plaintext)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self.assertEqual(encrypted, <span style="color:#ff0;font-weight:bold">0x3925841d02dc09fbdc118597196a0b32</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> test_decryption(self):
</span></span><span style="display:flex;"><span>        ciphertext = <span style="color:#ff0;font-weight:bold">0x3925841d02dc09fbdc118597196a0b32</span>
</span></span><span style="display:flex;"><span>        decrypted = self.AES.decrypt(ciphertext)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self.assertEqual(decrypted, <span style="color:#ff0;font-weight:bold">0x3243f6a8885a308d313198a2e0370734</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> __name__ == <span style="color:#0ff;font-weight:bold">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    unittest.main()
</span></span></code></pre></div><h4 id="44-编写des算法的测试代码">4.4 编写DES算法的测试代码<a hidden class="anchor" aria-hidden="true" href="#44-编写des算法的测试代码">#</a></h4>
<h4 id="45-编写aes和des对称加密的python实现并进行测试验证">4.5 编写AES和DES对称加密的python实现，并进行测试验证<a hidden class="anchor" aria-hidden="true" href="#45-编写aes和des对称加密的python实现并进行测试验证">#</a></h4>
<blockquote>
<p>代码和测试结果在报告最后</p>
</blockquote>
<h4 id="46-总结实验编写实验报告">4.6 总结实验，编写实验报告<a hidden class="anchor" aria-hidden="true" href="#46-总结实验编写实验报告">#</a></h4>
<h3 id="5-实验总结">5. 实验总结<a hidden class="anchor" aria-hidden="true" href="#5-实验总结">#</a></h3>
<ul>
<li>需要善于借鉴前人经验，搜集资料</li>
<li>实验只支持ascii码，对其他字符编码没有解决</li>
<li>利用优秀的工具，如Jupyter可以提高学习效率</li>
</ul>
<h3 id="6-实验完整代码">6. 实验完整代码<a hidden class="anchor" aria-hidden="true" href="#6-实验完整代码">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#007f7f">#!/usr/bin/env python</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#-*- coding:utf-8 -*-</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">ASE的python实现：
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">支持128位秘钥
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">支持秘钥和原文均为数字的AES加密解密
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Sbox = (
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x63</span>, <span style="color:#ff0;font-weight:bold">0x7C</span>, <span style="color:#ff0;font-weight:bold">0x77</span>, <span style="color:#ff0;font-weight:bold">0x7B</span>, <span style="color:#ff0;font-weight:bold">0xF2</span>, <span style="color:#ff0;font-weight:bold">0x6B</span>, <span style="color:#ff0;font-weight:bold">0x6F</span>, <span style="color:#ff0;font-weight:bold">0xC5</span>, <span style="color:#ff0;font-weight:bold">0x30</span>, <span style="color:#ff0;font-weight:bold">0x01</span>, <span style="color:#ff0;font-weight:bold">0x67</span>, <span style="color:#ff0;font-weight:bold">0x2B</span>, <span style="color:#ff0;font-weight:bold">0xFE</span>, <span style="color:#ff0;font-weight:bold">0xD7</span>, <span style="color:#ff0;font-weight:bold">0xAB</span>, <span style="color:#ff0;font-weight:bold">0x76</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0xCA</span>, <span style="color:#ff0;font-weight:bold">0x82</span>, <span style="color:#ff0;font-weight:bold">0xC9</span>, <span style="color:#ff0;font-weight:bold">0x7D</span>, <span style="color:#ff0;font-weight:bold">0xFA</span>, <span style="color:#ff0;font-weight:bold">0x59</span>, <span style="color:#ff0;font-weight:bold">0x47</span>, <span style="color:#ff0;font-weight:bold">0xF0</span>, <span style="color:#ff0;font-weight:bold">0xAD</span>, <span style="color:#ff0;font-weight:bold">0xD4</span>, <span style="color:#ff0;font-weight:bold">0xA2</span>, <span style="color:#ff0;font-weight:bold">0xAF</span>, <span style="color:#ff0;font-weight:bold">0x9C</span>, <span style="color:#ff0;font-weight:bold">0xA4</span>, <span style="color:#ff0;font-weight:bold">0x72</span>, <span style="color:#ff0;font-weight:bold">0xC0</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0xB7</span>, <span style="color:#ff0;font-weight:bold">0xFD</span>, <span style="color:#ff0;font-weight:bold">0x93</span>, <span style="color:#ff0;font-weight:bold">0x26</span>, <span style="color:#ff0;font-weight:bold">0x36</span>, <span style="color:#ff0;font-weight:bold">0x3F</span>, <span style="color:#ff0;font-weight:bold">0xF7</span>, <span style="color:#ff0;font-weight:bold">0xCC</span>, <span style="color:#ff0;font-weight:bold">0x34</span>, <span style="color:#ff0;font-weight:bold">0xA5</span>, <span style="color:#ff0;font-weight:bold">0xE5</span>, <span style="color:#ff0;font-weight:bold">0xF1</span>, <span style="color:#ff0;font-weight:bold">0x71</span>, <span style="color:#ff0;font-weight:bold">0xD8</span>, <span style="color:#ff0;font-weight:bold">0x31</span>, <span style="color:#ff0;font-weight:bold">0x15</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x04</span>, <span style="color:#ff0;font-weight:bold">0xC7</span>, <span style="color:#ff0;font-weight:bold">0x23</span>, <span style="color:#ff0;font-weight:bold">0xC3</span>, <span style="color:#ff0;font-weight:bold">0x18</span>, <span style="color:#ff0;font-weight:bold">0x96</span>, <span style="color:#ff0;font-weight:bold">0x05</span>, <span style="color:#ff0;font-weight:bold">0x9A</span>, <span style="color:#ff0;font-weight:bold">0x07</span>, <span style="color:#ff0;font-weight:bold">0x12</span>, <span style="color:#ff0;font-weight:bold">0x80</span>, <span style="color:#ff0;font-weight:bold">0xE2</span>, <span style="color:#ff0;font-weight:bold">0xEB</span>, <span style="color:#ff0;font-weight:bold">0x27</span>, <span style="color:#ff0;font-weight:bold">0xB2</span>, <span style="color:#ff0;font-weight:bold">0x75</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x09</span>, <span style="color:#ff0;font-weight:bold">0x83</span>, <span style="color:#ff0;font-weight:bold">0x2C</span>, <span style="color:#ff0;font-weight:bold">0x1A</span>, <span style="color:#ff0;font-weight:bold">0x1B</span>, <span style="color:#ff0;font-weight:bold">0x6E</span>, <span style="color:#ff0;font-weight:bold">0x5A</span>, <span style="color:#ff0;font-weight:bold">0xA0</span>, <span style="color:#ff0;font-weight:bold">0x52</span>, <span style="color:#ff0;font-weight:bold">0x3B</span>, <span style="color:#ff0;font-weight:bold">0xD6</span>, <span style="color:#ff0;font-weight:bold">0xB3</span>, <span style="color:#ff0;font-weight:bold">0x29</span>, <span style="color:#ff0;font-weight:bold">0xE3</span>, <span style="color:#ff0;font-weight:bold">0x2F</span>, <span style="color:#ff0;font-weight:bold">0x84</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x53</span>, <span style="color:#ff0;font-weight:bold">0xD1</span>, <span style="color:#ff0;font-weight:bold">0x00</span>, <span style="color:#ff0;font-weight:bold">0xED</span>, <span style="color:#ff0;font-weight:bold">0x20</span>, <span style="color:#ff0;font-weight:bold">0xFC</span>, <span style="color:#ff0;font-weight:bold">0xB1</span>, <span style="color:#ff0;font-weight:bold">0x5B</span>, <span style="color:#ff0;font-weight:bold">0x6A</span>, <span style="color:#ff0;font-weight:bold">0xCB</span>, <span style="color:#ff0;font-weight:bold">0xBE</span>, <span style="color:#ff0;font-weight:bold">0x39</span>, <span style="color:#ff0;font-weight:bold">0x4A</span>, <span style="color:#ff0;font-weight:bold">0x4C</span>, <span style="color:#ff0;font-weight:bold">0x58</span>, <span style="color:#ff0;font-weight:bold">0xCF</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0xD0</span>, <span style="color:#ff0;font-weight:bold">0xEF</span>, <span style="color:#ff0;font-weight:bold">0xAA</span>, <span style="color:#ff0;font-weight:bold">0xFB</span>, <span style="color:#ff0;font-weight:bold">0x43</span>, <span style="color:#ff0;font-weight:bold">0x4D</span>, <span style="color:#ff0;font-weight:bold">0x33</span>, <span style="color:#ff0;font-weight:bold">0x85</span>, <span style="color:#ff0;font-weight:bold">0x45</span>, <span style="color:#ff0;font-weight:bold">0xF9</span>, <span style="color:#ff0;font-weight:bold">0x02</span>, <span style="color:#ff0;font-weight:bold">0x7F</span>, <span style="color:#ff0;font-weight:bold">0x50</span>, <span style="color:#ff0;font-weight:bold">0x3C</span>, <span style="color:#ff0;font-weight:bold">0x9F</span>, <span style="color:#ff0;font-weight:bold">0xA8</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x51</span>, <span style="color:#ff0;font-weight:bold">0xA3</span>, <span style="color:#ff0;font-weight:bold">0x40</span>, <span style="color:#ff0;font-weight:bold">0x8F</span>, <span style="color:#ff0;font-weight:bold">0x92</span>, <span style="color:#ff0;font-weight:bold">0x9D</span>, <span style="color:#ff0;font-weight:bold">0x38</span>, <span style="color:#ff0;font-weight:bold">0xF5</span>, <span style="color:#ff0;font-weight:bold">0xBC</span>, <span style="color:#ff0;font-weight:bold">0xB6</span>, <span style="color:#ff0;font-weight:bold">0xDA</span>, <span style="color:#ff0;font-weight:bold">0x21</span>, <span style="color:#ff0;font-weight:bold">0x10</span>, <span style="color:#ff0;font-weight:bold">0xFF</span>, <span style="color:#ff0;font-weight:bold">0xF3</span>, <span style="color:#ff0;font-weight:bold">0xD2</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0xCD</span>, <span style="color:#ff0;font-weight:bold">0x0C</span>, <span style="color:#ff0;font-weight:bold">0x13</span>, <span style="color:#ff0;font-weight:bold">0xEC</span>, <span style="color:#ff0;font-weight:bold">0x5F</span>, <span style="color:#ff0;font-weight:bold">0x97</span>, <span style="color:#ff0;font-weight:bold">0x44</span>, <span style="color:#ff0;font-weight:bold">0x17</span>, <span style="color:#ff0;font-weight:bold">0xC4</span>, <span style="color:#ff0;font-weight:bold">0xA7</span>, <span style="color:#ff0;font-weight:bold">0x7E</span>, <span style="color:#ff0;font-weight:bold">0x3D</span>, <span style="color:#ff0;font-weight:bold">0x64</span>, <span style="color:#ff0;font-weight:bold">0x5D</span>, <span style="color:#ff0;font-weight:bold">0x19</span>, <span style="color:#ff0;font-weight:bold">0x73</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x60</span>, <span style="color:#ff0;font-weight:bold">0x81</span>, <span style="color:#ff0;font-weight:bold">0x4F</span>, <span style="color:#ff0;font-weight:bold">0xDC</span>, <span style="color:#ff0;font-weight:bold">0x22</span>, <span style="color:#ff0;font-weight:bold">0x2A</span>, <span style="color:#ff0;font-weight:bold">0x90</span>, <span style="color:#ff0;font-weight:bold">0x88</span>, <span style="color:#ff0;font-weight:bold">0x46</span>, <span style="color:#ff0;font-weight:bold">0xEE</span>, <span style="color:#ff0;font-weight:bold">0xB8</span>, <span style="color:#ff0;font-weight:bold">0x14</span>, <span style="color:#ff0;font-weight:bold">0xDE</span>, <span style="color:#ff0;font-weight:bold">0x5E</span>, <span style="color:#ff0;font-weight:bold">0x0B</span>, <span style="color:#ff0;font-weight:bold">0xDB</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0xE0</span>, <span style="color:#ff0;font-weight:bold">0x32</span>, <span style="color:#ff0;font-weight:bold">0x3A</span>, <span style="color:#ff0;font-weight:bold">0x0A</span>, <span style="color:#ff0;font-weight:bold">0x49</span>, <span style="color:#ff0;font-weight:bold">0x06</span>, <span style="color:#ff0;font-weight:bold">0x24</span>, <span style="color:#ff0;font-weight:bold">0x5C</span>, <span style="color:#ff0;font-weight:bold">0xC2</span>, <span style="color:#ff0;font-weight:bold">0xD3</span>, <span style="color:#ff0;font-weight:bold">0xAC</span>, <span style="color:#ff0;font-weight:bold">0x62</span>, <span style="color:#ff0;font-weight:bold">0x91</span>, <span style="color:#ff0;font-weight:bold">0x95</span>, <span style="color:#ff0;font-weight:bold">0xE4</span>, <span style="color:#ff0;font-weight:bold">0x79</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0xE7</span>, <span style="color:#ff0;font-weight:bold">0xC8</span>, <span style="color:#ff0;font-weight:bold">0x37</span>, <span style="color:#ff0;font-weight:bold">0x6D</span>, <span style="color:#ff0;font-weight:bold">0x8D</span>, <span style="color:#ff0;font-weight:bold">0xD5</span>, <span style="color:#ff0;font-weight:bold">0x4E</span>, <span style="color:#ff0;font-weight:bold">0xA9</span>, <span style="color:#ff0;font-weight:bold">0x6C</span>, <span style="color:#ff0;font-weight:bold">0x56</span>, <span style="color:#ff0;font-weight:bold">0xF4</span>, <span style="color:#ff0;font-weight:bold">0xEA</span>, <span style="color:#ff0;font-weight:bold">0x65</span>, <span style="color:#ff0;font-weight:bold">0x7A</span>, <span style="color:#ff0;font-weight:bold">0xAE</span>, <span style="color:#ff0;font-weight:bold">0x08</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0xBA</span>, <span style="color:#ff0;font-weight:bold">0x78</span>, <span style="color:#ff0;font-weight:bold">0x25</span>, <span style="color:#ff0;font-weight:bold">0x2E</span>, <span style="color:#ff0;font-weight:bold">0x1C</span>, <span style="color:#ff0;font-weight:bold">0xA6</span>, <span style="color:#ff0;font-weight:bold">0xB4</span>, <span style="color:#ff0;font-weight:bold">0xC6</span>, <span style="color:#ff0;font-weight:bold">0xE8</span>, <span style="color:#ff0;font-weight:bold">0xDD</span>, <span style="color:#ff0;font-weight:bold">0x74</span>, <span style="color:#ff0;font-weight:bold">0x1F</span>, <span style="color:#ff0;font-weight:bold">0x4B</span>, <span style="color:#ff0;font-weight:bold">0xBD</span>, <span style="color:#ff0;font-weight:bold">0x8B</span>, <span style="color:#ff0;font-weight:bold">0x8A</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x70</span>, <span style="color:#ff0;font-weight:bold">0x3E</span>, <span style="color:#ff0;font-weight:bold">0xB5</span>, <span style="color:#ff0;font-weight:bold">0x66</span>, <span style="color:#ff0;font-weight:bold">0x48</span>, <span style="color:#ff0;font-weight:bold">0x03</span>, <span style="color:#ff0;font-weight:bold">0xF6</span>, <span style="color:#ff0;font-weight:bold">0x0E</span>, <span style="color:#ff0;font-weight:bold">0x61</span>, <span style="color:#ff0;font-weight:bold">0x35</span>, <span style="color:#ff0;font-weight:bold">0x57</span>, <span style="color:#ff0;font-weight:bold">0xB9</span>, <span style="color:#ff0;font-weight:bold">0x86</span>, <span style="color:#ff0;font-weight:bold">0xC1</span>, <span style="color:#ff0;font-weight:bold">0x1D</span>, <span style="color:#ff0;font-weight:bold">0x9E</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0xE1</span>, <span style="color:#ff0;font-weight:bold">0xF8</span>, <span style="color:#ff0;font-weight:bold">0x98</span>, <span style="color:#ff0;font-weight:bold">0x11</span>, <span style="color:#ff0;font-weight:bold">0x69</span>, <span style="color:#ff0;font-weight:bold">0xD9</span>, <span style="color:#ff0;font-weight:bold">0x8E</span>, <span style="color:#ff0;font-weight:bold">0x94</span>, <span style="color:#ff0;font-weight:bold">0x9B</span>, <span style="color:#ff0;font-weight:bold">0x1E</span>, <span style="color:#ff0;font-weight:bold">0x87</span>, <span style="color:#ff0;font-weight:bold">0xE9</span>, <span style="color:#ff0;font-weight:bold">0xCE</span>, <span style="color:#ff0;font-weight:bold">0x55</span>, <span style="color:#ff0;font-weight:bold">0x28</span>, <span style="color:#ff0;font-weight:bold">0xDF</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x8C</span>, <span style="color:#ff0;font-weight:bold">0xA1</span>, <span style="color:#ff0;font-weight:bold">0x89</span>, <span style="color:#ff0;font-weight:bold">0x0D</span>, <span style="color:#ff0;font-weight:bold">0xBF</span>, <span style="color:#ff0;font-weight:bold">0xE6</span>, <span style="color:#ff0;font-weight:bold">0x42</span>, <span style="color:#ff0;font-weight:bold">0x68</span>, <span style="color:#ff0;font-weight:bold">0x41</span>, <span style="color:#ff0;font-weight:bold">0x99</span>, <span style="color:#ff0;font-weight:bold">0x2D</span>, <span style="color:#ff0;font-weight:bold">0x0F</span>, <span style="color:#ff0;font-weight:bold">0xB0</span>, <span style="color:#ff0;font-weight:bold">0x54</span>, <span style="color:#ff0;font-weight:bold">0xBB</span>, <span style="color:#ff0;font-weight:bold">0x16</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>InvSbox = (
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x52</span>, <span style="color:#ff0;font-weight:bold">0x09</span>, <span style="color:#ff0;font-weight:bold">0x6A</span>, <span style="color:#ff0;font-weight:bold">0xD5</span>, <span style="color:#ff0;font-weight:bold">0x30</span>, <span style="color:#ff0;font-weight:bold">0x36</span>, <span style="color:#ff0;font-weight:bold">0xA5</span>, <span style="color:#ff0;font-weight:bold">0x38</span>, <span style="color:#ff0;font-weight:bold">0xBF</span>, <span style="color:#ff0;font-weight:bold">0x40</span>, <span style="color:#ff0;font-weight:bold">0xA3</span>, <span style="color:#ff0;font-weight:bold">0x9E</span>, <span style="color:#ff0;font-weight:bold">0x81</span>, <span style="color:#ff0;font-weight:bold">0xF3</span>, <span style="color:#ff0;font-weight:bold">0xD7</span>, <span style="color:#ff0;font-weight:bold">0xFB</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x7C</span>, <span style="color:#ff0;font-weight:bold">0xE3</span>, <span style="color:#ff0;font-weight:bold">0x39</span>, <span style="color:#ff0;font-weight:bold">0x82</span>, <span style="color:#ff0;font-weight:bold">0x9B</span>, <span style="color:#ff0;font-weight:bold">0x2F</span>, <span style="color:#ff0;font-weight:bold">0xFF</span>, <span style="color:#ff0;font-weight:bold">0x87</span>, <span style="color:#ff0;font-weight:bold">0x34</span>, <span style="color:#ff0;font-weight:bold">0x8E</span>, <span style="color:#ff0;font-weight:bold">0x43</span>, <span style="color:#ff0;font-weight:bold">0x44</span>, <span style="color:#ff0;font-weight:bold">0xC4</span>, <span style="color:#ff0;font-weight:bold">0xDE</span>, <span style="color:#ff0;font-weight:bold">0xE9</span>, <span style="color:#ff0;font-weight:bold">0xCB</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x54</span>, <span style="color:#ff0;font-weight:bold">0x7B</span>, <span style="color:#ff0;font-weight:bold">0x94</span>, <span style="color:#ff0;font-weight:bold">0x32</span>, <span style="color:#ff0;font-weight:bold">0xA6</span>, <span style="color:#ff0;font-weight:bold">0xC2</span>, <span style="color:#ff0;font-weight:bold">0x23</span>, <span style="color:#ff0;font-weight:bold">0x3D</span>, <span style="color:#ff0;font-weight:bold">0xEE</span>, <span style="color:#ff0;font-weight:bold">0x4C</span>, <span style="color:#ff0;font-weight:bold">0x95</span>, <span style="color:#ff0;font-weight:bold">0x0B</span>, <span style="color:#ff0;font-weight:bold">0x42</span>, <span style="color:#ff0;font-weight:bold">0xFA</span>, <span style="color:#ff0;font-weight:bold">0xC3</span>, <span style="color:#ff0;font-weight:bold">0x4E</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x08</span>, <span style="color:#ff0;font-weight:bold">0x2E</span>, <span style="color:#ff0;font-weight:bold">0xA1</span>, <span style="color:#ff0;font-weight:bold">0x66</span>, <span style="color:#ff0;font-weight:bold">0x28</span>, <span style="color:#ff0;font-weight:bold">0xD9</span>, <span style="color:#ff0;font-weight:bold">0x24</span>, <span style="color:#ff0;font-weight:bold">0xB2</span>, <span style="color:#ff0;font-weight:bold">0x76</span>, <span style="color:#ff0;font-weight:bold">0x5B</span>, <span style="color:#ff0;font-weight:bold">0xA2</span>, <span style="color:#ff0;font-weight:bold">0x49</span>, <span style="color:#ff0;font-weight:bold">0x6D</span>, <span style="color:#ff0;font-weight:bold">0x8B</span>, <span style="color:#ff0;font-weight:bold">0xD1</span>, <span style="color:#ff0;font-weight:bold">0x25</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x72</span>, <span style="color:#ff0;font-weight:bold">0xF8</span>, <span style="color:#ff0;font-weight:bold">0xF6</span>, <span style="color:#ff0;font-weight:bold">0x64</span>, <span style="color:#ff0;font-weight:bold">0x86</span>, <span style="color:#ff0;font-weight:bold">0x68</span>, <span style="color:#ff0;font-weight:bold">0x98</span>, <span style="color:#ff0;font-weight:bold">0x16</span>, <span style="color:#ff0;font-weight:bold">0xD4</span>, <span style="color:#ff0;font-weight:bold">0xA4</span>, <span style="color:#ff0;font-weight:bold">0x5C</span>, <span style="color:#ff0;font-weight:bold">0xCC</span>, <span style="color:#ff0;font-weight:bold">0x5D</span>, <span style="color:#ff0;font-weight:bold">0x65</span>, <span style="color:#ff0;font-weight:bold">0xB6</span>, <span style="color:#ff0;font-weight:bold">0x92</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x6C</span>, <span style="color:#ff0;font-weight:bold">0x70</span>, <span style="color:#ff0;font-weight:bold">0x48</span>, <span style="color:#ff0;font-weight:bold">0x50</span>, <span style="color:#ff0;font-weight:bold">0xFD</span>, <span style="color:#ff0;font-weight:bold">0xED</span>, <span style="color:#ff0;font-weight:bold">0xB9</span>, <span style="color:#ff0;font-weight:bold">0xDA</span>, <span style="color:#ff0;font-weight:bold">0x5E</span>, <span style="color:#ff0;font-weight:bold">0x15</span>, <span style="color:#ff0;font-weight:bold">0x46</span>, <span style="color:#ff0;font-weight:bold">0x57</span>, <span style="color:#ff0;font-weight:bold">0xA7</span>, <span style="color:#ff0;font-weight:bold">0x8D</span>, <span style="color:#ff0;font-weight:bold">0x9D</span>, <span style="color:#ff0;font-weight:bold">0x84</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x90</span>, <span style="color:#ff0;font-weight:bold">0xD8</span>, <span style="color:#ff0;font-weight:bold">0xAB</span>, <span style="color:#ff0;font-weight:bold">0x00</span>, <span style="color:#ff0;font-weight:bold">0x8C</span>, <span style="color:#ff0;font-weight:bold">0xBC</span>, <span style="color:#ff0;font-weight:bold">0xD3</span>, <span style="color:#ff0;font-weight:bold">0x0A</span>, <span style="color:#ff0;font-weight:bold">0xF7</span>, <span style="color:#ff0;font-weight:bold">0xE4</span>, <span style="color:#ff0;font-weight:bold">0x58</span>, <span style="color:#ff0;font-weight:bold">0x05</span>, <span style="color:#ff0;font-weight:bold">0xB8</span>, <span style="color:#ff0;font-weight:bold">0xB3</span>, <span style="color:#ff0;font-weight:bold">0x45</span>, <span style="color:#ff0;font-weight:bold">0x06</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0xD0</span>, <span style="color:#ff0;font-weight:bold">0x2C</span>, <span style="color:#ff0;font-weight:bold">0x1E</span>, <span style="color:#ff0;font-weight:bold">0x8F</span>, <span style="color:#ff0;font-weight:bold">0xCA</span>, <span style="color:#ff0;font-weight:bold">0x3F</span>, <span style="color:#ff0;font-weight:bold">0x0F</span>, <span style="color:#ff0;font-weight:bold">0x02</span>, <span style="color:#ff0;font-weight:bold">0xC1</span>, <span style="color:#ff0;font-weight:bold">0xAF</span>, <span style="color:#ff0;font-weight:bold">0xBD</span>, <span style="color:#ff0;font-weight:bold">0x03</span>, <span style="color:#ff0;font-weight:bold">0x01</span>, <span style="color:#ff0;font-weight:bold">0x13</span>, <span style="color:#ff0;font-weight:bold">0x8A</span>, <span style="color:#ff0;font-weight:bold">0x6B</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x3A</span>, <span style="color:#ff0;font-weight:bold">0x91</span>, <span style="color:#ff0;font-weight:bold">0x11</span>, <span style="color:#ff0;font-weight:bold">0x41</span>, <span style="color:#ff0;font-weight:bold">0x4F</span>, <span style="color:#ff0;font-weight:bold">0x67</span>, <span style="color:#ff0;font-weight:bold">0xDC</span>, <span style="color:#ff0;font-weight:bold">0xEA</span>, <span style="color:#ff0;font-weight:bold">0x97</span>, <span style="color:#ff0;font-weight:bold">0xF2</span>, <span style="color:#ff0;font-weight:bold">0xCF</span>, <span style="color:#ff0;font-weight:bold">0xCE</span>, <span style="color:#ff0;font-weight:bold">0xF0</span>, <span style="color:#ff0;font-weight:bold">0xB4</span>, <span style="color:#ff0;font-weight:bold">0xE6</span>, <span style="color:#ff0;font-weight:bold">0x73</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x96</span>, <span style="color:#ff0;font-weight:bold">0xAC</span>, <span style="color:#ff0;font-weight:bold">0x74</span>, <span style="color:#ff0;font-weight:bold">0x22</span>, <span style="color:#ff0;font-weight:bold">0xE7</span>, <span style="color:#ff0;font-weight:bold">0xAD</span>, <span style="color:#ff0;font-weight:bold">0x35</span>, <span style="color:#ff0;font-weight:bold">0x85</span>, <span style="color:#ff0;font-weight:bold">0xE2</span>, <span style="color:#ff0;font-weight:bold">0xF9</span>, <span style="color:#ff0;font-weight:bold">0x37</span>, <span style="color:#ff0;font-weight:bold">0xE8</span>, <span style="color:#ff0;font-weight:bold">0x1C</span>, <span style="color:#ff0;font-weight:bold">0x75</span>, <span style="color:#ff0;font-weight:bold">0xDF</span>, <span style="color:#ff0;font-weight:bold">0x6E</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x47</span>, <span style="color:#ff0;font-weight:bold">0xF1</span>, <span style="color:#ff0;font-weight:bold">0x1A</span>, <span style="color:#ff0;font-weight:bold">0x71</span>, <span style="color:#ff0;font-weight:bold">0x1D</span>, <span style="color:#ff0;font-weight:bold">0x29</span>, <span style="color:#ff0;font-weight:bold">0xC5</span>, <span style="color:#ff0;font-weight:bold">0x89</span>, <span style="color:#ff0;font-weight:bold">0x6F</span>, <span style="color:#ff0;font-weight:bold">0xB7</span>, <span style="color:#ff0;font-weight:bold">0x62</span>, <span style="color:#ff0;font-weight:bold">0x0E</span>, <span style="color:#ff0;font-weight:bold">0xAA</span>, <span style="color:#ff0;font-weight:bold">0x18</span>, <span style="color:#ff0;font-weight:bold">0xBE</span>, <span style="color:#ff0;font-weight:bold">0x1B</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0xFC</span>, <span style="color:#ff0;font-weight:bold">0x56</span>, <span style="color:#ff0;font-weight:bold">0x3E</span>, <span style="color:#ff0;font-weight:bold">0x4B</span>, <span style="color:#ff0;font-weight:bold">0xC6</span>, <span style="color:#ff0;font-weight:bold">0xD2</span>, <span style="color:#ff0;font-weight:bold">0x79</span>, <span style="color:#ff0;font-weight:bold">0x20</span>, <span style="color:#ff0;font-weight:bold">0x9A</span>, <span style="color:#ff0;font-weight:bold">0xDB</span>, <span style="color:#ff0;font-weight:bold">0xC0</span>, <span style="color:#ff0;font-weight:bold">0xFE</span>, <span style="color:#ff0;font-weight:bold">0x78</span>, <span style="color:#ff0;font-weight:bold">0xCD</span>, <span style="color:#ff0;font-weight:bold">0x5A</span>, <span style="color:#ff0;font-weight:bold">0xF4</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x1F</span>, <span style="color:#ff0;font-weight:bold">0xDD</span>, <span style="color:#ff0;font-weight:bold">0xA8</span>, <span style="color:#ff0;font-weight:bold">0x33</span>, <span style="color:#ff0;font-weight:bold">0x88</span>, <span style="color:#ff0;font-weight:bold">0x07</span>, <span style="color:#ff0;font-weight:bold">0xC7</span>, <span style="color:#ff0;font-weight:bold">0x31</span>, <span style="color:#ff0;font-weight:bold">0xB1</span>, <span style="color:#ff0;font-weight:bold">0x12</span>, <span style="color:#ff0;font-weight:bold">0x10</span>, <span style="color:#ff0;font-weight:bold">0x59</span>, <span style="color:#ff0;font-weight:bold">0x27</span>, <span style="color:#ff0;font-weight:bold">0x80</span>, <span style="color:#ff0;font-weight:bold">0xEC</span>, <span style="color:#ff0;font-weight:bold">0x5F</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x60</span>, <span style="color:#ff0;font-weight:bold">0x51</span>, <span style="color:#ff0;font-weight:bold">0x7F</span>, <span style="color:#ff0;font-weight:bold">0xA9</span>, <span style="color:#ff0;font-weight:bold">0x19</span>, <span style="color:#ff0;font-weight:bold">0xB5</span>, <span style="color:#ff0;font-weight:bold">0x4A</span>, <span style="color:#ff0;font-weight:bold">0x0D</span>, <span style="color:#ff0;font-weight:bold">0x2D</span>, <span style="color:#ff0;font-weight:bold">0xE5</span>, <span style="color:#ff0;font-weight:bold">0x7A</span>, <span style="color:#ff0;font-weight:bold">0x9F</span>, <span style="color:#ff0;font-weight:bold">0x93</span>, <span style="color:#ff0;font-weight:bold">0xC9</span>, <span style="color:#ff0;font-weight:bold">0x9C</span>, <span style="color:#ff0;font-weight:bold">0xEF</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0xA0</span>, <span style="color:#ff0;font-weight:bold">0xE0</span>, <span style="color:#ff0;font-weight:bold">0x3B</span>, <span style="color:#ff0;font-weight:bold">0x4D</span>, <span style="color:#ff0;font-weight:bold">0xAE</span>, <span style="color:#ff0;font-weight:bold">0x2A</span>, <span style="color:#ff0;font-weight:bold">0xF5</span>, <span style="color:#ff0;font-weight:bold">0xB0</span>, <span style="color:#ff0;font-weight:bold">0xC8</span>, <span style="color:#ff0;font-weight:bold">0xEB</span>, <span style="color:#ff0;font-weight:bold">0xBB</span>, <span style="color:#ff0;font-weight:bold">0x3C</span>, <span style="color:#ff0;font-weight:bold">0x83</span>, <span style="color:#ff0;font-weight:bold">0x53</span>, <span style="color:#ff0;font-weight:bold">0x99</span>, <span style="color:#ff0;font-weight:bold">0x61</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x17</span>, <span style="color:#ff0;font-weight:bold">0x2B</span>, <span style="color:#ff0;font-weight:bold">0x04</span>, <span style="color:#ff0;font-weight:bold">0x7E</span>, <span style="color:#ff0;font-weight:bold">0xBA</span>, <span style="color:#ff0;font-weight:bold">0x77</span>, <span style="color:#ff0;font-weight:bold">0xD6</span>, <span style="color:#ff0;font-weight:bold">0x26</span>, <span style="color:#ff0;font-weight:bold">0xE1</span>, <span style="color:#ff0;font-weight:bold">0x69</span>, <span style="color:#ff0;font-weight:bold">0x14</span>, <span style="color:#ff0;font-weight:bold">0x63</span>, <span style="color:#ff0;font-weight:bold">0x55</span>, <span style="color:#ff0;font-weight:bold">0x21</span>, <span style="color:#ff0;font-weight:bold">0x0C</span>, <span style="color:#ff0;font-weight:bold">0x7D</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># 参考了C语言实现 http://cs.ucsb.edu/~koc/cs178/projects/JT/aes.c</span>
</span></span><span style="display:flex;"><span>xtime = <span style="color:#fff;font-weight:bold">lambda</span> a: (((a &lt;&lt; <span style="color:#ff0;font-weight:bold">1</span>) ^ <span style="color:#ff0;font-weight:bold">0x1B</span>) &amp; <span style="color:#ff0;font-weight:bold">0xFF</span>) <span style="color:#fff;font-weight:bold">if</span> (a &amp; <span style="color:#ff0;font-weight:bold">0x80</span>) <span style="color:#fff;font-weight:bold">else</span> (a &lt;&lt; <span style="color:#ff0;font-weight:bold">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Rcon = (
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x00</span>, <span style="color:#ff0;font-weight:bold">0x01</span>, <span style="color:#ff0;font-weight:bold">0x02</span>, <span style="color:#ff0;font-weight:bold">0x04</span>, <span style="color:#ff0;font-weight:bold">0x08</span>, <span style="color:#ff0;font-weight:bold">0x10</span>, <span style="color:#ff0;font-weight:bold">0x20</span>, <span style="color:#ff0;font-weight:bold">0x40</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x80</span>, <span style="color:#ff0;font-weight:bold">0x1B</span>, <span style="color:#ff0;font-weight:bold">0x36</span>, <span style="color:#ff0;font-weight:bold">0x6C</span>, <span style="color:#ff0;font-weight:bold">0xD8</span>, <span style="color:#ff0;font-weight:bold">0xAB</span>, <span style="color:#ff0;font-weight:bold">0x4D</span>, <span style="color:#ff0;font-weight:bold">0x9A</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0x2F</span>, <span style="color:#ff0;font-weight:bold">0x5E</span>, <span style="color:#ff0;font-weight:bold">0xBC</span>, <span style="color:#ff0;font-weight:bold">0x63</span>, <span style="color:#ff0;font-weight:bold">0xC6</span>, <span style="color:#ff0;font-weight:bold">0x97</span>, <span style="color:#ff0;font-weight:bold">0x35</span>, <span style="color:#ff0;font-weight:bold">0x6A</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff0;font-weight:bold">0xD4</span>, <span style="color:#ff0;font-weight:bold">0xB3</span>, <span style="color:#ff0;font-weight:bold">0x7D</span>, <span style="color:#ff0;font-weight:bold">0xFA</span>, <span style="color:#ff0;font-weight:bold">0xEF</span>, <span style="color:#ff0;font-weight:bold">0xC5</span>, <span style="color:#ff0;font-weight:bold">0x91</span>, <span style="color:#ff0;font-weight:bold">0x39</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> text2matrix(text):
</span></span><span style="display:flex;"><span>    matrix = []
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">for</span> i in <span style="color:#fff;font-weight:bold">range</span>(<span style="color:#ff0;font-weight:bold">16</span>):
</span></span><span style="display:flex;"><span>        byte = (text &gt;&gt; (<span style="color:#ff0;font-weight:bold">8</span> * (<span style="color:#ff0;font-weight:bold">15</span> - i))) &amp; <span style="color:#ff0;font-weight:bold">0xFF</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> i % <span style="color:#ff0;font-weight:bold">4</span> == <span style="color:#ff0;font-weight:bold">0</span>:
</span></span><span style="display:flex;"><span>            matrix.append([byte])
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>            matrix[<span style="color:#fff;font-weight:bold">int</span>(i / <span style="color:#ff0;font-weight:bold">4</span>)].append(byte)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> matrix
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> matrix2text(matrix):
</span></span><span style="display:flex;"><span>    text = <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">for</span> i in <span style="color:#fff;font-weight:bold">range</span>(<span style="color:#ff0;font-weight:bold">4</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> j in <span style="color:#fff;font-weight:bold">range</span>(<span style="color:#ff0;font-weight:bold">4</span>):
</span></span><span style="display:flex;"><span>            text |= (matrix[i][j] &lt;&lt; (<span style="color:#ff0;font-weight:bold">120</span> - <span style="color:#ff0;font-weight:bold">8</span> * (<span style="color:#ff0;font-weight:bold">4</span> * i + j)))
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> text
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> AES:
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> __init__(self, master_key):
</span></span><span style="display:flex;"><span>        self.change_key(master_key)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> change_key(self, master_key):
</span></span><span style="display:flex;"><span>        self.round_keys = text2matrix(master_key)
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># print self.round_keys</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> i in <span style="color:#fff;font-weight:bold">range</span>(<span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">4</span> * <span style="color:#ff0;font-weight:bold">11</span>):
</span></span><span style="display:flex;"><span>            self.round_keys.append([])
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> i % <span style="color:#ff0;font-weight:bold">4</span> == <span style="color:#ff0;font-weight:bold">0</span>:
</span></span><span style="display:flex;"><span>                byte = self.round_keys[i - <span style="color:#ff0;font-weight:bold">4</span>][<span style="color:#ff0;font-weight:bold">0</span>]        \
</span></span><span style="display:flex;"><span>                     ^ Sbox[self.round_keys[i - <span style="color:#ff0;font-weight:bold">1</span>][<span style="color:#ff0;font-weight:bold">1</span>]]  \
</span></span><span style="display:flex;"><span>                     ^ Rcon[<span style="color:#fff;font-weight:bold">int</span>(i / <span style="color:#ff0;font-weight:bold">4</span>)]
</span></span><span style="display:flex;"><span>                self.round_keys[i].append(byte)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">for</span> j in <span style="color:#fff;font-weight:bold">range</span>(<span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">4</span>):
</span></span><span style="display:flex;"><span>                    byte = self.round_keys[i - <span style="color:#ff0;font-weight:bold">4</span>][j]    \
</span></span><span style="display:flex;"><span>                         ^ Sbox[self.round_keys[i - <span style="color:#ff0;font-weight:bold">1</span>][(j + <span style="color:#ff0;font-weight:bold">1</span>) % <span style="color:#ff0;font-weight:bold">4</span>]]
</span></span><span style="display:flex;"><span>                    self.round_keys[i].append(byte)
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">for</span> j in <span style="color:#fff;font-weight:bold">range</span>(<span style="color:#ff0;font-weight:bold">4</span>):
</span></span><span style="display:flex;"><span>                    byte = self.round_keys[i - <span style="color:#ff0;font-weight:bold">4</span>][j]    \
</span></span><span style="display:flex;"><span>                         ^ self.round_keys[i - <span style="color:#ff0;font-weight:bold">1</span>][j]
</span></span><span style="display:flex;"><span>                    self.round_keys[i].append(byte)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># print self.round_keys</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> encrypt(self, plaintext):
</span></span><span style="display:flex;"><span>        self.plain_state = text2matrix(plaintext)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self.__add_round_key(self.plain_state, self.round_keys[:<span style="color:#ff0;font-weight:bold">4</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> i in <span style="color:#fff;font-weight:bold">range</span>(<span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">10</span>):
</span></span><span style="display:flex;"><span>            self.__round_encrypt(self.plain_state, self.round_keys[<span style="color:#ff0;font-weight:bold">4</span> * i : <span style="color:#ff0;font-weight:bold">4</span> * (i + <span style="color:#ff0;font-weight:bold">1</span>)])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self.__sub_bytes(self.plain_state)
</span></span><span style="display:flex;"><span>        self.__shift_rows(self.plain_state)
</span></span><span style="display:flex;"><span>        self.__add_round_key(self.plain_state, self.round_keys[<span style="color:#ff0;font-weight:bold">40</span>:])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> matrix2text(self.plain_state)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> decrypt(self, ciphertext):
</span></span><span style="display:flex;"><span>        self.cipher_state = text2matrix(ciphertext)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self.__add_round_key(self.cipher_state, self.round_keys[<span style="color:#ff0;font-weight:bold">40</span>:])
</span></span><span style="display:flex;"><span>        self.__inv_shift_rows(self.cipher_state)
</span></span><span style="display:flex;"><span>        self.__inv_sub_bytes(self.cipher_state)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> i in <span style="color:#fff;font-weight:bold">range</span>(<span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">0</span>, -<span style="color:#ff0;font-weight:bold">1</span>):
</span></span><span style="display:flex;"><span>            self.__round_decrypt(self.cipher_state, self.round_keys[<span style="color:#ff0;font-weight:bold">4</span> * i : <span style="color:#ff0;font-weight:bold">4</span> * (i + <span style="color:#ff0;font-weight:bold">1</span>)])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self.__add_round_key(self.cipher_state, self.round_keys[:<span style="color:#ff0;font-weight:bold">4</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> matrix2text(self.cipher_state)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> __add_round_key(self, s, k):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> i in <span style="color:#fff;font-weight:bold">range</span>(<span style="color:#ff0;font-weight:bold">4</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> j in <span style="color:#fff;font-weight:bold">range</span>(<span style="color:#ff0;font-weight:bold">4</span>):
</span></span><span style="display:flex;"><span>                s[i][j] ^= k[i][j]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> __round_encrypt(self, state_matrix, key_matrix):
</span></span><span style="display:flex;"><span>        self.__sub_bytes(state_matrix)
</span></span><span style="display:flex;"><span>        self.__shift_rows(state_matrix)
</span></span><span style="display:flex;"><span>        self.__mix_columns(state_matrix)
</span></span><span style="display:flex;"><span>        self.__add_round_key(state_matrix, key_matrix)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> __round_decrypt(self, state_matrix, key_matrix):
</span></span><span style="display:flex;"><span>        self.__add_round_key(state_matrix, key_matrix)
</span></span><span style="display:flex;"><span>        self.__inv_mix_columns(state_matrix)
</span></span><span style="display:flex;"><span>        self.__inv_shift_rows(state_matrix)
</span></span><span style="display:flex;"><span>        self.__inv_sub_bytes(state_matrix)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> __sub_bytes(self, s):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> i in <span style="color:#fff;font-weight:bold">range</span>(<span style="color:#ff0;font-weight:bold">4</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> j in <span style="color:#fff;font-weight:bold">range</span>(<span style="color:#ff0;font-weight:bold">4</span>):
</span></span><span style="display:flex;"><span>                s[i][j] = Sbox[s[i][j]]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> __inv_sub_bytes(self, s):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> i in <span style="color:#fff;font-weight:bold">range</span>(<span style="color:#ff0;font-weight:bold">4</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> j in <span style="color:#fff;font-weight:bold">range</span>(<span style="color:#ff0;font-weight:bold">4</span>):
</span></span><span style="display:flex;"><span>                s[i][j] = InvSbox[s[i][j]]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> __shift_rows(self, s):
</span></span><span style="display:flex;"><span>        s[<span style="color:#ff0;font-weight:bold">0</span>][<span style="color:#ff0;font-weight:bold">1</span>], s[<span style="color:#ff0;font-weight:bold">1</span>][<span style="color:#ff0;font-weight:bold">1</span>], s[<span style="color:#ff0;font-weight:bold">2</span>][<span style="color:#ff0;font-weight:bold">1</span>], s[<span style="color:#ff0;font-weight:bold">3</span>][<span style="color:#ff0;font-weight:bold">1</span>] = s[<span style="color:#ff0;font-weight:bold">1</span>][<span style="color:#ff0;font-weight:bold">1</span>], s[<span style="color:#ff0;font-weight:bold">2</span>][<span style="color:#ff0;font-weight:bold">1</span>], s[<span style="color:#ff0;font-weight:bold">3</span>][<span style="color:#ff0;font-weight:bold">1</span>], s[<span style="color:#ff0;font-weight:bold">0</span>][<span style="color:#ff0;font-weight:bold">1</span>]
</span></span><span style="display:flex;"><span>        s[<span style="color:#ff0;font-weight:bold">0</span>][<span style="color:#ff0;font-weight:bold">2</span>], s[<span style="color:#ff0;font-weight:bold">1</span>][<span style="color:#ff0;font-weight:bold">2</span>], s[<span style="color:#ff0;font-weight:bold">2</span>][<span style="color:#ff0;font-weight:bold">2</span>], s[<span style="color:#ff0;font-weight:bold">3</span>][<span style="color:#ff0;font-weight:bold">2</span>] = s[<span style="color:#ff0;font-weight:bold">2</span>][<span style="color:#ff0;font-weight:bold">2</span>], s[<span style="color:#ff0;font-weight:bold">3</span>][<span style="color:#ff0;font-weight:bold">2</span>], s[<span style="color:#ff0;font-weight:bold">0</span>][<span style="color:#ff0;font-weight:bold">2</span>], s[<span style="color:#ff0;font-weight:bold">1</span>][<span style="color:#ff0;font-weight:bold">2</span>]
</span></span><span style="display:flex;"><span>        s[<span style="color:#ff0;font-weight:bold">0</span>][<span style="color:#ff0;font-weight:bold">3</span>], s[<span style="color:#ff0;font-weight:bold">1</span>][<span style="color:#ff0;font-weight:bold">3</span>], s[<span style="color:#ff0;font-weight:bold">2</span>][<span style="color:#ff0;font-weight:bold">3</span>], s[<span style="color:#ff0;font-weight:bold">3</span>][<span style="color:#ff0;font-weight:bold">3</span>] = s[<span style="color:#ff0;font-weight:bold">3</span>][<span style="color:#ff0;font-weight:bold">3</span>], s[<span style="color:#ff0;font-weight:bold">0</span>][<span style="color:#ff0;font-weight:bold">3</span>], s[<span style="color:#ff0;font-weight:bold">1</span>][<span style="color:#ff0;font-weight:bold">3</span>], s[<span style="color:#ff0;font-weight:bold">2</span>][<span style="color:#ff0;font-weight:bold">3</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> __inv_shift_rows(self, s):
</span></span><span style="display:flex;"><span>        s[<span style="color:#ff0;font-weight:bold">0</span>][<span style="color:#ff0;font-weight:bold">1</span>], s[<span style="color:#ff0;font-weight:bold">1</span>][<span style="color:#ff0;font-weight:bold">1</span>], s[<span style="color:#ff0;font-weight:bold">2</span>][<span style="color:#ff0;font-weight:bold">1</span>], s[<span style="color:#ff0;font-weight:bold">3</span>][<span style="color:#ff0;font-weight:bold">1</span>] = s[<span style="color:#ff0;font-weight:bold">3</span>][<span style="color:#ff0;font-weight:bold">1</span>], s[<span style="color:#ff0;font-weight:bold">0</span>][<span style="color:#ff0;font-weight:bold">1</span>], s[<span style="color:#ff0;font-weight:bold">1</span>][<span style="color:#ff0;font-weight:bold">1</span>], s[<span style="color:#ff0;font-weight:bold">2</span>][<span style="color:#ff0;font-weight:bold">1</span>]
</span></span><span style="display:flex;"><span>        s[<span style="color:#ff0;font-weight:bold">0</span>][<span style="color:#ff0;font-weight:bold">2</span>], s[<span style="color:#ff0;font-weight:bold">1</span>][<span style="color:#ff0;font-weight:bold">2</span>], s[<span style="color:#ff0;font-weight:bold">2</span>][<span style="color:#ff0;font-weight:bold">2</span>], s[<span style="color:#ff0;font-weight:bold">3</span>][<span style="color:#ff0;font-weight:bold">2</span>] = s[<span style="color:#ff0;font-weight:bold">2</span>][<span style="color:#ff0;font-weight:bold">2</span>], s[<span style="color:#ff0;font-weight:bold">3</span>][<span style="color:#ff0;font-weight:bold">2</span>], s[<span style="color:#ff0;font-weight:bold">0</span>][<span style="color:#ff0;font-weight:bold">2</span>], s[<span style="color:#ff0;font-weight:bold">1</span>][<span style="color:#ff0;font-weight:bold">2</span>]
</span></span><span style="display:flex;"><span>        s[<span style="color:#ff0;font-weight:bold">0</span>][<span style="color:#ff0;font-weight:bold">3</span>], s[<span style="color:#ff0;font-weight:bold">1</span>][<span style="color:#ff0;font-weight:bold">3</span>], s[<span style="color:#ff0;font-weight:bold">2</span>][<span style="color:#ff0;font-weight:bold">3</span>], s[<span style="color:#ff0;font-weight:bold">3</span>][<span style="color:#ff0;font-weight:bold">3</span>] = s[<span style="color:#ff0;font-weight:bold">1</span>][<span style="color:#ff0;font-weight:bold">3</span>], s[<span style="color:#ff0;font-weight:bold">2</span>][<span style="color:#ff0;font-weight:bold">3</span>], s[<span style="color:#ff0;font-weight:bold">3</span>][<span style="color:#ff0;font-weight:bold">3</span>], s[<span style="color:#ff0;font-weight:bold">0</span>][<span style="color:#ff0;font-weight:bold">3</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> __mix_single_column(self, a):
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># please see Sec 4.1.2 in The Design of Rijndael</span>
</span></span><span style="display:flex;"><span>        t = a[<span style="color:#ff0;font-weight:bold">0</span>] ^ a[<span style="color:#ff0;font-weight:bold">1</span>] ^ a[<span style="color:#ff0;font-weight:bold">2</span>] ^ a[<span style="color:#ff0;font-weight:bold">3</span>]
</span></span><span style="display:flex;"><span>        u = a[<span style="color:#ff0;font-weight:bold">0</span>]
</span></span><span style="display:flex;"><span>        a[<span style="color:#ff0;font-weight:bold">0</span>] ^= t ^ xtime(a[<span style="color:#ff0;font-weight:bold">0</span>] ^ a[<span style="color:#ff0;font-weight:bold">1</span>])
</span></span><span style="display:flex;"><span>        a[<span style="color:#ff0;font-weight:bold">1</span>] ^= t ^ xtime(a[<span style="color:#ff0;font-weight:bold">1</span>] ^ a[<span style="color:#ff0;font-weight:bold">2</span>])
</span></span><span style="display:flex;"><span>        a[<span style="color:#ff0;font-weight:bold">2</span>] ^= t ^ xtime(a[<span style="color:#ff0;font-weight:bold">2</span>] ^ a[<span style="color:#ff0;font-weight:bold">3</span>])
</span></span><span style="display:flex;"><span>        a[<span style="color:#ff0;font-weight:bold">3</span>] ^= t ^ xtime(a[<span style="color:#ff0;font-weight:bold">3</span>] ^ u)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> __mix_columns(self, s):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> i in <span style="color:#fff;font-weight:bold">range</span>(<span style="color:#ff0;font-weight:bold">4</span>):
</span></span><span style="display:flex;"><span>            self.__mix_single_column(s[i])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> __inv_mix_columns(self, s):
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f"># see Sec 4.1.3 in The Design of Rijndael</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> i in <span style="color:#fff;font-weight:bold">range</span>(<span style="color:#ff0;font-weight:bold">4</span>):
</span></span><span style="display:flex;"><span>            u = xtime(xtime(s[i][<span style="color:#ff0;font-weight:bold">0</span>] ^ s[i][<span style="color:#ff0;font-weight:bold">2</span>]))
</span></span><span style="display:flex;"><span>            v = xtime(xtime(s[i][<span style="color:#ff0;font-weight:bold">1</span>] ^ s[i][<span style="color:#ff0;font-weight:bold">3</span>]))
</span></span><span style="display:flex;"><span>            s[i][<span style="color:#ff0;font-weight:bold">0</span>] ^= u
</span></span><span style="display:flex;"><span>            s[i][<span style="color:#ff0;font-weight:bold">1</span>] ^= v
</span></span><span style="display:flex;"><span>            s[i][<span style="color:#ff0;font-weight:bold">2</span>] ^= u
</span></span><span style="display:flex;"><span>            s[i][<span style="color:#ff0;font-weight:bold">3</span>] ^= v
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self.__mix_columns(s)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>master_key = <span style="color:#ff0;font-weight:bold">0x2b7e151628aed2a6abf7158809cf4f3c</span>
</span></span><span style="display:flex;"><span>AESbar = AES(master_key)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> test_encryption():
</span></span><span style="display:flex;"><span>    plaintext = <span style="color:#ff0;font-weight:bold">0x3243f6a8885a308d313198a2e0370734</span>
</span></span><span style="display:flex;"><span>    encrypted = AESbar.encrypt(plaintext)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">print</span>(<span style="color:#0ff;font-weight:bold">&#39;加密得密文： 0x</span><span style="color:#0ff;font-weight:bold">%x</span><span style="color:#0ff;font-weight:bold">&#39;</span>  % encrypted)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">assert</span> encrypted == <span style="color:#ff0;font-weight:bold">0x3925841d02dc09fbdc118597196a0b32</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">print</span>(<span style="color:#0ff;font-weight:bold">&#39;加密结果正确&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> test_decryption():
</span></span><span style="display:flex;"><span>    ciphertext = <span style="color:#ff0;font-weight:bold">0x3925841d02dc09fbdc118597196a0b32</span>
</span></span><span style="display:flex;"><span>    decrypted = AESbar.decrypt(ciphertext)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">print</span>(<span style="color:#0ff;font-weight:bold">&#39;解密得原文: 0x</span><span style="color:#0ff;font-weight:bold">%x</span><span style="color:#0ff;font-weight:bold">&#39;</span> % decrypted)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">assert</span> decrypted == <span style="color:#ff0;font-weight:bold">0x3243f6a8885a308d313198a2e0370734</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">print</span>(<span style="color:#0ff;font-weight:bold">&#39;解密成功&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> __name__ == <span style="color:#0ff;font-weight:bold">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">print</span>(<span style="color:#0ff;font-weight:bold">&#39;开始单元测试：&#39;</span>)
</span></span><span style="display:flex;"><span>    test_encryption()
</span></span><span style="display:flex;"><span>    test_decryption()
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">print</span>(<span style="color:#0ff;font-weight:bold">&#39;单元测试成功&#39;</span>)
</span></span></code></pre></div><pre><code>开始单元测试：
加密得密文： 0x3925841d02dc09fbdc118597196a0b32
加密结果正确
解密得原文: 0x3243f6a8885a308d313198a2e0370734
解密成功
单元测试成功
</code></pre>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#007f7f">#!/usr/bin/env python</span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#-*- coding:utf-8 -*-</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">DES加密解密的Python3实现
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#Initial permut matrix for the datas</span>
</span></span><span style="display:flex;"><span>PI = [<span style="color:#ff0;font-weight:bold">58</span>, <span style="color:#ff0;font-weight:bold">50</span>, <span style="color:#ff0;font-weight:bold">42</span>, <span style="color:#ff0;font-weight:bold">34</span>, <span style="color:#ff0;font-weight:bold">26</span>, <span style="color:#ff0;font-weight:bold">18</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">2</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ff0;font-weight:bold">60</span>, <span style="color:#ff0;font-weight:bold">52</span>, <span style="color:#ff0;font-weight:bold">44</span>, <span style="color:#ff0;font-weight:bold">36</span>, <span style="color:#ff0;font-weight:bold">28</span>, <span style="color:#ff0;font-weight:bold">20</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">4</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ff0;font-weight:bold">62</span>, <span style="color:#ff0;font-weight:bold">54</span>, <span style="color:#ff0;font-weight:bold">46</span>, <span style="color:#ff0;font-weight:bold">38</span>, <span style="color:#ff0;font-weight:bold">30</span>, <span style="color:#ff0;font-weight:bold">22</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">6</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ff0;font-weight:bold">64</span>, <span style="color:#ff0;font-weight:bold">56</span>, <span style="color:#ff0;font-weight:bold">48</span>, <span style="color:#ff0;font-weight:bold">40</span>, <span style="color:#ff0;font-weight:bold">32</span>, <span style="color:#ff0;font-weight:bold">24</span>, <span style="color:#ff0;font-weight:bold">16</span>, <span style="color:#ff0;font-weight:bold">8</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ff0;font-weight:bold">57</span>, <span style="color:#ff0;font-weight:bold">49</span>, <span style="color:#ff0;font-weight:bold">41</span>, <span style="color:#ff0;font-weight:bold">33</span>, <span style="color:#ff0;font-weight:bold">25</span>, <span style="color:#ff0;font-weight:bold">17</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">1</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ff0;font-weight:bold">59</span>, <span style="color:#ff0;font-weight:bold">51</span>, <span style="color:#ff0;font-weight:bold">43</span>, <span style="color:#ff0;font-weight:bold">35</span>, <span style="color:#ff0;font-weight:bold">27</span>, <span style="color:#ff0;font-weight:bold">19</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">3</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ff0;font-weight:bold">61</span>, <span style="color:#ff0;font-weight:bold">53</span>, <span style="color:#ff0;font-weight:bold">45</span>, <span style="color:#ff0;font-weight:bold">37</span>, <span style="color:#ff0;font-weight:bold">29</span>, <span style="color:#ff0;font-weight:bold">21</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">5</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ff0;font-weight:bold">63</span>, <span style="color:#ff0;font-weight:bold">55</span>, <span style="color:#ff0;font-weight:bold">47</span>, <span style="color:#ff0;font-weight:bold">39</span>, <span style="color:#ff0;font-weight:bold">31</span>, <span style="color:#ff0;font-weight:bold">23</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">7</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#Initial permut made on the key</span>
</span></span><span style="display:flex;"><span>CP_1 = [<span style="color:#ff0;font-weight:bold">57</span>, <span style="color:#ff0;font-weight:bold">49</span>, <span style="color:#ff0;font-weight:bold">41</span>, <span style="color:#ff0;font-weight:bold">33</span>, <span style="color:#ff0;font-weight:bold">25</span>, <span style="color:#ff0;font-weight:bold">17</span>, <span style="color:#ff0;font-weight:bold">9</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">58</span>, <span style="color:#ff0;font-weight:bold">50</span>, <span style="color:#ff0;font-weight:bold">42</span>, <span style="color:#ff0;font-weight:bold">34</span>, <span style="color:#ff0;font-weight:bold">26</span>, <span style="color:#ff0;font-weight:bold">18</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">59</span>, <span style="color:#ff0;font-weight:bold">51</span>, <span style="color:#ff0;font-weight:bold">43</span>, <span style="color:#ff0;font-weight:bold">35</span>, <span style="color:#ff0;font-weight:bold">27</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff0;font-weight:bold">19</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">60</span>, <span style="color:#ff0;font-weight:bold">52</span>, <span style="color:#ff0;font-weight:bold">44</span>, <span style="color:#ff0;font-weight:bold">36</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff0;font-weight:bold">63</span>, <span style="color:#ff0;font-weight:bold">55</span>, <span style="color:#ff0;font-weight:bold">47</span>, <span style="color:#ff0;font-weight:bold">39</span>, <span style="color:#ff0;font-weight:bold">31</span>, <span style="color:#ff0;font-weight:bold">23</span>, <span style="color:#ff0;font-weight:bold">15</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">62</span>, <span style="color:#ff0;font-weight:bold">54</span>, <span style="color:#ff0;font-weight:bold">46</span>, <span style="color:#ff0;font-weight:bold">38</span>, <span style="color:#ff0;font-weight:bold">30</span>, <span style="color:#ff0;font-weight:bold">22</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">61</span>, <span style="color:#ff0;font-weight:bold">53</span>, <span style="color:#ff0;font-weight:bold">45</span>, <span style="color:#ff0;font-weight:bold">37</span>, <span style="color:#ff0;font-weight:bold">29</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff0;font-weight:bold">21</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">28</span>, <span style="color:#ff0;font-weight:bold">20</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">4</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#Permut applied on shifted key to get Ki+1</span>
</span></span><span style="display:flex;"><span>CP_2 = [<span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">17</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">24</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">28</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">21</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">23</span>, <span style="color:#ff0;font-weight:bold">19</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">4</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff0;font-weight:bold">26</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">16</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">27</span>, <span style="color:#ff0;font-weight:bold">20</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">2</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff0;font-weight:bold">41</span>, <span style="color:#ff0;font-weight:bold">52</span>, <span style="color:#ff0;font-weight:bold">31</span>, <span style="color:#ff0;font-weight:bold">37</span>, <span style="color:#ff0;font-weight:bold">47</span>, <span style="color:#ff0;font-weight:bold">55</span>, <span style="color:#ff0;font-weight:bold">30</span>, <span style="color:#ff0;font-weight:bold">40</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff0;font-weight:bold">51</span>, <span style="color:#ff0;font-weight:bold">45</span>, <span style="color:#ff0;font-weight:bold">33</span>, <span style="color:#ff0;font-weight:bold">48</span>, <span style="color:#ff0;font-weight:bold">44</span>, <span style="color:#ff0;font-weight:bold">49</span>, <span style="color:#ff0;font-weight:bold">39</span>, <span style="color:#ff0;font-weight:bold">56</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff0;font-weight:bold">34</span>, <span style="color:#ff0;font-weight:bold">53</span>, <span style="color:#ff0;font-weight:bold">46</span>, <span style="color:#ff0;font-weight:bold">42</span>, <span style="color:#ff0;font-weight:bold">50</span>, <span style="color:#ff0;font-weight:bold">36</span>, <span style="color:#ff0;font-weight:bold">29</span>, <span style="color:#ff0;font-weight:bold">32</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#Expand matrix to get a 48bits matrix of datas to apply the xor with Ki</span>
</span></span><span style="display:flex;"><span>E = [<span style="color:#ff0;font-weight:bold">32</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">5</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">9</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">13</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">16</span>, <span style="color:#ff0;font-weight:bold">17</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#ff0;font-weight:bold">16</span>, <span style="color:#ff0;font-weight:bold">17</span>, <span style="color:#ff0;font-weight:bold">18</span>, <span style="color:#ff0;font-weight:bold">19</span>, <span style="color:#ff0;font-weight:bold">20</span>, <span style="color:#ff0;font-weight:bold">21</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#ff0;font-weight:bold">20</span>, <span style="color:#ff0;font-weight:bold">21</span>, <span style="color:#ff0;font-weight:bold">22</span>, <span style="color:#ff0;font-weight:bold">23</span>, <span style="color:#ff0;font-weight:bold">24</span>, <span style="color:#ff0;font-weight:bold">25</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#ff0;font-weight:bold">24</span>, <span style="color:#ff0;font-weight:bold">25</span>, <span style="color:#ff0;font-weight:bold">26</span>, <span style="color:#ff0;font-weight:bold">27</span>, <span style="color:#ff0;font-weight:bold">28</span>, <span style="color:#ff0;font-weight:bold">29</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#ff0;font-weight:bold">28</span>, <span style="color:#ff0;font-weight:bold">29</span>, <span style="color:#ff0;font-weight:bold">30</span>, <span style="color:#ff0;font-weight:bold">31</span>, <span style="color:#ff0;font-weight:bold">32</span>, <span style="color:#ff0;font-weight:bold">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#SBOX</span>
</span></span><span style="display:flex;"><span>S_BOX = [
</span></span><span style="display:flex;"><span>         
</span></span><span style="display:flex;"><span>[[<span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">7</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">8</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">0</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">13</span>],
</span></span><span style="display:flex;"><span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[[<span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">10</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">5</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">15</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">9</span>],
</span></span><span style="display:flex;"><span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[[<span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">8</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">1</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">7</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">12</span>],
</span></span><span style="display:flex;"><span>],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[[<span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">15</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">9</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">4</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">14</span>],
</span></span><span style="display:flex;"><span>],  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[[<span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">9</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">6</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">14</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">3</span>],
</span></span><span style="display:flex;"><span>], 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[[<span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">11</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">8</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">6</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">13</span>],
</span></span><span style="display:flex;"><span>], 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[[<span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">1</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">6</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">2</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">12</span>],
</span></span><span style="display:flex;"><span>],
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>[[<span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">7</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">2</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">8</span>],
</span></span><span style="display:flex;"><span> [<span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">11</span>],
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#Permut made after each SBox substitution for each round</span>
</span></span><span style="display:flex;"><span>P = [<span style="color:#ff0;font-weight:bold">16</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">20</span>, <span style="color:#ff0;font-weight:bold">21</span>, <span style="color:#ff0;font-weight:bold">29</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">28</span>, <span style="color:#ff0;font-weight:bold">17</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">23</span>, <span style="color:#ff0;font-weight:bold">26</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">18</span>, <span style="color:#ff0;font-weight:bold">31</span>, <span style="color:#ff0;font-weight:bold">10</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">24</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">32</span>, <span style="color:#ff0;font-weight:bold">27</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">9</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#ff0;font-weight:bold">19</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">30</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">22</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">25</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#Final permut for datas after the 16 rounds</span>
</span></span><span style="display:flex;"><span>PI_1 = [<span style="color:#ff0;font-weight:bold">40</span>, <span style="color:#ff0;font-weight:bold">8</span>, <span style="color:#ff0;font-weight:bold">48</span>, <span style="color:#ff0;font-weight:bold">16</span>, <span style="color:#ff0;font-weight:bold">56</span>, <span style="color:#ff0;font-weight:bold">24</span>, <span style="color:#ff0;font-weight:bold">64</span>, <span style="color:#ff0;font-weight:bold">32</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff0;font-weight:bold">39</span>, <span style="color:#ff0;font-weight:bold">7</span>, <span style="color:#ff0;font-weight:bold">47</span>, <span style="color:#ff0;font-weight:bold">15</span>, <span style="color:#ff0;font-weight:bold">55</span>, <span style="color:#ff0;font-weight:bold">23</span>, <span style="color:#ff0;font-weight:bold">63</span>, <span style="color:#ff0;font-weight:bold">31</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff0;font-weight:bold">38</span>, <span style="color:#ff0;font-weight:bold">6</span>, <span style="color:#ff0;font-weight:bold">46</span>, <span style="color:#ff0;font-weight:bold">14</span>, <span style="color:#ff0;font-weight:bold">54</span>, <span style="color:#ff0;font-weight:bold">22</span>, <span style="color:#ff0;font-weight:bold">62</span>, <span style="color:#ff0;font-weight:bold">30</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff0;font-weight:bold">37</span>, <span style="color:#ff0;font-weight:bold">5</span>, <span style="color:#ff0;font-weight:bold">45</span>, <span style="color:#ff0;font-weight:bold">13</span>, <span style="color:#ff0;font-weight:bold">53</span>, <span style="color:#ff0;font-weight:bold">21</span>, <span style="color:#ff0;font-weight:bold">61</span>, <span style="color:#ff0;font-weight:bold">29</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff0;font-weight:bold">36</span>, <span style="color:#ff0;font-weight:bold">4</span>, <span style="color:#ff0;font-weight:bold">44</span>, <span style="color:#ff0;font-weight:bold">12</span>, <span style="color:#ff0;font-weight:bold">52</span>, <span style="color:#ff0;font-weight:bold">20</span>, <span style="color:#ff0;font-weight:bold">60</span>, <span style="color:#ff0;font-weight:bold">28</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff0;font-weight:bold">35</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">43</span>, <span style="color:#ff0;font-weight:bold">11</span>, <span style="color:#ff0;font-weight:bold">51</span>, <span style="color:#ff0;font-weight:bold">19</span>, <span style="color:#ff0;font-weight:bold">59</span>, <span style="color:#ff0;font-weight:bold">27</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff0;font-weight:bold">34</span>, <span style="color:#ff0;font-weight:bold">2</span>, <span style="color:#ff0;font-weight:bold">42</span>, <span style="color:#ff0;font-weight:bold">10</span>, <span style="color:#ff0;font-weight:bold">50</span>, <span style="color:#ff0;font-weight:bold">18</span>, <span style="color:#ff0;font-weight:bold">58</span>, <span style="color:#ff0;font-weight:bold">26</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff0;font-weight:bold">33</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">41</span>, <span style="color:#ff0;font-weight:bold">9</span>, <span style="color:#ff0;font-weight:bold">49</span>, <span style="color:#ff0;font-weight:bold">17</span>, <span style="color:#ff0;font-weight:bold">57</span>, <span style="color:#ff0;font-weight:bold">25</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">#Matrix that determine the shift for each round of keys</span>
</span></span><span style="display:flex;"><span>SHIFT = [<span style="color:#ff0;font-weight:bold">1</span>,<span style="color:#ff0;font-weight:bold">1</span>,<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">1</span>,<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#ff0;font-weight:bold">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> string_to_bit_array(text):<span style="color:#007f7f">#Convert a string into a list of bits</span>
</span></span><span style="display:flex;"><span>    array = <span style="color:#fff;font-weight:bold">list</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">for</span> char in text:
</span></span><span style="display:flex;"><span>        binval = binvalue(char, <span style="color:#ff0;font-weight:bold">8</span>)<span style="color:#007f7f">#Get the char value on one byte</span>
</span></span><span style="display:flex;"><span>        array.extend([<span style="color:#fff;font-weight:bold">int</span>(x) <span style="color:#fff;font-weight:bold">for</span> x in <span style="color:#fff;font-weight:bold">list</span>(binval)]) <span style="color:#007f7f">#Add the bits to the final list</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> array
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> bit_array_to_string(array): <span style="color:#007f7f">#Recreate the string from the bit array</span>
</span></span><span style="display:flex;"><span>    res = <span style="color:#0ff;font-weight:bold">&#39;&#39;</span>.join([<span style="color:#fff;font-weight:bold">chr</span>(<span style="color:#fff;font-weight:bold">int</span>(y,<span style="color:#ff0;font-weight:bold">2</span>)) <span style="color:#fff;font-weight:bold">for</span> y in [<span style="color:#0ff;font-weight:bold">&#39;&#39;</span>.join([<span style="color:#fff;font-weight:bold">str</span>(x) <span style="color:#fff;font-weight:bold">for</span> x in <span style="color:#fff;font-weight:bold">bytes</span>]) <span style="color:#fff;font-weight:bold">for</span> <span style="color:#fff;font-weight:bold">bytes</span> in  nsplit(array,<span style="color:#ff0;font-weight:bold">8</span>)]])   
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> res
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> binvalue(val, bitsize): <span style="color:#007f7f">#Return the binary value as a string of the given size </span>
</span></span><span style="display:flex;"><span>    binval = <span style="color:#fff;font-weight:bold">bin</span>(val)[<span style="color:#ff0;font-weight:bold">2</span>:] <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">isinstance</span>(val, <span style="color:#fff;font-weight:bold">int</span>) <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">bin</span>(<span style="color:#fff;font-weight:bold">ord</span>(val))[<span style="color:#ff0;font-weight:bold">2</span>:]
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">len</span>(binval) &gt; bitsize:
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">raise</span> <span style="color:#0ff;font-weight:bold">&#34;binary value larger than the expected size&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">while</span> <span style="color:#fff;font-weight:bold">len</span>(binval) &lt; bitsize:
</span></span><span style="display:flex;"><span>        binval = <span style="color:#0ff;font-weight:bold">&#34;0&#34;</span>+binval <span style="color:#007f7f">#Add as many 0 as needed to get the wanted size</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> binval
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> nsplit(s, n):<span style="color:#007f7f">#Split a list into sublists of size &#34;n&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> [s[k:k+n] <span style="color:#fff;font-weight:bold">for</span> k in <span style="color:#fff;font-weight:bold">range</span>(<span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#fff;font-weight:bold">len</span>(s), n)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ENCRYPT=<span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>DECRYPT=<span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> des():
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        self.password = <span style="color:#fff;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>        self.text = <span style="color:#fff;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>        self.keys = <span style="color:#fff;font-weight:bold">list</span>()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> run(self, key, text, action=ENCRYPT, padding=<span style="color:#fff;font-weight:bold">False</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">len</span>(key) &lt; <span style="color:#ff0;font-weight:bold">8</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">raise</span> <span style="color:#0ff;font-weight:bold">&#34;Key Should be 8 bytes long&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">elif</span> <span style="color:#fff;font-weight:bold">len</span>(key) &gt; <span style="color:#ff0;font-weight:bold">8</span>:
</span></span><span style="display:flex;"><span>            key = key[:<span style="color:#ff0;font-weight:bold">8</span>] <span style="color:#007f7f">#If key size is above 8bytes, cut to be 8bytes long</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        self.password = key
</span></span><span style="display:flex;"><span>        self.text = text
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> padding and action==ENCRYPT:
</span></span><span style="display:flex;"><span>            self.addPadding()
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">elif</span> <span style="color:#fff;font-weight:bold">len</span>(self.text) % <span style="color:#ff0;font-weight:bold">8</span> != <span style="color:#ff0;font-weight:bold">0</span>:<span style="color:#007f7f">#If not padding specified data size must be multiple of 8 bytes</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">raise</span> <span style="color:#0ff;font-weight:bold">&#34;Data size should be multiple of 8&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        self.generatekeys() <span style="color:#007f7f">#Generate all the keys</span>
</span></span><span style="display:flex;"><span>        text_blocks = nsplit(self.text, <span style="color:#ff0;font-weight:bold">8</span>) <span style="color:#007f7f">#Split the text in blocks of 8 bytes so 64 bits</span>
</span></span><span style="display:flex;"><span>        result = <span style="color:#fff;font-weight:bold">list</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> block in text_blocks:<span style="color:#007f7f">#Loop over all the blocks of data</span>
</span></span><span style="display:flex;"><span>            block = string_to_bit_array(block)<span style="color:#007f7f">#Convert the block in bit array</span>
</span></span><span style="display:flex;"><span>            block = self.permut(block,PI)<span style="color:#007f7f">#Apply the initial permutation</span>
</span></span><span style="display:flex;"><span>            g, d = nsplit(block, <span style="color:#ff0;font-weight:bold">32</span>) <span style="color:#007f7f">#g(LEFT), d(RIGHT)</span>
</span></span><span style="display:flex;"><span>            tmp = <span style="color:#fff;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> i in <span style="color:#fff;font-weight:bold">range</span>(<span style="color:#ff0;font-weight:bold">16</span>): <span style="color:#007f7f">#Do the 16 rounds</span>
</span></span><span style="display:flex;"><span>                d_e = self.expand(d, E) <span style="color:#007f7f">#Expand d to match Ki size (48bits)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> action == ENCRYPT:
</span></span><span style="display:flex;"><span>                    tmp = self.xor(self.keys[i], d_e)<span style="color:#007f7f">#If encrypt use Ki</span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>                    tmp = self.xor(self.keys[<span style="color:#ff0;font-weight:bold">15</span>-i], d_e)<span style="color:#007f7f">#If decrypt start by the last key</span>
</span></span><span style="display:flex;"><span>                tmp = self.substitute(tmp) <span style="color:#007f7f">#Method that will apply the SBOXes</span>
</span></span><span style="display:flex;"><span>                tmp = self.permut(tmp, P)
</span></span><span style="display:flex;"><span>                tmp = self.xor(g, tmp)
</span></span><span style="display:flex;"><span>                g = d
</span></span><span style="display:flex;"><span>                d = tmp
</span></span><span style="display:flex;"><span>            result += self.permut(d+g, PI_1) <span style="color:#007f7f">#Do the last permut and append the result to result</span>
</span></span><span style="display:flex;"><span>        final_res = bit_array_to_string(result)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> padding and action==DECRYPT:
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> self.removePadding(final_res) <span style="color:#007f7f">#Remove the padding if decrypt and padding is true</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> final_res <span style="color:#007f7f">#Return the final string of data ciphered/deciphered</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> substitute(self, d_e):<span style="color:#007f7f">#Substitute bytes using SBOX</span>
</span></span><span style="display:flex;"><span>        subblocks = nsplit(d_e, <span style="color:#ff0;font-weight:bold">6</span>)<span style="color:#007f7f">#Split bit array into sublist of 6 bits</span>
</span></span><span style="display:flex;"><span>        result = <span style="color:#fff;font-weight:bold">list</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> i in <span style="color:#fff;font-weight:bold">range</span>(<span style="color:#fff;font-weight:bold">len</span>(subblocks)): <span style="color:#007f7f">#For all the sublists</span>
</span></span><span style="display:flex;"><span>            block = subblocks[i]
</span></span><span style="display:flex;"><span>            row = <span style="color:#fff;font-weight:bold">int</span>(<span style="color:#fff;font-weight:bold">str</span>(block[<span style="color:#ff0;font-weight:bold">0</span>])+<span style="color:#fff;font-weight:bold">str</span>(block[<span style="color:#ff0;font-weight:bold">5</span>]),<span style="color:#ff0;font-weight:bold">2</span>)<span style="color:#007f7f">#Get the row with the first and last bit</span>
</span></span><span style="display:flex;"><span>            column = <span style="color:#fff;font-weight:bold">int</span>(<span style="color:#0ff;font-weight:bold">&#39;&#39;</span>.join([<span style="color:#fff;font-weight:bold">str</span>(x) <span style="color:#fff;font-weight:bold">for</span> x in block[<span style="color:#ff0;font-weight:bold">1</span>:][:-<span style="color:#ff0;font-weight:bold">1</span>]]),<span style="color:#ff0;font-weight:bold">2</span>) <span style="color:#007f7f">#Column is the 2,3,4,5th bits</span>
</span></span><span style="display:flex;"><span>            val = S_BOX[i][row][column] <span style="color:#007f7f">#Take the value in the SBOX appropriated for the round (i)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">bin</span> = binvalue(val, <span style="color:#ff0;font-weight:bold">4</span>)<span style="color:#007f7f">#Convert the value to binary</span>
</span></span><span style="display:flex;"><span>            result += [<span style="color:#fff;font-weight:bold">int</span>(x) <span style="color:#fff;font-weight:bold">for</span> x in <span style="color:#fff;font-weight:bold">bin</span>]<span style="color:#007f7f">#And append it to the resulting list</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> result
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> permut(self, block, table):<span style="color:#007f7f">#Permut the given block using the given table (so generic method)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> [block[x-<span style="color:#ff0;font-weight:bold">1</span>] <span style="color:#fff;font-weight:bold">for</span> x in table]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> expand(self, block, table):<span style="color:#007f7f">#Do the exact same thing than permut but for more clarity has been renamed</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> [block[x-<span style="color:#ff0;font-weight:bold">1</span>] <span style="color:#fff;font-weight:bold">for</span> x in table]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> xor(self, t1, t2):<span style="color:#007f7f">#Apply a xor and return the resulting list</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> [x^y <span style="color:#fff;font-weight:bold">for</span> x,y in <span style="color:#fff;font-weight:bold">zip</span>(t1,t2)]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> generatekeys(self):<span style="color:#007f7f">#Algorithm that generates all the keys</span>
</span></span><span style="display:flex;"><span>        self.keys = []
</span></span><span style="display:flex;"><span>        key = string_to_bit_array(self.password)
</span></span><span style="display:flex;"><span>        key = self.permut(key, CP_1) <span style="color:#007f7f">#Apply the initial permut on the key</span>
</span></span><span style="display:flex;"><span>        g, d = nsplit(key, <span style="color:#ff0;font-weight:bold">28</span>) <span style="color:#007f7f">#Split it in to (g-&gt;LEFT),(d-&gt;RIGHT)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> i in <span style="color:#fff;font-weight:bold">range</span>(<span style="color:#ff0;font-weight:bold">16</span>):<span style="color:#007f7f">#Apply the 16 rounds</span>
</span></span><span style="display:flex;"><span>            g, d = self.shift(g, d, SHIFT[i]) <span style="color:#007f7f">#Apply the shift associated with the round (not always 1)</span>
</span></span><span style="display:flex;"><span>            tmp = g + d <span style="color:#007f7f">#Merge them</span>
</span></span><span style="display:flex;"><span>            self.keys.append(self.permut(tmp, CP_2)) <span style="color:#007f7f">#Apply the permut to get the Ki</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> shift(self, g, d, n): <span style="color:#007f7f">#Shift a list of the given value</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> g[n:] + g[:n], d[n:] + d[:n]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> addPadding(self):<span style="color:#007f7f">#Add padding to the datas using PKCS5 spec.</span>
</span></span><span style="display:flex;"><span>        pad_len = <span style="color:#ff0;font-weight:bold">8</span> - (<span style="color:#fff;font-weight:bold">len</span>(self.text) % <span style="color:#ff0;font-weight:bold">8</span>)
</span></span><span style="display:flex;"><span>        self.text += pad_len * <span style="color:#fff;font-weight:bold">chr</span>(pad_len)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> removePadding(self, data):<span style="color:#007f7f">#Remove the padding of the plain text (it assume there is padding)</span>
</span></span><span style="display:flex;"><span>        pad_len = <span style="color:#fff;font-weight:bold">ord</span>(data[-<span style="color:#ff0;font-weight:bold">1</span>])
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> data[:-pad_len]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> encrypt(self, key, text, padding=<span style="color:#fff;font-weight:bold">False</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> self.run(key, text, ENCRYPT, padding)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> decrypt(self, key, text, padding=<span style="color:#fff;font-weight:bold">False</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> self.run(key, text, DECRYPT, padding)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">if</span> __name__ == <span style="color:#0ff;font-weight:bold">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    key = <span style="color:#0ff;font-weight:bold">&#34;secret_k&#34;</span>
</span></span><span style="display:flex;"><span>    text= <span style="color:#0ff;font-weight:bold">&#34;Hello wo&#34;</span>
</span></span><span style="display:flex;"><span>    d = des()
</span></span><span style="display:flex;"><span>    r = d.encrypt(key,text)
</span></span><span style="display:flex;"><span>    r2 = d.decrypt(key,r)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">print</span>(<span style="color:#0ff;font-weight:bold">&#34;Ciphered: </span><span style="color:#0ff;font-weight:bold">%r</span><span style="color:#0ff;font-weight:bold">&#34;</span> % r)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">print</span>(<span style="color:#0ff;font-weight:bold">&#34;Deciphered: &#34;</span>, r2)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">assert</span> r2 == text
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">print</span>(<span style="color:#0ff;font-weight:bold">&#39;成功实现DES加密解密&#39;</span>)
</span></span></code></pre></div><pre><code>Ciphered: 'ßåýåÚ\x9f\\\x9d'
Deciphered:  Hello wo
成功实现DES加密解密
</code></pre>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://blog.niuhemoon.win/tags/python/">Python</a></li>
      <li><a href="https://blog.niuhemoon.win/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/">密码学</a></li>
    </ul>
<div class="footer-comments">
  <p>For comments, please   <a href="mailto:carlton2tang@gmail.com" class="email-button" style="font-size: inherit; padding: 5px 10px; background-color: #3f6b9a; color: white; text-decoration: none; border-radius: 3px; transition: background-color 0.3s;">
    send an email
</a> to me</p>

</div>
<nav class="paginav">
  <a class="prev" href="https://blog.niuhemoon.win/posts/tech/wiringpi-gpio/">
    <span class="title">« 上一页</span>
    <br>
    <span>树莓派GPIO入门</span>
  </a>
  <a class="next" href="https://blog.niuhemoon.win/posts/tech/python-hash-experiment/">
    <span class="title">下一页 »</span>
    <br>
    <span>Python实现MD5和Sha256</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
      
    <span>&copy; 2024 <a href="https://blog.niuhemoon.win">Niuhe&#39;s Blog</a></span>
    <span xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/">
        Licensed under
        <a
          href="http://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1"
          target="_blank"
          rel="license noopener noreferrer"
          style="display:inline-block;"
          >CC BY-NC-SA 4.0 </a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '📄复制';

        function copyingDone() {
            copybutton.innerHTML = '👌🏻已复制!';
            setTimeout(() => {
                copybutton.innerHTML = '📄复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
